<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: renderer.ml (progress.src.progress.engine)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">progress</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; progress.engine &#x00BB; renderer.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>renderer.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">progress</a><ul><li>Library <code>progress</code><ul><li><a href="../../progress/Progress/index.html">Progress</a></li></ul></li><li>Library <code>progress.engine</code><ul><li><a href="../../progress.engine/Progress_engine/index.html">Progress_engine</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>progress<ul><li><a href="../progress/progress.ml.html">progress.ml</a></li><li><a href="../progress/progress__.ml.html">progress__.ml</a></li><li><a href="../progress/terminal_width.ml.html">terminal_width.ml</a></li></ul></li><li>progress.engine<ul><li><a href="config.ml.html">config.ml</a></li><li><a href="duration.ml.html">duration.ml</a></li><li><a href="flow_meter.ml.html">flow_meter.ml</a></li><li><a href="import.ml.html">import.ml</a></li><li><a href="integer.ml.html">integer.ml</a></li><li><a href="line.ml.html">line.ml</a></li><li><a href="line_buffer.ml.html">line_buffer.ml</a></li><li><a href="line_intf.ml.html">line_intf.ml</a></li><li><a href="line_primitives.ml.html">line_primitives.ml</a></li><li><a href="line_primitives_intf.ml.html">line_primitives_intf.ml</a></li><li><a href="multi.ml.html">multi.ml</a></li><li><a href="multi_intf.ml.html">multi_intf.ml</a></li><li><a href="platform.ml.html">platform.ml</a></li><li><a href="printer.ml.html">printer.ml</a></li><li><a href="progress_engine.ml.html">progress_engine.ml</a></li><li><a href="progress_engine__.ml.html">progress_engine__.ml</a></li><li><a href="progress_engine_intf.ml.html">progress_engine_intf.ml</a></li><li><a href="#" class="current_unit">renderer.ml</a></li><li><a href="renderer_intf.ml.html">renderer_intf.ml</a></li><li><a href="stdlib_ext.ml.html">stdlib_ext.ml</a></li><li><a href="units.ml.html">units.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
<a id="L496" class="source_line" href="#L496">496</a>
<a id="L497" class="source_line" href="#L497">497</a>
<a id="L498" class="source_line" href="#L498">498</a>
<a id="L499" class="source_line" href="#L499">499</a>
<a id="L500" class="source_line" href="#L500">500</a>
<a id="L501" class="source_line" href="#L501">501</a>
<a id="L502" class="source_line" href="#L502">502</a>
<a id="L503" class="source_line" href="#L503">503</a>
<a id="L504" class="source_line" href="#L504">504</a>
<a id="L505" class="source_line" href="#L505">505</a>
<a id="L506" class="source_line" href="#L506">506</a>
<a id="L507" class="source_line" href="#L507">507</a>
<a id="L508" class="source_line" href="#L508">508</a>
<a id="L509" class="source_line" href="#L509">509</a>
<a id="L510" class="source_line" href="#L510">510</a>
<a id="L511" class="source_line" href="#L511">511</a>
<a id="L512" class="source_line" href="#L512">512</a>
<a id="L513" class="source_line" href="#L513">513</a>
<a id="L514" class="source_line" href="#L514">514</a>
<a id="L515" class="source_line" href="#L515">515</a>
<a id="L516" class="source_line" href="#L516">516</a>
<a id="L517" class="source_line" href="#L517">517</a>
<a id="L518" class="source_line" href="#L518">518</a>
<a id="L519" class="source_line" href="#L519">519</a>
<a id="L520" class="source_line" href="#L520">520</a>
<a id="L521" class="source_line" href="#L521">521</a>
<a id="L522" class="source_line" href="#L522">522</a>
<a id="L523" class="source_line" href="#L523">523</a>
<a id="L524" class="source_line" href="#L524">524</a>
<a id="L525" class="source_line" href="#L525">525</a>
<a id="L526" class="source_line" href="#L526">526</a>
<a id="L527" class="source_line" href="#L527">527</a>
<a id="L528" class="source_line" href="#L528">528</a>
<a id="L529" class="source_line" href="#L529">529</a>
<a id="L530" class="source_line" href="#L530">530</a>
<a id="L531" class="source_line" href="#L531">531</a>
<a id="L532" class="source_line" href="#L532">532</a>
<a id="L533" class="source_line" href="#L533">533</a>
<a id="L534" class="source_line" href="#L534">534</a>
<a id="L535" class="source_line" href="#L535">535</a>
<a id="L536" class="source_line" href="#L536">536</a>
<a id="L537" class="source_line" href="#L537">537</a>
<a id="L538" class="source_line" href="#L538">538</a>
<a id="L539" class="source_line" href="#L539">539</a>
<a id="L540" class="source_line" href="#L540">540</a>
<a id="L541" class="source_line" href="#L541">541</a>
<a id="L542" class="source_line" href="#L542">542</a>
<a id="L543" class="source_line" href="#L543">543</a>
<a id="L544" class="source_line" href="#L544">544</a>
<a id="L545" class="source_line" href="#L545">545</a>
<a id="L546" class="source_line" href="#L546">546</a>
<a id="L547" class="source_line" href="#L547">547</a>
<a id="L548" class="source_line" href="#L548">548</a>
<a id="L549" class="source_line" href="#L549">549</a>
<a id="L550" class="source_line" href="#L550">550</a>
<a id="L551" class="source_line" href="#L551">551</a>
<a id="L552" class="source_line" href="#L552">552</a>
<a id="L553" class="source_line" href="#L553">553</a>
<a id="L554" class="source_line" href="#L554">554</a>
<a id="L555" class="source_line" href="#L555">555</a>
<a id="L556" class="source_line" href="#L556">556</a>
<a id="L557" class="source_line" href="#L557">557</a>
<a id="L558" class="source_line" href="#L558">558</a>
<a id="L559" class="source_line" href="#L559">559</a>
<a id="L560" class="source_line" href="#L560">560</a>
<a id="L561" class="source_line" href="#L561">561</a>
<a id="L562" class="source_line" href="#L562">562</a>
<a id="L563" class="source_line" href="#L563">563</a>
<a id="L564" class="source_line" href="#L564">564</a>
<a id="L565" class="source_line" href="#L565">565</a>
<a id="L566" class="source_line" href="#L566">566</a>
<a id="L567" class="source_line" href="#L567">567</a>
<a id="L568" class="source_line" href="#L568">568</a>
<a id="L569" class="source_line" href="#L569">569</a>
<a id="L570" class="source_line" href="#L570">570</a>
<a id="L571" class="source_line" href="#L571">571</a>
<a id="L572" class="source_line" href="#L572">572</a>
<a id="L573" class="source_line" href="#L573">573</a>
<a id="L574" class="source_line" href="#L574">574</a>
<a id="L575" class="source_line" href="#L575">575</a>
<a id="L576" class="source_line" href="#L576">576</a>
<a id="L577" class="source_line" href="#L577">577</a>
<a id="L578" class="source_line" href="#L578">578</a>
<a id="L579" class="source_line" href="#L579">579</a>
<a id="L580" class="source_line" href="#L580">580</a>
<a id="L581" class="source_line" href="#L581">581</a>
<a id="L582" class="source_line" href="#L582">582</a>
<a id="L583" class="source_line" href="#L583">583</a>
<a id="L584" class="source_line" href="#L584">584</a>
<a id="L585" class="source_line" href="#L585">585</a>
<a id="L586" class="source_line" href="#L586">586</a>
<a id="L587" class="source_line" href="#L587">587</a>
<a id="L588" class="source_line" href="#L588">588</a>
<a id="L589" class="source_line" href="#L589">589</a>
<a id="L590" class="source_line" href="#L590">590</a>
<a id="L591" class="source_line" href="#L591">591</a>
<a id="L592" class="source_line" href="#L592">592</a>
<a id="L593" class="source_line" href="#L593">593</a>
<a id="L594" class="source_line" href="#L594">594</a>
<a id="L595" class="source_line" href="#L595">595</a>
<a id="L596" class="source_line" href="#L596">596</a>
<a id="L597" class="source_line" href="#L597">597</a>
<a id="L598" class="source_line" href="#L598">598</a>
<a id="L599" class="source_line" href="#L599">599</a>
<a id="L600" class="source_line" href="#L600">600</a>
<a id="L601" class="source_line" href="#L601">601</a>
<a id="L602" class="source_line" href="#L602">602</a>
<a id="L603" class="source_line" href="#L603">603</a>
<a id="L604" class="source_line" href="#L604">604</a>
<a id="L605" class="source_line" href="#L605">605</a>
<a id="L606" class="source_line" href="#L606">606</a>
<a id="L607" class="source_line" href="#L607">607</a>
<a id="L608" class="source_line" href="#L608">608</a>
</code><code class="source_code"><span><span class="COMMENT">(*————————————————————————————————————————————————————————————————————————————
   Copyright (c) 2020–2021 Craig Ferguson &lt;me@craigfe.io&gt;
   Distributed under the MIT license. See terms at the end of this file.
  ————————————————————————————————————————————————————————————————————————————*)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** The core of the progress bar rendering logic. Consumes the {!Line} DSL and
    emits rendering functions that put {!Ansi} escape codes in the right places. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <a href="renderer_intf.ml.html"><span class="UIDENT">Renderer_intf</span></a><span class="EOL">
</span><span class="OPEN">open</span><span class="BANG">!</span> <a href="import.ml.html"><span class="UIDENT">Import</span></a><span class="EOL">
</span><span id="module-Bar_id"><span class="MODULE">module</span> <span class="UIDENT">Bar_id</span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Unique_id"><span class="UIDENT">Unique_id</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* TODO: this module should probably be inlined with the
   [Line_primitives.Compiled.t] types: since those values only ever correspond to
   exactly one [Bar_renderer], and both are responsible for state management. *)</span><span class="EOL">
</span><span id="module-Bar_renderer"><span class="MODULE">module</span> <span class="UIDENT">Bar_renderer</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span id="module-Bar_renderer.type-t"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Bar_renderer.type-contents"><span class="TYPE">type</span> <span class="LIDENT">contents</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_255"><span class="LIDENT">width</span> <span class="COLON">:</span> <span class="LIDENT">int</span><span class="SEMI">;</span></span> <span id="def_250"><span class="LIDENT">data</span> <span class="COLON">:</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Clean</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Dirty</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="RBRACKET">]</span></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-create"><span class="VAL">val</span> <span class="LIDENT">create</span> <span class="COLON">:</span> <a href="line_primitives.ml.html#type-t"><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-update"><span class="VAL">val</span> <span class="LIDENT">update</span> <span class="COLON">:</span> <span class="LIDENT">unconditional</span><span class="COLON">:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">contents</span></span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-report"><span class="VAL">val</span> <span class="LIDENT">report</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">contents</span></span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-tick"><span class="VAL">val</span> <span class="LIDENT">tick</span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">contents</span></span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-finalise"><span class="VAL">val</span> <span class="LIDENT">finalise</span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">contents</span></span><span class="EOL">
</span>  <span id="module-Bar_renderer.val-id"><span class="VAL">val</span> <span class="LIDENT">id</span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="EOL">
</span><span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Bar_renderer.type-t"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_230"><span class="LIDENT">line_buffer</span> <span class="COLON">:</span> <a href="line_buffer.ml.html#type-t"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_253"><span class="LIDENT">update</span> <span class="COLON">:</span> <span class="LIDENT">unconditional</span><span class="COLON">:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_240"><span class="LIDENT">report</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_254"><span class="LIDENT">finalise</span> <span class="COLON">:</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_243"><span class="LIDENT">tick</span> <span class="COLON">:</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_234"><span class="LIDENT">id</span> <span class="COLON">:</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_236"><span class="MUTABLE">mutable</span> <span class="LIDENT">finalised</span> <span class="COLON">:</span> <span class="LIDENT">bool</span></span><span class="EOL">
</span>    <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Bar_renderer.type-contents"><span class="TYPE">type</span> <span class="LIDENT">contents</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_231"><span class="LIDENT">width</span> <span class="COLON">:</span> <span class="LIDENT">int</span><span class="SEMI">;</span></span> <span id="def_246"><span class="LIDENT">data</span> <span class="COLON">:</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Clean</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Dirty</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="RBRACKET">]</span></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* TODO: get rid of all this boilerplate *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-create"><span class="LIDENT">create</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span><span class="DOT">.</span> <a href="line_primitives.ml.html#type-t"><span class="LIDENT">a</span> <span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">a</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>   <span class="FUN">fun</span> <span id="local_s_1"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_s_2"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span> <a href="line_primitives.ml.html#val-compile"><span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">compile</span></a> <a href="#local_s_1"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_line_buffer_3"><span class="LIDENT">line_buffer</span></span> <span class="EQUAL">=</span> <a href="line_buffer.ml.html#val-create"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="LABEL">~size:</span><span class="INT">80</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_report_4"><span class="LIDENT">report</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_report_5"><span class="LIDENT">report</span></span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Staged.val-prj"><span class="UIDENT">Staged</span><span class="DOT">.</span><span class="LIDENT">prj</span></a> <span class="LPAREN">(</span><a href="line_primitives.ml.html#val-report"><span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">report</span></a> <a href="#local_s_2"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_a_6"><span class="LIDENT">a</span></span> <span class="COLON">:</span> <span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_report_5"><span class="LIDENT">report</span></a> <a href="#local_line_buffer_3"><span class="LIDENT">line_buffer</span></a> <a href="#local_a_6"><span class="LIDENT">a</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_update_7"><span class="LIDENT">update</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">le<span id="module-Make.module-Bar_list.type-t.constructor-Zero"><span id="module-Bar_list.type-t.constructor-Zero">t</span></span></span> <span id="local_update_8"><span class="LIDENT">update</span></span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Staged.val-prj"><span class="UIDENT">Staged</span><span class="DOT">.</span><span class="LIDENT">prj</span></a> <span class="LPAREN">(</span><a href="line_primitives.ml.html#val-update"><span class="UIDENT">L<span id="module-Make.module-Bar_list.type-t.constructor-One"><span id="module-Bar_list.type-t.constructor-One">ine_primitives</span></span></span><span class="DOT">.</span><span class="LIDENT">update</span></a> <a href="#local_s_2"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FUN">fun</span> <span class="TILDE">~</span><span id="local_unconditional_9"><span class="LIDENT">uncondition<span id="module-Make.module-Bar_list.type-t.constructor-Many"><span id="module-Bar_list.type-t.constructor-Many">al</span></span></span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_update_8"><span class="LIDENT">update</span></a> <a href="#local_line_buffer_3"><span class="LIDENT">line_buffer</span></a> <span class="TILDE">~</span><a href="#local_unconditional_9"><span class="LIDENT">unconditional</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_finalise_10"><span class="LIDENT">finali<span id="module-Make.module-Bar_list.type-t.constructor-Plus"><span id="module-Bar_list.type-t.constructor-Plus">se</span></span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_finalise_11"><span class="LIDENT">finalise</span></span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Staged.val-prj"><span class="UIDENT">Staged</span><span class="DOT">.</span><span class="LIDENT">prj</span></a> <span class="LPAREN">(</span><a href="line_primitives.ml.html#val-finalise"><span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">finalise</span></a> <a href="#local_s_2"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_finalise_11"><span class="LIDENT">finalise</span></a> <a href="#local_line_buffer_3"><span class="LIDENT">line_buffer</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_tick_12"><span class="LIDENT">tick</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_tick_13"><span class="LIDENT">tick</span></span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Staged.val-prj"><span class="UIDENT">Staged</span><span class="DOT">.</span><span class="LIDENT">prj</span></a> <span class="LPAREN">(</span><a href="line_primitives.ml.html#val-tick"><span class="UIDENT">Line_primitives</span><span class="DOT">.</span><span class="LIDENT">tick</span></a> <a href="#local_s_2"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_tick_13"><span class="LIDENT">tick</span></a> <a href="#local_line_buffer_3"><span class="LIDENT">line_buffer</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_id_14"><span class="LIDENT">id</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_line_buffer_3"><span class="LIDENT">line_buffer</span></a><span class="SEMI">;</span> <a href="#local_report_4"><span class="LIDENT">report</span></a><span class="SEMI">;</span> <a href="#local_update_7"><span class="LIDENT">update</span></a><span class="SEMI">;</span> <a href="#local_finalise_10"><span class="LIDENT">finalise</span></a><span class="SEMI">;</span> <a href="#local_tick_12"><span class="LIDENT">tick</span></a><span class="SEMI">;</span> <a href="#local_id_14"><span class="LIDENT">id</span></a><span class="SEMI">;</span> <span class="LIDENT">finalised</span> <span class="EQUAL">=</span> <span class="FALSE">false</span> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-finalise"><span class="LIDENT">finalise</span></span> <span id="local_t_15"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_width_16"><span class="LIDENT">width</span></span> <span class="EQUAL">=</span> <a href="#local_t_15"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">finalise</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_data_17"><span class="LIDENT">data</span></span> <span class="EQUAL">=</span> <a href="line_buffer.ml.html#val-contents"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_t_15"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">line_buffer</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_t_15"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">finalised</span> <span class="LESSMINUS">&lt;-</span> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_width_16"><span class="LIDENT">width</span></a><span class="SEMI">;</span> <a href="#local_data_17"><span class="LIDENT">data</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-tick"><span class="LIDENT">tick</span></span> <span id="local_t_18"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_t_18"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">finalised</span> <span class="THEN">then</span> <span class="LIDENT">finalise</span> <a href="#local_t_18"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_width_19"><span class="LIDENT">width</span></span> <span class="EQUAL">=</span> <a href="#local_t_18"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">tick</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_data_20"><span class="LIDENT">data</span></span> <span class="EQUAL">=</span> <a href="line_buffer.ml.html#val-contents"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_t_18"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">line_buffer</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <a href="#local_width_19"><span class="LIDENT">width</span></a><span class="SEMI">;</span> <a href="#local_data_20"><span class="LIDENT">data</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-update"><span class="LIDENT">update</span></span> <span class="TILDE">~</span><span id="local_unconditional_21"><span class="LIDENT">unconditional</span></span> <span id="local_t_22"><span class="LIDENT">t</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* We continue to render even once the bar has been finalised in order to
       account for terminal width changes. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">finalised</span> <span class="THEN">then</span> <span class="LIDENT">finalise</span> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_width_23"><span class="LIDENT">width</span></span> <span class="EQUAL">=</span> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">update</span> <span class="TILDE">~</span><a href="#local_unconditional_21"><span class="LIDENT">unconditional</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_data_24"><span class="LIDENT">data</span></span> <span class="EQUAL">=</span> <a href="line_buffer.ml.html#val-contents"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">line_buffer</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <a href="#local_width_23"><span class="LIDENT">width</span></a><span class="SEMI">;</span> <a href="#local_data_24"><span class="LIDENT">data</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-report"><span class="LIDENT">report</span></span> <span id="local_t_25"><span class="LIDENT">t</span></span> <span id="local_x_26"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_t_25"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">finalised</span> <span class="THEN">then</span> <span class="LIDENT">finalise</span> <a href="#local_t_25"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_width_27"><span class="LIDENT">width</span></span> <span class="EQUAL">=</span> <a href="#local_t_25"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">report</span> <a href="#local_x_26"><span class="LIDENT">x</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_data_28"><span class="LIDENT">data</span></span> <span class="EQUAL">=</span> <a href="line_buffer.ml.html#val-contents"><span class="UIDENT">Line_buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_t_25"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">line_buffer</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <a href="#local_width_27"><span class="LIDENT">width</span></a><span class="SEMI">;</span> <a href="#local_data_28"><span class="LIDENT">data</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Bar_renderer.val-id"><span class="LIDENT">id</span></span> <span id="local_t_29"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_29"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">id</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Bar_list"><span class="MODULE">module</span> <span class="UIDENT">Bar_list</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <a href="multi_intf.ml.html#module-Hlist"><span class="UIDENT">Multi</span><span class="DOT">.</span><span class="UIDENT">Hlist</span></a> <span class="LPAREN">(</span><span class="UIDENT">Bar_renderer</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Display"><span class="MODULE">module</span> <span class="UIDENT">Display</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span id="module-Display.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Display.module-Unique_id"><span class="MODULE">module</span> <span class="UIDENT">Unique_id</span> <span class="COLON">:</span> <a href="stdlib_ext.ml.html#module-type-Eq"><span class="UIDENT">Eq</span></a></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Display.val-create"><span class="VAL">val</span> <span class="LIDENT">create</span> <span class="COLON">:</span> <span class="LIDENT">config</span><span class="COLON">:</span><a href="config.ml.html#type-t"><span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Initialise a display with a given set of bar renderers. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Immutable state *)</span><span class="EOL">
</span>  <span id="module-Display.val-uid"><span class="VAL">val</span> <span class="LIDENT">uid</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="module-Display.val-config"><span class="VAL">val</span> <span class="LIDENT">config</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="config.ml.html#type-t"><span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Lifecycle management *)</span><span class="EOL">
</span>  <span id="module-Display.val-initial_render"><span class="VAL">val</span> <span class="LIDENT">initial_render</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-tick"><span class="VAL">val</span> <span class="LIDENT">tick</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-handle_width_change"><span class="VAL">val</span> <span class="LIDENT">handle_width_change</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-pause"><span class="VAL">val</span> <span class="LIDENT">pause</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-resume"><span class="VAL">val</span> <span class="LIDENT">resume</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-interject_with"><span class="VAL">val</span> <span class="LIDENT">interject_with</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span><span class="EOL">
</span>  <span id="module-Display.val-cleanup"><span class="VAL">val</span> <span class="LIDENT">cleanup</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-finalise"><span class="VAL">val</span> <span class="LIDENT">finalise</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Bar-specific functions *)</span><span class="EOL">
</span>  <span id="module-Display.val-add_line"><span class="VAL">val</span> <span class="LIDENT">add_line</span> <span class="COLON">:</span> <span class="OPTLABEL">?above:</span><span class="LIDENT">int</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UNDERSCORE">_</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-remove_line"><span class="VAL">val</span> <span class="LIDENT">remove_line</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-rerender_line"><span class="VAL">val</span> <span class="LIDENT">rerender_line</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">contents</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-Display.val-finalise_line"><span class="VAL">val</span> <span class="LIDENT">finalise_line</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span><span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Display.module-Unique_id"><span class="MODULE">module</span> <span class="UIDENT">Unique_id</span> <span class="EQUAL">=</span> <a href="stdlib_ext.ml.html#module-Unique_id"><span class="UIDENT">Unique_id</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Display.type-some_bar"><span class="TYPE">type</span> <span class="LIDENT">some_bar</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span id="module-Display.type-some_bar.constructor-E"><span class="BAR">|</span> <span class="UIDENT">E</span> <span class="COLON">:</span><span class="EOL">
</span>        <span class="LBRACE">{</span> <span id="def_252"><span class="LIDENT">renderer</span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>        <span class="SEMI">;</span></span> <span id="def_238"><span class="MUTABLE">mutable</span> <span class="LIDENT">latest_width</span> <span class="COLON">:</span> <span class="LIDENT">int</span><span class="EOL">
</span>        <span class="SEMI">;</span></span> <span id="def_235"><span class="MUTABLE">mutable</span> <span class="LIDENT">position</span> <span class="COLON">:</span> <span class="LIDENT">int</span></span><span class="EOL">
</span>        <span class="RBRACE">}</span><span class="EOL">
</span>        <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">some_bar</span></span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Display.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_248"><span class="LIDENT">config</span> <span class="COLON">:</span> <a href="config.ml.html#type-t"><span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_242"><span class="LIDENT">uid</span> <span class="COLON">:</span> <span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_232"><span class="LIDENT">bars</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="COMMA">,</span> <span class="LIDENT">some_bar</span><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_229"><span class="LIDENT">rows</span> <span class="COLON">:</span> <a href="../../../vector/src/vector/vector.ml.html#type-t"><span class="LIDENT">some_bar</span> <span class="LIDENT">option</span> <span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span>    <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-config"><span class="LIDENT">config</span></span> <span id="local_t_30"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_30"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-create"><span class="LIDENT">create</span></span> <span class="TILDE">~</span><span id="local_config_31"><span class="LIDENT">config</span></span> <span id="local_bars_32"><span class="LIDENT">bars</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_uid_33"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_rows_34"><span class="LIDENT">rows</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_f_35"><span class="LIDENT">f</span></span> <span id="local_i_36"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_renderer_37"><span class="LIDENT">renderer</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span class="LBRACE">{</span> <a href="#local_renderer_37"><span class="LIDENT">renderer</span></a><span class="SEMI">;</span> <span class="LIDENT">latest_width</span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="SEMI">;</span> <span class="LIDENT">position</span> <span class="EQUAL">=</span> <a href="#local_i_36"><span class="LIDENT">i</span></a> <span class="RBRACE">}</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">mapi</span> <a href="#local_bars_32"><span class="LIDENT">bars</span></a> <span class="LABEL">~f:</span><span class="LBRACE">{</span> <a href="#local_f_35"><span class="LIDENT">f</span></a> <span class="RBRACE">}</span> <span class="INFIXOP0">|&gt;</span> <a href="../../../vector/src/vector/vector.ml.html#val-of_list"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">of_list</span></a> <span class="LABEL">~dummy:</span><span class="UIDENT">None</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_bar_count_38"><span class="LIDENT">bar_count</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_bars_32"><span class="LIDENT">bars</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_bars_39"><span class="LIDENT">bars</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <a href="#local_bar_count_38"><span class="LIDENT">bar_count</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-iter"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <a href="#local_rows_34"><span class="LIDENT">rows</span></a><span class="EOL">
</span>      <span class="LABEL">~f:</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/option.ml.html#val-iter"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span class="LBRACE">{</span> <span id="local_renderer_41"><span class="LIDENT">renderer</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_t_40"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>             <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_bars_39"><span class="LIDENT">bars</span></a> <span class="LABEL">~key:</span><span class="LPAREN">(</span><span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_renderer_41"><span class="LIDENT">renderer</span></a><span class="RPAREN">)</span> <span class="LABEL">~data:</span><a href="#local_t_40"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_config_31"><span class="LIDENT">config</span></a><span class="SEMI">;</span> <a href="#local_uid_33"><span class="LIDENT">uid</span></a><span class="SEMI">;</span> <a href="#local_bars_39"><span class="LIDENT">bars</span></a><span class="SEMI">;</span> <a href="#local_rows_34"><span class="LIDENT">rows</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-uid"><span class="LIDENT">uid</span></span> <span class="LBRACE">{</span> <span id="local_uid_42"><span class="LIDENT">uid</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="EQUAL">=</span> <a href="#local_uid_42"><span class="LIDENT">uid</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Terminals generally don't wrap blank suffixes of lines (e.g. [&quot; \n&quot;] is
     equivalent to [&quot;\n&quot;]), so we should account for this when estimating the
     width at which a given line will be wrapped. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-get_blank_suffix_length"><span class="LIDENT">get_blank_suffix_length</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_43"><span class="LIDENT">aux</span></span> <span id="local_str_44"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="MINUS">-</span><span class="INT">1</span> <span class="MINUSGREATER">-&gt;</span> <span class="MINUS">-</span><span class="INT">1</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_i_45"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span> <span class="MATCH">match</span> <a href="#local_str_44"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_45"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="WITH">with</span> <span class="CHAR">' '</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_aux_43"><span class="LIDENT">aux</span></a> <a href="#local_str_44"><span class="LIDENT">str</span></a> <span class="LPAREN">(</span><a href="#local_i_45"><span class="LIDENT">i</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_i_45"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="FUN">fun</span> <span id="local_str_46"><span class="LIDENT">str</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_last_index_47"><span class="LIDENT">last_index</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_str_46"><span class="LIDENT">str</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_last_index_47"><span class="LIDENT">last_index</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_aux_43"><span class="LIDENT">aux</span></a> <a href="#local_str_46"><span class="LIDENT">str</span></a> <a href="#local_last_index_47"><span class="LIDENT">last_index</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-rerender_line_and_advance"><span class="LIDENT">rerender_line_and_advance</span></span> <span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_48"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_49"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span id="local_new_width_50"><span class="LIDENT">new_width</span></span><span class="EOL">
</span>      <span id="local_data_51"><span class="LIDENT">data</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_old_width_52"><span class="LIDENT">old_width</span></span> <span class="EQUAL">=</span> <a href="#local_bar_49"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">latest_width</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_bar_49"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">latest_width</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_new_width_50"><span class="LIDENT">new_width</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="LIDENT">get_blank_suffix_length</span> <a href="#local_data_51"><span class="LIDENT">data</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_ppf_48"><span class="LIDENT">ppf</span></a> <a href="#local_data_51"><span class="LIDENT">data</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_new_width_50"><span class="LIDENT">new_width</span></a> <a href="stdlib_ext.ml.html#module-Poly.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_old_width_52"><span class="LIDENT">old_width</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_ppf_48"><span class="LIDENT">ppf</span></a> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_line"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_line</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-rerender_all_from_top"><span class="LIDENT">rerender_all_from_top</span></span> <span class="TILDE">~</span><span id="local_stage_53"><span class="LIDENT">stage</span></span> <span class="TILDE">~</span><span id="local_starting_at_54"><span class="LIDENT">starting_at</span></span> <span class="TILDE">~</span><span id="local_unconditional_55"><span class="LIDENT">unconditional</span></span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_57"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_rows_58"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_t_56"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_total_rows_59"><span class="LIDENT">total_rows</span></span> <span class="EQUAL">=</span> <a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_58"><span class="LIDENT">rows</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-iteri_from"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">iteri_from</span></a> <a href="#local_starting_at_54"><span class="LIDENT">starting_at</span></a> <a href="#local_rows_58"><span class="LIDENT">rows</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_idx_60"><span class="LIDENT">idx</span></span> <span id="local_slot_61"><span class="LIDENT">slot</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_is_last_62"><span class="LIDENT">is_last</span></span> <span class="EQUAL">=</span> <a href="#local_idx_60"><span class="LIDENT">idx</span></a> <a href="stdlib_ext.ml.html#module-Poly.val-(=)"><span class="EQUAL">=</span></a> <a href="#local_total_rows_59"><span class="LIDENT">total_rows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_slot_61"><span class="LIDENT">slot</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_57"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%s&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_line"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_line</span></a><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_63"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>              <span class="LET">let</span> <span class="LPAREN">(</span><span id="def_239"><span class="LBRACE">{</span> <span id="local_width_64"><span class="LIDENT">width</span></span><span class="SEMI">;</span> <span id="local_data_65"><span class="LIDENT">data</span></span> <span class="RBRACE">}</span></span> <span class="COLON">:</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">contents</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>                <span class="MATCH">match</span> <a href="#local_stage_53"><span class="LIDENT">stage</span></a> <span class="WITH">with</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">update</span> <span class="TILDE">~</span><a href="#local_unconditional_55"><span class="LIDENT">unconditional</span></a> <a href="#local_bar_63"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">renderer</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">tick</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">tick</span> <a href="#local_bar_63"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">renderer</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalise</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">finalise</span> <a href="#local_bar_63"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">renderer</span><span class="EOL">
</span>              <span class="IN">in</span><span class="EOL">
</span>              <span class="MATCH">match</span> <a href="#local_data_65"><span class="LIDENT">data</span></a> <span class="WITH">with</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Clean</span> <span class="UNDERSCORE">_</span> <span class="WHEN">when</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <a href="#local_unconditional_55"><span class="LIDENT">unconditional</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Clean</span> <span id="local_contents_66"><span class="LIDENT">contents</span></span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Dirty</span> <span id="local_contents_67"><span class="LIDENT">contents</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                  <span class="LIDENT">rerender_line_and_advance</span> <a href="#local_t_56"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span> <a href="#local_bar_63"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span> <a href="#local_width_64"><span class="LIDENT">width</span></a> <a href="#local_contents_67"><span class="LIDENT">contents</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_is_last_62"><span class="LIDENT">is_last</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="FALSE">false</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_force_newline"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_force_newline</span></a> <a href="#local_ppf_57"><span class="LIDENT">ppf</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="TRUE">true</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_57"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;\r%!&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-initial_render"><span class="LIDENT">initial_render</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="LABEL">~starting_at:</span><span class="INT">0</span> <span class="LABEL">~unconditional:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-get_bar_exn"><span class="LIDENT">get_bar_exn</span></span> <span class="TILDE">~</span><span id="local_msg_68"><span class="LIDENT">msg</span></span> <span id="local_bars_69"><span class="LIDENT">bars</span></span> <span id="local_uid_70"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="EXCEPTION">exception</span> <span id="def_251"><span class="UIDENT">Finalised</span> <span class="OF">of</span> <span class="LIDENT">string</span></span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <a href="#local_bars_69"><span class="LIDENT">bars</span></a> <a href="#local_uid_70"><span class="LIDENT">uid</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_x_71"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_71"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="EXCEPTION">exception</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Finalised</span> <a href="#local_msg_68"><span class="LIDENT">msg</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-rerender_line"><span class="LIDENT">rerender_line</span></span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_73"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_bars_74"><span class="LIDENT">bars</span></span><span class="SEMI">;</span> <span id="local_rows_75"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_t_72"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span id="local_uid_76"><span class="LIDENT">uid</span></span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="LBRACE">{</span> <span id="local_width_77"><span class="LIDENT">width</span></span><span class="SEMI">;</span> <span id="local_data_78"><span class="LIDENT">data</span></span> <span class="RBRACE">}</span> <span class="COLON">:</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">contents</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_79"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LIDENT">get_bar_exn</span> <span class="LABEL">~msg:</span><span class="STRING">&quot;Can't render to finalised bar&quot;</span> <a href="#local_bars_74"><span class="LIDENT">bars</span></a> <a href="#local_uid_76"><span class="LIDENT">uid</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_data_78"><span class="LIDENT">data</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Clean</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Dirty</span> <span id="local_data_80"><span class="LIDENT">data</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_distance_from_base_81"><span class="LIDENT">distance_from_base</span></span> <span class="EQUAL">=</span> <a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_75"><span class="LIDENT">rows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_bar_79"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">position</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>        <span class="COMMENT">(* NOTE: we add an initial carriage return to avoid overflowing the line if
           the user has typed into the terminal between renders. *)</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_73"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;\r%a&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_distance_from_base_81"><span class="LIDENT">distance_from_base</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">rerender_line_and_advance</span> <a href="#local_t_72"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span> <a href="#local_bar_79"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span> <a href="#local_width_77"><span class="LIDENT">width</span></a> <a href="#local_data_80"><span class="LIDENT">data</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_73"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%a\r%!&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_down"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_down</span></a> <a href="#local_distance_from_base_81"><span class="LIDENT">distance_from_base</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-finalise_line"><span class="LIDENT">finalise_line</span></span> <span id="local_t_82"><span class="LIDENT">t</span></span> <span id="local_uid_83"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_84"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LIDENT">get_bar_exn</span> <span class="LABEL">~msg:</span><span class="STRING">&quot;Bar already finalised&quot;</span> <a href="#local_t_82"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <a href="#local_uid_83"><span class="LIDENT">uid</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_contents_85"><span class="LIDENT">contents</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">finalise</span> <a href="#local_bar_84"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">renderer</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">rerender_line</span> <a href="#local_t_82"><span class="LIDENT">t</span></a> <a href="#local_uid_83"><span class="LIDENT">uid</span></a> <a href="#local_contents_85"><span class="LIDENT">contents</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-remove"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">remove</span></a> <a href="#local_t_82"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <a href="#local_uid_83"><span class="LIDENT">uid</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-add_line"><span class="LIDENT">add_line</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_above_86"><span class="LIDENT">above</span></span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="RPAREN">)</span> <span id="local_t_87"><span class="LIDENT">t</span></span> <span id="local_renderer_88"><span class="LIDENT">renderer</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_position_89"><span class="LIDENT">position</span></span> <span class="EQUAL">=</span> <a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_above_86"><span class="LIDENT">above</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_key_90"><span class="LIDENT">key</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_renderer_88"><span class="LIDENT">renderer</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_bar_91"><span class="LIDENT">bar</span></span> <span class="EQUAL">=</span> <span class="UIDENT">E</span> <span class="LBRACE">{</span> <a href="#local_renderer_88"><span class="LIDENT">renderer</span></a><span class="SEMI">;</span> <span class="LIDENT">latest_width</span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="SEMI">;</span> <a href="#local_position_89"><span class="LIDENT">position</span></a> <span class="RBRACE">}</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <span class="TILDE">~</span><a href="#local_key_90"><span class="LIDENT">key</span></a> <span class="LABEL">~data:</span><a href="#local_bar_91"><span class="LIDENT">bar</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-insert"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">insert</span></a> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <a href="#local_position_89"><span class="LIDENT">position</span></a> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_bar_91"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-iteri_from"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">iteri_from</span></a> <span class="LPAREN">(</span><a href="#local_position_89"><span class="LIDENT">position</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_92"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_93"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_bar_93"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">position</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_i_92"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* The cursor is now one line above the bottom. Move to the correct starting
       position for a re-render of the affected suffix of the display. *)</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_force_newline"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_force_newline</span></a> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="DOT">.</span><span class="LIDENT">ppf</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="DOT">.</span><span class="LIDENT">ppf</span> <a href="#local_above_86"><span class="LIDENT">above</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="LABEL">~starting_at:</span><a href="#local_position_89"><span class="LIDENT">position</span></a><span class="EOL">
</span>      <span class="LABEL">~unconditional:</span><span class="TRUE">true</span> <a href="#local_t_87"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-remove_line"><span class="LIDENT">remove_line</span></span> <span id="local_t_94"><span class="LIDENT">t</span></span> <span id="local_key_95"><span class="LIDENT">key</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span class="LBRACE">{</span> <span id="local_position_100"><span class="LIDENT">position</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find_opt"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find_opt</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <a href="#local_key_95"><span class="LIDENT">key</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_bar_96"><span class="LIDENT">bar</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_bar_96"><span class="LIDENT">bar</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="COMMENT">(* This can either mean that the line has already been finalised, or
             that this key is unknown. *)</span><span class="EOL">
</span>          <span class="MATCH">match</span><span class="EOL">
</span>            <a href="import.ml.html#module-Vector.val-find_map"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">find_map</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUNCTION">function</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_98"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="AS">as</span> <span id="local_some_bar_97"><span class="LIDENT">some_bar</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                  <span class="IF">if</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_key_95"><span class="LIDENT">key</span></a> <span class="LPAREN">(</span><span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_bar_98"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">renderer</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>                    <a href="#local_some_bar_97"><span class="LIDENT">some_bar</span></a><span class="EOL">
</span>                  <span class="ELSE">else</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_bar_99"><span class="LIDENT">bar</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_bar_99"><span class="LIDENT">bar</span></a><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;No such line in display&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-mem"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">mem</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <a href="#local_key_95"><span class="LIDENT">key</span></a> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-remove"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">remove</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">bars</span> <a href="#local_key_95"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-remove"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">remove</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <a href="#local_position_100"><span class="LIDENT">position</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="import.ml.html#module-Vector.val-iteri_from"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">iteri_from</span></a> <a href="#local_position_100"><span class="LIDENT">position</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_101"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_bar_102"><span class="LIDENT">bar</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_bar_102"><span class="LIDENT">bar</span></a><span class="DOT">.</span><span class="LIDENT">position</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_i_101"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* The cursor is now one line below the bottom. Move to the correct starting
       position for a re-render of the affected suffix of the display. *)</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="DOT">.</span><span class="LIDENT">ppf</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_display_suffix"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_display_suffix</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="DOT">.</span><span class="LIDENT">ppf</span> <span class="INT">1</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">config</span><span class="DOT">.</span><span class="LIDENT">ppf</span> <span class="LPAREN">(</span><a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">rows</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_position_100"><span class="LIDENT">position</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="LABEL">~starting_at:</span><a href="#local_position_100"><span class="LIDENT">position</span></a><span class="EOL">
</span>      <span class="LABEL">~unconditional:</span><span class="TRUE">true</span> <a href="#local_t_94"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-ceil_div"><span class="LIDENT">ceil_div</span></span> <span id="local_x_103"><span class="LIDENT">x</span></span> <span id="local_y_104"><span class="LIDENT">y</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="#local_x_103"><span class="LIDENT">x</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_y_104"><span class="LIDENT">y</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(/)"><span class="INFIXOP3">/</span></a> <a href="#local_y_104"><span class="LIDENT">y</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-overflow_rows"><span class="LIDENT">overflow_rows</span></span> <span class="TILDE">~</span><span id="local_old_width_105"><span class="LIDENT">old_width</span></span> <span class="TILDE">~</span><span id="local_new_width_106"><span class="LIDENT">new_width</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="stdlib_ext.ml.html#local_max_9"><span class="LIDENT">max</span></a> <span class="INT">0</span> <span class="LPAREN">(</span><span class="LIDENT">ceil_div</span> <a href="#local_old_width_105"><span class="LIDENT">old_width</span></a> <a href="#local_new_width_106"><span class="LIDENT">new_width</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-handle_width_change"><span class="LIDENT">handle_width_change</span></span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_108"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_rows_109"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_display_107"><span class="LIDENT">display</span></span><span class="RPAREN">)</span><span class="EOL">
</span>      <span id="local_new_width_110"><span class="LIDENT">new_width</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_row_count_111"><span class="LIDENT">row_count</span></span> <span class="EQUAL">=</span> <a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_109"><span class="LIDENT">rows</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_latest_widths_112"><span class="LIDENT">latest_widths</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-init"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">init</span></a> <a href="#local_row_count_111"><span class="LIDENT">row_count</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_113"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="import.ml.html#module-Vector.val-get_exn"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">get_exn</span></a> <a href="#local_rows_109"><span class="LIDENT">rows</span></a> <a href="#local_i_113"><span class="LIDENT">i</span></a><span class="EOL">
</span>          <span class="INFIXOP0">|&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/option.ml.html#val-fold"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">fold</span></a> <span class="LABEL">~none:</span><span class="INT">0</span> <span class="LABEL">~some:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UIDENT">E</span> <span id="local_t_114"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_t_114"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">latest_width</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_overflows_115"><span class="LIDENT">overflows</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-fold_left"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <a href="#local_latest_widths_112"><span class="LIDENT">latest_widths</span></a> <span class="LABEL">~init:</span><span class="INT">0</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_a_116"><span class="LIDENT">a</span></span> <span id="local_old_width_117"><span class="LIDENT">old_width</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_a_116"><span class="LIDENT">a</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="LIDENT">overflow_rows</span> <span class="TILDE">~</span><a href="#local_old_width_117"><span class="LIDENT">old_width</span></a> <span class="TILDE">~</span><a href="#local_new_width_110"><span class="LIDENT">new_width</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_bottom_overflow_118"><span class="LIDENT">bottom_overflow</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LIDENT">overflow_rows</span> <span class="LABEL">~old_width:</span><a href="#local_latest_widths_112"><span class="LIDENT">latest_widths</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_row_count_111"><span class="LIDENT">row_count</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_new_width_110"><span class="LIDENT">new_width</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_move_up_119"><span class="LIDENT">move_up</span></span> <span class="EQUAL">=</span> <a href="#local_overflows_115"><span class="LIDENT">overflows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_row_count_111"><span class="LIDENT">row_count</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_bottom_overflow_118"><span class="LIDENT">bottom_overflow</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_ppf_108"><span class="LIDENT">ppf</span></a> <a href="#local_move_up_119"><span class="LIDENT">move_up</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_overflows_115"><span class="LIDENT">overflows</span></a> <a href="stdlib_ext.ml.html#module-Poly.val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span> <span class="THEN">then</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_ppf_108"><span class="LIDENT">ppf</span></a> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_display_suffix"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_display_suffix</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="LABEL">~starting_at:</span><span class="INT">0</span> <span class="LABEL">~unconditional:</span><span class="TRUE">true</span><span class="EOL">
</span>      <a href="#local_display_107"><span class="LIDENT">display</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-tick"><span class="LIDENT">tick</span></span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_121"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_rows_122"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_t_120"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_ppf_121"><span class="LIDENT">ppf</span></a> <span class="LPAREN">(</span><a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_122"><span class="LIDENT">rows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">tick</span> <span class="LABEL">~starting_at:</span><span class="INT">0</span> <span class="LABEL">~unconditional:</span><span class="FALSE">false</span> <a href="#local_t_120"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-pause"><span class="LIDENT">pause</span></span> <span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_123"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_rows_124"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_123"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%s%!&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_line"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_line</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="FOR">for</span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="INT">1</span> <span class="TO">to</span> <a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_124"><span class="LIDENT">rows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_123"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%a%s%!&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <span class="INT">1</span><span class="EOL">
</span>        <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_line"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_line</span></a><span class="EOL">
</span>    <span class="DONE">done</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-resume"><span class="LIDENT">resume</span></span> <span id="local_t_125"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">update</span> <span class="LABEL">~starting_at:</span><span class="INT">0</span> <span class="LABEL">~unconditional:</span><span class="TRUE">true</span> <a href="#local_t_125"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-interject_with"><span class="LIDENT">interject_with</span></span> <span id="local_t_126"><span class="LIDENT">t</span></span> <span id="local_f_127"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">pause</span> <a href="#local_t_126"><span class="LIDENT">t</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/fun.ml.html#val-protect"><span class="UIDENT">Fun</span><span class="DOT">.</span><span class="LIDENT">protect</span></a> <a href="#local_f_127"><span class="LIDENT">f</span></a> <span class="LABEL">~finally:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">resume</span> <a href="#local_t_126"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-cleanup"><span class="LIDENT">cleanup</span></span> <span class="LBRACE">{</span> <span id="local_config_128"><span class="LIDENT">config</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_config_128"><span class="LIDENT">config</span></a><span class="DOT">.</span><span class="LIDENT">hide_cursor</span> <span class="THEN">then</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_config_128"><span class="LIDENT">config</span></a><span class="DOT">.</span><span class="LIDENT">ppf</span> <span class="STRING">&quot;\n%s%!&quot;</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-show_cursor"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">show_cursor</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Display.val-finalise"><span class="LIDENT">finalise</span></span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">config</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="local_ppf_130"><span class="LIDENT">ppf</span></span><span class="SEMI">;</span> <span id="local_hide_cursor_131"><span class="LIDENT">hide_cursor</span></span><span class="SEMI">;</span> <span id="local_persistent_132"><span class="LIDENT">persistent</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="SEMI">;</span> <span id="local_rows_133"><span class="LIDENT">rows</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_display_129"><span class="LIDENT">display</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-move_up"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">move_up</span></a> <a href="#local_ppf_130"><span class="LIDENT">ppf</span></a> <span class="LPAREN">(</span><a href="../../../vector/src/vector/vector.ml.html#val-length"><span class="UIDENT">Vector</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_rows_133"><span class="LIDENT">rows</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_persistent_132"><span class="LIDENT">persistent</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LIDENT">rerender_all_from_top</span> <span class="LABEL">~stage:</span><span class="BACKQUOTE">`</span><span class="LIDENT">finalise</span> <span class="LABEL">~starting_at:</span><span class="INT">0</span> <span class="LABEL">~unconditional:</span><span class="TRUE">true</span><span class="EOL">
</span>        <a href="#local_display_129"><span class="LIDENT">display</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_130"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;@,@]&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_ppf_130"><span class="LIDENT">ppf</span></a> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-erase_display_suffix"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">erase_display_suffix</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_130"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%s%!&quot;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_hide_cursor_131"><span class="LIDENT">hide_cursor</span></a> <span class="THEN">then</span> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-show_cursor"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">show_cursor</span></a> <span class="ELSE">else</span> <span class="STRING">&quot;&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Reporter"><span class="MODULE">module</span> <span class="UIDENT">Reporter</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Reporter.type-t"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_256"><span class="LIDENT">uid</span> <span class="COLON">:</span> <span class="UIDENT">Bar_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_241"><span class="LIDENT">display</span> <span class="COLON">:</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_237"><span class="LIDENT">update</span> <span class="COLON">:</span> <span class="LIDENT">unconditional</span><span class="COLON">:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_247"><span class="LIDENT">report</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>    <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Reporter.val-report"><span class="LIDENT">report</span></span> <span id="local_t_134"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_134"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">report</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Reporter.type-list"><span class="TYPE">type</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span id="module-Make.module-Reporter.type-list.constructor-[]"><span id="module-Reporter.type-list.constructor-[]"><span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LIDENT">list</span></span></span><span class="EOL">
</span>    <span id="module-Make.module-Reporter.type-list.constructor-::"><span id="module-Reporter.type-list.constructor-::"><span class="BAR">|</span> <span class="LPAREN">(</span> <span class="COLONCOLON">::</span> <span class="RPAREN">)</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">b</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">list</span></span></span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Make"><span class="MODULE">module</span> <span class="UIDENT">Make</span> <span class="LPAREN">(</span><span class="UIDENT">Platform</span> <span class="COLON">:</span> <a href="platform.ml.html#module-type-S"><span class="UIDENT">Platform</span><span class="DOT">.</span><span class="UIDENT">S</span></a><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Make.module-Config"><span class="MODULE">module</span> <span class="UIDENT">Config</span> <span class="EQUAL">=</span> <a href="config.ml.html"><span class="UIDENT">Config</span></a></span><span class="EOL">
</span>  <span id="module-Make.module-Line"><span class="MODULE">module</span> <span class="UIDENT">Line</span> <span class="EQUAL">=</span> <a href="line.ml.html#module-Make"><span class="UIDENT">Line</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">Platform</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Global"><span class="MODULE">module</span> <span class="UIDENT">Global</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>    <span id="module-Make.module-Global.val-active_display"><span class="VAL">val</span> <span class="LIDENT">active_display</span> <span class="COLON">:</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span></span><span class="EOL">
</span>    <span id="module-Make.module-Global.val-find_display"><span class="VAL">val</span> <span class="LIDENT">find_display</span> <span class="COLON">:</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#type-result"><span class="LPAREN">(</span><span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="COMMA">,</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="LIDENT">result</span></a></span><span class="EOL">
</span>    <span id="module-Make.module-Global.val-set_active_exn"><span class="VAL">val</span> <span class="LIDENT">set_active_exn</span> <span class="COLON">:</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>    <span id="module-Make.module-Global.val-set_inactive"><span class="VAL">val</span> <span class="LIDENT">set_inactive</span> <span class="COLON">:</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Make.module-Global.type-runtime"><span class="TYPE">type</span> <span class="LIDENT">runtime</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span class="COMMENT">(* Race conditions over these fields are not handled, but protection against
           concurrent usage is best-effort anyway. *)</span><span class="EOL">
</span>        <span id="def_244"><span class="MUTABLE">mutable</span> <span class="LIDENT">active_display</span> <span class="COLON">:</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span><span class="EOL">
</span>      <span class="SEMI">;</span></span> <span id="def_245"><span class="LIDENT">displaced_handlers</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><span class="LIDENT">int</span><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#type-signal_behavior"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">signal_behavior</span></a><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span>      <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-runtime"><span class="LIDENT">runtime</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span class="LIDENT">active_display</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span> <span class="LIDENT">displaced_handlers</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">0</span> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-is_active"><span class="LIDENT">is_active</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/option.ml.html#val-is_some"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">is_some</span></a> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-active_display"><span class="LIDENT">active_display</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-cleanup"><span class="LIDENT">cleanup</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/option.ml.html#val-iter"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">cleanup</span> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-find_display"><span class="LIDENT">find_display</span></span> <span id="local_uid_135"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LIDENT">active_display</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_display_136"><span class="LIDENT">display</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">Display</span><span class="DOT">.</span><span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">equal</span> <span class="LPAREN">(</span><span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">uid</span> <a href="#local_display_136"><span class="LIDENT">display</span></a><span class="RPAREN">)</span> <a href="#local_uid_135"><span class="LIDENT">uid</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>            <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="UIDENT">Ok</span> <a href="#local_display_136"><span class="LIDENT">display</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-handle_width_change"><span class="LIDENT">handle_width_change</span></span> <span id="local_w_137"><span class="LIDENT">w</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LPAREN">(</span><a href="#local_w_137"><span class="LIDENT">w</span></a><span class="COMMA">,</span> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_w_138"><span class="LIDENT">w</span></span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_display_139"><span class="LIDENT">display</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">handle_width_change</span> <a href="#local_display_139"><span class="LIDENT">display</span></a> <a href="#local_w_138"><span class="LIDENT">w</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-handle_signal"><span class="LIDENT">handle_signal</span></span> <span id="local_code_140"><span class="LIDENT">code</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LIDENT">cleanup</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find_opt"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find_opt</span></a> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">displaced_handlers</span> <a href="#local_code_140"><span class="LIDENT">code</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Signal_handle</span> <span id="local_f_141"><span class="LIDENT">f</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_141"><span class="LIDENT">f</span></a> <a href="#local_code_140"><span class="LIDENT">code</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UIDENT">Signal_default</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-exit"><span class="LIDENT">exit</span></a> <span class="INT">100</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UIDENT">Signal_ignore</span> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-init_handlers"><span class="LIDENT">init_handlers</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LAZY">lazy</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-at_exit"><span class="LIDENT">at_exit</span></a> <span class="LIDENT">cleanup</span><span class="SEMI">;</span><span class="EOL">
</span>         <span class="UIDENT">Platform</span><span class="DOT">.</span><span class="UIDENT">Terminal_width</span><span class="DOT">.</span><span class="LIDENT">set_changed_callback</span> <span class="LIDENT">handle_width_change</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-signals"><span class="LIDENT">signals</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="OPEN">open</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html"><span class="UIDENT">Sys</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LBRACKET">[</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigint"><span class="LIDENT">sigint</span></a><span class="SEMI">;</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigterm"><span class="LIDENT">sigterm</span></a><span class="SEMI">;</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigsegv"><span class="LIDENT">sigsegv</span></a> <span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(@)"><span class="INFIXOP1">@</span></a> <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="LIDENT">win32</span></a> <span class="THEN">then</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="ELSE">else</span> <span class="LBRACKET">[</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigquit"><span class="LIDENT">sigquit</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-set_active_exn"><span class="LIDENT">set_active_exn</span></span> <span id="local_display_142"><span class="LIDENT">display</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <span class="LIDENT">is_active</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Can't run more than one progress bar renderer simultaneously&quot;</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#val-force"><span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">force</span></a> <span class="LIDENT">init_handlers</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">ListLabels</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">signals</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_code_143"><span class="LIDENT">code</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_prev_handler_144"><span class="LIDENT">prev_handler</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-signal"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">signal</span></a> <a href="#local_code_143"><span class="LIDENT">code</span></a> <span class="LPAREN">(</span><span class="UIDENT">Signal_handle</span> <span class="LIDENT">handle_signal</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="COMMENT">(* Until the previous signal is added to the hashtable, there's a short
             period of time in which the {i previous} signal handler might be
             ignored. Not much we can do about that, unfortunately. *)</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">displaced_handlers</span> <span class="LABEL">~key:</span><a href="#local_code_143"><span class="LIDENT">code</span></a> <span class="LABEL">~data:</span><a href="#local_prev_handler_144"><span class="LIDENT">prev_handler</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Some</span> <a href="#local_display_142"><span class="LIDENT">display</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Global.val-set_inactive"><span class="LIDENT">set_inactive</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-iter"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">displaced_handlers</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="TILDE">~</span><span id="local_key_145"><span class="LIDENT">key</span></span> <span class="TILDE">~</span><span id="local_data_146"><span class="LIDENT">data</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-set_signal"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">set_signal</span></a> <a href="#local_key_145"><span class="LIDENT">key</span></a> <a href="#local_data_146"><span class="LIDENT">data</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-clear"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">clear</span></a> <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">displaced_handlers</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">runtime</span><span class="DOT">.</span><span class="LIDENT">active_display</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-reporter_of_bar"><span class="LIDENT">reporter_of_bar</span></span> <span class="LPAREN">(</span><span class="TYPE">type</span> <span class="LIDENT">a</span><span class="RPAREN">)</span> <span id="local_display_147"><span class="LIDENT">display</span></span> <span class="LPAREN">(</span><span id="local_bar_148"><span class="LIDENT">bar</span></span> <span class="COLON">:</span> <span class="LIDENT">a</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="COLON">:</span> <span class="LIDENT">a</span> <span class="LIDENT">reporter</span> <span class="EQUAL">=</span><span class="EOL">
</span>   <span class="FUN">fun</span> <span id="local_x_149"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">report</span> <a href="#local_bar_148"><span class="LIDENT">bar</span></a> <a href="#local_x_149"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">rerender_line</span> <a href="#local_display_147"><span class="LIDENT">display</span></a> <span class="LPAREN">(</span><span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_bar_148"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-updater_of_bar"><span class="LIDENT">updater_of_bar</span></span> <span id="local_display_150"><span class="LIDENT">display</span></span> <span id="local_bar_151"><span class="LIDENT">bar</span></span> <span class="TILDE">~</span><span id="local_unconditional_152"><span class="LIDENT">unconditional</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">update</span> <span class="TILDE">~</span><a href="#local_unconditional_152"><span class="LIDENT">unconditional</span></a> <a href="#local_bar_151"><span class="LIDENT">bar</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">rerender_line</span> <a href="#local_display_150"><span class="LIDENT">display</span></a> <span class="LPAREN">(</span><span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_bar_151"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Bar_list"><span class="MODULE">module</span> <span class="UIDENT">Bar_list</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span class="INCLUDE">include</span> <span class="UIDENT">Bar_list</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Make.module-Bar_list.val-of_multi"><span class="LIDENT">of_multi</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="DOT">.</span> <span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="multi_intf.ml.html#module-Hlist.type-t"><span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Multi</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="EOL">
</span>        <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_elt_153"><span class="LIDENT">elt</span></span> <span id="local_cfg_154"><span class="LIDENT">cfg</span></span> <span id="local_x_155"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="UIDENT">Line</span><span class="DOT">.</span><span class="LIDENT">to_primitive</span> <a href="#local_cfg_154"><span class="LIDENT">cfg</span></a> <a href="#local_x_155"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FUN">fun</span> <span id="local_cfg_156"><span class="LIDENT">cfg</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Zero</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Zero</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">One</span> <span id="local_x_157"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">One</span> <span class="LPAREN">(</span><a href="#local_elt_153"><span class="LIDENT">elt</span></a> <a href="#local_cfg_156"><span class="LIDENT">cfg</span></a> <a href="#local_x_157"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Many</span> <span id="local_xs_158"><span class="LIDENT">xs</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Many</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_xs_158"><span class="LIDENT">xs</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_159"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_elt_153"><span class="LIDENT">elt</span></a> <a href="#local_cfg_156"><span class="LIDENT">cfg</span></a> <a href="#local_x_159"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Plus</span> <span class="LPAREN">(</span><span id="local_xs_160"><span class="LIDENT">xs</span></span><span class="COMMA">,</span> <span id="local_ys_161"><span class="LIDENT">ys</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Plus</span> <span class="LPAREN">(</span><span class="LIDENT">of_multi</span> <a href="#local_cfg_156"><span class="LIDENT">cfg</span></a> <a href="#local_xs_160"><span class="LIDENT">xs</span></a><span class="COMMA">,</span> <span class="LIDENT">of_multi</span> <a href="#local_cfg_156"><span class="LIDENT">cfg</span></a> <a href="#local_ys_161"><span class="LIDENT">ys</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Hlist"><span class="MODULE">module</span> <span class="UIDENT">Hlist</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span class="COMMENT">(* ['a] and ['b] correspond to parameters of [Bar_list.t]. *)</span><span class="EOL">
</span>    <span id="module-Make.module-Hlist.type-t"><span class="TYPE">type</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span id="module-Make.module-Hlist.type-t.constructor-[]"><span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>      <span id="module-Make.module-Hlist.type-t.constructor-::"><span class="BAR">|</span> <span class="LPAREN">(</span> <span class="COLONCOLON">::</span> <span class="RPAREN">)</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">b</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">t</span></span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Make.module-Hlist.val-append"><span class="LIDENT">append</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span> <span class="LIDENT">c</span><span class="DOT">.</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">b</span><span class="COMMA">,</span> <span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">c</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>     <span class="FUN">fun</span> <span id="local_xs_162"><span class="LIDENT">xs</span></span> <span id="local_ys_163"><span class="LIDENT">ys</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="MATCH">match</span> <a href="#local_xs_162"><span class="LIDENT">xs</span></a> <span class="WITH">with</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_ys_163"><span class="LIDENT">ys</span></a> <span class="BAR">|</span> <span id="local_x_164"><span class="LIDENT">x</span></span> <span class="COLONCOLON">::</span> <span id="local_xs_165"><span class="LIDENT">xs</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_164"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <span class="LIDENT">append</span> <a href="#local_xs_165"><span class="LIDENT">xs</span></a> <a href="#local_ys_163"><span class="LIDENT">ys</span></a><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-interject_with"><span class="LIDENT">interject_with</span></span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="DOT">.</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="EQUAL">=</span><span class="EOL">
</span>   <span class="FUN">fun</span> <span id="local_f_166"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">active_display</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_166"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_d_167"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">interject_with</span> <a href="#local_d_167"><span class="LIDENT">d</span></a> <a href="#local_f_166"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-instrument_logs_reporter"><span class="LIDENT">instrument_logs_reporter</span></span> <span class="COLON">:</span> <span class="UIDENT">Logs</span><span class="DOT">.</span><span class="LIDENT">reporter</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Logs</span><span class="DOT">.</span><span class="LIDENT">reporter</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_wrap_msgf_168"><span class="LIDENT">wrap_msgf</span></span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="DOT">.</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Logs</span><span class="DOT">.</span><span class="LIDENT">msgf</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Logs</span><span class="DOT">.</span><span class="LIDENT">msgf</span> <span class="EQUAL">=</span><span class="EOL">
</span>     <span class="FUN">fun</span> <span id="local_msgf_169"><span class="LIDENT">msgf</span></span> <span id="local_construction_170"><span class="LIDENT">construction</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">interject_with</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_msgf_169"><span class="LIDENT">msgf</span></a> <a href="#local_construction_170"><span class="LIDENT">construction</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="FUN">fun</span> <span id="local_r_171"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span class="LIDENT">report</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_src_172"><span class="LIDENT">src</span></span> <span id="local_level_173"><span class="LIDENT">level</span></span> <span class="TILDE">~</span><span id="local_over_174"><span class="LIDENT">over</span></span> <span id="local_k_175"><span class="LIDENT">k</span></span> <span id="local_f_176"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_r_171"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">report</span> <a href="#local_src_172"><span class="LIDENT">src</span></a> <a href="#local_level_173"><span class="LIDENT">level</span></a> <span class="TILDE">~</span><a href="#local_over_174"><span class="LIDENT">over</span></a> <a href="#local_k_175"><span class="LIDENT">k</span></a> <span class="LPAREN">(</span><a href="#local_wrap_msgf_168"><span class="LIDENT">wrap_msgf</span></a> <a href="#local_f_176"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-logs_reporter"><span class="LIDENT">logs_reporter</span></span> <span class="QUESTION">?</span><span id="local_pp_header_177"><span class="LIDENT">pp_header</span></span> <span class="QUESTION">?</span><span id="local_app_178"><span class="LIDENT">app</span></span> <span class="QUESTION">?</span><span id="local_dst_179"><span class="LIDENT">dst</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">instrument_logs_reporter</span> <span class="LPAREN">(</span><span class="UIDENT">Logs_fmt</span><span class="DOT">.</span><span class="LIDENT">reporter</span> <span class="QUESTION">?</span><a href="#local_pp_header_177"><span class="LIDENT">pp_header</span></a> <span class="QUESTION">?</span><a href="#local_app_178"><span class="LIDENT">app</span></a> <span class="QUESTION">?</span><a href="#local_dst_179"><span class="LIDENT">dst</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Reporter"><span class="MODULE">module</span> <span class="UIDENT">Reporter</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span class="INCLUDE">include</span> <span class="UIDENT">Reporter</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Reporter.val-finalise"><span class="LIDENT">finalise</span></span> <span class="LPAREN">(</span><span id="local_t_180"><span class="LIDENT">t</span></span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_180"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">display</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Display already finalised&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_display_181"><span class="LIDENT">display</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">finalise_line</span> <a href="#local_display_181"><span class="LIDENT">display</span></a> <a href="#local_t_180"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Reporters"><span class="MODULE">module</span> <span class="UIDENT">Reporters</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Make.module-Reporters.type-t"><span class="TYPE">type</span> <span class="NONREC">nonrec</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Reporter</span><span class="DOT">.</span><span class="LIDENT">list</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Make.module-Reporters.val-apply_all"><span class="LIDENT">apply_all</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="DOT">.</span> <span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">b</span> <span class="EQUAL">=</span><span class="EOL">
</span>     <span class="FUN">fun</span> <span id="local_f_182"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUNCTION">function</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_182"><span class="LIDENT">f</span></a> <span class="BAR">|</span> <span id="local_x_183"><span class="LIDENT">x</span></span> <span class="COLONCOLON">::</span> <span id="local_xs_184"><span class="LIDENT">xs</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">apply_all</span> <span class="LPAREN">(</span><a href="#local_f_182"><span class="LIDENT">f</span></a> <a href="#local_x_183"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <a href="#local_xs_184"><span class="LIDENT">xs</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Make.module-Reporters.val-of_hlist"><span class="LIDENT">of_hlist</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="DOT">.</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Hlist</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_x_185"><span class="LIDENT">x</span></span> <span class="COLONCOLON">::</span> <span id="local_xs_186"><span class="LIDENT">xs</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_185"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <span class="LIDENT">of_hlist</span> <a href="#local_xs_186"><span class="LIDENT">xs</span></a><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-Display"><span class="MODULE">module</span> <span class="UIDENT">Display</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Make.module-Display.type-t"><span class="TYPE">type</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span id="def_233"><span class="LIDENT">uid</span> <span class="COLON">:</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="UIDENT">Unique_id</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="SEMI">;</span></span> <span id="def_249"><span class="LIDENT">initial_reporters</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="QUOTE">'</span><span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Reporters</span><span class="DOT">.</span><span class="LIDENT">t</span></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-start"><span class="LIDENT">start</span></span> <span class="COLON">:</span><span class="EOL">
</span>        <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="DOT">.</span> <span class="OPTLABEL">?config:</span><span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">user_supplied</span> <span class="MINUSGREATER">-&gt;</span> <a href="multi_intf.ml.html#module-Hlist.type-t"><span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Multi</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>     <span class="FUN">fun</span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_config_187"><span class="LIDENT">config</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">v</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <span id="local_bars_188"><span class="LIDENT">bars</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_config_189"><span class="LIDENT">config</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Config</span><span class="DOT">.</span><span class="LIDENT">apply_defaults</span> <a href="#local_config_187"><span class="LIDENT">config</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_bars_190"><span class="LIDENT">bars</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">of_multi</span> <a href="#local_config_189"><span class="LIDENT">config</span></a> <a href="#local_bars_188"><span class="LIDENT">bars</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_ppf_191"><span class="LIDENT">ppf</span></span> <span class="EQUAL">=</span> <a href="#local_config_189"><span class="LIDENT">config</span></a><span class="DOT">.</span><span class="LIDENT">ppf</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_display_192"><span class="LIDENT">display</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_config_189"><span class="LIDENT">config</span></a> <a href="#local_bars_190"><span class="LIDENT">bars</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">set_active_exn</span> <a href="#local_display_192"><span class="LIDENT">display</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_open_box"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_open_box</span></a> <a href="#local_ppf_191"><span class="LIDENT">ppf</span></a> <span class="INT">0</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_config_189"><span class="LIDENT">config</span></a><span class="DOT">.</span><span class="LIDENT">hide_cursor</span> <span class="THEN">then</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_ppf_191"><span class="LIDENT">ppf</span></a> <a href="../../../terminal/src/terminal.ansi/ansi.ml.html#val-hide_cursor"><span class="UIDENT">Terminal</span><span class="DOT">.</span><span class="UIDENT">Ansi</span><span class="DOT">.</span><span class="LIDENT">hide_cursor</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">initial_render</span> <a href="#local_display_192"><span class="LIDENT">display</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_inner_193"><span class="LIDENT">inner</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="DOT">.</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Bar_list</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="UIDENT">Hlist</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Zero</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">One</span> <span id="local_bar_194"><span class="LIDENT">bar</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span> <span class="LIDENT">reporter_of_bar</span> <a href="#local_display_192"><span class="LIDENT">display</span></a> <a href="#local_bar_194"><span class="LIDENT">bar</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Many</span> <span id="local_xs_195"><span class="LIDENT">xs</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="LBRACKET">[</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">ListLabels</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_xs_195"><span class="LIDENT">xs</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_bar_196"><span class="LIDENT">bar</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">reporter_of_bar</span> <a href="#local_display_192"><span class="LIDENT">display</span></a> <a href="#local_bar_196"><span class="LIDENT">bar</span></a><span class="RPAREN">)</span> <span class="RBRACKET">]</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Plus</span> <span class="LPAREN">(</span><span id="local_left_197"><span class="LIDENT">left</span></span><span class="COMMA">,</span> <span id="local_right_198"><span class="LIDENT">right</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_left_199"><span class="LIDENT">left</span></span> <span class="EQUAL">=</span> <a href="#local_inner_193"><span class="LIDENT">inner</span></a> <a href="#local_left_197"><span class="LIDENT">left</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_right_200"><span class="LIDENT">right</span></span> <span class="EQUAL">=</span> <a href="#local_inner_193"><span class="LIDENT">inner</span></a> <a href="#local_right_198"><span class="LIDENT">right</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="UIDENT">Hlist</span><span class="DOT">.</span><span class="LIDENT">append</span> <a href="#local_left_199"><span class="LIDENT">left</span></a> <a href="#local_right_200"><span class="LIDENT">right</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_bars_201"><span class="LIDENT">bars</span></span> <span class="EQUAL">=</span> <a href="#local_inner_193"><span class="LIDENT">inner</span></a> <a href="#local_bars_190"><span class="LIDENT">bars</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span class="LIDENT">uid</span> <span class="EQUAL">=</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">uid</span> <a href="#local_display_192"><span class="LIDENT">display</span></a><span class="SEMI">;</span> <span class="LIDENT">initial_reporters</span> <span class="EQUAL">=</span> <span class="UIDENT">Reporters</span><span class="DOT">.</span><span class="LIDENT">of_hlist</span> <a href="#local_bars_201"><span class="LIDENT">bars</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-add_line"><span class="LIDENT">add_line</span></span> <span class="QUESTION">?</span><span id="local_above_202"><span class="LIDENT">above</span></span> <span id="local_t_203"><span class="LIDENT">t</span></span> <span id="local_line_204"><span class="LIDENT">line</span></span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="UIDENT">Reporter</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_203"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Cannot add a line to a finalised display&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_d_205"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_bar_206"><span class="LIDENT">bar</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="UIDENT">Line</span><span class="DOT">.</span><span class="LIDENT">to_primitive</span> <span class="LPAREN">(</span><span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">config</span> <a href="#local_d_205"><span class="LIDENT">d</span></a><span class="RPAREN">)</span> <a href="#local_line_204"><span class="LIDENT">line</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">add_line</span> <span class="QUESTION">?</span><a href="#local_above_202"><span class="LIDENT">above</span></a> <a href="#local_d_205"><span class="LIDENT">d</span></a> <a href="#local_bar_206"><span class="LIDENT">bar</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_uid_207"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bar_renderer</span><span class="DOT">.</span><span class="LIDENT">id</span> <a href="#local_bar_206"><span class="LIDENT">bar</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_report_208"><span class="LIDENT">report</span></span> <span class="EQUAL">=</span> <span class="LIDENT">reporter_of_bar</span> <a href="#local_d_205"><span class="LIDENT">d</span></a> <a href="#local_bar_206"><span class="LIDENT">bar</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_update_209"><span class="LIDENT">update</span></span> <span class="EQUAL">=</span> <span class="LIDENT">updater_of_bar</span> <a href="#local_d_205"><span class="LIDENT">d</span></a> <a href="#local_bar_206"><span class="LIDENT">bar</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LBRACE">{</span> <span class="LIDENT">display</span> <span class="EQUAL">=</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">uid</span> <a href="#local_d_205"><span class="LIDENT">d</span></a><span class="SEMI">;</span> <a href="#local_uid_207"><span class="LIDENT">uid</span></a><span class="SEMI">;</span> <a href="#local_report_208"><span class="LIDENT">report</span></a><span class="SEMI">;</span> <a href="#local_update_209"><span class="LIDENT">update</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-remove_line"><span class="LIDENT">remove_line</span></span> <span id="local_t_210"><span class="LIDENT">t</span></span> <span class="LPAREN">(</span><span id="local_reporter_211"><span class="LIDENT">reporter</span></span> <span class="COLON">:</span> <span class="UNDERSCORE">_</span> <span class="UIDENT">Reporter</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_210"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a><span class="EOL">
</span>            <span class="STRING">&quot;Cannot remove a line from a display that is already finalised&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_d_212"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">remove_line</span> <a href="#local_d_212"><span class="LIDENT">d</span></a> <a href="#local_reporter_211"><span class="LIDENT">reporter</span></a><span class="DOT">.</span><span class="LIDENT">uid</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-finalise"><span class="LIDENT">finalise</span></span> <span id="local_t_213"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_213"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Display already finalised&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_display_214"><span class="LIDENT">display</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">finalise</span> <a href="#local_display_214"><span class="LIDENT">display</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">set_inactive</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-tick"><span class="LIDENT">tick</span></span> <span id="local_t_215"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_215"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_d_216"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">tick</span> <a href="#local_d_216"><span class="LIDENT">d</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-reporters"><span class="LIDENT">reporters</span></span> <span id="local_t_217"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_217"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">initial_reporters</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-pause"><span class="LIDENT">pause</span></span> <span id="local_t_218"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_218"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Cannot pause a finalised display&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_d_219"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">pause</span> <a href="#local_d_219"><span class="LIDENT">d</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Make.module-Display.val-resume"><span class="LIDENT">resume</span></span> <span id="local_t_220"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Global</span><span class="DOT">.</span><span class="LIDENT">find_display</span> <a href="#local_t_220"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="LIDENT">finalised</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Cannot pause a finalised display&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_d_221"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">resume</span> <a href="#local_d_221"><span class="LIDENT">d</span></a><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-with_reporters"><span class="LIDENT">with_reporters</span></span> <span class="QUESTION">?</span><span id="local_config_222"><span class="LIDENT">config</span></span> <span id="local_t_223"><span class="LIDENT">t</span></span> <span id="local_f_224"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_display_225"><span class="LIDENT">display</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">start</span> <span class="QUESTION">?</span><a href="#local_config_222"><span class="LIDENT">config</span></a> <a href="#local_t_223"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/fun.ml.html#val-protect"><span class="UIDENT">Fun</span><span class="DOT">.</span><span class="LIDENT">protect</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Reporters</span><span class="DOT">.</span><span class="LIDENT">apply_all</span> <a href="#local_f_224"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">reporters</span> <a href="#local_display_225"><span class="LIDENT">display</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LABEL">~finally:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Display</span><span class="DOT">.</span><span class="LIDENT">finalise</span> <a href="#local_display_225"><span class="LIDENT">display</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-with_reporter"><span class="LIDENT">with_reporter</span></span> <span class="QUESTION">?</span><span id="local_config_226"><span class="LIDENT">config</span></span> <span id="local_b_227"><span class="LIDENT">b</span></span> <span id="local_f_228"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="LIDENT">with_reporters</span> <span class="QUESTION">?</span><a href="#local_config_226"><span class="LIDENT">config</span></a> <span class="LPAREN">(</span><a href="multi.ml.html#val-line"><span class="UIDENT">Multi</span><span class="DOT">.</span><span class="LIDENT">line</span></a> <a href="#local_b_227"><span class="LIDENT">b</span></a><span class="RPAREN">)</span> <a href="#local_f_228"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(*————————————————————————————————————————————————————————————————————————————
   Copyright (c) 2020–2021 Craig Ferguson &lt;me@craigfe.io&gt;

   Permission to use, copy, modify, and/or distribute this software for any
   purpose with or without fee is hereby granted, provided that the above
   copyright notice and this permission notice appear in all copies.

   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
  ————————————————————————————————————————————————————————————————————————————*)</span><span class="EOL">
</span></span></code></pre></body></html>
