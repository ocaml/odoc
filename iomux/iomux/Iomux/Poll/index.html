<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Poll (iomux.iomux.Iomux.Poll)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../sherlodoc_db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../index.html">üè†</a> &#x00BB; <a href="../../../index.html">iomux</a> &#x00BB; Library <code>iomux</code> &#x00BB; <a href="../index.html">Iomux</a> &#x00BB; Poll</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Iomux.Poll</span></code><a href="../../../src/iomux/poll.ml.html" class="source_link">Source</a></h1><p>A direct binding of poll(2).</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../index.html">iomux</a><ul><li>Library <code>iomux</code><ul><li><a href="../index.html">Iomux</a><ul><li><a href="#" class="current_unit">Poll</a><ul><li><a href="Flags/index.html">Flags</a></li></ul></li><li><a href="../Util/index.html">Util</a></li></ul></li></ul></li><li><a href="../../../src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#type-t" class="source_link">Source</a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Main type for a poller.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-create" class="source_link">Source</a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?maxfds</span>:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ?maxfds ()</code> creates a new poller.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">maxfds</span> <p>Maximum number of fds, defaults to <a href="../Util/index.html#val-max_open_files"><code>Util.max_open_files</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-maxfds"><a href="#val-maxfds" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-maxfds" class="source_link">Source</a><code><span><span class="keyword">val</span> maxfds : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>maxfds t</code> is the maximum number of file descriptor slots allocated for <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Flags"><a href="#module-Flags" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#module-Flags" class="source_link">Source</a><code><span><span class="keyword">module</span> <a href="Flags/index.html">Flags</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The set of flags associated with a file descriptor event.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-has_ppoll"><a href="#val-has_ppoll" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-has_ppoll" class="source_link">Source</a><code><span><span class="keyword">val</span> has_ppoll : bool</span></code></div><div class="spec-doc"><p><code>has_ppoll</code> is true if the system supports the ppoll(2) system call. Notably macos as of 2023 does not have it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invalid_fd"><a href="#val-invalid_fd" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-invalid_fd" class="source_link">Source</a><code><span><span class="keyword">val</span> invalid_fd : <a href="../../../../ocaml-base-compiler/unix/Unix/index.html#type-file_descr">Unix.file_descr</a></span></code></div><div class="spec-doc"><p><code>invalid_fd</code> is the <a href="../../../../ocaml-base-compiler/unix/Unix/index.html#type-file_descr"><code>Unix.file_descr</code></a> of value -1.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-poll_timeout"><a href="#type-poll_timeout" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#type-poll_timeout" class="source_link">Source</a><code><span><span class="keyword">type</span> poll_timeout</span><span> = </span></code><ol><li id="type-poll_timeout.Infinite" class="def variant constructor anchored"><a href="#type-poll_timeout.Infinite" class="anchor"></a><code><span>| </span><span><span class="constructor">Infinite</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No timeout, wait forever</p><span class="comment-delim">*)</span></div></li><li id="type-poll_timeout.Nowait" class="def variant constructor anchored"><a href="#type-poll_timeout.Nowait" class="anchor"></a><code><span>| </span><span><span class="constructor">Nowait</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Don't block, return immediately</p><span class="comment-delim">*)</span></div></li><li id="type-poll_timeout.Milliseconds" class="def variant constructor anchored"><a href="#type-poll_timeout.Milliseconds" class="anchor"></a><code><span>| </span><span><span class="constructor">Milliseconds</span> <span class="keyword">of</span> int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Block for at most <code>int</code> milliseconds</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The timeout parameter for <a href="#val-poll"><code>poll</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-poll" class="source_link">Source</a><code><span><span class="keyword">val</span> poll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-poll_timeout">poll_timeout</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>The actual poll(2) call</p><p><code>poll t nfds timeout</code> polls for the first <code>nfds</code>, like the system call, invalid (-1) entries are ignored. The internal buffer is not modified after the call. It returns the number of ready file descriptors suitable to be used with <a href="#val-iter_ready"><code>iter_ready</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ppoll_timeout"><a href="#type-ppoll_timeout" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#type-ppoll_timeout" class="source_link">Source</a><code><span><span class="keyword">type</span> ppoll_timeout</span><span> = </span></code><ol><li id="type-ppoll_timeout.Infinite" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Infinite" class="anchor"></a><code><span>| </span><span><span class="constructor">Infinite</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No timeout, wait forever</p><span class="comment-delim">*)</span></div></li><li id="type-ppoll_timeout.Nowait" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Nowait" class="anchor"></a><code><span>| </span><span><span class="constructor">Nowait</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Don't block, return immediately</p><span class="comment-delim">*)</span></div></li><li id="type-ppoll_timeout.Nanoseconds" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Nanoseconds" class="anchor"></a><code><span>| </span><span><span class="constructor">Nanoseconds</span> <span class="keyword">of</span> int64</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Block for at most <code>int64</code> nanoseconds</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The timeout parameter for <a href="#val-ppoll"><code>ppoll</code></a>. Supports nanoseconds instead of milliseconds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ppoll"><a href="#val-ppoll" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-ppoll" class="source_link">Source</a><code><span><span class="keyword">val</span> ppoll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ppoll_timeout">ppoll_timeout</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int list</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>The actual ppoll(2) call</p><p><code>ppoll t nfds timeout sigmask</code> is like <a href="#val-poll"><code>poll</code></a> but supports nanoseconds and a list of signals that are atomically masked during execution and restored uppon return. If the system does not <a href="#val-has_ppoll"><code>has_ppoll</code></a> this call will raise <a href="../../../../ocaml-base-compiler/unix/Unix/index.html#exception-Unix_error"><code>Unix.Unix_error</code></a> with ENOSYS. You most likely want to use <a href="#val-ppoll_or_poll"><code>ppoll_or_poll</code></a>, see below.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ppoll_or_poll"><a href="#val-ppoll_or_poll" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-ppoll_or_poll" class="source_link">Source</a><code><span><span class="keyword">val</span> ppoll_or_poll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ppoll_timeout">ppoll_timeout</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>A more portable ppoll(2) call</p><p><code>ppoll_or_poll t nfds tiemout</code> is like <a href="#val-ppoll"><code>ppoll</code></a> if the system <a href="#val-has_ppoll"><code>has_ppoll</code></a>, otherwise the call is emulated via <a href="#val-poll"><code>poll</code></a>, notably the timeout is internally converted to milliseconds and there is no support for signal masking. You most likely want to use this instead of <a href="#val-ppoll"><code>ppoll</code></a>, the two calls are kept to prevent the user from expecting nanoseconds resolution from an emulated <a href="#val-ppoll"><code>ppoll</code></a> call.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_index"><a href="#val-set_index" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-set_index" class="source_link">Source</a><code><span><span class="keyword">val</span> set_index : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml-base-compiler/unix/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_index t index fd flag</code> modifies the internal buffer at <code>index</code> to listen to <code>flag</code> events of <code>fd</code>. This overwrites any previous value of <code>flag</code> and <code>fd</code> internally. <a href="#val-invalid_fd"><code>invalid_fd</code></a> (-1) can be used to deactivate the slot, but usage of <a href="#val-invalidate_index"><code>invalidate_index</code></a> is preferred.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invalidate_index"><a href="#val-invalidate_index" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-invalidate_index" class="source_link">Source</a><code><span><span class="keyword">val</span> invalidate_index : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>invalidate_index t index</code> modifies the internal buffer by invalidating <code>index</code>. The kernel will ignore that slot. We also clear flags, just for kicks.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_revents"><a href="#val-get_revents" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-get_revents" class="source_link">Source</a><code><span><span class="keyword">val</span> get_revents : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="Flags/index.html#type-t">Flags.t</a></span></code></div><div class="spec-doc"><p><code>get_revents t index</code> is the returned event flags set after a call to <a href="#val-poll"><code>poll</code></a> or <a href="#val-ppoll"><code>ppoll</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_fd"><a href="#val-get_fd" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-get_fd" class="source_link">Source</a><code><span><span class="keyword">val</span> get_fd : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../../../../ocaml-base-compiler/unix/Unix/index.html#type-file_descr">Unix.file_descr</a></span></code></div><div class="spec-doc"><p><code>get_fd t index</code> is the file descriptor associated with <code>index</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_ready"><a href="#val-iter_ready" class="anchor"></a><a href="../../../src/iomux/poll.ml.html#val-iter_ready" class="source_link">Source</a><code><span><span class="keyword">val</span> iter_ready : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml-base-compiler/unix/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>iter_ready t nready fn</code> scans the internal buffer for every ready file descriptor and calls <code>fn index fd flags</code>, the scanning is aborted after <code>nready</code> entries are found. Invalid file descriptors (set to -1 via invalidate_index) are skipped. Typical usage is that <code>nready</code> is the return of <a href="#val-poll"><code>poll</code></a> or <a href="#val-ppoll"><code>ppoll</code></a>. The internal buffer is left unmodified.</p></div></div></div></body></html>
