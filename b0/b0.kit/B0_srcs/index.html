<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>B0_srcs (b0.b0.kit.B0_srcs)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../sherlodoc_db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; Library <code>b0.kit</code> &#x00BB; B0_srcs</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>B0_srcs</span></code></h1><p>Select source files.</p><p><b>FIXME.</b> This will need a few more design rounds. Here are a few things:</p><ul><li>Review w.r.t. <code>b0</code>.</li><li>We likely want combinators represenging <a href="#type-sel"><code>sel</code></a>s and producing <a href="#type-t"><code>t</code></a> and ways union <code>t</code>s (for `Fut users).</li><li>The <code>`Fut</code> case should return a <a href="#type-t"><code>t</code></a>.</li><li>Support for watermaking should likely occur here.</li></ul><p>This module provides a type to select source files for build units in B0 files. To support generated source files, selections can depend on the build.</p><p>In a nutshell the declaration:</p><pre class="language-ocaml"><code>let srcs =
  Fpath.[ `Dir (v &quot;src-exe&quot;); `Dir_rec (v &quot;src&quot;); `X (v &quot;src/not.ml&quot;);
          `X (v &quot;src/not&quot;)]</code></pre><p>instructs to:</p><ul><li>Select all the files in <em>directory</em> <code>src-exe</code>.</li><li>Select all the files in the <em>file hierarchy</em> rooted at directory <code>src</code>.</li><li>Remove from the files found in directories the files whose paths segments are prefixed by <code>src/not.ml</code> and <code>src/not</code>.</li></ul><p>Relative file paths are expressed relative to the build unit's <span class="xref-unresolved" title="B0_build.Unit.scope_dir">scope directory</span>.</p><p>The prefix relation for exclusions respects path segments boundaries. In the example any file whose path matches <code>src/not.ml</code>, <code>src/not.ml/*</code>, <code>src/not</code> or <code>src/not/*</code> is excluded from the selection. But for example <code>src/not.c</code> is not.</p><p>The relative order of directory selections and exclusions doesn't matter, the semantics is to select all the files via <code>`Dir</code> and <code>`Dir_rec</code> and then apply the exclusion <code>`X</code> on the resulting set. Exclusions affect only directory selections, not file <code>`File</code> and future <code>`Future</code> <a href="#type-sel" title="sel">selections</a>.</p><p>When a directory is selected via <code>`Dir</code> or <code>`Dir_rec</code>, all its files are, modulo exclusions. It is expected that build units themselves filter the final result by file extension or additional mechanisms. Consult the documentation of build units for more information.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#sel">Source selection</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="../../b00_manual.html">B00 manual</a></li><li><a href="../../cmdlet_manual.html">Cmdlet manual</a></li><li><a href="../../driver_dev.html">B0 driver development manual</a></li><li><a href="../../manual.html">B0 manual</a></li><li><a href="../../old_manual.html">B0 manual</a></li><li><a href="../../opam.html"><code>opam</code> support manual</a></li><li><a href="../../rationale.html">Why b0 ?</a></li><li><a href="../../release.html">B0 release support manual</a></li><li><a href="../../todo.html">Design considerations and todo</a></li><li><a href="../../unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="../../b0/B0_build/index.html">B0_build</a></li><li><a href="../../b0/B0_cli/index.html">B0_cli</a></li><li><a href="../../b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="../../b0/B0_def/index.html">B0_def</a></li><li><a href="../../b0/B0_dir/index.html">B0_dir</a></li><li><a href="../../b0/B0_driver/index.html">B0_driver</a></li><li><a href="../../b0/B0_file/index.html">B0_file</a></li><li><a href="../../b0/B0_meta/index.html">B0_meta</a></li><li><a href="../../b0/B0_pack/index.html">B0_pack</a></li><li><a href="../../b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="../../b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="../../b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="../../b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="../../b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="../../b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="../../b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="../../b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="../../b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="../../b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="../../b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="../../b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="../../b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="../../b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="../../b0.b00/B00/index.html">B00</a></li><li><a href="../../b0.b00/B000/index.html">B000</a></li><li><a href="../../b0.b00/B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="../../b0.b00.kit/B00_base64/index.html">B00_base64</a></li><li><a href="../../b0.b00.kit/B00_cli/index.html">B00_cli</a></li><li><a href="../../b0.b00.kit/B00_cmark/index.html">B00_cmark</a></li><li><a href="../../b0.b00.kit/B00_editor/index.html">B00_editor</a></li><li><a href="../../b0.b00.kit/B00_fexts/index.html">B00_fexts</a></li><li><a href="../../b0.b00.kit/B00_findex/index.html">B00_findex</a></li><li><a href="../../b0.b00.kit/B00_github/index.html">B00_github</a></li><li><a href="../../b0.b00.kit/B00_htmlg/index.html">B00_htmlg</a></li><li><a href="../../b0.b00.kit/B00_http/index.html">B00_http</a></li><li><a href="../../b0.b00.kit/B00_jsoo/index.html">B00_jsoo</a></li><li><a href="../../b0.b00.kit/B00_lines/index.html">B00_lines</a></li><li><a href="../../b0.b00.kit/B00_ocaml/index.html">B00_ocaml</a></li><li><a href="../../b0.b00.kit/B00_odoc/index.html">B00_odoc</a></li><li><a href="../../b0.b00.kit/B00_os/index.html">B00_os</a></li><li><a href="../../b0.b00.kit/B00_pager/index.html">B00_pager</a></li><li><a href="../../b0.b00.kit/B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="../../b0.b00.kit/B00_rsync/index.html">B00_rsync</a></li><li><a href="../../b0.b00.kit/B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="../../b0.b00.kit/B00_serialk_sexp/index.html">B00_serialk_sexp</a></li><li><a href="../../b0.b00.kit/B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="../../b0.b00.kit/B00_trace/index.html">B00_trace</a></li><li><a href="../../b0.b00.kit/B00_vcs/index.html">B00_vcs</a></li><li><a href="../../b0.b00.kit/B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="../B0_expect/index.html">B0_expect</a></li><li><a href="../B0_jsoo/index.html">B0_jsoo</a></li><li><a href="../B0_kit/index.html">B0_kit</a></li><li><a href="../B0_ocaml/index.html">B0_ocaml</a></li><li><a href="../B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="../B0_opam/index.html">B0_opam</a></li><li><a href="../B0_release/index.html">B0_release</a></li><li><a href="#" class="current_unit">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="../../b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="sel"><a href="#sel" class="anchor"></a>Source selection</h2><div class="odoc-spec"><div class="spec type anchored" id="type-sel"><a href="#type-sel" class="anchor"></a><code><span><span class="keyword">type</span> sel</span><span> = </span><span>[ </span></code><ol><li id="type-sel.Dir" class="def variant constructor anchored"><a href="#type-sel.Dir" class="anchor"></a><code><span>| </span><span>`Dir <span class="keyword">of</span> <a href="../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></span></code></li><li id="type-sel.Dir_rec" class="def variant constructor anchored"><a href="#type-sel.Dir_rec" class="anchor"></a><code><span>| </span><span>`Dir_rec <span class="keyword">of</span> <a href="../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></span></code></li><li id="type-sel.X" class="def variant constructor anchored"><a href="#type-sel.X" class="anchor"></a><code><span>| </span><span>`X <span class="keyword">of</span> <a href="../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></span></code></li><li id="type-sel.File" class="def variant constructor anchored"><a href="#type-sel.File" class="anchor"></a><code><span>| </span><span>`File <span class="keyword">of</span> <a href="../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a></span></code></li><li id="type-sel.Fut" class="def variant constructor anchored"><a href="#type-sel.Fut" class="anchor"></a><code><span>| </span><span>`Fut <span class="keyword">of</span> <span><a href="../../b0/B0_build/index.html#type-t">B0_build.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../b0.std/B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a> <a href="../../b0.std/B0_std/Fut/index.html#type-t">B0_std.Fut.t</a></span></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for file selectors.</p><ul><li><code>`File f</code> unconditionaly selects the file <code>f</code>. <code>f</code> must exist and be a file.</li><li><code>`Dir d</code> selects the files of directory <code>d</code> modulo <code>`X</code> exclusions. <code>d</code> must exist and be a directory. dotfile paths are ignored.</li><li><code>`Dir_rec d</code> selects the files of the file <em>hierarchy</em> rooted at <code>d</code> modulo <code>`X</code> exclusions. <code>d</code> must exist and be a directory. dotfile paths are ignored.</li><li><code>`X x</code> removes from directory selections any file whose path segments are prefixed by <code>x</code>, respecting segment boundaries. A potential trailing directory separators in <code>x</code> is removed.</li><li><code>`Fut f</code> uses the given future during the build to determine a set of files unconditionally added to the selection. FIXME this s not the right interface, see <code>root_of_file</code>, maybe we should return a <a href="#type-t"><code>t</code></a> itself and merge the results</li></ul><p>Except for <code>`Fut</code>, any relative path is made absolute to the current build unit with <code>B0_build.Unit.root_dir</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sels"><a href="#type-sels" class="anchor"></a><code><span><span class="keyword">type</span> sels</span><span> = <span><a href="#type-sel">sel</a> list</span></span></code></div><div class="spec-doc"><p>The type for source selection.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for source selection results.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-select"><a href="#val-select" class="anchor"></a><code><span><span class="keyword">val</span> select : <span><a href="../../b0/B0_build/index.html#type-t">B0_build.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-sels">sels</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../b0.std/B0_std/Fut/index.html#type-t">B0_std.Fut.t</a></span></span></code></div><div class="spec-doc"><p><code>select b sels</code> selects in <code>b</code> the sources specified by <code>sels</code>.</p><p><b>Important.</b> All files in the map that were selected via <code>`File</code>, <code>`D</code> and <code>`D_rec</code> are automatically <a href="../../b0.b00/B00/Memo/index.html#val-file_ready" title="B00.Memo.file_ready">made ready</a> in <code>b</code>. For those selected via <code>`Fut</code> readyness determination is left to the invoked funtion.</p><p><b>FIXME.</b> Provide ordering guarantes and avoid non-det from the fs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-by_ext"><a href="#val-by_ext" class="anchor"></a><code><span><span class="keyword">val</span> by_ext : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../b0.b00.kit/B00_fexts/index.html#type-map">B00_fexts.map</a></span></code></div><div class="spec-doc"><p><code>by_ext s</code> are the selected files mapped by their file extension (not <a href="../../b0.std/B0_std/Fpath/index.html#file_exts" title="file_exts">multiple file extension</a>). Each file is guaranteed to appear only once in the map and is absolute.</p></div></div></div></body></html>
