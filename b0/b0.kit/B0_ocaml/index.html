<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>B0_ocaml (b0.b0.kit.B0_ocaml)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../sherlodoc_db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; Library <code>b0.kit</code> &#x00BB; B0_ocaml</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>B0_ocaml</span></code></h1><p>OCaml B0 file support.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#units">Units</a></li><li><a href="#build_conf">Build configuration</a><ul><li><a href="#code">Generated code</a></li></ul></li><li><a href="#frag">Build fragments</a></li><li><a href="#metadata">Metadata</a></li><li><a href="#lib">Library resolution</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="../../b00_manual.html">B00 manual</a></li><li><a href="../../cmdlet_manual.html">Cmdlet manual</a></li><li><a href="../../driver_dev.html">B0 driver development manual</a></li><li><a href="../../manual.html">B0 manual</a></li><li><a href="../../old_manual.html">B0 manual</a></li><li><a href="../../opam.html"><code>opam</code> support manual</a></li><li><a href="../../rationale.html">Why b0 ?</a></li><li><a href="../../release.html">B0 release support manual</a></li><li><a href="../../todo.html">Design considerations and todo</a></li><li><a href="../../unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="../../b0/B0_build/index.html">B0_build</a></li><li><a href="../../b0/B0_cli/index.html">B0_cli</a></li><li><a href="../../b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="../../b0/B0_def/index.html">B0_def</a></li><li><a href="../../b0/B0_dir/index.html">B0_dir</a></li><li><a href="../../b0/B0_driver/index.html">B0_driver</a></li><li><a href="../../b0/B0_file/index.html">B0_file</a></li><li><a href="../../b0/B0_meta/index.html">B0_meta</a></li><li><a href="../../b0/B0_pack/index.html">B0_pack</a></li><li><a href="../../b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="../../b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="../../b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="../../b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="../../b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="../../b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="../../b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="../../b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="../../b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="../../b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="../../b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="../../b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="../../b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="../../b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="../../b0.b00/B00/index.html">B00</a></li><li><a href="../../b0.b00/B000/index.html">B000</a></li><li><a href="../../b0.b00/B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="../../b0.b00.kit/B00_base64/index.html">B00_base64</a></li><li><a href="../../b0.b00.kit/B00_cli/index.html">B00_cli</a></li><li><a href="../../b0.b00.kit/B00_cmark/index.html">B00_cmark</a></li><li><a href="../../b0.b00.kit/B00_editor/index.html">B00_editor</a></li><li><a href="../../b0.b00.kit/B00_fexts/index.html">B00_fexts</a></li><li><a href="../../b0.b00.kit/B00_findex/index.html">B00_findex</a></li><li><a href="../../b0.b00.kit/B00_github/index.html">B00_github</a></li><li><a href="../../b0.b00.kit/B00_htmlg/index.html">B00_htmlg</a></li><li><a href="../../b0.b00.kit/B00_http/index.html">B00_http</a></li><li><a href="../../b0.b00.kit/B00_jsoo/index.html">B00_jsoo</a></li><li><a href="../../b0.b00.kit/B00_lines/index.html">B00_lines</a></li><li><a href="../../b0.b00.kit/B00_ocaml/index.html">B00_ocaml</a></li><li><a href="../../b0.b00.kit/B00_odoc/index.html">B00_odoc</a></li><li><a href="../../b0.b00.kit/B00_os/index.html">B00_os</a></li><li><a href="../../b0.b00.kit/B00_pager/index.html">B00_pager</a></li><li><a href="../../b0.b00.kit/B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="../../b0.b00.kit/B00_rsync/index.html">B00_rsync</a></li><li><a href="../../b0.b00.kit/B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="../../b0.b00.kit/B00_serialk_sexp/index.html">B00_serialk_sexp</a></li><li><a href="../../b0.b00.kit/B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="../../b0.b00.kit/B00_trace/index.html">B00_trace</a></li><li><a href="../../b0.b00.kit/B00_vcs/index.html">B00_vcs</a></li><li><a href="../../b0.b00.kit/B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="../B0_expect/index.html">B0_expect</a></li><li><a href="../B0_jsoo/index.html">B0_jsoo</a></li><li><a href="../B0_kit/index.html">B0_kit</a></li><li><a href="#" class="current_unit">B0_ocaml</a><ul><li><a href="Meta/index.html">Meta</a></li></ul></li><li><a href="../B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="../B0_opam/index.html">B0_opam</a></li><li><a href="../B0_release/index.html">B0_release</a></li><li><a href="../B0_srcs/index.html">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="../../b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="units"><a href="#units" class="anchor"></a>Units</h2><p>A few high-level build units.</p><div class="odoc-spec"><div class="spec value anchored" id="val-libname"><a href="#val-libname" class="anchor"></a><code><span><span class="keyword">val</span> libname : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html#type-t">B00_ocaml.Lib.Name.t</a></span></code></div><div class="spec-doc"><p><code>libname n</code> is <code>n</code> as an OCaml <a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html" title="B00_ocaml.Lib.Name">library name</a>. This is shortcut for <a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html#val-v"><code>B00_ocaml.Lib.Name.v</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exe"><a href="#val-exe" class="anchor"></a><code><span><span class="keyword">val</span> exe : 
  <span><span class="optlabel">?wrap</span>:<span>(<span><a href="../../b0/B0_unit/index.html#type-proc">B0_unit.proc</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../b0/B0_unit/index.html#type-proc">B0_unit.proc</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?doc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?meta</span>:<a href="../../b0/B0_meta/index.html#type-t">B0_meta.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?action</span>:<a href="../../b0/B0_unit/index.html#type-action">B0_unit.action</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?c_requires</span>:<a href="../../b0.std/B0_std/Cmd/index.html#type-t">B0_std.Cmd.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?requires</span>:<span><a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html#type-t">B00_ocaml.Lib.Name.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">srcs</span>:<a href="../B0_srcs/index.html#type-sels">B0_srcs.sels</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../b0/B0_unit/index.html#type-t">B0_unit.t</a></span></code></div><div class="spec-doc"><p><code>exe n</code> is a build unit for an executable named <code>n</code> (without the platform specific extension).</p><ul><li><code>doc</code> is the unit doc string.</li><li><code>meta</code> is the initial metadata.</li><li><code>c_requires</code> FIXME hack, something more sensitive should be done. This each of these options are passed as <code>-cclib</code> options.</li><li><code>requires</code> are the OCaml libraries required to compile the executable.</li><li><code>name</code> is the name of the unit (defaults to <code>n</code>).</li><li><code>srcs</code> are the executable sources. All files with extension <code>.ml</code>, <code>.mli</code>, <code>.c</code> and <code>.h</code> are considered for compiling and linking the executable.</li><li><code>wrap</code> allows to extend the build procedure you must call the given build procedure. TODO maybe remove once we have good <a href="#frag" title="frag">Build fragments</a>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib"><a href="#val-lib" class="anchor"></a><code><span><span class="keyword">val</span> lib : 
  <span><span class="optlabel">?wrap</span>:<span>(<span><a href="../../b0/B0_unit/index.html#type-proc">B0_unit.proc</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../b0/B0_unit/index.html#type-proc">B0_unit.proc</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?doc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?meta</span>:<a href="../../b0/B0_meta/index.html#type-t">B0_meta.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?action</span>:<a href="../../b0/B0_unit/index.html#type-action">B0_unit.action</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?c_requires</span>:<a href="../../b0.std/B0_std/Cmd/index.html#type-t">B0_std.Cmd.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?requires</span>:<span><a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html#type-t">B00_ocaml.Lib.Name.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0.b00.kit/B00_ocaml/Lib/Name/index.html#type-t">B00_ocaml.Lib.Name.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">srcs</span>:<a href="../B0_srcs/index.html#type-sels">B0_srcs.sels</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../b0/B0_unit/index.html#type-t">B0_unit.t</a></span></code></div><div class="spec-doc"><p><code>lib n ~srcs</code> is a built unit for a library named <code>l</code> made of sources <code>src</code>.</p><ul><li><code>doc</code> is the unit doc string.</li><li><code>meta</code> is the initial metadata.</li><li><code>c_requires</code> FIXME hack, something more sensitive should be done. This each of these options are passed as <code>-cclib</code> options.</li><li><code>requires</code> are the OCaml libraries required to compile the library.</li><li><code>name</code> is the name of the build unit (default to <code>n</code> with <code>.</code> substituted by <code>-</code>)</li><li><code>srcs</code> are the library sources. extension <code>.ml</code>, <code>.mli</code>, <code>.c</code> and <code>.h</code> are considered for compiling and linking the executable.</li><li><code>wrap</code> allows to extend the build procedure you must call the given build procedure. TODO maybe remove once we have good <a href="#frag" title="frag">Build fragments</a>.</li></ul></div></div><h2 id="build_conf"><a href="#build_conf" class="anchor"></a>Build configuration</h2><div class="odoc-spec"><div class="spec value anchored" id="val-conf"><a href="#val-conf" class="anchor"></a><code><span><span class="keyword">val</span> conf : <span><a href="../../b0.b00.kit/B00_ocaml/Conf/index.html#type-t">B00_ocaml.Conf.t</a> <a href="../../b0.b00/B00/Store/index.html#type-key">B00.Store.key</a></span></span></code></div><div class="spec-doc"><p><code>conf</code> is a memo key store with the OCaml configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-version"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : <span><a href="../../b0/B0_build/index.html#type-t">B0_build.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(int * int * int * <span>string option</span>)</span> <a href="../../b0.std/B0_std/Fut/index.html#type-t">B0_std.Fut.t</a></span></span></code></div><div class="spec-doc"><p><code>ocaml_version b</code> gets <code>B00_ocaml.Tool.Conf.version</code> from <a href="#val-conf"><code>conf</code></a>.</p></div></div><h3 id="code"><a href="#code" class="anchor"></a>Generated code</h3><p>In a build it is desirable to know which code is being produced because if both are produced the compilers may compete to produce some of the shared build artefacts. The following store keys allow to express build code <a href="#val-wanted_code" title="wanted_code">desires</a> and determine the actual <a href="#val-built_code" title="built_code">decision</a>. Note the desires may actually be altered units that may build FIXME maybe we should stick to must.</p><div class="odoc-spec"><div class="spec type anchored" id="type-built_code"><a href="#type-built_code" class="anchor"></a><code><span><span class="keyword">type</span> built_code</span><span> = </span><span>[ </span></code><ol><li id="type-built_code.Byte" class="def variant constructor anchored"><a href="#type-built_code.Byte" class="anchor"></a><code><span>| </span><span>`Byte</span></code></li><li id="type-built_code.Native" class="def variant constructor anchored"><a href="#type-built_code.Native" class="anchor"></a><code><span>| </span><span>`Native</span></code></li><li id="type-built_code.All" class="def variant constructor anchored"><a href="#type-built_code.All" class="anchor"></a><code><span>| </span><span>`All</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type indicating which code is being built.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_built_code"><a href="#val-pp_built_code" class="anchor"></a><code><span><span class="keyword">val</span> pp_built_code : <span><a href="#type-built_code">built_code</a> <a href="../../b0.std/B0_std/Fmt/index.html#type-t">B0_std.Fmt.t</a></span></span></code></div><div class="spec-doc"><p><code>pp_built_code</code> formats <a href="#type-built_code"><code>built_code</code></a> values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wanted_code"><a href="#val-wanted_code" class="anchor"></a><code><span><span class="keyword">val</span> wanted_code : <span><span>[ <a href="#type-built_code">built_code</a> <span>| `Auto</span> ]</span> <a href="../../b0.b00/B00/Store/index.html#type-key">B00.Store.key</a></span></span></code></div><div class="spec-doc"><p><code>wanted_code</code> indicates which code should be built, default determines to <code>`Auto</code>. If <code>`Auto</code> is used and no unit that may build has specific <a href="Meta/index.html#val-needs_code"><code>Meta.needs_code</code></a> then <code>`Native</code> is used if <code>ocamlopt</code> can be found in the memo environment and <code>`Byte</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-built_code"><a href="#val-built_code" class="anchor"></a><code><span><span class="keyword">val</span> built_code : <span><a href="#type-built_code">built_code</a> <a href="../../b0.b00/B00/Store/index.html#type-key">B00.Store.key</a></span></span></code></div><div class="spec-doc"><p><code>build_code</code> is a memo key indicating the built code. By default determines by consulting <code>wanted_code</code>.</p></div></div><h2 id="frag"><a href="#frag" class="anchor"></a>Build fragments</h2><p>See <span class="xref-unresolved" title="TODO.frag">TODO</span>.</p><h2 id="metadata"><a href="#metadata" class="anchor"></a>Metadata</h2><div class="odoc-spec"><div class="spec value anchored" id="val-tag"><a href="#val-tag" class="anchor"></a><code><span><span class="keyword">val</span> tag : <span>unit <a href="../../b0/B0_meta/index.html#type-key">B0_meta.key</a></span></span></code></div><div class="spec-doc"><p><code>tag</code> indicates the entity is related to OCaml.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Meta"><a href="#module-Meta" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Meta/index.html">Meta</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Metadata keys</p></div></div><h2 id="lib"><a href="#lib" class="anchor"></a>Library resolution</h2><div class="odoc-spec"><div class="spec value anchored" id="val-lib_resolver"><a href="#val-lib_resolver" class="anchor"></a><code><span><span class="keyword">val</span> lib_resolver : <span><a href="../../b0.b00.kit/B00_ocaml/Lib/Resolver/index.html#type-t">B00_ocaml.Lib.Resolver.t</a> <a href="../../b0.b00/B00/Store/index.html#type-key">B00.Store.key</a></span></span></code></div><div class="spec-doc"><p><code>lib_resolver</code> is the library resolver used by the build units defined by this module. See <a href="#val-default_lib_resolver"><code>default_lib_resolver</code></a> for the default.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_lib_resolver"><a href="#val-default_lib_resolver" class="anchor"></a><code><span><span class="keyword">val</span> default_lib_resolver : 
  <span><a href="../../b0.b00/B00/Store/index.html#type-t">B00.Store.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0.b00/B00/Memo/index.html#type-t">B00.Memo.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0.b00.kit/B00_ocaml/Lib/Resolver/index.html#type-t">B00_ocaml.Lib.Resolver.t</a> <a href="../../b0.std/B0_std/Fut/index.html#type-t">B0_std.Fut.t</a></span></span></code></div><div class="spec-doc"><p><code>default_lib_resolver</code> determines the default value of <a href="#val-lib_resolver"><code>lib_resolver</code></a>. This resolver does the following:</p><ol><li>It first looks if the library name is <a href="Meta/index.html#val-library" title="Meta.library">defined</a> by a unit that <a href="../../b0/B0_build/index.html#val-may_build" title="B0_build.may_build">may</a> be built. If that is the case it creates a library out of that build unit via <a href="#val-lib_of_unit"><code>lib_of_unit</code></a>.</li><li>It looks into the build environment via <a href="../../b0.b00.kit/B00_ocaml/Lib/Resolver/index.html#val-ocamlpath"><code>B00_ocaml.Lib.Resolver.ocamlpath</code></a> and <a href="../../b0.b00.kit/B00_ocaml/Lib/Resolver/index.html#val-ocamlfind"><code>B00_ocaml.Lib.Resolver.ocamlfind</code></a> using the <a href="../../b0/B0_build/index.html#val-shared_build_dir"><code>B0_build.shared_build_dir</code></a> directory of the build.</li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib_of_unit"><a href="#val-lib_of_unit" class="anchor"></a><code><span><span class="keyword">val</span> lib_of_unit : 
  <span><a href="../../b0/B0_build/index.html#type-t">B0_build.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0.b00.kit/B00_ocaml/Conf/index.html#type-t">B00_ocaml.Conf.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0/B0_unit/index.html#type-t">B0_unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../b0.b00.kit/B00_ocaml/Lib/index.html#type-t">B00_ocaml.Lib.t</a> option</span> <a href="../../b0.std/B0_std/Fut/index.html#type-t">B0_std.Fut.t</a></span></span></code></div><div class="spec-doc"><p><code>lib_of_unit b ocaml_conf u</code> defines a library from unit <code>u</code> by consulting <a href="Meta/index.html#val-requires"><code>Meta.requires</code></a>, <a href="Meta/index.html#val-library"><code>Meta.library</code></a> and <a href="Meta/index.html#val-mod_srcs"><code>Meta.mod_srcs</code></a>. As a side effect this <a href="../../b0/B0_build/index.html#val-require"><code>B0_build.require</code></a> <code>u</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib_resolver_build_scope"><a href="#val-lib_resolver_build_scope" class="anchor"></a><code><span><span class="keyword">val</span> lib_resolver_build_scope : 
  <span><a href="../../b0/B0_build/index.html#type-t">B0_build.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../b0.b00.kit/B00_ocaml/Conf/index.html#type-t">B00_ocaml.Conf.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../b0.b00.kit/B00_ocaml/Lib/Resolver/index.html#type-scope">B00_ocaml.Lib.Resolver.scope</a></span></code></div><div class="spec-doc"><p><code>lib_resolver_build_scope b conf</code> is a library resolver scope for OCaml libraries that can be built in <code>b</code>. For a unit <code>u</code> to be recognized as such it has to:</p><ul><li>Be in the <a href="../../b0/B0_build/index.html#val-may_build"><code>B0_build.may_build</code></a> set of <code>b</code>.</li><li>Define the <a href="Meta/index.html#val-library"><code>Meta.library</code></a> and <a href="Meta/index.html#val-requires"><code>Meta.requires</code></a> in its metadata.</li></ul></div></div></div></body></html>
