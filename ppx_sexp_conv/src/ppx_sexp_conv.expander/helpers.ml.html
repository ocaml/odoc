<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: helpers.ml (ppx_sexp_conv.src.ppx_sexp_conv.expander)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">ppx_sexp_conv</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; ppx_sexp_conv.expander &#x00BB; helpers.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>helpers.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">ppx_sexp_conv</a><ul><li>Library <code>ppx_sexp_conv</code><ul><li><a href="../../ppx_sexp_conv/Ppx_sexp_conv/index.html">Ppx_sexp_conv</a></li></ul></li><li>Library <code>ppx_sexp_conv.expander</code><ul><li><a href="../../ppx_sexp_conv.expander/Ppx_sexp_conv_expander/index.html">Ppx_sexp_conv_expander</a></li></ul></li><li>Library <code>ppx_sexp_conv.runtime-lib</code><ul><li><a href="../../ppx_sexp_conv.runtime-lib/Ppx_sexp_conv_lib/index.html">Ppx_sexp_conv_lib</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>ppx_sexp_conv<ul><li><a href="../ppx_sexp_conv/ppx_sexp_conv.ml.html">ppx_sexp_conv.ml</a></li></ul></li><li>ppx_sexp_conv.expander<ul><li><a href="attrs.ml.html">attrs.ml</a></li><li><a href="conversion.ml.html">conversion.ml</a></li><li><a href="expand_of_sexp.ml.html">expand_of_sexp.ml</a></li><li><a href="expand_sexp_of.ml.html">expand_sexp_of.ml</a></li><li><a href="fresh_name.ml.html">fresh_name.ml</a></li><li><a href="#" class="current_unit">helpers.ml</a></li><li><a href="lifted.ml.html">lifted.ml</a></li><li><a href="ppx_sexp_conv_expander.ml.html">ppx_sexp_conv_expander.ml</a></li><li><a href="ppx_sexp_conv_expander__.ml.html">ppx_sexp_conv_expander__.ml</a></li><li><a href="ppx_sexp_conv_grammar.ml.html">ppx_sexp_conv_grammar.ml</a></li><li><a href="record_field_attrs.ml.html">record_field_attrs.ml</a></li><li><a href="renaming.ml.html">renaming.ml</a></li></ul></li><li>ppx_sexp_conv.runtime-lib<ul><li><a href="../ppx_sexp_conv.runtime-lib/ppx_sexp_conv_lib.ml.html">ppx_sexp_conv_lib.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
</code><code class="source_code"><span><span class="OPEN">open</span><span class="BANG">!</span> <a href="../../../base/src/base/base.ml.html"><span class="UIDENT">Base</span></a><span class="EOL">
</span><span class="OPEN">open</span><span class="BANG">!</span> <a href="../../../ppxlib/src/ppxlib/ppxlib.ml.html"><span class="UIDENT">Ppxlib</span></a><span class="EOL">
</span><span class="OPEN">open</span> <a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default"><span class="UIDENT">Ast_builder</span><span class="DOT">.</span><span class="UIDENT">Default</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-(--&gt;)"><span class="LPAREN">(</span> <span class="INFIXOP2">--&gt;</span> <span class="RPAREN">)</span></span> <span id="local_lhs_1"><span class="LIDENT">lhs</span></span> <span id="local_rhs_2"><span class="LIDENT">rhs</span></span> <span class="EQUAL">=</span> <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-case"><span class="LIDENT">case</span></a> <span class="LABEL">~guard:</span><span class="UIDENT">None</span> <span class="TILDE">~</span><a href="#local_lhs_1"><span class="LIDENT">lhs</span></a> <span class="TILDE">~</span><a href="#local_rhs_2"><span class="LIDENT">rhs</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Utility functions *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-replace_variables_by_underscores"><span class="LIDENT">replace_variables_by_underscores</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_map_3"><span class="LIDENT">map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="OBJECT">object</span><span class="EOL">
</span>      <span class="INHERIT">inherit</span> <span class="UIDENT">Ast_traverse</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="AS">as</span> <span class="LIDENT">super</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">core_type_desc</span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Ptyp_var</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ptyp_any</span><span class="EOL">
</span>        <span class="BAR">|</span> <span id="local_t_4"><span class="LIDENT">t</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">super</span><span class="HASH">#</span><span class="LIDENT">core_type_desc</span> <a href="#local_t_4"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_map_3"><span class="LIDENT">map</span></a><span class="HASH">#</span><span class="LIDENT">core_type</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-make_rigid_types"><span class="LIDENT">make_rigid_types</span></span> <span id="local_tps_5"><span class="LIDENT">tps</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../base/src/base/list0.ml.html#val-fold"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold</span></a><span class="EOL">
</span>    <a href="#local_tps_5"><span class="LIDENT">tps</span></a><span class="EOL">
</span>    <span class="LABEL">~init:</span><span class="LPAREN">(</span><a href="../../../base/src/base/map.ml.html#val-empty"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">empty</span></a> <span class="LPAREN">(</span><span class="MODULE">module</span> <a href="../../../base/src/base/string.ml.html"><span class="UIDENT">String</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_map_6"><span class="LIDENT">map</span></span> <span id="local_tp_7"><span class="LIDENT">tp</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="../../../base/src/base/map.ml.html#module-Accessors.val-update"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">update</span></a> <a href="#local_map_6"><span class="LIDENT">map</span></a> <a href="#local_tp_7"><span class="LIDENT">tp</span></a><span class="DOT">.</span><span class="LIDENT">txt</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="fresh_name.ml.html#val-of_string_loc"><span class="UIDENT">Fresh_name</span><span class="DOT">.</span><span class="LIDENT">of_string_loc</span></a> <a href="#local_tp_7"><span class="LIDENT">tp</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_fresh_8"><span class="LIDENT">fresh</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* Ignore duplicate names, the typechecker will raise after expansion. *)</span><span class="EOL">
</span>          <a href="#local_fresh_8"><span class="LIDENT">fresh</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-find_rigid_type"><span class="LIDENT">find_rigid_type</span></span> <span class="TILDE">~</span><span id="local_loc_9"><span class="LIDENT">loc</span></span> <span class="TILDE">~</span><span id="local_rigid_types_10"><span class="LIDENT">rigid_types</span></span> <span id="local_name_11"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="../../../base/src/base/map.ml.html#module-Accessors.val-find"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <a href="#local_rigid_types_10"><span class="LIDENT">rigid_types</span></a> <a href="#local_name_11"><span class="LIDENT">name</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_tp_12"><span class="LIDENT">tp</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="fresh_name.ml.html#val-to_string_loc"><span class="UIDENT">Fresh_name</span><span class="DOT">.</span><span class="LIDENT">to_string_loc</span></a> <a href="#local_tp_12"><span class="LIDENT">tp</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="COMMENT">(* Ignore unbound type names, the typechecker will raise after expansion. *)</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span class="LIDENT">txt</span> <span class="EQUAL">=</span> <a href="#local_name_11"><span class="LIDENT">name</span></a><span class="SEMI">;</span> <a href="#local_loc_9"><span class="LIDENT">loc</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-make_type_rigid"><span class="LIDENT">make_type_rigid</span></span> <span class="TILDE">~</span><span id="local_rigid_types_13"><span class="LIDENT">rigid_types</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_map_14"><span class="LIDENT">map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="OBJECT">object</span><span class="EOL">
</span>      <span class="INHERIT">inherit</span> <span class="UIDENT">Ast_traverse</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="AS">as</span> <span class="LIDENT">super</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">core_type</span> <span id="local_ty_15"><span class="LIDENT">ty</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_ptyp_desc_16"><span class="LIDENT">ptyp_desc</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_ty_15"><span class="LIDENT">ty</span></a><span class="DOT">.</span><span class="LIDENT">ptyp_desc</span> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">Ptyp_var</span> <span id="local_s_17"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="UIDENT">Ptyp_constr</span><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default.module-Located.val-map_lident"><span class="UIDENT">Located</span><span class="DOT">.</span><span class="LIDENT">map_lident</span></a> <span class="LPAREN">(</span><span class="LIDENT">find_rigid_type</span> <span class="LABEL">~loc:</span><a href="#local_ty_15"><span class="LIDENT">ty</span></a><span class="DOT">.</span><span class="LIDENT">ptyp_loc</span> <span class="TILDE">~</span><a href="#local_rigid_types_13"><span class="LIDENT">rigid_types</span></a> <a href="#local_s_17"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="BAR">|</span> <span id="local_desc_18"><span class="LIDENT">desc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">super</span><span class="HASH">#</span><span class="LIDENT">core_type_desc</span> <a href="#local_desc_18"><span class="LIDENT">desc</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LBRACE">{</span> <a href="#local_ty_15"><span class="LIDENT">ty</span></a> <span class="WITH">with</span> <a href="#local_ptyp_desc_16"><span class="LIDENT">ptyp_desc</span></a> <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_map_14"><span class="LIDENT">map</span></a><span class="HASH">#</span><span class="LIDENT">core_type</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Generates the quantified type [ ! 'a .. 'z . (make_mono_type t ('a .. 'z)) ] or
   [type a .. z. make_mono_type t (a .. z)] when [use_rigid_variables] is true.
   Annotation are needed for non regular recursive datatypes and gadt when the return type
   of constructors are constrained. Unfortunately, putting rigid variables everywhere does
   not work because of certains types with constraints. We thus only use rigid variables
   for sum types, which includes all GADTs. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-tvars_of_core_type"><span class="LIDENT">tvars_of_core_type</span></span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-core_type"><span class="LIDENT">core_type</span></a> <span class="MINUSGREATER">-&gt;</span> <a href="../../../base/src/base/base.ml.html#module-Export.type-list"><a href="../../../base/src/base/base.ml.html#module-Export.type-string"><span class="LIDENT">string</span></a> <span class="LIDENT">list</span></a> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_tvars_19"><span class="LIDENT">tvars</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="OBJECT">object</span><span class="EOL">
</span>      <span class="INHERIT">inherit</span> <span class="LBRACKET">[</span><a href="../../../base/src/base/base.ml.html#module-Export.type-list"><a href="../../../base/src/base/base.ml.html#module-Export.type-string"><span class="LIDENT">string</span></a> <span class="LIDENT">list</span></a><span class="RBRACKET">]</span> <span class="UIDENT">Ast_traverse</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="AS">as</span> <span class="LIDENT">super</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">core_type</span> <span id="local_x_20"><span class="LIDENT">x</span></span> <span id="local_acc_21"><span class="LIDENT">acc</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_x_20"><span class="LIDENT">x</span></a><span class="DOT">.</span><span class="LIDENT">ptyp_desc</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Ptyp_var</span> <span id="local_x_22"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="../../../base/src/base/list.ml.html#val-mem"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">mem</span></a> <a href="#local_acc_21"><span class="LIDENT">acc</span></a> <a href="#local_x_22"><span class="LIDENT">x</span></a> <span class="LABEL">~equal:</span><a href="../../../base/src/base/import0.ml.html#module-String_replace_polymorphic_compare.val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="THEN">then</span> <a href="#local_acc_21"><span class="LIDENT">acc</span></a> <span class="ELSE">else</span> <a href="#local_x_22"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_21"><span class="LIDENT">acc</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">super</span><span class="HASH">#</span><span class="LIDENT">core_type</span> <a href="#local_x_20"><span class="LIDENT">x</span></a> <a href="#local_acc_21"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_typ_23"><span class="LIDENT">typ</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../base/src/base/list0.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <span class="LPAREN">(</span><a href="#local_tvars_19"><span class="LIDENT">tvars</span></a><span class="HASH">#</span><span class="LIDENT">core_type</span> <a href="#local_typ_23"><span class="LIDENT">typ</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-constrained_function_binding"><span class="LIDENT">constrained_function_binding</span></span><span class="EOL">
</span>      <span class="COMMENT">(* placing a suitably polymorphic or rigid type constraint on the pattern or body *)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span id="local_loc_24"><span class="LIDENT">loc</span></span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib/location.ml.html#type-t"><span class="UIDENT">Location</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span id="local_td_25"><span class="LIDENT">td</span></span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-type_declaration"><span class="LIDENT">type_declaration</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span id="local_typ_26"><span class="LIDENT">typ</span></span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-core_type"><span class="LIDENT">core_type</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="TILDE">~</span><span class="LPAREN">(</span><span id="local_tps_27"><span class="LIDENT">tps</span></span> <span class="COLON">:</span> <a href="../../../base/src/base/base.ml.html#module-Export.type-list"><a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-loc"><a href="../../../base/src/base/base.ml.html#module-Export.type-string"><span class="LIDENT">string</span></a> <span class="LIDENT">loc</span></a> <span class="LIDENT">list</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="TILDE">~</span><span class="LPAREN">(</span><span id="local_func_name_28"><span class="LIDENT">func_name</span></span> <span class="COLON">:</span> <a href="../../../base/src/base/base.ml.html#module-Export.type-string"><span class="LIDENT">string</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span id="local_body_29"><span class="LIDENT">body</span></span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-expression"><span class="LIDENT">expression</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_vars_30"><span class="LIDENT">vars</span></span> <span class="EQUAL">=</span> <span class="LIDENT">tvars_of_core_type</span> <a href="#local_typ_26"><span class="LIDENT">typ</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_has_vars_31"><span class="LIDENT">has_vars</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_vars_30"><span class="LIDENT">vars</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="COLONCOLON">::</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_pat_32"><span class="LIDENT">pat</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_pat_33"><span class="LIDENT">pat</span></span> <span class="EQUAL">=</span> <a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default.val-pvar"><span class="LIDENT">pvar</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <a href="#local_func_name_28"><span class="LIDENT">func_name</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../base/src/base/base.ml.html#module-Export.val-not"><span class="LIDENT">not</span></a> <a href="#local_has_vars_31"><span class="LIDENT">has_vars</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_pat_33"><span class="LIDENT">pat</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_vars_34"><span class="LIDENT">vars</span></span> <span class="EQUAL">=</span> <a href="../../../base/src/base/list.ml.html#module-Cartesian_product.val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_txt_35"><span class="LIDENT">txt</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACE">{</span> <a href="#local_txt_35"><span class="LIDENT">txt</span></a><span class="SEMI">;</span> <a href="#local_loc_24"><span class="LIDENT">loc</span></a> <span class="RBRACE">}</span><span class="RPAREN">)</span> <a href="#local_vars_30"><span class="LIDENT">vars</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-ppat_constraint"><span class="LIDENT">ppat_constraint</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <a href="#local_pat_33"><span class="LIDENT">pat</span></a> <span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default.val-ptyp_poly"><span class="LIDENT">ptyp_poly</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <a href="#local_vars_34"><span class="LIDENT">vars</span></a> <a href="#local_typ_26"><span class="LIDENT">typ</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_body_36"><span class="LIDENT">body</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_use_rigid_variables_37"><span class="LIDENT">use_rigid_variables</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_td_25"><span class="LIDENT">td</span></a><span class="DOT">.</span><span class="LIDENT">ptype_kind</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ptype_variant</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_use_rigid_variables_37"><span class="LIDENT">use_rigid_variables</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_rigid_types_38"><span class="LIDENT">rigid_types</span></span> <span class="EQUAL">=</span> <span class="LIDENT">make_rigid_types</span> <a href="#local_tps_27"><span class="LIDENT">tps</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../base/src/base/list0.ml.html#val-fold_right"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_right</span></a><span class="EOL">
</span>        <a href="#local_tps_27"><span class="LIDENT">tps</span></a><span class="EOL">
</span>        <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_tp_39"><span class="LIDENT">tp</span></span> <span id="local_body_40"><span class="LIDENT">body</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_newtype"><span class="LIDENT">pexp_newtype</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <span class="LPAREN">(</span><span class="LIDENT">find_rigid_type</span> <span class="LABEL">~loc:</span><a href="#local_tp_39"><span class="LIDENT">tp</span></a><span class="DOT">.</span><span class="LIDENT">loc</span> <span class="TILDE">~</span><a href="#local_rigid_types_38"><span class="LIDENT">rigid_types</span></a> <a href="#local_tp_39"><span class="LIDENT">tp</span></a><span class="DOT">.</span><span class="LIDENT">txt</span><span class="RPAREN">)</span> <a href="#local_body_40"><span class="LIDENT">body</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LABEL">~init:</span><span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_constraint"><span class="LIDENT">pexp_constraint</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <a href="#local_body_29"><span class="LIDENT">body</span></a> <span class="LPAREN">(</span><span class="LIDENT">make_type_rigid</span> <span class="TILDE">~</span><a href="#local_rigid_types_38"><span class="LIDENT">rigid_types</span></a> <a href="#local_typ_26"><span class="LIDENT">typ</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_has_vars_31"><span class="LIDENT">has_vars</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_body_29"><span class="LIDENT">body</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_constraint"><span class="LIDENT">pexp_constraint</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <a href="#local_body_29"><span class="LIDENT">body</span></a> <a href="#local_typ_26"><span class="LIDENT">typ</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-value_binding"><span class="LIDENT">value_binding</span></a> <span class="TILDE">~</span><a href="#local_loc_24"><span class="LIDENT">loc</span></a> <span class="TILDE">~</span><a href="#local_pat_32"><span class="LIDENT">pat</span></a> <span class="LABEL">~expr:</span><a href="#local_body_36"><span class="LIDENT">body</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-with_let"><span class="LIDENT">with_let</span></span> <span class="TILDE">~</span><span id="local_loc_41"><span class="LIDENT">loc</span></span> <span class="TILDE">~</span><span id="local_binds_42"><span class="LIDENT">binds</span></span> <span id="local_body_43"><span class="LIDENT">body</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../base/src/base/list0.ml.html#val-fold_right"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_right</span></a> <a href="#local_binds_42"><span class="LIDENT">binds</span></a> <span class="LABEL">~init:</span><a href="#local_body_43"><span class="LIDENT">body</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_bind_44"><span class="LIDENT">bind</span></span> <span id="local_body_45"><span class="LIDENT">body</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../base/src/base/list1.ml.html#val-is_empty"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">is_empty</span></a> <a href="#local_bind_44"><span class="LIDENT">bind</span></a> <span class="THEN">then</span> <a href="#local_body_45"><span class="LIDENT">body</span></a> <span class="ELSE">else</span> <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_let"><span class="LIDENT">pexp_let</span></a> <span class="TILDE">~</span><a href="#local_loc_41"><span class="LIDENT">loc</span></a> <span class="UIDENT">Nonrecursive</span> <a href="#local_bind_44"><span class="LIDENT">bind</span></a> <a href="#local_body_45"><span class="LIDENT">body</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-with_types"><span class="LIDENT">with_types</span></span> <span class="TILDE">~</span><span id="local_loc_46"><span class="LIDENT">loc</span></span> <span class="TILDE">~</span><span id="local_types_47"><span class="LIDENT">types</span></span> <span id="local_body_48"><span class="LIDENT">body</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="../../../base/src/base/list1.ml.html#val-is_empty"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">is_empty</span></a> <a href="#local_types_47"><span class="LIDENT">types</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_body_48"><span class="LIDENT">body</span></a><span class="EOL">
</span>  <span class="ELSE">else</span><span class="EOL">
</span>    <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_open"><span class="LIDENT">pexp_open</span></a><span class="EOL">
</span>      <span class="TILDE">~</span><a href="#local_loc_46"><span class="LIDENT">loc</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-open_infos"><span class="LIDENT">open_infos</span></a><span class="EOL">
</span>         <span class="TILDE">~</span><a href="#local_loc_46"><span class="LIDENT">loc</span></a><span class="EOL">
</span>         <span class="LABEL">~override:</span><span class="UIDENT">Fresh</span><span class="EOL">
</span>         <span class="LABEL">~expr:</span><span class="EOL">
</span>           <span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pmod_structure"><span class="LIDENT">pmod_structure</span></a><span class="EOL">
</span>              <span class="TILDE">~</span><a href="#local_loc_46"><span class="LIDENT">loc</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../base/src/base/list.ml.html#module-Cartesian_product.val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_types_47"><span class="LIDENT">types</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_type_decl_49"><span class="LIDENT">type_decl</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pstr_type"><span class="LIDENT">pstr_type</span></a> <span class="TILDE">~</span><a href="#local_loc_46"><span class="LIDENT">loc</span></a> <span class="UIDENT">Recursive</span> <span class="LBRACKET">[</span> <a href="#local_type_decl_49"><span class="LIDENT">type_decl</span></a> <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="#local_body_48"><span class="LIDENT">body</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-fresh_lambda"><span class="LIDENT">fresh_lambda</span></span> <span class="TILDE">~</span><span id="local_loc_50"><span class="LIDENT">loc</span></span> <span id="local_apply_51"><span class="LIDENT">apply</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_var_52"><span class="LIDENT">var</span></span> <span class="EQUAL">=</span> <a href="../../../ppxlib/src/ppxlib/common.ml.html#val-gen_symbol"><span class="LIDENT">gen_symbol</span></a> <span class="LABEL">~prefix:</span><span class="STRING">&quot;x&quot;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_pat_53"><span class="LIDENT">pat</span></span> <span class="EQUAL">=</span> <a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default.val-pvar"><span class="LIDENT">pvar</span></a> <span class="TILDE">~</span><a href="#local_loc_50"><span class="LIDENT">loc</span></a> <a href="#local_var_52"><span class="LIDENT">var</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_arg_54"><span class="LIDENT">arg</span></span> <span class="EQUAL">=</span> <a href="../../../ppxlib/src/ppxlib/ast_builder.ml.html#module-Default.val-evar"><span class="LIDENT">evar</span></a> <span class="TILDE">~</span><a href="#local_loc_50"><span class="LIDENT">loc</span></a> <a href="#local_var_52"><span class="LIDENT">var</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_body_55"><span class="LIDENT">body</span></span> <span class="EQUAL">=</span> <a href="#local_apply_51"><span class="LIDENT">apply</span></a> <span class="TILDE">~</span><a href="#local_arg_54"><span class="LIDENT">arg</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ppxlib/src/ppxlib/ast_builder_generated.ml.html#module-M.val-pexp_fun"><span class="LIDENT">pexp_fun</span></a> <span class="TILDE">~</span><a href="#local_loc_50"><span class="LIDENT">loc</span></a> <span class="UIDENT">Nolabel</span> <span class="UIDENT">None</span> <a href="#local_pat_53"><span class="LIDENT">pat</span></a> <a href="#local_body_55"><span class="LIDENT">body</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-is_value_expression"><span class="LIDENT">is_value_expression</span></span> <span id="local_expr_56"><span class="LIDENT">expr</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_expr_56"><span class="LIDENT">expr</span></a><span class="DOT">.</span><span class="LIDENT">pexp_desc</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="COMMENT">(* Syntactic values. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_ident</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Pexp_constant</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Pexp_function</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Pexp_fun</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Pexp_lazy</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>  <span class="COMMENT">(* Type-only wrappers; we check their contents. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_constraint</span> <span class="LPAREN">(</span><span id="local_expr_57"><span class="LIDENT">expr</span></span><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-core_type"><span class="LIDENT">core_type</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_coerce</span> <span class="LPAREN">(</span><span id="local_expr_58"><span class="LIDENT">expr</span></span><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <a href="../../../base/src/base/base.ml.html#module-Export.type-option"><a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-core_type"><span class="LIDENT">core_type</span></a> <span class="LIDENT">option</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-core_type"><span class="LIDENT">core_type</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_newtype</span> <span class="LPAREN">(</span><span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <a href="../../../ppxlib/src/ppxlib.ast/ast.ml.html#type-loc"><a href="../../../base/src/base/base.ml.html#module-Export.type-string"><span class="LIDENT">string</span></a> <span class="LIDENT">loc</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <span id="local_expr_59"><span class="LIDENT">expr</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">is_value_expression</span> <a href="#local_expr_59"><span class="LIDENT">expr</span></a><span class="EOL">
</span>  <span class="COMMENT">(* Allocating constructors; they are only values if all of their contents are. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_tuple</span> <span id="local_exprs_60"><span class="LIDENT">exprs</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../base/src/base/list0.ml.html#val-for_all"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <a href="#local_exprs_60"><span class="LIDENT">exprs</span></a> <span class="LABEL">~f:</span><span class="LIDENT">is_value_expression</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_construct</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_maybe_expr_61"><span class="LIDENT">maybe_expr</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../base/src/base/option.ml.html#val-for_all"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <a href="#local_maybe_expr_61"><span class="LIDENT">maybe_expr</span></a> <span class="LABEL">~f:</span><span class="LIDENT">is_value_expression</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_variant</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_maybe_expr_62"><span class="LIDENT">maybe_expr</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../base/src/base/option.ml.html#val-for_all"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <a href="#local_maybe_expr_62"><span class="LIDENT">maybe_expr</span></a> <span class="LABEL">~f:</span><span class="LIDENT">is_value_expression</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_record</span> <span class="LPAREN">(</span><span id="local_fields_63"><span class="LIDENT">fields</span></span><span class="COMMA">,</span> <span id="local_maybe_expr_64"><span class="LIDENT">maybe_expr</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="../../../base/src/base/list0.ml.html#val-for_all"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <a href="#local_fields_63"><span class="LIDENT">fields</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_expr_65"><span class="LIDENT">expr</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">is_value_expression</span> <a href="#local_expr_65"><span class="LIDENT">expr</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <a href="../../../base/src/base/base.ml.html#module-Export.val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="../../../base/src/base/option.ml.html#val-for_all"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <a href="#local_maybe_expr_64"><span class="LIDENT">maybe_expr</span></a> <span class="LABEL">~f:</span><span class="LIDENT">is_value_expression</span><span class="EOL">
</span>  <span class="COMMENT">(* Not values, or not always values. We make a conservative approximation. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_unreachable</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_let</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_apply</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_match</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_try</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_field</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_setfield</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_array</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_ifthenelse</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_sequence</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_while</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_for</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_send</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_new</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_setinstvar</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_override</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_letmodule</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_letexception</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_assert</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_poly</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_object</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_pack</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_open</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_letop</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Pexp_extension</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-really_recursive_respecting_opaque"><span class="LIDENT">really_recursive_respecting_opaque</span></span> <span id="local_rec_flag_66"><span class="LIDENT">rec_flag</span></span> <span id="local_tds_67"><span class="LIDENT">tds</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="OBJECT">object</span><span class="EOL">
</span>    <span class="INHERIT">inherit</span> <span class="LIDENT">type_is_recursive</span> <a href="#local_rec_flag_66"><span class="LIDENT">rec_flag</span></a> <a href="#local_tds_67"><span class="LIDENT">tds</span></a> <span class="AS">as</span> <span class="LIDENT">super</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">core_type</span> <span id="local_ctype_68"><span class="LIDENT">ctype</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_ctype_68"><span class="LIDENT">ctype</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="WHEN">when</span> <a href="../../../base/src/base/option.ml.html#val-is_some"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">is_some</span></a> <span class="LPAREN">(</span><a href="../../../ppxlib/src/ppxlib/attribute.ml.html#val-get"><span class="UIDENT">Attribute</span><span class="DOT">.</span><span class="LIDENT">get</span></a> <span class="LABEL">~mark_as_seen:</span><span class="FALSE">false</span> <a href="attrs.ml.html#val-opaque"><span class="UIDENT">Attrs</span><span class="DOT">.</span><span class="LIDENT">opaque</span></a> <a href="#local_ctype_68"><span class="LIDENT">ctype</span></a><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKETPERCENT">[%</span><span class="TYPE">type</span><span class="COLON">:</span> <span class="LBRACKETPERCENT">[%</span><span class="LIDENT">t</span><span class="QUESTION">?</span> <span class="UNDERSCORE">_</span><span class="RBRACKET">]</span> <span class="LIDENT">sexp_opaque</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">super</span><span class="HASH">#</span><span class="LIDENT">core_type</span> <a href="#local_ctype_68"><span class="LIDENT">ctype</span></a><span class="EOL">
</span>  <span class="END">end</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="HASH">#</span><span class="LIDENT">go</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-strip_attributes"><span class="LIDENT">strip_attributes</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="OBJECT">object</span><span class="EOL">
</span>    <span class="INHERIT">inherit</span> <span class="UIDENT">Ast_traverse</span><span class="DOT">.</span><span class="LIDENT">map</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">attribute</span> <span id="local_attr_69"><span class="LIDENT">attr</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ppxlib/src/ppxlib/location.ml.html#val-raise_errorf"><span class="UIDENT">Location</span><span class="DOT">.</span><span class="LIDENT">raise_errorf</span></a> <span class="LABEL">~loc:</span><a href="#local_attr_69"><span class="LIDENT">attr</span></a><span class="DOT">.</span><span class="LIDENT">attr_loc</span> <span class="STRING">&quot;failed to strip attribute from syntax&quot;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">attributes</span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">signature</span> <span id="local_items_70"><span class="LIDENT">items</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../base/src/base/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <a href="#local_items_70"><span class="LIDENT">items</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_item_71"><span class="LIDENT">item</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_item_71"><span class="LIDENT">item</span></a><span class="DOT">.</span><span class="LIDENT">psig_desc</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Psig_attribute</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">structure</span> <span id="local_items_72"><span class="LIDENT">items</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../base/src/base/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <a href="#local_items_72"><span class="LIDENT">items</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_item_73"><span class="LIDENT">item</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_item_73"><span class="LIDENT">item</span></a><span class="DOT">.</span><span class="LIDENT">pstr_desc</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Pstr_attribute</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">class_signature</span> <span id="local_csig_74"><span class="LIDENT">csig</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <a href="#local_csig_74"><span class="LIDENT">csig</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="LIDENT">pcsig_fields</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../../../base/src/base/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <a href="#local_csig_74"><span class="LIDENT">csig</span></a><span class="DOT">.</span><span class="LIDENT">pcsig_fields</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_field_75"><span class="LIDENT">field</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="#local_field_75"><span class="LIDENT">field</span></a><span class="DOT">.</span><span class="LIDENT">pctf_desc</span> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Pctf_attribute</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="METHOD">method</span><span class="BANG">!</span> <span class="LIDENT">class_structure</span> <span id="local_cstr_76"><span class="LIDENT">cstr</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <a href="#local_cstr_76"><span class="LIDENT">cstr</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="LIDENT">pcstr_fields</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../../../base/src/base/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <a href="#local_cstr_76"><span class="LIDENT">cstr</span></a><span class="DOT">.</span><span class="LIDENT">pcstr_fields</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_field_77"><span class="LIDENT">field</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="#local_field_77"><span class="LIDENT">field</span></a><span class="DOT">.</span><span class="LIDENT">pcf_desc</span> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Pcf_attribute</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="END">end</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span></span></code></pre></body></html>
