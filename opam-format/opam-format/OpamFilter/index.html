<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamFilter (opam-format.opam-format.OpamFilter)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../sherlodoc_db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">opam-format</a> &#x00BB; Library <code>opam-format</code> &#x00BB; OpamFilter</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>OpamFilter</span></code><a href="../../src/opam-format/opamFilter.ml.html" class="source_link">Source</a></h1><p>Formulas on variables, as used in opam files build scripts</p><p>Filters are a small language of formulas over strings and booleans used for conditions and text replacements. It has relational operators over strings (using version-number comparison), And, Or and Not boolean operations, dynamic casting (using strings &quot;true&quot; and &quot;false&quot;), and string interpolation. Variables are resolved using a user function returning an option, undefined values are propagated.</p><p>String interpolation uses the syntax <code>%{identifier}%</code></p><p>Identifiers have the form</p><pre>[package:]var[?str_if_true:str_if_false_or_undef]</pre><p>The last optional part specifies a conversion from boolean to static strings.</p><p>The syntax <code>pkg1+pkg2+pkgn:var</code> is allowed as a shortcut to <code>pkg1:var &amp; pkg2:var &amp; pkgn:var</code>.</p><p>The special variable <code>pkg:enable</code> is allowed as a shortcut for <code>pkg:installed?enable:disable</code></p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">opam-format</a><ul><li>Library <code>opam-format</code><ul><li><a href="../OpamFile/index.html">OpamFile</a></li><li><a href="#" class="current_unit">OpamFilter</a></li><li><a href="../OpamFormat/index.html">OpamFormat</a></li><li><a href="../OpamFormatConfig/index.html">OpamFormatConfig</a></li><li><a href="../OpamFormula/index.html">OpamFormula</a></li><li><a href="../OpamInterpLexer/index.html">OpamInterpLexer</a></li><li><a href="../OpamLineLexer/index.html">OpamLineLexer</a></li><li><a href="../OpamPackage/index.html">OpamPackage</a></li><li><a href="../OpamPath/index.html">OpamPath</a></li><li><a href="../OpamPp/index.html">OpamPp</a></li><li><a href="../OpamRepositoryName/index.html">OpamRepositoryName</a></li><li><a href="../OpamSwitch/index.html">OpamSwitch</a></li><li><a href="../OpamSysPkg/index.html">OpamSysPkg</a></li><li><a href="../OpamTypes/index.html">OpamTypes</a></li><li><a href="../OpamTypesBase/index.html">OpamTypesBase</a></li><li><a href="../OpamVariable/index.html">OpamVariable</a></li></ul></li><li><a href="../../src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-to_string"><a href="#val-to_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-to_string" class="source_link">Source</a><code><span><span class="keyword">val</span> to_string : 
  <span><span class="optlabel">?custom</span>:
    <span>(<span><span class="label">context</span>:<span>[&gt; `And <span>| `Defined</span> <span>| `Not</span> <span>| `Or</span> <span>| `Relop</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">paren</span>:<span>(<span><span class="optlabel">?cond</span>:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
      <span>string option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Pretty-print <code>custom ?context ?paren filter</code> is a function that permit to customise part of filter pretty-printing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_down_left"><a href="#val-fold_down_left" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-fold_down_left" class="source_link">Source</a><code><span><span class="keyword">val</span> fold_down_left : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Folds on the tree of a filter</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_up"><a href="#val-map_up" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-map_up" class="source_link">Source</a><code><span><span class="keyword">val</span> map_up : 
  <span><span>(<span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a></span></code></div><div class="spec-doc"><p>Maps on all nodes of a filter, bottom-up</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_interp_regex"><a href="#val-string_interp_regex" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-string_interp_regex" class="source_link">Source</a><code><span><span class="keyword">val</span> string_interp_regex : <a href="../../../re/re/Re/index.html#type-re">Re.re</a></span></code></div><div class="spec-doc"><p>Regex matching string interpolation syntax (<code>&quot;%%&quot;</code>, <code>&quot;%{xxx}%&quot;</code>, or <code>&quot;%{xxx&quot;</code> if unclosed)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_variables_from_string"><a href="#val-extract_variables_from_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-extract_variables_from_string" class="source_link">Source</a><code><span><span class="keyword">val</span> extract_variables_from_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-variables"><a href="#val-variables" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-variables" class="source_link">Source</a><code><span><span class="keyword">val</span> variables : <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> list</span></span></code></div><div class="spec-doc"><p>Returns all the variables appearing in a filter (including the ones within string interpolations</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-env"><a href="#type-env" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#type-env" class="source_link">Source</a><code><span><span class="keyword">type</span> env</span><span> = <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-variable_contents">OpamTypes.variable_contents</a> option</span></span></code></div><div class="spec-doc"><p>Type of filter environment.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fident"><a href="#type-fident" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#type-fident" class="source_link">Source</a><code><span><span class="keyword">type</span> fident</span><span> =
  <span><span><a href="../OpamTypes/index.html#type-name">OpamTypes.name</a> option</span> list</span> * <a href="../OpamTypes/index.html#type-variable">OpamTypes.variable</a> * <span><span>(string * string)</span> option</span></span></code></div><div class="spec-doc"><p>The type of filter idents with (optionally multiple) qualifying package names and optional string converter. Package name <code>None</code> encodes the self-reference <code>_</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_variables"><a href="#val-map_variables" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-map_variables" class="source_link">Source</a><code><span><span class="keyword">val</span> map_variables : 
  <span><span>(<span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a></span></code></div><div class="spec-doc"><p>Maps on all variables appearing in a filter. The case where package variables are renamed differently and appear in a filter ident of the form <code>%{pkg1+pkg2:var}%</code> is not supported and raises <code>Invalid_argument</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_variables_in_string"><a href="#val-map_variables_in_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-map_variables_in_string" class="source_link">Source</a><code><span><span class="keyword">val</span> map_variables_in_string : 
  <span><span>(<span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Same limitation as <code>map_variables</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_variables_in_fident"><a href="#val-map_variables_in_fident" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-map_variables_in_fident" class="source_link">Source</a><code><span><span class="keyword">val</span> map_variables_in_fident : 
  <span><span>(<span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-fident">fident</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-fident">fident</a></span></code></div><div class="spec-doc"><p>Does not handle rewriting the variables to different names (which can't be expressed with a <code>fident</code> anymore), and raises <code>Invalid_argument</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-distribute_negations"><a href="#val-distribute_negations" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-distribute_negations" class="source_link">Source</a><code><span><span class="keyword">val</span> distribute_negations : <span><span class="optlabel">?neg</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a></span></code></div><div class="spec-doc"><p>Distributes the negations to apply only to atoms</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_string"><a href="#val-expand_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-expand_string" class="source_link">Source</a><code><span><span class="keyword">val</span> expand_string : 
  <span><span class="optlabel">?partial</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default</span>:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p>Rewrites string interpolations within a string. <code>default</code> is applied to the fident string (e.g. what's between <code>%{</code> and <code>}%</code>) when the expansion is undefined. If unspecified, this raises <code>Failure</code>.</p><p>With <code>partial</code>, <code>default</code> defaults to the identity, and is otherwise expected to return a fident. In this case, the returned string is supposed to be expanded again (expansion results are escaped, escapes are otherwise kept). This makes the function idempotent</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unclosed_expansions"><a href="#val-unclosed_expansions" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-unclosed_expansions" class="source_link">Source</a><code><span><span class="keyword">val</span> unclosed_expansions : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>(int * int)</span> * string)</span> list</span></span></code></div><div class="spec-doc"><p>Returns the (beginning, end) offsets and substrings of any unclosed <code>%{</code> expansions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval"><a href="#val-eval" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-eval" class="source_link">Source</a><code><span><span class="keyword">val</span> eval : 
  <span><span class="optlabel">?default</span>:<a href="../OpamTypes/index.html#type-variable_contents">OpamTypes.variable_contents</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-variable_contents">OpamTypes.variable_contents</a></span></code></div><div class="spec-doc"><p>Computes the value of a filter. May raise <code>Failure</code> if <code>default</code> isn't provided</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_to_bool"><a href="#val-eval_to_bool" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-eval_to_bool" class="source_link">Source</a><code><span><span class="keyword">val</span> eval_to_bool : <span><span class="optlabel">?default</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Like <code>eval</code> but casts the result to a bool. Raises <code>Invalid_argument</code> if not a valid bool and no default supplied.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-opt_eval_to_bool"><a href="#val-opt_eval_to_bool" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-opt_eval_to_bool" class="source_link">Source</a><code><span><span class="keyword">val</span> opt_eval_to_bool : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> option</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Same as <code>eval_to_bool</code>, but takes an option as filter and returns always <code>true</code> on <code>None</code>, <code>false</code> when the filter is <code>Undefined</code>. This is the most common behaviour for using &quot;filters&quot; for filtering</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_to_string"><a href="#val-eval_to_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-eval_to_string" class="source_link">Source</a><code><span><span class="keyword">val</span> eval_to_string : <span><span class="optlabel">?default</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Like <code>eval</code> but casts the result to a string</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-partial_eval"><a href="#val-partial_eval" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-partial_eval" class="source_link">Source</a><code><span><span class="keyword">val</span> partial_eval : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a></span></code></div><div class="spec-doc"><p>Reduces what can be, keeps the rest unchanged</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ident_of_var"><a href="#val-ident_of_var" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-ident_of_var" class="source_link">Source</a><code><span><span class="keyword">val</span> ident_of_var : <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-fident">fident</a></span></code></div><div class="spec-doc"><p>Wraps a full_variable into a fident accessor</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ident_of_string"><a href="#val-ident_of_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-ident_of_string" class="source_link">Source</a><code><span><span class="keyword">val</span> ident_of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-fident">fident</a></span></code></div><div class="spec-doc"><p>A fident accessor directly referring a variable with the given name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ident_value"><a href="#val-ident_value" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-ident_value" class="source_link">Source</a><code><span><span class="keyword">val</span> ident_value : 
  <span><span class="optlabel">?default</span>:<a href="../OpamTypes/index.html#type-variable_contents">OpamTypes.variable_contents</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-fident">fident</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-variable_contents">OpamTypes.variable_contents</a></span></code></div><div class="spec-doc"><p>Resolves a filter ident. Like <code>eval</code>, may raise Failure if no default is provided</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ident_string"><a href="#val-ident_string" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-ident_string" class="source_link">Source</a><code><span><span class="keyword">val</span> ident_string : <span><span class="optlabel">?default</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fident">fident</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Like <code>ident_value</code>, but casts the result to a string</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ident_bool"><a href="#val-ident_bool" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-ident_bool" class="source_link">Source</a><code><span><span class="keyword">val</span> ident_bool : <span><span class="optlabel">?default</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fident">fident</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Like <code>ident_value</code>, but casts the result to a bool</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_interpolations_in_file_full"><a href="#val-expand_interpolations_in_file_full" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-expand_interpolations_in_file_full" class="source_link">Source</a><code><span><span class="keyword">val</span> expand_interpolations_in_file_full : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">src</span>:<a href="../OpamTypes/index.html#type-filename">OpamTypes.filename</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst</span>:<a href="../OpamTypes/index.html#type-filename">OpamTypes.filename</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Same as <code>expand_interpolations_in_file</code> but allows to set the source <code>src</code> and destination <code>dst</code> files independently instead of implying <code>src</code> = <code>dst</code>.in</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand_interpolations_in_file"><a href="#val-expand_interpolations_in_file" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-expand_interpolations_in_file" class="source_link">Source</a><code><span><span class="keyword">val</span> expand_interpolations_in_file : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-basename">OpamTypes.basename</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Rewrites <code>basename</code>.in to <code>basename</code>, expanding interpolations. If the first line begins <code>&quot;opam-version:&quot;</code>, assumes that expansion of variables within strings should be properly escaped. In particular, this means that Windows paths should expand correctly when generating .config files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commands"><a href="#val-commands" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-commands" class="source_link">Source</a><code><span><span class="keyword">val</span> commands : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../OpamTypes/index.html#type-command">OpamTypes.command</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> list</span></span></code></div><div class="spec-doc"><p>Processes filters evaluation in a command list: parameter expansion and conditional filtering</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-single_command"><a href="#val-single_command" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-single_command" class="source_link">Source</a><code><span><span class="keyword">val</span> single_command : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../OpamTypes/index.html#type-arg">OpamTypes.arg</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>Process a simpler command, without filters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-simple_arg_variables"><a href="#val-simple_arg_variables" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-simple_arg_variables" class="source_link">Source</a><code><span><span class="keyword">val</span> simple_arg_variables : <span><a href="../OpamTypes/index.html#type-simple_arg">OpamTypes.simple_arg</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> list</span></span></code></div><div class="spec-doc"><p>Extracts the list of variables from an argument</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commands_variables"><a href="#val-commands_variables" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-commands_variables" class="source_link">Source</a><code><span><span class="keyword">val</span> commands_variables : <span><span><a href="../OpamTypes/index.html#type-command">OpamTypes.command</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> list</span></span></code></div><div class="spec-doc"><p>Extracts variables appearing in a list of commands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_formula"><a href="#val-of_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-of_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> of_formula : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../OpamTypes/index.html#type-generic_formula">OpamTypes.generic_formula</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a></span></code></div><div class="spec-doc"><p>Converts a generic formula to a filter, given a converter for atoms</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-filter_formula"><a href="#val-filter_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-filter_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> filter_formula : 
  <span><span class="optlabel">?default_version</span>:<a href="../OpamTypes/index.html#type-version">OpamTypes.version</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-formula">OpamTypes.formula</a></span></code></div><div class="spec-doc"><p>Resolves the filter in a filtered formula, reducing to a pure formula.</p><p><code>default</code> is the assumed result for undefined filters. If a version filter doesn't resolve to a valid version, the constraint is dropped unless <code>default_version</code> is specified.</p><p>May raise, as other filter functions, if <code>default</code> is not provided and filters don't resolve.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-partial_filter_formula"><a href="#val-partial_filter_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-partial_filter_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> partial_filter_formula : 
  <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a></span></code></div><div class="spec-doc"><p>Reduces according to what is defined in <code>env</code>, and returns the simplified formula</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_filter_formula"><a href="#val-gen_filter_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-gen_filter_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> gen_filter_formula : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>[&lt; `True <span>| `False</span> <span><span>| `Formula</span> of <span><span class="type-var">'b</span> <a href="../OpamTypes/index.html#type-generic_formula">OpamTypes.generic_formula</a></span></span> ]</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span> * <span class="type-var">'a</span>)</span> <a href="../OpamFormula/index.html#type-formula">OpamFormula.formula</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'c</span> * <span><span class="type-var">'b</span> <a href="../OpamTypes/index.html#type-generic_formula">OpamTypes.generic_formula</a></span>)</span> <a href="../OpamFormula/index.html#type-formula">OpamFormula.formula</a></span></span></code></div><div class="spec-doc"><p>A more generic formula reduction function, that takes a &quot;partial resolver&quot; as argument</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_filtered_formula"><a href="#val-string_of_filtered_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-string_of_filtered_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> string_of_filtered_formula : <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-variables_of_filtered_formula"><a href="#val-variables_of_filtered_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-variables_of_filtered_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> variables_of_filtered_formula : 
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-full_variable">OpamTypes.full_variable</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-filter_deps"><a href="#val-filter_deps" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-filter_deps" class="source_link">Source</a><code><span><span class="keyword">val</span> filter_deps : 
  <span><span class="label">build</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">post</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?test</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?doc</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev_setup</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default_version</span>:<a href="../OpamTypes/index.html#type-version">OpamTypes.version</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-formula">OpamTypes.formula</a></span></code></div><div class="spec-doc"><p>Resolves the build, post, test, doc, dev flags in a filtered formula (which is supposed to have been pre-processed to remove switch and global variables). <code>default</code> determines the behaviour on undefined filters, and the function may raise if it is undefined. If a constraint resolves to an invalid version, it is dropped, or replaced with <code>default_version</code> if specified. If test, doc or dev are unspecified, they are assumed to be filtered out already and encountering them will raise an assert.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-deps_var_env"><a href="#val-deps_var_env" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-deps_var_env" class="source_link">Source</a><code><span><span class="keyword">val</span> deps_var_env : 
  <span><span class="label">build</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">post</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?test</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?doc</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev_setup</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dev</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p>The environment used in resolving the dependency filters, as per <code>filter_deps</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-simplify_extended_version_formula"><a href="#val-simplify_extended_version_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-simplify_extended_version_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> simplify_extended_version_formula : 
  <span><a href="../OpamTypes/index.html#type-condition">OpamTypes.condition</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-condition">OpamTypes.condition</a> option</span></span></code></div><div class="spec-doc"><p>Like <code>OpamFormula.simplify_version_formula</code>, but on filtered formulas (filters are kept unchanged, but put in front)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-atomise_extended"><a href="#val-atomise_extended" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-atomise_extended" class="source_link">Source</a><code><span><span class="keyword">val</span> atomise_extended : 
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../OpamPackage/Name/index.html#type-t">OpamPackage.Name.t</a>
   * <span>(<a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a> * <span><span>(<a href="../OpamTypes/index.html#type-relop">OpamTypes.relop</a> * <a href="../OpamTypes/index.html#type-filter">OpamTypes.filter</a>)</span> option</span>)</span>)</span>
    <a href="../OpamFormula/index.html#type-formula">OpamFormula.formula</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sort_filtered_formula"><a href="#val-sort_filtered_formula" class="anchor"></a><a href="../../src/opam-format/opamFilter.ml.html#val-sort_filtered_formula" class="source_link">Source</a><code><span><span class="keyword">val</span> sort_filtered_formula : 
  <span><span>(<span><span>(<a href="../OpamTypes/index.html#type-name">OpamTypes.name</a> * <a href="../OpamTypes/index.html#type-condition">OpamTypes.condition</a>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<a href="../OpamTypes/index.html#type-name">OpamTypes.name</a> * <a href="../OpamTypes/index.html#type-condition">OpamTypes.condition</a>)</span> <span class="arrow">&#45;&gt;</span></span>
    int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../OpamTypes/index.html#type-filtered_formula">OpamTypes.filtered_formula</a></span></code></div></div></div></body></html>
