<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: resolver.ml (odoc.src.odoc.odoc)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">The odoc documentation generator</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; odoc.odoc &#x00BB; resolver.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>resolver.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">The odoc documentation generator</a><ul><li><a href="../../odoc_for_authors.html"><code>odoc</code> for Authors</a></li><li><a href="../../cheatsheet.html">Cheatsheet</a></li><li><a href="../../dune.html">Dune and odoc</a></li><li><a href="../../features.html">Language Features</a></li><li><a href="../../ocamldoc_differences.html">Markup Differences From OCamldoc</a></li><li><a href="../../interface.html"><code>odoc</code> Interface Guarantees</a></li><li><a href="../../driver.html">How to Drive <code>odoc</code></a></li><li><a href="../../json.html">JSON output</a></li><li><a href="../../deprecated/index.html">Deprecated features</a></li><li>Library <code>odoc.document</code><ul><li><a href="../../odoc.document/Odoc_document/index.html">Odoc_document</a></li></ul></li><li>Library <code>odoc.examples</code><ul><li><a href="../../odoc.examples/Odoc_examples/index.html">Odoc_examples</a></li></ul></li><li>Library <code>odoc.html</code><ul><li><a href="../../odoc.html/Odoc_html/index.html">Odoc_html</a></li></ul></li><li>Library <code>odoc.html_support_files</code><ul><li><a href="../../odoc.html_support_files/Odoc_html_support_files/index.html">Odoc_html_support_files</a></li></ul></li><li>Library <code>odoc.index</code><ul><li><a href="../../odoc.index/Odoc_index/index.html">Odoc_index</a></li></ul></li><li>Library <code>odoc.json_index</code><ul><li><a href="../../odoc.json_index/Odoc_json_index/index.html">Odoc_json_index</a></li></ul></li><li>Library <code>odoc.latex</code><ul><li><a href="../../odoc.latex/Odoc_latex/index.html">Odoc_latex</a></li></ul></li><li>Library <code>odoc.loader</code><ul><li><a href="../../odoc.loader/Odoc_loader/index.html">Odoc_loader</a></li></ul></li><li>Library <code>odoc.manpage</code><ul><li><a href="../../odoc.manpage/Odoc_manpage/index.html">Odoc_manpage</a></li></ul></li><li>Library <code>odoc.model</code><ul><li><a href="../../odoc.model/Odoc_model/index.html">Odoc_model</a></li></ul></li><li>Library <code>odoc.model_desc</code><ul><li><a href="../../odoc.model_desc/Odoc_model_desc/index.html">Odoc_model_desc</a></li></ul></li><li>Library <code>odoc.ocamlary</code><ul><li><a href="../../odoc.ocamlary/Ocamlary/index.html">Ocamlary</a></li></ul></li><li>Library <code>odoc.occurrences</code><ul><li><a href="../../odoc.occurrences/Odoc_occurrences/index.html">Odoc_occurrences</a></li></ul></li><li>Library <code>odoc.odoc</code><ul><li><a href="../../odoc.odoc/Odoc_odoc/index.html">Odoc_odoc</a></li></ul></li><li>Library <code>odoc.odoc_utils</code><ul><li><a href="../../odoc.odoc_utils/Odoc_utils/index.html">Odoc_utils</a></li></ul></li><li>Library <code>odoc.search</code><ul><li><a href="../../odoc.search/Odoc_search/index.html">Odoc_search</a></li></ul></li><li>Library <code>odoc.search_html_frontend</code><ul><li><a href="../../odoc.search_html_frontend/Odoc_html_frontend/index.html">Odoc_html_frontend</a></li></ul></li><li>Library <code>odoc.syntax_highlighter</code><ul><li><a href="../../odoc.syntax_highlighter/Syntax_highlighter/index.html">Syntax_highlighter</a></li></ul></li><li>Library <code>odoc.xref2</code><ul><li><a href="../../odoc.xref2/Odoc_xref2/index.html">Odoc_xref2</a></li></ul></li><li>Library <code>odoc.xref_test</code><ul><li><a href="../../odoc.xref_test/Odoc_xref_test/index.html">Odoc_xref_test</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>odoc.document<ul><li><a href="../odoc.document/ML.ml.html">ML.ml</a></li><li><a href="../odoc.document/codefmt.ml.html">codefmt.ml</a></li><li><a href="../odoc.document/comment.ml.html">comment.ml</a></li><li><a href="../odoc.document/compat.ml.html">compat.ml</a></li><li><a href="../odoc.document/doctree.ml.html">doctree.ml</a></li><li><a href="../odoc.document/generator.ml.html">generator.ml</a></li><li><a href="../odoc.document/generator_signatures.ml.html">generator_signatures.ml</a></li><li><a href="../odoc.document/odoc_document.ml.html">odoc_document.ml</a></li><li><a href="../odoc.document/reason.ml.html">reason.ml</a></li><li><a href="../odoc.document/renderer.ml.html">renderer.ml</a></li><li><a href="../odoc.document/sidebar.ml.html">sidebar.ml</a></li><li><a href="../odoc.document/targets.ml.html">targets.ml</a></li><li><a href="../odoc.document/types.ml.html">types.ml</a></li><li><a href="../odoc.document/url.ml.html">url.ml</a></li><li><a href="../odoc.document/utils.ml.html">utils.ml</a></li></ul></li><li>odoc.examples<ul><li><a href="../odoc.examples/odoc_examples.ml.html">odoc_examples.ml</a></li><li><a href="../odoc.examples/odoc_examples__.ml.html">odoc_examples__.ml</a></li></ul></li><li>odoc.html<ul><li><a href="../odoc.html/config.ml.html">config.ml</a></li><li><a href="../odoc.html/generator.ml.html">generator.ml</a></li><li><a href="../odoc.html/html_fragment_json.ml.html">html_fragment_json.ml</a></li><li><a href="../odoc.html/html_page.ml.html">html_page.ml</a></li><li><a href="../odoc.html/html_source.ml.html">html_source.ml</a></li><li><a href="../odoc.html/link.ml.html">link.ml</a></li><li><a href="../odoc.html/odoc_html.ml.html">odoc_html.ml</a></li><li><a href="../odoc.html/odoc_html__.ml.html">odoc_html__.ml</a></li><li><a href="../odoc.html/sidebar.ml.html">sidebar.ml</a></li><li><a href="../odoc.html/types.ml.html">types.ml</a></li></ul></li><li>odoc.html_support_files<ul><li><a href="../odoc.html_support_files/odoc_html_support_files.ml.html">odoc_html_support_files.ml</a></li></ul></li><li>odoc.index<ul><li><a href="../odoc.index/entry.ml.html">entry.ml</a></li><li><a href="../odoc.index/in_progress.ml.html">in_progress.ml</a></li><li><a href="../odoc.index/odoc_index.ml.html">odoc_index.ml</a></li><li><a href="../odoc.index/odoc_index__.ml.html">odoc_index__.ml</a></li><li><a href="../odoc.index/skeleton.ml.html">skeleton.ml</a></li><li><a href="../odoc.index/skeleton_of.ml.html">skeleton_of.ml</a></li></ul></li><li>odoc.json_index<ul><li><a href="../odoc.json_index/json_display.ml.html">json_display.ml</a></li><li><a href="../odoc.json_index/json_search.ml.html">json_search.ml</a></li><li><a href="../odoc.json_index/odoc_json_index.ml.html">odoc_json_index.ml</a></li></ul></li><li>odoc.latex<ul><li><a href="../odoc.latex/generator.ml.html">generator.ml</a></li><li><a href="../odoc.latex/odoc_latex.ml.html">odoc_latex.ml</a></li><li><a href="../odoc.latex/raw.ml.html">raw.ml</a></li><li><a href="../odoc.latex/types.ml.html">types.ml</a></li></ul></li><li>odoc.loader<ul><li><a href="../odoc.loader/cmi.ml.html">cmi.ml</a></li><li><a href="../odoc.loader/cmt.ml.html">cmt.ml</a></li><li><a href="../odoc.loader/cmti.ml.html">cmti.ml</a></li><li><a href="../odoc.loader/doc_attr.ml.html">doc_attr.ml</a></li><li><a href="../odoc.loader/ident_env.ml.html">ident_env.ml</a></li><li><a href="../odoc.loader/implementation.ml.html">implementation.ml</a></li><li><a href="../odoc.loader/odoc_loader.ml.html">odoc_loader.ml</a></li><li><a href="../odoc.loader/odoc_loader__.ml.html">odoc_loader__.ml</a></li><li><a href="../odoc.loader/typedtree_traverse.ml.html">typedtree_traverse.ml</a></li></ul></li><li>odoc.manpage<ul><li><a href="../odoc.manpage/generator.ml.html">generator.ml</a></li><li><a href="../odoc.manpage/link.ml.html">link.ml</a></li><li><a href="../odoc.manpage/odoc_manpage.ml.html">odoc_manpage.ml</a></li></ul></li><li>odoc.model<ul><li><a href="../odoc.model/comment.ml.html">comment.ml</a></li><li><a href="../odoc.model/compat.ml.html">compat.ml</a></li><li><a href="../odoc.model/error.ml.html">error.ml</a></li><li><a href="../odoc.model/frontmatter.ml.html">frontmatter.ml</a></li><li><a href="../odoc.model/lang.ml.html">lang.ml</a></li><li><a href="../odoc.model/location_.ml.html">location_.ml</a></li><li><a href="../odoc.model/names.ml.html">names.ml</a></li><li><a href="../odoc.model/odoc_model.ml.html">odoc_model.ml</a></li><li><a href="../odoc.model/odoc_model__.ml.html">odoc_model__.ml</a></li><li><a href="../odoc.model/paths.ml.html">paths.ml</a></li><li><a href="../odoc.model/paths_types.ml.html">paths_types.ml</a></li><li><a href="../odoc.model/reference.ml.html">reference.ml</a></li><li><a href="../odoc.model/root.ml.html">root.ml</a></li><li><a href="../odoc.model/semantics.ml.html">semantics.ml</a></li></ul></li><li>odoc.model_desc<ul><li><a href="../odoc.model_desc/comment_desc.ml.html">comment_desc.ml</a></li><li><a href="../odoc.model_desc/lang_desc.ml.html">lang_desc.ml</a></li><li><a href="../odoc.model_desc/odoc_model_desc.ml.html">odoc_model_desc.ml</a></li><li><a href="../odoc.model_desc/paths_desc.ml.html">paths_desc.ml</a></li><li><a href="../odoc.model_desc/type_desc.ml.html">type_desc.ml</a></li></ul></li><li>odoc.occurrences<ul><li><a href="../odoc.occurrences/odoc_occurrences.ml.html">odoc_occurrences.ml</a></li><li><a href="../odoc.occurrences/odoc_occurrences__.ml.html">odoc_occurrences__.ml</a></li><li><a href="../odoc.occurrences/table.ml.html">table.ml</a></li></ul></li><li>odoc.odoc<ul><li><a href="asset.ml.html">asset.ml</a></li><li><a href="classify.ml.html">classify.ml</a></li><li><a href="compile.ml.html">compile.ml</a></li><li><a href="depends.ml.html">depends.ml</a></li><li><a href="fs.ml.html">fs.ml</a></li><li><a href="html_fragment.ml.html">html_fragment.ml</a></li><li><a href="html_page.ml.html">html_page.ml</a></li><li><a href="indexing.ml.html">indexing.ml</a></li><li><a href="latex.ml.html">latex.ml</a></li><li><a href="man_page.ml.html">man_page.ml</a></li><li><a href="occurrences.ml.html">occurrences.ml</a></li><li><a href="odoc_file.ml.html">odoc_file.ml</a></li><li><a href="odoc_link.ml.html">odoc_link.ml</a></li><li><a href="odoc_odoc.ml.html">odoc_odoc.ml</a></li><li><a href="or_error.ml.html">or_error.ml</a></li><li><a href="rendering.ml.html">rendering.ml</a></li><li><a href="#" class="current_unit">resolver.ml</a></li><li><a href="sidebar.ml.html">sidebar.ml</a></li><li><a href="source.ml.html">source.ml</a></li><li><a href="support_files.ml.html">support_files.ml</a></li><li><a href="url.ml.html">url.ml</a></li></ul></li><li>odoc.odoc_utils<ul><li><a href="../odoc.odoc_utils/json.ml.html">json.ml</a></li><li><a href="../odoc.odoc_utils/odoc_list.ml.html">odoc_list.ml</a></li><li><a href="../odoc.odoc_utils/odoc_utils.ml.html">odoc_utils.ml</a></li><li><a href="../odoc.odoc_utils/odoc_utils__.ml.html">odoc_utils__.ml</a></li><li><a href="../odoc.odoc_utils/tree.ml.html">tree.ml</a></li></ul></li><li>odoc.search<ul><li><a href="../odoc.search/html.ml.html">html.ml</a></li><li><a href="../odoc.search/odoc_search.ml.html">odoc_search.ml</a></li><li><a href="../odoc.search/text.ml.html">text.ml</a></li></ul></li><li>odoc.search_html_frontend<ul><li><a href="../odoc.search_html_frontend/odoc_html_frontend.ml.html">odoc_html_frontend.ml</a></li></ul></li><li>odoc.syntax_highlighter<ul><li><a href="../odoc.syntax_highlighter/syntax_highlighter.ml.html">syntax_highlighter.ml</a></li></ul></li><li>odoc.xref2<ul><li><a href="../odoc.xref2/cfrag.ml.html">cfrag.ml</a></li><li><a href="../odoc.xref2/compile.ml.html">compile.ml</a></li><li><a href="../odoc.xref2/component.ml.html">component.ml</a></li><li><a href="../odoc.xref2/cpath.ml.html">cpath.ml</a></li><li><a href="../odoc.xref2/env.ml.html">env.ml</a></li><li><a href="../odoc.xref2/errors.ml.html">errors.ml</a></li><li><a href="../odoc.xref2/expand_tools.ml.html">expand_tools.ml</a></li><li><a href="../odoc.xref2/find.ml.html">find.ml</a></li><li><a href="../odoc.xref2/ident.ml.html">ident.ml</a></li><li><a href="../odoc.xref2/lang_of.ml.html">lang_of.ml</a></li><li><a href="../odoc.xref2/link.ml.html">link.ml</a></li><li><a href="../odoc.xref2/lookup_failures.ml.html">lookup_failures.ml</a></li><li><a href="../odoc.xref2/odoc_xref2.ml.html">odoc_xref2.ml</a></li><li><a href="../odoc.xref2/ref_tools.ml.html">ref_tools.ml</a></li><li><a href="../odoc.xref2/shape_tools.ml.html">shape_tools.ml</a></li><li><a href="../odoc.xref2/strengthen.ml.html">strengthen.ml</a></li><li><a href="../odoc.xref2/subst.ml.html">subst.ml</a></li><li><a href="../odoc.xref2/tools.ml.html">tools.ml</a></li></ul></li><li>odoc.xref_test<ul><li><a href="../odoc.xref_test/common.ml.html">common.ml</a></li><li><a href="../odoc.xref_test/odoc_xref_test.ml.html">odoc_xref_test.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
<a id="L496" class="source_line" href="#L496">496</a>
<a id="L497" class="source_line" href="#L497">497</a>
<a id="L498" class="source_line" href="#L498">498</a>
<a id="L499" class="source_line" href="#L499">499</a>
<a id="L500" class="source_line" href="#L500">500</a>
<a id="L501" class="source_line" href="#L501">501</a>
<a id="L502" class="source_line" href="#L502">502</a>
<a id="L503" class="source_line" href="#L503">503</a>
<a id="L504" class="source_line" href="#L504">504</a>
<a id="L505" class="source_line" href="#L505">505</a>
<a id="L506" class="source_line" href="#L506">506</a>
<a id="L507" class="source_line" href="#L507">507</a>
<a id="L508" class="source_line" href="#L508">508</a>
<a id="L509" class="source_line" href="#L509">509</a>
<a id="L510" class="source_line" href="#L510">510</a>
<a id="L511" class="source_line" href="#L511">511</a>
<a id="L512" class="source_line" href="#L512">512</a>
<a id="L513" class="source_line" href="#L513">513</a>
<a id="L514" class="source_line" href="#L514">514</a>
<a id="L515" class="source_line" href="#L515">515</a>
<a id="L516" class="source_line" href="#L516">516</a>
<a id="L517" class="source_line" href="#L517">517</a>
<a id="L518" class="source_line" href="#L518">518</a>
<a id="L519" class="source_line" href="#L519">519</a>
<a id="L520" class="source_line" href="#L520">520</a>
<a id="L521" class="source_line" href="#L521">521</a>
<a id="L522" class="source_line" href="#L522">522</a>
<a id="L523" class="source_line" href="#L523">523</a>
<a id="L524" class="source_line" href="#L524">524</a>
<a id="L525" class="source_line" href="#L525">525</a>
<a id="L526" class="source_line" href="#L526">526</a>
<a id="L527" class="source_line" href="#L527">527</a>
<a id="L528" class="source_line" href="#L528">528</a>
<a id="L529" class="source_line" href="#L529">529</a>
<a id="L530" class="source_line" href="#L530">530</a>
<a id="L531" class="source_line" href="#L531">531</a>
<a id="L532" class="source_line" href="#L532">532</a>
<a id="L533" class="source_line" href="#L533">533</a>
<a id="L534" class="source_line" href="#L534">534</a>
<a id="L535" class="source_line" href="#L535">535</a>
<a id="L536" class="source_line" href="#L536">536</a>
<a id="L537" class="source_line" href="#L537">537</a>
<a id="L538" class="source_line" href="#L538">538</a>
<a id="L539" class="source_line" href="#L539">539</a>
<a id="L540" class="source_line" href="#L540">540</a>
<a id="L541" class="source_line" href="#L541">541</a>
<a id="L542" class="source_line" href="#L542">542</a>
<a id="L543" class="source_line" href="#L543">543</a>
<a id="L544" class="source_line" href="#L544">544</a>
<a id="L545" class="source_line" href="#L545">545</a>
<a id="L546" class="source_line" href="#L546">546</a>
<a id="L547" class="source_line" href="#L547">547</a>
<a id="L548" class="source_line" href="#L548">548</a>
<a id="L549" class="source_line" href="#L549">549</a>
<a id="L550" class="source_line" href="#L550">550</a>
<a id="L551" class="source_line" href="#L551">551</a>
<a id="L552" class="source_line" href="#L552">552</a>
<a id="L553" class="source_line" href="#L553">553</a>
<a id="L554" class="source_line" href="#L554">554</a>
<a id="L555" class="source_line" href="#L555">555</a>
<a id="L556" class="source_line" href="#L556">556</a>
<a id="L557" class="source_line" href="#L557">557</a>
<a id="L558" class="source_line" href="#L558">558</a>
<a id="L559" class="source_line" href="#L559">559</a>
<a id="L560" class="source_line" href="#L560">560</a>
<a id="L561" class="source_line" href="#L561">561</a>
<a id="L562" class="source_line" href="#L562">562</a>
<a id="L563" class="source_line" href="#L563">563</a>
<a id="L564" class="source_line" href="#L564">564</a>
<a id="L565" class="source_line" href="#L565">565</a>
<a id="L566" class="source_line" href="#L566">566</a>
<a id="L567" class="source_line" href="#L567">567</a>
<a id="L568" class="source_line" href="#L568">568</a>
<a id="L569" class="source_line" href="#L569">569</a>
<a id="L570" class="source_line" href="#L570">570</a>
<a id="L571" class="source_line" href="#L571">571</a>
<a id="L572" class="source_line" href="#L572">572</a>
<a id="L573" class="source_line" href="#L573">573</a>
<a id="L574" class="source_line" href="#L574">574</a>
<a id="L575" class="source_line" href="#L575">575</a>
<a id="L576" class="source_line" href="#L576">576</a>
<a id="L577" class="source_line" href="#L577">577</a>
<a id="L578" class="source_line" href="#L578">578</a>
<a id="L579" class="source_line" href="#L579">579</a>
<a id="L580" class="source_line" href="#L580">580</a>
<a id="L581" class="source_line" href="#L581">581</a>
<a id="L582" class="source_line" href="#L582">582</a>
<a id="L583" class="source_line" href="#L583">583</a>
<a id="L584" class="source_line" href="#L584">584</a>
<a id="L585" class="source_line" href="#L585">585</a>
<a id="L586" class="source_line" href="#L586">586</a>
<a id="L587" class="source_line" href="#L587">587</a>
<a id="L588" class="source_line" href="#L588">588</a>
<a id="L589" class="source_line" href="#L589">589</a>
<a id="L590" class="source_line" href="#L590">590</a>
<a id="L591" class="source_line" href="#L591">591</a>
<a id="L592" class="source_line" href="#L592">592</a>
<a id="L593" class="source_line" href="#L593">593</a>
<a id="L594" class="source_line" href="#L594">594</a>
<a id="L595" class="source_line" href="#L595">595</a>
<a id="L596" class="source_line" href="#L596">596</a>
<a id="L597" class="source_line" href="#L597">597</a>
<a id="L598" class="source_line" href="#L598">598</a>
<a id="L599" class="source_line" href="#L599">599</a>
<a id="L600" class="source_line" href="#L600">600</a>
<a id="L601" class="source_line" href="#L601">601</a>
<a id="L602" class="source_line" href="#L602">602</a>
<a id="L603" class="source_line" href="#L603">603</a>
<a id="L604" class="source_line" href="#L604">604</a>
<a id="L605" class="source_line" href="#L605">605</a>
<a id="L606" class="source_line" href="#L606">606</a>
<a id="L607" class="source_line" href="#L607">607</a>
<a id="L608" class="source_line" href="#L608">608</a>
<a id="L609" class="source_line" href="#L609">609</a>
<a id="L610" class="source_line" href="#L610">610</a>
<a id="L611" class="source_line" href="#L611">611</a>
<a id="L612" class="source_line" href="#L612">612</a>
<a id="L613" class="source_line" href="#L613">613</a>
<a id="L614" class="source_line" href="#L614">614</a>
<a id="L615" class="source_line" href="#L615">615</a>
<a id="L616" class="source_line" href="#L616">616</a>
</code><code class="source_code"><span><span class="COMMENT">(*
 * Copyright (c) 2014 Leo White &lt;leo@lpw25.net&gt;
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* We are slightly more flexible here than OCaml usually is, and allow
   'linking' of modules that have the same name. This is because we do
   documentation at a package level - it's perfectly acceptable to have
   libraries within a package that are never meant to be linked into the same
   binary, however package-level documents such as module and type indexes
   effectively have to link those libraries together. Hence we may find
   ourselves in the unfortunate situation where there are multiple modules with the same
   name in our include path. We therefore maintain a mapping of module/page
   name to Root _list_. Where we've already made a judgement about which module
   we're looking for we have a digest, and can pick the correct module. When we
   don't (for example, when handling package-level mld files), we pick the
   first right now. The ocamldoc syntax doesn't currently allow for specifying
   more accurately than just the module name anyway.

   Where we notice this ambiguity we warn the user to wrap their libraries,
   which will generally fix this issue. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="OPEN">open</span> <a href="../odoc.odoc_utils/odoc_utils.ml.html"><span class="UIDENT">Odoc_utils</span></a><span class="EOL">
</span><span class="OPEN">open</span> <a href="or_error.ml.html"><span class="UIDENT">Or_error</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="type-named_root"><span class="TYPE">type</span> <span class="LIDENT">named_root</span> <span class="EQUAL">=</span> <span class="LIDENT">string</span> <span class="STAR">*</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span><span id="module-Named_roots"><span class="MODULE">module</span> <span class="UIDENT">Named_roots</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span id="module-Named_roots.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-error"><span class="TYPE">type</span> <span class="LIDENT">error</span> <span class="EQUAL">=</span> <span id="module-Named_roots.type-error.constructor-NoPackage"><span class="UIDENT">NoPackage</span></span> <span id="module-Named_roots.type-error.constructor-NoRoot"><span class="BAR">|</span> <span class="UIDENT">NoRoot</span></span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-input"><span class="TYPE">type</span> <span class="LIDENT">input</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_297"><span class="LIDENT">name</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="SEMI">;</span></span> <span id="def_307"><span class="LIDENT">dir</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.val-create"><span class="VAL">val</span> <span class="LIDENT">create</span> <span class="COLON">:</span> <span class="LIDENT">input</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">current_root</span><span class="COLON">:</span><span class="LIDENT">named_root</span> <span class="LIDENT">option</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.val-current_root"><span class="VAL">val</span> <span class="LIDENT">current_root</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">option</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.val-find_by_path"><span class="VAL">val</span> <span class="LIDENT">find_by_path</span> <span class="COLON">:</span><span class="EOL">
</span>    <span class="OPTLABEL">?root:</span><span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">path</span><span class="COLON">:</span><a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <a href="or_error.ml.html#type-result"><span class="LPAREN">(</span><a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">option</span><span class="COMMA">,</span> <span class="LIDENT">error</span><span class="RPAREN">)</span> <span class="LIDENT">result</span></a></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.val-find_by_name"><span class="VAL">val</span> <span class="LIDENT">find_by_name</span> <span class="COLON">:</span><span class="EOL">
</span>    <span class="OPTLABEL">?root:</span><span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">name</span><span class="COLON">:</span><span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <a href="or_error.ml.html#type-result"><span class="LPAREN">(</span><a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">list</span><span class="COMMA">,</span> <span class="LIDENT">error</span><span class="RPAREN">)</span> <span class="LIDENT">result</span></a></span><span class="EOL">
</span><span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Named_roots.type-flat"><span class="TYPE">type</span> <span class="LIDENT">flat</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span id="module-Named_roots.type-flat.constructor-Unvisited"><span class="BAR">|</span> <span class="UIDENT">Unvisited</span> <span class="OF">of</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span>    <span id="module-Named_roots.type-flat.constructor-Visited"><span class="BAR">|</span> <span class="UIDENT">Visited</span> <span class="OF">of</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><span class="LIDENT">string</span><span class="COMMA">,</span> <a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-hierarchical"><span class="TYPE">type</span> <span class="LIDENT">hierarchical</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="COMMA">,</span> <a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="STAR">*</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-pkg"><span class="TYPE">type</span> <span class="LIDENT">pkg</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_309"><span class="LIDENT">flat</span> <span class="COLON">:</span> <span class="LIDENT">flat</span><span class="SEMI">;</span></span> <span id="def_305"><span class="LIDENT">hierarchical</span> <span class="COLON">:</span> <span class="LIDENT">hierarchical</span></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_304"><span class="LIDENT">table</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><span class="LIDENT">string</span><span class="COMMA">,</span> <span class="LIDENT">pkg</span><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="SEMI">;</span></span> <span id="def_289"><span class="LIDENT">current_root</span> <span class="COLON">:</span> <span class="LIDENT">named_root</span> <span class="LIDENT">option</span></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-input"><span class="TYPE">type</span> <span class="LIDENT">input</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_301"><span class="LIDENT">name</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="SEMI">;</span></span> <span id="def_291"><span class="LIDENT">dir</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Named_roots.type-error"><span class="TYPE">type</span> <span class="LIDENT">error</span> <span class="EQUAL">=</span> <span id="module-Named_roots.type-error.constructor-NoPackage"><span class="UIDENT">NoPackage</span></span> <span id="module-Named_roots.type-error.constructor-NoRoot"><span class="BAR">|</span> <span class="UIDENT">NoRoot</span></span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-hashtbl_find_opt"><span class="LIDENT">hashtbl_find_opt</span></span> <span id="local_cache_1"><span class="LIDENT">cache</span></span> <span id="local_package_2"><span class="LIDENT">package</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <a href="#local_cache_1"><span class="LIDENT">cache</span></a> <a href="#local_package_2"><span class="LIDENT">package</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_x_3"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_x_3"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="EXCEPTION">exception</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-create"><span class="LIDENT">create</span></span> <span class="LPAREN">(</span><span id="local_pkglist_4"><span class="LIDENT">pkglist</span></span> <span class="COLON">:</span> <span class="LIDENT">input</span> <span class="LIDENT">list</span><span class="RPAREN">)</span> <span class="TILDE">~</span><span id="local_current_root_5"><span class="LIDENT">current_root</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_cache_6"><span class="LIDENT">cache</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">42</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LBRACE">{</span> <span class="LIDENT">name</span> <span class="EQUAL">=</span> <span id="local_pkgname_7"><span class="LIDENT">pkgname</span></span><span class="SEMI">;</span> <span class="LIDENT">dir</span> <span class="EQUAL">=</span> <span id="local_root_8"><span class="LIDENT">root</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_flat_9"><span class="LIDENT">flat</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unvisited</span> <a href="#local_root_8"><span class="LIDENT">root</span></a><span class="EOL">
</span>        <span class="AND">and</span> <span id="local_hierarchical_10"><span class="LIDENT">hierarchical</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">42</span><span class="COMMA">,</span> <a href="#local_root_8"><span class="LIDENT">root</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_cache_6"><span class="LIDENT">cache</span></a> <a href="#local_pkgname_7"><span class="LIDENT">pkgname</span></a> <span class="LBRACE">{</span> <a href="#local_flat_9"><span class="LIDENT">flat</span></a><span class="SEMI">;</span> <a href="#local_hierarchical_10"><span class="LIDENT">hierarchical</span></a> <span class="RBRACE">}</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="#local_pkglist_4"><span class="LIDENT">pkglist</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_current_root_5"><span class="LIDENT">current_root</span></a><span class="SEMI">;</span> <span class="LIDENT">table</span> <span class="EQUAL">=</span> <a href="#local_cache_6"><span class="LIDENT">cache</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-current_root"><span class="LIDENT">current_root</span></span> <span id="local_t_11"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-Option.val-map"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-snd"><span class="LIDENT">snd</span></a> <a href="#local_t_11"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">current_root</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-find_by_path"><span class="LIDENT">find_by_path</span></span> <span class="QUESTION">?</span><span id="local_root_12"><span class="LIDENT">root</span></span> <span class="LBRACE">{</span> <span class="LIDENT">table</span> <span class="EQUAL">=</span> <span id="local_cache_13"><span class="LIDENT">cache</span></span><span class="SEMI">;</span> <span id="local_current_root_14"><span class="LIDENT">current_root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="TILDE">~</span><span id="local_path_15"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_path_16"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">normalize</span> <a href="#local_path_15"><span class="LIDENT">path</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_root_17"><span class="LIDENT">root</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LPAREN">(</span><a href="#local_root_12"><span class="LIDENT">root</span></a><span class="COMMA">,</span> <a href="#local_current_root_14"><span class="LIDENT">current_root</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_pkg_18"><span class="LIDENT">pkg</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_pkg_19"><span class="LIDENT">pkg</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_pkg_19"><span class="LIDENT">pkg</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="UIDENT">NoRoot</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_root_17"><span class="LIDENT">root</span></a> <a href="or_error.ml.html#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_root_20"><span class="LIDENT">root</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">hashtbl_find_opt</span> <a href="#local_cache_13"><span class="LIDENT">cache</span></a> <a href="#local_root_20"><span class="LIDENT">root</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LBRACE">{</span> <span class="LIDENT">hierarchical</span> <span class="EQUAL">=</span> <span id="local_cache_21"><span class="LIDENT">cache</span></span><span class="COMMA">,</span> <span id="local_root_22"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="MATCH">match</span> <span class="LIDENT">hashtbl_find_opt</span> <a href="#local_cache_21"><span class="LIDENT">cache</span></a> <a href="#local_path_16"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_x_23"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_x_23"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_full_path_24"><span class="LIDENT">full_path</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="INFIXOP3">//</span> <span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="fs.ml.html#module-Directory.val-to_fpath"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">to_fpath</span></a> <a href="#local_root_22"><span class="LIDENT">root</span></a><span class="RPAREN">)</span> <a href="#local_path_16"><span class="LIDENT">path</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="IF">if</span> <a href="fs.ml.html#module-File.val-exists"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">exists</span></a> <a href="#local_full_path_24"><span class="LIDENT">full_path</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_cache_21"><span class="LIDENT">cache</span></a> <a href="#local_path_16"><span class="LIDENT">path</span></a> <a href="#local_full_path_24"><span class="LIDENT">full_path</span></a><span class="SEMI">;</span><span class="EOL">
</span>              <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_full_path_24"><span class="LIDENT">full_path</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="ELSE">else</span> <span class="UIDENT">Ok</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="UIDENT">NoPackage</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-populate_flat_namespace"><span class="LIDENT">populate_flat_namespace</span></span> <span class="TILDE">~</span><span id="local_root_25"><span class="LIDENT">root</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_flat_namespace_26"><span class="LIDENT">flat_namespace</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">42</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span><span class="EOL">
</span>        <a href="fs.ml.html#module-Directory.val-fold_files_rec_result"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">fold_files_rec_result</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span id="local_path_27"><span class="LIDENT">path</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_name_28"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">filename</span> <a href="#local_path_27"><span class="LIDENT">path</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_flat_namespace_26"><span class="LIDENT">flat_namespace</span></a> <a href="#local_name_28"><span class="LIDENT">name</span></a> <a href="#local_path_27"><span class="LIDENT">path</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="#local_root_25"><span class="LIDENT">root</span></a><span class="EOL">
</span>      <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span><span class="EOL">
</span>      <span class="COMMENT">(* The function passed to [fold_files_rec_result] never returns [Error _] *)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_flat_namespace_26"><span class="LIDENT">flat_namespace</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Named_roots.val-find_by_name"><span class="LIDENT">find_by_name</span></span> <span class="QUESTION">?</span><span id="local_root_29"><span class="LIDENT">root</span></span> <span class="LBRACE">{</span> <span class="LIDENT">table</span> <span class="EQUAL">=</span> <span id="local_cache_30"><span class="LIDENT">cache</span></span><span class="SEMI">;</span> <span id="local_current_root_31"><span class="LIDENT">current_root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="TILDE">~</span><span id="local_name_32"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_package_33"><span class="LIDENT">package</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LPAREN">(</span><a href="#local_root_29"><span class="LIDENT">root</span></a><span class="COMMA">,</span> <a href="#local_current_root_31"><span class="LIDENT">current_root</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_pkg_34"><span class="LIDENT">pkg</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_pkg_35"><span class="LIDENT">pkg</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_pkg_35"><span class="LIDENT">pkg</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="UIDENT">NoRoot</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_package_33"><span class="LIDENT">package</span></a> <a href="or_error.ml.html#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_package_36"><span class="LIDENT">package</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">hashtbl_find_opt</span> <a href="#local_cache_30"><span class="LIDENT">cache</span></a> <a href="#local_package_36"><span class="LIDENT">package</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LBRACE">{</span> <span class="LIDENT">flat</span> <span class="EQUAL">=</span> <span class="UIDENT">Visited</span> <span id="local_flat_37"><span class="LIDENT">flat</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find_all"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find_all</span></a> <a href="#local_flat_37"><span class="LIDENT">flat</span></a> <a href="#local_name_32"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">flat</span> <span class="EQUAL">=</span> <span class="UIDENT">Unvisited</span> <span id="local_root_39"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_p_38"><span class="LIDENT">p</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_flat_40"><span class="LIDENT">flat</span></span> <span class="EQUAL">=</span> <span class="LIDENT">populate_flat_namespace</span> <span class="TILDE">~</span><a href="#local_root_39"><span class="LIDENT">root</span></a> <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-replace"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">replace</span></a> <a href="#local_cache_30"><span class="LIDENT">cache</span></a> <a href="#local_package_36"><span class="LIDENT">package</span></a> <span class="LBRACE">{</span> <a href="#local_p_38"><span class="LIDENT">p</span></a> <span class="WITH">with</span> <span class="LIDENT">flat</span> <span class="EQUAL">=</span> <span class="UIDENT">Visited</span> <a href="#local_flat_40"><span class="LIDENT">flat</span></a> <span class="RBRACE">}</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find_all"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find_all</span></a> <a href="#local_flat_40"><span class="LIDENT">flat</span></a> <a href="#local_name_32"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="UIDENT">NoPackage</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">find_by_name</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">warning</span> <span class="STRING">&quot;-5&quot;</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Accessible_paths"><span class="MODULE">module</span> <span class="UIDENT">Accessible_paths</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span id="module-Accessible_paths.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Accessible_paths.val-create"><span class="VAL">val</span> <span class="LIDENT">create</span> <span class="COLON">:</span> <span class="LIDENT">directories</span><span class="COLON">:</span><a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Accessible_paths.val-find"><span class="VAL">val</span> <span class="LIDENT">find</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Accessible_paths.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#type-t"><span class="LPAREN">(</span><span class="LIDENT">string</span><span class="COMMA">,</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="COMMENT">(* list *)</span><span class="RPAREN">)</span> <span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Accessible_paths.val-create"><span class="LIDENT">create</span></span> <span class="TILDE">~</span><span id="local_directories_41"><span class="LIDENT">directories</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_unit_cache_42"><span class="LIDENT">unit_cache</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">42</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_directory_43"><span class="LIDENT">directory</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="TRY">try</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_files_44"><span class="LIDENT">files</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-readdir"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">readdir</span></a> <span class="LPAREN">(</span><a href="fs.ml.html#module-Directory.val-to_string"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_directory_43"><span class="LIDENT">directory</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-iter"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>            <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_file_45"><span class="LIDENT">file</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_file_46"><span class="LIDENT">file</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">v</span> <a href="#local_file_45"><span class="LIDENT">file</span></a> <span class="IN">in</span><span class="EOL">
</span>              <span class="IF">if</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">has_ext</span> <span class="STRING">&quot;odoc&quot;</span> <a href="#local_file_46"><span class="LIDENT">file</span></a> <span class="THEN">then</span><span class="EOL">
</span>                <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <a href="#local_unit_cache_42"><span class="LIDENT">unit_cache</span></a><span class="EOL">
</span>                  <span class="LPAREN">(</span><span class="UIDENT">Astring</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LIDENT">capitalize</span><span class="EOL">
</span>                     <span class="LPAREN">(</span><a href="#local_file_46"><span class="LIDENT">file</span></a> <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">rem_ext</span> <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Fpath</span><span class="DOT">.</span><span class="LIDENT">basename</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>                  <span class="LPAREN">(</span><a href="fs.ml.html#module-File.val-append"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">append</span></a> <a href="#local_directory_43"><span class="LIDENT">directory</span></a> <a href="#local_file_46"><span class="LIDENT">file</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>            <a href="#local_files_44"><span class="LIDENT">files</span></a><span class="EOL">
</span>        <span class="WITH">with</span> <span class="UIDENT">Sys_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* TODO: Raise a warning if a directory given as -I cannot be opened *)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="#local_directories_41"><span class="LIDENT">directories</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_unit_cache_42"><span class="LIDENT">unit_cache</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Accessible_paths.val-find"><span class="LIDENT">find</span></span> <span id="local_t_47"><span class="LIDENT">t</span></span> <span id="local_name_48"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_name_49"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Astring</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LIDENT">capitalize</span> <a href="#local_name_48"><span class="LIDENT">name</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find_all"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find_all</span></a> <a href="#local_t_47"><span class="LIDENT">t</span></a> <a href="#local_name_49"><span class="LIDENT">name</span></a><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Hierarchy"><span class="MODULE">module</span> <span class="UIDENT">Hierarchy</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span class="DOCSTRING">(** Represent a file hierarchy and allow file path manipulations that do not
      escape it. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Hierarchy.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Hierarchy.type-error"><span class="TYPE">type</span> <span class="LIDENT">error</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape_hierarchy</span> <span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Hierarchy.val-make"><span class="VAL">val</span> <span class="LIDENT">make</span> <span class="COLON">:</span> <span class="LIDENT">hierarchy_root</span><span class="COLON">:</span><a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">current_dir</span><span class="COLON">:</span><a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Hierarchy.val-resolve_relative"><span class="VAL">val</span> <span class="LIDENT">resolve_relative</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <a href="or_error.ml.html#type-result"><span class="LPAREN">(</span><a href="fs.ml.html#module-File.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="COMMA">,</span> <span class="LIDENT">error</span><span class="RPAREN">)</span> <span class="LIDENT">result</span></a></span><span class="EOL">
</span>  <span class="DOCSTRING">(** [resolve_relative h relpath] resolve [relpath] relatively to the current
      directory, making sure not to escape the hierarchy. *)</span><span class="EOL">
</span><span class="END">end</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Hierarchy.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_306"><span class="LIDENT">hierarchy_root</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="SEMI">;</span></span> <span id="def_298"><span class="LIDENT">current_dir</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a></span> <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Hierarchy.type-error"><span class="TYPE">type</span> <span class="LIDENT">error</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape_hierarchy</span> <span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Hierarchy.val-make"><span class="LIDENT">make</span></span> <span class="TILDE">~</span><span id="local_hierarchy_root_50"><span class="LIDENT">hierarchy_root</span></span> <span class="TILDE">~</span><span id="local_current_dir_51"><span class="LIDENT">current_dir</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <a href="#local_hierarchy_root_50"><span class="LIDENT">hierarchy_root</span></a><span class="SEMI">;</span> <a href="#local_current_dir_51"><span class="LIDENT">current_dir</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Hierarchy.val-resolve_relative"><span class="LIDENT">resolve_relative</span></span> <span id="local_t_52"><span class="LIDENT">t</span></span> <span id="local_relpath_53"><span class="LIDENT">relpath</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_path_54"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span> <a href="fs.ml.html#module-File.val-append"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">append</span></a> <a href="#local_t_52"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">current_dir</span> <a href="#local_relpath_53"><span class="LIDENT">relpath</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="fs.ml.html#module-Directory.val-contains"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">contains</span></a> <span class="LABEL">~parentdir:</span><a href="#local_t_52"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">hierarchy_root</span> <a href="#local_path_54"><span class="LIDENT">path</span></a> <span class="THEN">then</span> <span class="UIDENT">Ok</span> <a href="#local_path_54"><span class="LIDENT">path</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape_hierarchy</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-StringMap"><span class="MODULE">module</span> <span class="UIDENT">StringMap</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/map.ml.html#module-Make"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">String</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_imports_map"><span class="LIDENT">build_imports_map</span></span> <span id="local_imports_55"><span class="LIDENT">imports</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_map_56"><span class="LIDENT">map</span></span> <span id="local_import_57"><span class="LIDENT">import</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_import_57"><span class="LIDENT">import</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="UIDENT">Import</span><span class="DOT">.</span><span class="UIDENT">Unresolved</span> <span class="LPAREN">(</span><span id="local_name_58"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">StringMap</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_name_58"><span class="LIDENT">name</span></a> <a href="#local_import_57"><span class="LIDENT">import</span></a> <a href="#local_map_56"><span class="LIDENT">map</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="UIDENT">Import</span><span class="DOT">.</span><span class="UIDENT">Resolved</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_name_59"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">StringMap</span><span class="DOT">.</span><span class="LIDENT">add</span> <span class="LPAREN">(</span><a href="../odoc.model/names.ml.html#module-Name.val-to_string"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Names</span><span class="DOT">.</span><span class="UIDENT">ModuleName</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_name_59"><span class="LIDENT">name</span></a><span class="RPAREN">)</span> <a href="#local_import_57"><span class="LIDENT">import</span></a> <a href="#local_map_56"><span class="LIDENT">map</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="UIDENT">StringMap</span><span class="DOT">.</span><span class="LIDENT">empty</span> <a href="#local_imports_55"><span class="LIDENT">imports</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-root_name"><span class="LIDENT">root_name</span></span> <span id="local_root_60"><span class="LIDENT">root</span></span> <span class="EQUAL">=</span> <a href="../odoc.model/root.ml.html#module-Odoc_file.val-name"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Root</span><span class="DOT">.</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">name</span></a> <a href="#local_root_60"><span class="LIDENT">root</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Root</span><span class="DOT">.</span><span class="LIDENT">file</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-unit_name"><span class="LIDENT">unit_name</span></span><span class="EOL">
</span>    <span class="LPAREN">(</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <span class="LBRACE">{</span> <span id="local_root_61"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Page_content</span> <span class="LBRACE">{</span> <span id="local_root_62"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Impl_content</span> <span class="LBRACE">{</span> <span id="local_root_63"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Asset_content</span> <span class="LBRACE">{</span> <span id="local_root_64"><span class="LIDENT">root</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">root_name</span> <a href="#local_root_64"><span class="LIDENT">root</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-unit_cache"><span class="LIDENT">unit_cache</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">42</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-load_unit_from_file"><span class="LIDENT">load_unit_from_file</span></span> <span id="local_path_65"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <span class="LIDENT">unit_cache</span> <a href="#local_path_65"><span class="LIDENT">path</span></a><span class="EOL">
</span>  <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_r_66"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <a href="odoc_file.ml.html#val-load"><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">load</span></a> <a href="#local_path_65"><span class="LIDENT">path</span></a> <a href="or_error.ml.html#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_u_67"><span class="LIDENT">u</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_u_67"><span class="LIDENT">u</span></a><span class="DOT">.</span><span class="LIDENT">content</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LIDENT">unit_cache</span> <a href="#local_path_65"><span class="LIDENT">path</span></a> <a href="#local_r_66"><span class="LIDENT">r</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_r_66"><span class="LIDENT">r</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-self"><span class="LIDENT">self</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Load every units matching a given name. Cached. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-load_units_from_name"><span class="LIDENT">load_units_from_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_safe_read_68"><span class="LIDENT">safe_read</span></span> <span id="local_file_69"><span class="LIDENT">file</span></span> <span id="local_acc_70"><span class="LIDENT">acc</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">load_unit_from_file</span> <a href="#local_file_69"><span class="LIDENT">file</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_u_71"><span class="LIDENT">u</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_u_71"><span class="LIDENT">u</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_70"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span id="local_msg_72"><span class="LIDENT">msg</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* TODO: Propagate warnings instead of printing. *)</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_warning_73"><span class="LIDENT">warning</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../odoc.model/error.ml.html#val-filename_only"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">filename_only</span></a> <span class="STRING">&quot;%s&quot;</span> <a href="#local_msg_72"><span class="LIDENT">msg</span></a> <span class="LPAREN">(</span><a href="fs.ml.html#module-File.val-to_string"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_file_69"><span class="LIDENT">file</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-prerr_endline"><span class="LIDENT">prerr_endline</span></a> <span class="LPAREN">(</span><a href="../odoc.model/error.ml.html#val-to_string"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_warning_73"><span class="LIDENT">warning</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_acc_70"><span class="LIDENT">acc</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_do_load_74"><span class="LIDENT">do_load</span></span> <span id="local_ap_75"><span class="LIDENT">ap</span></span> <span id="local_target_name_76"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_paths_77"><span class="LIDENT">paths</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_ap_75"><span class="LIDENT">ap</span></a> <a href="#local_target_name_76"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_right"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_right</span></a> <a href="#local_safe_read_68"><span class="LIDENT">safe_read</span></a> <a href="#local_paths_77"><span class="LIDENT">paths</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_check_self_78"><span class="LIDENT">check_self</span></span> <span id="local_name_79"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">self</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_n_80"><span class="LIDENT">n</span></span><span class="COMMA">,</span> <span id="local_unit_81"><span class="LIDENT">unit</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="#local_n_80"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_name_79"><span class="LIDENT">name</span></a> <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_unit_81"><span class="LIDENT">unit</span></a> <span class="ELSE">else</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_ap_82"><span class="LIDENT">ap</span></span> <span id="local_target_name_83"><span class="LIDENT">target_name</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_check_self_78"><span class="LIDENT">check_self</span></a> <a href="#local_target_name_83"><span class="LIDENT">target_name</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_unit_84"><span class="LIDENT">unit</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span> <a href="#local_unit_84"><span class="LIDENT">unit</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_do_load_74"><span class="LIDENT">do_load</span></a> <a href="#local_ap_82"><span class="LIDENT">ap</span></a> <a href="#local_target_name_83"><span class="LIDENT">target_name</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-find_map"><span class="LIDENT">find_map</span></span> <span id="local_f_85"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span id="local_hd_86"><span class="LIDENT">hd</span></span> <span class="COLONCOLON">::</span> <span id="local_tl_87"><span class="LIDENT">tl</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_f_85"><span class="LIDENT">f</span></a> <a href="#local_hd_86"><span class="LIDENT">hd</span></a> <span class="WITH">with</span> <span class="UIDENT">Some</span> <span id="local_x_88"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_x_88"><span class="LIDENT">x</span></a><span class="COMMA">,</span> <a href="#local_tl_87"><span class="LIDENT">tl</span></a><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">find_map</span> <a href="#local_f_85"><span class="LIDENT">f</span></a> <a href="#local_tl_87"><span class="LIDENT">tl</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_unit_with_digest"><span class="LIDENT">lookup_unit_with_digest</span></span> <span id="local_ap_89"><span class="LIDENT">ap</span></span> <span id="local_target_name_90"><span class="LIDENT">target_name</span></span> <span id="local_digest_91"><span class="LIDENT">digest</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unit_that_match_digest_92"><span class="LIDENT">unit_that_match_digest</span></span> <span id="local_u_93"><span class="LIDENT">u</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_u_93"><span class="LIDENT">u</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <span id="local_m_94"><span class="LIDENT">m</span></span><span class="EOL">
</span>      <span class="WHEN">when</span> <a href="../../../ocaml-base-compiler/src/stdlib/digest.ml.html#module-MD5.val-compare"><span class="UIDENT">Digest</span><span class="DOT">.</span><span class="LIDENT">compare</span></a> <a href="#local_m_94"><span class="LIDENT">m</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="LIDENT">digest</span> <a href="#local_digest_91"><span class="LIDENT">digest</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>      <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Some</span> <a href="#local_m_94"><span class="LIDENT">m</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_units_95"><span class="LIDENT">units</span></span> <span class="EQUAL">=</span> <span class="LIDENT">load_units_from_name</span> <a href="#local_ap_89"><span class="LIDENT">ap</span></a> <a href="#local_target_name_90"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">find_map</span> <a href="#local_unit_that_match_digest_92"><span class="LIDENT">unit_that_match_digest</span></a> <a href="#local_units_95"><span class="LIDENT">units</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_m_96"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="UIDENT">Found</span> <a href="#local_m_96"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Lookup a compilation unit matching a name. If there is more than one
    result, report on stderr and return the first one.

    TODO: Correctly propagate warnings instead of printing. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-{lookup_unit_by_name}1/shadowed/(odoc-src-odoc.odoc-resolver.ml)"><span class="LIDENT">lookup_unit_by_name</span></span> <span id="local_ap_97"><span class="LIDENT">ap</span></span> <span id="local_target_name_98"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_first_unit_99"><span class="LIDENT">first_unit</span></span> <span id="local_u_100"><span class="LIDENT">u</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_u_100"><span class="LIDENT">u</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <span id="local_m_101"><span class="LIDENT">m</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_m_101"><span class="LIDENT">m</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Impl_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Page_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Asset_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_find_ambiguous_102"><span class="LIDENT">find_ambiguous</span></span> <span id="local_tl_103"><span class="LIDENT">tl</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">find_map</span> <a href="#local_first_unit_99"><span class="LIDENT">first_unit</span></a> <a href="#local_tl_103"><span class="LIDENT">tl</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_m_104"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span id="local_tl_105"><span class="LIDENT">tl</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_m_104"><span class="LIDENT">m</span></a> <span class="COLONCOLON">::</span> <a href="#local_find_ambiguous_102"><span class="LIDENT">find_ambiguous</span></a> <a href="#local_tl_105"><span class="LIDENT">tl</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_units_106"><span class="LIDENT">units</span></span> <span class="EQUAL">=</span> <span class="LIDENT">load_units_from_name</span> <a href="#local_ap_97"><span class="LIDENT">ap</span></a> <a href="#local_target_name_98"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">find_map</span> <a href="#local_first_unit_99"><span class="LIDENT">first_unit</span></a> <a href="#local_units_106"><span class="LIDENT">units</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_m_107"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span id="local_tl_108"><span class="LIDENT">tl</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_find_ambiguous_102"><span class="LIDENT">find_ambiguous</span></a> <a href="#local_tl_108"><span class="LIDENT">tl</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_ambiguous_109"><span class="LIDENT">ambiguous</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_ambiguous_110"><span class="LIDENT">ambiguous</span></span> <span class="EQUAL">=</span> <a href="#local_m_107"><span class="LIDENT">m</span></a> <span class="COLONCOLON">::</span> <a href="#local_ambiguous_109"><span class="LIDENT">ambiguous</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_ambiguous_111"><span class="LIDENT">ambiguous</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_m_112"><span class="LIDENT">m</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">root_name</span> <a href="#local_m_112"><span class="LIDENT">m</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="LIDENT">root</span><span class="RPAREN">)</span><span class="EOL">
</span>              <a href="#local_ambiguous_110"><span class="LIDENT">ambiguous</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_warning_113"><span class="LIDENT">warning</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <a href="../odoc.model/error.ml.html#val-filename_only"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">filename_only</span></a><span class="EOL">
</span>              <span class="STRING">&quot;Ambiguous lookup. Possible files: %a&quot;</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html"><span class="UIDENT">Format</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_list"><span class="LIDENT">pp_print_list</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="LIDENT">pp_print_string</span></a><span class="RPAREN">)</span><span class="EOL">
</span>              <a href="#local_ambiguous_111"><span class="LIDENT">ambiguous</span></a> <a href="#local_target_name_98"><span class="LIDENT">target_name</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-prerr_endline"><span class="LIDENT">prerr_endline</span></a> <span class="LPAREN">(</span><a href="../odoc.model/error.ml.html#val-to_string"><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_warning_113"><span class="LIDENT">warning</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Some</span> <a href="#local_m_107"><span class="LIDENT">m</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Lookup an unit. First looks into [imports_map] then searches into the
    paths. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_unit_by_name"><span class="LIDENT">lookup_unit_by_name</span></span> <span class="TILDE">~</span><span id="local_important_digests_114"><span class="LIDENT">important_digests</span></span> <span class="TILDE">~</span><span id="local_imports_map_115"><span class="LIDENT">imports_map</span></span> <span id="local_ap_116"><span class="LIDENT">ap</span></span> <span id="local_target_name_117"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_of_option_118"><span class="LIDENT">of_option</span></span> <span id="local_f_119"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_f_119"><span class="LIDENT">f</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_m_120"><span class="LIDENT">m</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="UIDENT">Found</span> <a href="#local_m_120"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">StringMap</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_target_name_117"><span class="LIDENT">target_name</span></a> <a href="#local_imports_map_115"><span class="LIDENT">imports_map</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="UIDENT">Import</span><span class="DOT">.</span><span class="UIDENT">Unresolved</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_digest_121"><span class="LIDENT">digest</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">lookup_unit_with_digest</span> <a href="#local_ap_116"><span class="LIDENT">ap</span></a> <a href="#local_target_name_117"><span class="LIDENT">target_name</span></a> <a href="#local_digest_121"><span class="LIDENT">digest</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Unresolved</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_important_digests_114"><span class="LIDENT">important_digests</span></a> <span class="THEN">then</span> <span class="UIDENT">Ok</span> <span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="UIDENT">Forward_reference</span><span class="EOL">
</span>      <span class="ELSE">else</span> <a href="#local_of_option_118"><span class="LIDENT">of_option</span></a> <span class="LPAREN">(</span><span class="LIDENT">lookup_unit_by_name</span> <a href="#local_ap_116"><span class="LIDENT">ap</span></a> <a href="#local_target_name_117"><span class="LIDENT">target_name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Resolved</span> <span class="LPAREN">(</span><span id="local_root_122"><span class="LIDENT">root</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_unit_with_digest</span> <a href="#local_ap_116"><span class="LIDENT">ap</span></a> <a href="#local_target_name_117"><span class="LIDENT">target_name</span></a> <a href="#local_root_122"><span class="LIDENT">root</span></a><span class="DOT">.</span><span class="LIDENT">digest</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="EXCEPTION">exception</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_important_digests_114"><span class="LIDENT">important_digests</span></a> <span class="THEN">then</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span>      <span class="ELSE">else</span> <a href="#local_of_option_118"><span class="LIDENT">of_option</span></a> <span class="LPAREN">(</span><span class="LIDENT">lookup_unit_by_name</span> <a href="#local_ap_116"><span class="LIDENT">ap</span></a> <a href="#local_target_name_117"><span class="LIDENT">target_name</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Lookup a page.

    TODO: Warning on ambiguous lookup. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_page_by_name"><span class="LIDENT">lookup_page_by_name</span></span> <span id="local_ap_123"><span class="LIDENT">ap</span></span> <span id="local_target_name_124"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_target_name_125"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;page-&quot;</span> <span class="INFIXOP1">^</span> <a href="#local_target_name_124"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_is_page_126"><span class="LIDENT">is_page</span></span> <span id="local_u_127"><span class="LIDENT">u</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_u_127"><span class="LIDENT">u</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Page_content</span> <span id="local_p_128"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_p_128"><span class="LIDENT">p</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Impl_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Unit_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Asset_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_units_129"><span class="LIDENT">units</span></span> <span class="EQUAL">=</span> <span class="LIDENT">load_units_from_name</span> <a href="#local_ap_123"><span class="LIDENT">ap</span></a> <a href="#local_target_name_125"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">find_map</span> <a href="#local_is_page_126"><span class="LIDENT">is_page</span></a> <a href="#local_units_129"><span class="LIDENT">units</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_p_130"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_p_130"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Lookup an implementation. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_impl"><span class="LIDENT">lookup_impl</span></span> <span id="local_ap_131"><span class="LIDENT">ap</span></span> <span id="local_target_name_132"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_target_name_133"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;impl-&quot;</span> <span class="INFIXOP1">^</span> <span class="UIDENT">Astring</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LIDENT">uncapitalize</span> <a href="#local_target_name_132"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_is_impl_134"><span class="LIDENT">is_impl</span></span> <span id="local_u_135"><span class="LIDENT">u</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_u_135"><span class="LIDENT">u</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Impl_content</span> <span id="local_p_136"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_p_136"><span class="LIDENT">p</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Page_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Unit_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Asset_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_units_137"><span class="LIDENT">units</span></span> <span class="EQUAL">=</span> <span class="LIDENT">load_units_from_name</span> <a href="#local_ap_131"><span class="LIDENT">ap</span></a> <a href="#local_target_name_133"><span class="LIDENT">target_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">find_map</span> <a href="#local_is_impl_134"><span class="LIDENT">is_impl</span></a> <a href="#local_units_137"><span class="LIDENT">units</span></a> <span class="WITH">with</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_p_138"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_p_138"><span class="LIDENT">p</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Add the current unit to the cache. No need to load other units with the same
    name. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-add_unit_to_cache"><span class="LIDENT">add_unit_to_cache</span></span> <span id="local_u_139"><span class="LIDENT">u</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_target_name_140"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_u_139"><span class="LIDENT">u</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Page_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;page-&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Impl_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;impl-&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Unit_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Asset_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;asset-&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="INFIXOP1">^</span> <span class="LIDENT">unit_name</span> <a href="#local_u_139"><span class="LIDENT">u</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">self</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_target_name_140"><span class="LIDENT">target_name</span></a><span class="COMMA">,</span> <a href="#local_u_139"><span class="LIDENT">u</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Resolve a path reference in the given named roots and hierarchy.
    [possible_unit_names] should return a list of possible file names for the
    given unit name. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_path"><span class="LIDENT">lookup_path</span></span> <span class="TILDE">~</span><span id="local_possible_unit_names_141"><span class="LIDENT">possible_unit_names</span></span> <span class="TILDE">~</span><span id="local_named_roots_142"><span class="LIDENT">named_roots</span></span> <span class="TILDE">~</span><span id="local_hierarchy_143"><span class="LIDENT">hierarchy</span></span> <span class="LPAREN">(</span><span id="local_tag_144"><span class="LIDENT">tag</span></span><span class="COMMA">,</span> <span id="local_path_145"><span class="LIDENT">path</span></span><span class="RPAREN">)</span> <span class="COLON">:</span><span class="EOL">
</span>    <a href="or_error.ml.html#type-result"><span class="LPAREN">(</span><a href="odoc_file.ml.html#type-content"><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">content</span></a><span class="COMMA">,</span> <span class="LBRACKET">[</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="LIDENT">result</span></a> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="OPEN">open</span> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad"><span class="UIDENT">Odoc_utils</span><span class="DOT">.</span><span class="UIDENT">OptionMonad</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_option_to_result_146"><span class="LIDENT">option_to_result</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span> <span class="UIDENT">Some</span> <span id="local_p_147"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_p_147"><span class="LIDENT">p</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* TODO: We might want to differentiate when the file is not found and when
     an unexpected error occurred. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_handle_load_error_148"><span class="LIDENT">handle_load_error</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span> <span class="UIDENT">Ok</span> <span id="local_u_149"><span class="LIDENT">u</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_u_149"><span class="LIDENT">u</span></a> <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_ref_path_to_file_path_150"><span class="LIDENT">ref_path_to_file_path</span></span> <span id="local_path_151"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_path_151"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_name_152"><span class="LIDENT">name</span></span> <span class="COLONCOLON">::</span> <span id="local_rest_153"><span class="LIDENT">rest</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fname_154"><span class="LIDENT">fname</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <span class="LPAREN">(</span><a href="#local_fname_154"><span class="LIDENT">fname</span></a> <span class="COLONCOLON">::</span> <a href="#local_rest_153"><span class="LIDENT">rest</span></a><span class="RPAREN">)</span> <span class="INFIXOP0">|&gt;</span> <a href="fs.ml.html#module-File.val-of_segs"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">of_segs</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="#local_possible_unit_names_141"><span class="LIDENT">possible_unit_names</span></a> <a href="#local_name_152"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_find_by_path_155"><span class="LIDENT">find_by_path</span></span> <span class="QUESTION">?</span><span id="local_root_156"><span class="LIDENT">root</span></span> <span id="local_named_roots_157"><span class="LIDENT">named_roots</span></span> <span id="local_path_158"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">find_by_path</span> <span class="QUESTION">?</span><a href="#local_root_156"><span class="LIDENT">root</span></a> <a href="#local_named_roots_157"><span class="LIDENT">named_roots</span></a> <span class="TILDE">~</span><a href="#local_path_158"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_x_159"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_159"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="UIDENT">NoPackage</span> <span class="BAR">|</span> <span class="UIDENT">NoRoot</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_find_in_named_roots_160"><span class="LIDENT">find_in_named_roots</span></span> <span class="QUESTION">?</span><span id="local_root_161"><span class="LIDENT">root</span></span> <span id="local_path_162"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_named_roots_142"><span class="LIDENT">named_roots</span></a> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_named_roots_163"><span class="LIDENT">named_roots</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="#local_find_by_path_155"><span class="LIDENT">find_by_path</span></a> <span class="QUESTION">?</span><a href="#local_root_161"><span class="LIDENT">root</span></a> <a href="#local_named_roots_163"><span class="LIDENT">named_roots</span></a> <a href="#local_path_162"><span class="LIDENT">path</span></a> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_path_164"><span class="LIDENT">path</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">load_unit_from_file</span> <a href="#local_path_164"><span class="LIDENT">path</span></a> <span class="INFIXOP0">|&gt;</span> <a href="#local_handle_load_error_148"><span class="LIDENT">handle_load_error</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_find_in_hierarchy_165"><span class="LIDENT">find_in_hierarchy</span></span> <span id="local_path_166"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_hierarchy_143"><span class="LIDENT">hierarchy</span></a> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_hierarchy_167"><span class="LIDENT">hierarchy</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="UIDENT">Hierarchy</span><span class="DOT">.</span><span class="LIDENT">resolve_relative</span> <a href="#local_hierarchy_167"><span class="LIDENT">hierarchy</span></a> <a href="#local_path_166"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_path_168"><span class="LIDENT">path</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">load_unit_from_file</span> <a href="#local_path_168"><span class="LIDENT">path</span></a> <span class="INFIXOP0">|&gt;</span> <a href="#local_handle_load_error_148"><span class="LIDENT">handle_load_error</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape_hierarchy</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span> <span class="COMMENT">(* TODO: propagate more information *)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_tag_144"><span class="LIDENT">tag</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">TCurrentPackage</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="COMMENT">(* [path] is within the current package root. *)</span><span class="EOL">
</span>      <a href="#local_ref_path_to_file_path_150"><span class="LIDENT">ref_path_to_file_path</span></a> <a href="#local_path_145"><span class="LIDENT">path</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="../odoc.odoc_utils/odoc_list.ml.html#val-find_map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find_map</span></a> <a href="#local_find_in_named_roots_160"><span class="LIDENT">find_in_named_roots</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="#local_option_to_result_146"><span class="LIDENT">option_to_result</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">TAbsolutePath</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_path_145"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_root_169"><span class="LIDENT">root</span></span> <span class="COLONCOLON">::</span> <span id="local_path_170"><span class="LIDENT">path</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_ref_path_to_file_path_150"><span class="LIDENT">ref_path_to_file_path</span></a> <a href="#local_path_170"><span class="LIDENT">path</span></a><span class="EOL">
</span>          <span class="INFIXOP0">|&gt;</span> <a href="../odoc.odoc_utils/odoc_list.ml.html#val-find_map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find_map</span></a> <span class="LPAREN">(</span><a href="#local_find_in_named_roots_160"><span class="LIDENT">find_in_named_roots</span></a> <span class="TILDE">~</span><a href="#local_root_169"><span class="LIDENT">root</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="#local_option_to_result_146"><span class="LIDENT">option_to_result</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">TRelativePath</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#local_ref_path_to_file_path_150"><span class="LIDENT">ref_path_to_file_path</span></a> <a href="#local_path_145"><span class="LIDENT">path</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="../odoc.odoc_utils/odoc_list.ml.html#val-find_map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find_map</span></a> <a href="#local_find_in_hierarchy_165"><span class="LIDENT">find_in_hierarchy</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="#local_option_to_result_146"><span class="LIDENT">option_to_result</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_asset_by_path"><span class="LIDENT">lookup_asset_by_path</span></span> <span class="TILDE">~</span><span id="local_pages_171"><span class="LIDENT">pages</span></span> <span class="TILDE">~</span><span id="local_hierarchy_172"><span class="LIDENT">hierarchy</span></span> <span id="local_path_173"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_possible_unit_names_174"><span class="LIDENT">possible_unit_names</span></span> <span id="local_name_175"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span> <span class="STRING">&quot;asset-&quot;</span> <span class="INFIXOP1">^</span> <a href="#local_name_175"><span class="LIDENT">name</span></a> <span class="INFIXOP1">^</span> <span class="STRING">&quot;.odoc&quot;</span> <span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">lookup_path</span> <span class="TILDE">~</span><a href="#local_possible_unit_names_174"><span class="LIDENT">possible_unit_names</span></a> <span class="LABEL">~named_roots:</span><a href="#local_pages_171"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_172"><span class="LIDENT">hierarchy</span></a> <a href="#local_path_173"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Asset_content</span> <span id="local_asset_176"><span class="LIDENT">asset</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_asset_176"><span class="LIDENT">asset</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="COMMENT">(* TODO: Report is not an asset. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_e_177"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_177"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_page_by_path"><span class="LIDENT">lookup_page_by_path</span></span> <span class="TILDE">~</span><span id="local_pages_178"><span class="LIDENT">pages</span></span> <span class="TILDE">~</span><span id="local_hierarchy_179"><span class="LIDENT">hierarchy</span></span> <span id="local_path_180"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_possible_unit_names_181"><span class="LIDENT">possible_unit_names</span></span> <span id="local_name_182"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span> <span class="STRING">&quot;page-&quot;</span> <span class="INFIXOP1">^</span> <a href="#local_name_182"><span class="LIDENT">name</span></a> <span class="INFIXOP1">^</span> <span class="STRING">&quot;.odoc&quot;</span> <span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">lookup_path</span> <span class="TILDE">~</span><a href="#local_possible_unit_names_181"><span class="LIDENT">possible_unit_names</span></a> <span class="LABEL">~named_roots:</span><a href="#local_pages_178"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_179"><span class="LIDENT">hierarchy</span></a> <a href="#local_path_180"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Page_content</span> <span id="local_page_183"><span class="LIDENT">page</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_page_183"><span class="LIDENT">page</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="COMMENT">(* TODO: Report is not a page. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_e_184"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_184"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_unit_by_path"><span class="LIDENT">lookup_unit_by_path</span></span> <span class="TILDE">~</span><span id="local_libs_185"><span class="LIDENT">libs</span></span> <span class="TILDE">~</span><span id="local_hierarchy_186"><span class="LIDENT">hierarchy</span></span> <span id="local_path_187"><span class="LIDENT">path</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_possible_unit_names_188"><span class="LIDENT">possible_unit_names</span></span> <span id="local_name_189"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Astring</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="EOL">
</span>      <span class="LBRACKET">[</span> <span class="LIDENT">capitalize</span> <a href="#local_name_189"><span class="LIDENT">name</span></a> <span class="INFIXOP1">^</span> <span class="STRING">&quot;.odoc&quot;</span><span class="SEMI">;</span> <span class="LIDENT">uncapitalize</span> <a href="#local_name_189"><span class="LIDENT">name</span></a> <span class="INFIXOP1">^</span> <span class="STRING">&quot;.odoc&quot;</span> <span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">lookup_path</span> <span class="TILDE">~</span><a href="#local_possible_unit_names_188"><span class="LIDENT">possible_unit_names</span></a> <span class="LABEL">~named_roots:</span><a href="#local_libs_185"><span class="LIDENT">libs</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_186"><span class="LIDENT">hierarchy</span></a> <a href="#local_path_187"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <span id="local_u_190"><span class="LIDENT">u</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="UIDENT">Found</span> <a href="#local_u_190"><span class="LIDENT">u</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="COMMENT">(* TODO: Report is not a module. *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_e_191"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_191"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_unit"><span class="LIDENT">lookup_unit</span></span> <span class="TILDE">~</span><span id="local_important_digests_192"><span class="LIDENT">important_digests</span></span> <span class="TILDE">~</span><span id="local_imports_map_193"><span class="LIDENT">imports_map</span></span> <span id="local_ap_194"><span class="LIDENT">ap</span></span> <span class="TILDE">~</span><span id="local_libs_195"><span class="LIDENT">libs</span></span> <span class="TILDE">~</span><span id="local_hierarchy_196"><span class="LIDENT">hierarchy</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Path</span> <span id="local_p_197"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_unit_by_path</span> <span class="TILDE">~</span><a href="#local_libs_195"><span class="LIDENT">libs</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_196"><span class="LIDENT">hierarchy</span></a> <a href="#local_p_197"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Name</span> <span id="local_n_198"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_unit_by_name</span> <span class="TILDE">~</span><a href="#local_important_digests_192"><span class="LIDENT">important_digests</span></a> <span class="TILDE">~</span><a href="#local_imports_map_193"><span class="LIDENT">imports_map</span></a> <a href="#local_ap_194"><span class="LIDENT">ap</span></a> <a href="#local_n_198"><span class="LIDENT">n</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-{lookup_page}2/shadowed/(odoc-src-odoc.odoc-resolver.ml)"><span class="LIDENT">lookup_page</span></span> <span id="local_ap_199"><span class="LIDENT">ap</span></span> <span class="TILDE">~</span><span id="local_pages_200"><span class="LIDENT">pages</span></span> <span class="TILDE">~</span><span id="local_hierarchy_201"><span class="LIDENT">hierarchy</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Path</span> <span id="local_p_202"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_page_by_path</span> <span class="TILDE">~</span><a href="#local_pages_200"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_201"><span class="LIDENT">hierarchy</span></a> <a href="#local_p_202"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Name</span> <span id="local_n_203"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_page_by_name</span> <a href="#local_ap_199"><span class="LIDENT">ap</span></a> <a href="#local_n_203"><span class="LIDENT">n</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_asset"><span class="LIDENT">lookup_asset</span></span> <span class="TILDE">~</span><span id="local_pages_204"><span class="LIDENT">pages</span></span> <span class="TILDE">~</span><span id="local_hierarchy_205"><span class="LIDENT">hierarchy</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Path</span> <span id="local_p_206"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">lookup_asset_by_path</span> <span class="TILDE">~</span><a href="#local_pages_204"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_205"><span class="LIDENT">hierarchy</span></a> <a href="#local_p_206"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Name</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;TODO&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_302"><span class="LIDENT">important_digests</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_290"><span class="LIDENT">ap</span> <span class="COLON">:</span> <span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_311"><span class="LIDENT">extended_ap</span> <span class="COLON">:</span> <span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_310"><span class="LIDENT">pages</span> <span class="COLON">:</span> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_303"><span class="LIDENT">libs</span> <span class="COLON">:</span> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_292"><span class="LIDENT">open_modules</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_299"><span class="LIDENT">current_dir</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-roots"><span class="TYPE">type</span> <span class="LIDENT">roots</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_308"><span class="LIDENT">page_roots</span> <span class="COLON">:</span> <span class="LIDENT">named_root</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_294"><span class="LIDENT">lib_roots</span> <span class="COLON">:</span> <span class="LIDENT">named_root</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_296"><span class="LIDENT">current_lib</span> <span class="COLON">:</span> <span class="LIDENT">named_root</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_300"><span class="LIDENT">current_package</span> <span class="COLON">:</span> <span class="LIDENT">named_root</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_293"><span class="LIDENT">current_dir</span> <span class="COLON">:</span> <a href="fs.ml.html#module-Directory.type-t"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="SEMI">;</span></span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-create"><span class="LIDENT">create</span></span> <span class="TILDE">~</span><span id="local_important_digests_207"><span class="LIDENT">important_digests</span></span> <span class="TILDE">~</span><span id="local_directories_208"><span class="LIDENT">directories</span></span> <span class="TILDE">~</span><span id="local_open_modules_209"><span class="LIDENT">open_modules</span></span> <span class="TILDE">~</span><span id="local_roots_210"><span class="LIDENT">roots</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_295"><span id="local_pages_211"><span class="LIDENT">pages</span></span><span class="COMMA">,</span> <span id="local_libs_212"><span class="LIDENT">libs</span></span><span class="COMMA">,</span> <span id="local_current_dir_213"><span class="LIDENT">current_dir</span></span><span class="COMMA">,</span> <span id="local_directories_214"><span class="LIDENT">directories</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_roots_210"><span class="LIDENT">roots</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <a href="#local_directories_208"><span class="LIDENT">directories</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LBRACE">{</span> <span id="local_page_roots_215"><span class="LIDENT">page_roots</span></span><span class="SEMI">;</span> <span id="local_lib_roots_216"><span class="LIDENT">lib_roots</span></span><span class="SEMI">;</span> <span id="local_current_lib_217"><span class="LIDENT">current_lib</span></span><span class="SEMI">;</span> <span id="local_current_package_218"><span class="LIDENT">current_package</span></span><span class="SEMI">;</span> <span id="local_current_dir_219"><span class="LIDENT">current_dir</span></span> <span class="RBRACE">}</span><span class="EOL">
</span>      <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_prepare_220"><span class="LIDENT">prepare</span></span> <span id="local_roots_221"><span class="LIDENT">roots</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_name_222"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span id="local_dir_223"><span class="LIDENT">dir</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACE">{</span> <a href="#local_name_222"><span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">name</span></a><span class="SEMI">;</span> <a href="#local_dir_223"><span class="LIDENT">dir</span></a> <span class="RBRACE">}</span><span class="RPAREN">)</span> <a href="#local_roots_221"><span class="LIDENT">roots</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_directories_224"><span class="LIDENT">directories</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_current_package_218"><span class="LIDENT">current_package</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_directories_208"><span class="LIDENT">directories</span></a><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local__pkg_225"><span class="LIDENT">_pkg</span></span><span class="COMMA">,</span> <span id="local_dir_226"><span class="LIDENT">dir</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_dir_226"><span class="LIDENT">dir</span></a> <span class="COLONCOLON">::</span> <a href="#local_directories_208"><span class="LIDENT">directories</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_lib_roots_227"><span class="LIDENT">lib_roots</span></span> <span class="EQUAL">=</span> <a href="#local_prepare_220"><span class="LIDENT">prepare</span></a> <a href="#local_lib_roots_216"><span class="LIDENT">lib_roots</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_page_roots_228"><span class="LIDENT">page_roots</span></span> <span class="EQUAL">=</span> <a href="#local_prepare_220"><span class="LIDENT">prepare</span></a> <a href="#local_page_roots_215"><span class="LIDENT">page_roots</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_pages_229"><span class="LIDENT">pages</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~current_root:</span><a href="#local_current_package_218"><span class="LIDENT">current_package</span></a> <a href="#local_page_roots_228"><span class="LIDENT">page_roots</span></a><span class="EOL">
</span>        <span class="AND">and</span> <span id="local_libs_230"><span class="LIDENT">libs</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~current_root:</span><a href="#local_current_lib_217"><span class="LIDENT">current_lib</span></a> <a href="#local_lib_roots_227"><span class="LIDENT">lib_roots</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_directories_231"><span class="LIDENT">directories</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-sort_uniq"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">sort_uniq</span></a> <a href="fs.ml.html#module-Directory.val-compare"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">compare</span></a> <span class="LPAREN">(</span><a href="#local_current_dir_219"><span class="LIDENT">current_dir</span></a> <span class="COLONCOLON">::</span> <a href="#local_directories_224"><span class="LIDENT">directories</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_pages_229"><span class="LIDENT">pages</span></a><span class="COMMA">,</span> <span class="UIDENT">Some</span> <a href="#local_libs_230"><span class="LIDENT">libs</span></a><span class="COMMA">,</span> <span class="UIDENT">Some</span> <a href="#local_current_dir_219"><span class="LIDENT">current_dir</span></a><span class="COMMA">,</span> <a href="#local_directories_231"><span class="LIDENT">directories</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_ap_232"><span class="LIDENT">ap</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_directories_214"><span class="LIDENT">directories</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_extended_directories_233"><span class="LIDENT">extended_directories</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_roots_210"><span class="LIDENT">roots</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_directories_214"><span class="LIDENT">directories</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LBRACE">{</span> <span id="local_lib_roots_234"><span class="LIDENT">lib_roots</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_directories_214"><span class="LIDENT">directories</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(@)"><span class="INFIXOP1">@</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-snd"><span class="LIDENT">snd</span></a> <a href="#local_lib_roots_234"><span class="LIDENT">lib_roots</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_extended_directories_235"><span class="LIDENT">extended_directories</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-sort_uniq"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">sort_uniq</span></a> <a href="fs.ml.html#module-Directory.val-compare"><span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">Directory</span><span class="DOT">.</span><span class="LIDENT">compare</span></a> <a href="#local_extended_directories_233"><span class="LIDENT">extended_directories</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_extended_ap_236"><span class="LIDENT">extended_ap</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~directories:</span><a href="#local_extended_directories_235"><span class="LIDENT">extended_directories</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <a href="#local_important_digests_207"><span class="LIDENT">important_digests</span></a><span class="SEMI">;</span> <a href="#local_ap_232"><span class="LIDENT">ap</span></a><span class="SEMI">;</span> <a href="#local_extended_ap_236"><span class="LIDENT">extended_ap</span></a><span class="SEMI">;</span> <a href="#local_open_modules_209"><span class="LIDENT">open_modules</span></a><span class="SEMI">;</span> <a href="#local_pages_211"><span class="LIDENT">pages</span></a><span class="SEMI">;</span> <a href="#local_libs_212"><span class="LIDENT">libs</span></a><span class="SEMI">;</span> <a href="#local_current_dir_213"><span class="LIDENT">current_dir</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Helpers for creating xref2 env. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="OPEN">open</span> <a href="../odoc.xref2/odoc_xref2.ml.html"><span class="UIDENT">Odoc_xref2</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_compile_env_for_unit"><span class="LIDENT">build_compile_env_for_unit</span></span><span class="EOL">
</span>    <span class="LBRACE">{</span><span class="EOL">
</span>      <span id="local_important_digests_237"><span class="LIDENT">important_digests</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_ap_238"><span class="LIDENT">ap</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">extended_ap</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">open_modules</span> <span class="EQUAL">=</span> <span id="local_open_units_239"><span class="LIDENT">open_units</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">pages</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">libs</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">current_dir</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="RBRACE">}</span> <span id="local_m_240"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">add_unit_to_cache</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <a href="#local_m_240"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_imports_map_241"><span class="LIDENT">imports_map</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build_imports_map</span> <a href="#local_m_240"><span class="LIDENT">m</span></a><span class="DOT">.</span><span class="LIDENT">imports</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* Do not implement [lookup_page] in compile mode, as that might return
     different results depending on the compilation order.
     On the other hand, [lookup_unit] is needed at compile time and the
     compilation order is known by the driver. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_lookup_unit_242"><span class="LIDENT">lookup_unit</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">lookup_unit</span> <span class="TILDE">~</span><a href="#local_important_digests_237"><span class="LIDENT">important_digests</span></a> <span class="TILDE">~</span><a href="#local_imports_map_241"><span class="LIDENT">imports_map</span></a> <a href="#local_ap_238"><span class="LIDENT">ap</span></a> <span class="LABEL">~libs:</span><span class="UIDENT">None</span> <span class="LABEL">~hierarchy:</span><span class="UIDENT">None</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_page_243"><span class="LIDENT">lookup_page</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_asset_244"><span class="LIDENT">lookup_asset</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_impl_245"><span class="LIDENT">lookup_impl</span></span> <span class="EQUAL">=</span> <span class="LIDENT">lookup_impl</span> <a href="#local_ap_238"><span class="LIDENT">ap</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_246"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_open_units_239"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">open_units</span></a><span class="SEMI">;</span> <a href="#local_lookup_unit_242"><span class="LIDENT">lookup_unit</span></a><span class="SEMI">;</span> <a href="#local_lookup_page_243"><span class="LIDENT">lookup_page</span></a><span class="SEMI">;</span> <a href="#local_lookup_impl_245"><span class="LIDENT">lookup_impl</span></a><span class="SEMI">;</span> <a href="#local_lookup_asset_244"><span class="LIDENT">lookup_asset</span></a> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_of_unit"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_of_unit</span></a> <a href="#local_m_240"><span class="LIDENT">m</span></a> <span class="LABEL">~linking:</span><span class="FALSE">false</span> <a href="#local_resolver_246"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** [important_digests] and [imports_map] only apply to modules. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build"><span class="LIDENT">build</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_imports_map_247"><span class="LIDENT">imports_map</span></span> <span class="EQUAL">=</span> <span class="UIDENT">StringMap</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_hierarchy_roots_248"><span class="LIDENT">hierarchy_roots</span></span><span class="EOL">
</span>    <span class="LBRACE">{</span><span class="EOL">
</span>      <span id="local_important_digests_249"><span class="LIDENT">important_digests</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_ap_250"><span class="LIDENT">ap</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_extended_ap_251"><span class="LIDENT">extended_ap</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">open_modules</span> <span class="EQUAL">=</span> <span id="local_open_units_254"><span class="LIDENT">open_units</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_pages_252"><span class="LIDENT">pages</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_libs_253"><span class="LIDENT">libs</span></span><span class="SEMI">;</span><span class="EOL">
</span>      <span id="local_current_dir_255"><span class="LIDENT">current_dir</span></span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="RBRACE">}</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_hierarchy_256"><span class="LIDENT">hierarchy</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="OPEN">open</span> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad"><span class="UIDENT">OptionMonad</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_current_dir_255"><span class="LIDENT">current_dir</span></a> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_current_dir_257"><span class="LIDENT">current_dir</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="#local_hierarchy_roots_248"><span class="LIDENT">hierarchy_roots</span></a> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="UIDENT">Named_roots</span><span class="DOT">.</span><span class="LIDENT">current_root</span> <a href="../odoc.odoc_utils/odoc_utils.ml.html#module-OptionMonad.val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_hierarchy_root_258"><span class="LIDENT">hierarchy_root</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Hierarchy</span><span class="DOT">.</span><span class="LIDENT">make</span> <span class="TILDE">~</span><a href="#local_hierarchy_root_258"><span class="LIDENT">hierarchy_root</span></a> <span class="TILDE">~</span><a href="#local_current_dir_257"><span class="LIDENT">current_dir</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_lookup_unit_259"><span class="LIDENT">lookup_unit</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">lookup_unit</span> <span class="TILDE">~</span><a href="#local_important_digests_249"><span class="LIDENT">important_digests</span></a> <span class="TILDE">~</span><a href="#local_imports_map_247"><span class="LIDENT">imports_map</span></a> <a href="#local_extended_ap_251"><span class="LIDENT">extended_ap</span></a> <span class="TILDE">~</span><a href="#local_libs_253"><span class="LIDENT">libs</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_256"><span class="LIDENT">hierarchy</span></a><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_page_260"><span class="LIDENT">lookup_page</span></span> <span class="EQUAL">=</span> <span class="LIDENT">lookup_page</span> <a href="#local_ap_250"><span class="LIDENT">ap</span></a> <span class="TILDE">~</span><a href="#local_pages_252"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_256"><span class="LIDENT">hierarchy</span></a><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_asset_261"><span class="LIDENT">lookup_asset</span></span> <span class="EQUAL">=</span> <span class="LIDENT">lookup_asset</span> <span class="TILDE">~</span><a href="#local_pages_252"><span class="LIDENT">pages</span></a> <span class="TILDE">~</span><a href="#local_hierarchy_256"><span class="LIDENT">hierarchy</span></a><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_lookup_impl_262"><span class="LIDENT">lookup_impl</span></span> <span class="EQUAL">=</span> <span class="LIDENT">lookup_impl</span> <a href="#local_ap_250"><span class="LIDENT">ap</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <a href="#local_open_units_254"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">open_units</span></a><span class="SEMI">;</span> <a href="#local_lookup_unit_259"><span class="LIDENT">lookup_unit</span></a><span class="SEMI">;</span> <a href="#local_lookup_page_260"><span class="LIDENT">lookup_page</span></a><span class="SEMI">;</span> <a href="#local_lookup_impl_262"><span class="LIDENT">lookup_impl</span></a><span class="SEMI">;</span> <a href="#local_lookup_asset_261"><span class="LIDENT">lookup_asset</span></a> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_compile_env_for_impl"><span class="LIDENT">build_compile_env_for_impl</span></span> <span id="local_t_263"><span class="LIDENT">t</span></span> <span id="local_i_264"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_imports_map_265"><span class="LIDENT">imports_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">build_imports_map</span> <a href="#local_i_264"><span class="LIDENT">i</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Implementation</span><span class="DOT">.</span><span class="LIDENT">imports</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_266"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build</span> <span class="TILDE">~</span><a href="#local_imports_map_265"><span class="LIDENT">imports_map</span></a> <a href="#local_t_263"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_of_impl"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_of_impl</span></a> <a href="#local_i_264"><span class="LIDENT">i</span></a> <a href="#local_resolver_266"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_link_env_for_unit"><span class="LIDENT">build_link_env_for_unit</span></span> <span id="local_t_267"><span class="LIDENT">t</span></span> <span id="local_m_268"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">add_unit_to_cache</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Unit_content</span> <a href="#local_m_268"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_imports_map_269"><span class="LIDENT">imports_map</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build_imports_map</span> <a href="#local_m_268"><span class="LIDENT">m</span></a><span class="DOT">.</span><span class="LIDENT">imports</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_270"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build</span> <span class="TILDE">~</span><a href="#local_imports_map_269"><span class="LIDENT">imports_map</span></a> <span class="OPTLABEL">?hierarchy_roots:</span><a href="#local_t_267"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">libs</span> <a href="#local_t_267"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_of_unit"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_of_unit</span></a> <a href="#local_m_268"><span class="LIDENT">m</span></a> <span class="LABEL">~linking:</span><span class="TRUE">true</span> <a href="#local_resolver_270"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_link_env_for_impl"><span class="LIDENT">build_link_env_for_impl</span></span> <span id="local_t_271"><span class="LIDENT">t</span></span> <span id="local_i_272"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_imports_map_273"><span class="LIDENT">imports_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">build_imports_map</span> <a href="#local_i_272"><span class="LIDENT">i</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Implementation</span><span class="DOT">.</span><span class="LIDENT">imports</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_274"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build</span> <span class="TILDE">~</span><a href="#local_imports_map_273"><span class="LIDENT">imports_map</span></a> <a href="#local_t_271"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_of_impl"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_of_impl</span></a> <a href="#local_i_272"><span class="LIDENT">i</span></a> <a href="#local_resolver_274"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_env_for_page"><span class="LIDENT">build_env_for_page</span></span> <span id="local_t_275"><span class="LIDENT">t</span></span> <span id="local_p_276"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">add_unit_to_cache</span> <span class="LPAREN">(</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Page_content</span> <a href="#local_p_276"><span class="LIDENT">p</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_277"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">build</span> <span class="OPTLABEL">?hierarchy_roots:</span><a href="#local_t_275"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pages</span> <span class="LBRACE">{</span> <a href="#local_t_275"><span class="LIDENT">t</span></a> <span class="WITH">with</span> <span class="LIDENT">important_digests</span> <span class="EQUAL">=</span> <span class="FALSE">false</span> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_of_page"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_of_page</span></a> <a href="#local_p_276"><span class="LIDENT">p</span></a> <a href="#local_resolver_277"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-build_env_for_reference"><span class="LIDENT">build_env_for_reference</span></span> <span id="local_t_278"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolver_279"><span class="LIDENT">resolver</span></span> <span class="EQUAL">=</span> <span class="LIDENT">build</span> <span class="LBRACE">{</span> <a href="#local_t_278"><span class="LIDENT">t</span></a> <span class="WITH">with</span> <span class="LIDENT">important_digests</span> <span class="EQUAL">=</span> <span class="FALSE">false</span> <span class="RBRACE">}</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="../odoc.xref2/env.ml.html#val-env_for_reference"><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">env_for_reference</span></a> <a href="#local_resolver_279"><span class="LIDENT">resolver</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_page"><span class="LIDENT">lookup_page</span></span> <span id="local_t_280"><span class="LIDENT">t</span></span> <span id="local_target_name_281"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">lookup_page_by_name</span> <a href="#local_t_280"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">ap</span> <a href="#local_target_name_281"><span class="LIDENT">target_name</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_p_282"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_p_282"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-resolve_import"><span class="LIDENT">resolve_import</span></span> <span id="local_t_283"><span class="LIDENT">t</span></span> <span id="local_target_name_284"><span class="LIDENT">target_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_285"><span class="LIDENT">loop</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_path_286"><span class="LIDENT">path</span></span> <span class="COLONCOLON">::</span> <span id="local_tl_287"><span class="LIDENT">tl</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="odoc_file.ml.html#val-load_root"><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">load_root</span></a> <a href="#local_path_286"><span class="LIDENT">path</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_285"><span class="LIDENT">loop</span></a> <a href="#local_tl_287"><span class="LIDENT">tl</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_root_288"><span class="LIDENT">root</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="#local_root_288"><span class="LIDENT">root</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Root</span><span class="DOT">.</span><span class="LIDENT">file</span> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Compilation_unit</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_root_288"><span class="LIDENT">root</span></a><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Impl</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Page</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Asset</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_285"><span class="LIDENT">loop</span></a> <a href="#local_tl_287"><span class="LIDENT">tl</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_285"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><span class="UIDENT">Accessible_paths</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_t_283"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">ap</span> <a href="#local_target_name_284"><span class="LIDENT">target_name</span></a><span class="RPAREN">)</span><span class="EOL">
</span></span></code></pre></body></html>
