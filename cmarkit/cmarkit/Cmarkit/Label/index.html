<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Label (cmarkit.cmarkit.Cmarkit.Label)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../sherlodoc_db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../index.html">üè†</a> &#x00BB; <a href="../../../index.html">Cmarkit  <span class="version">v0.3.0</span></a> &#x00BB; Library <code>cmarkit</code> &#x00BB; <a href="../index.html">Cmarkit</a> &#x00BB; Label</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Cmarkit.Label</span></code></h1><p>Labels.</p><p>Labels are used by <a href="https://spec.commonmark.org/0.30/#reference-link">reference links</a> to refer to the <a href="#definitions" title="definitions">definitions</a> of <a href="https://spec.commonmark.org/0.30/#link-reference-definitions">link reference definitions</a>, <a href="../index.html#ext_footnote_def" title="ext_footnote_def">footnote definitions</a> and your own <a href="#resolvers" title="resolvers">interpretations</a>.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#label">Labels</a></li><li><a href="#definitions">Definitions</a></li><li><a href="#resolvers">Resolvers</a></li><li><a href="#resolver_example">Resolver example</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../index.html">Cmarkit  <span class="version">v0.3.0</span></a><ul><li>Library <code>cmarkit</code><ul><li><a href="../index.html">Cmarkit</a><ul><li><a href="../Textloc/index.html">Textloc</a></li><li><a href="../Meta/index.html">Meta</a></li><li><a href="../Layout/index.html">Layout</a></li><li><a href="../Block_line/index.html">Block_line</a></li><li><a href="#" class="current_unit">Label</a><ul><li><a href="Map/index.html">Map</a></li></ul></li><li><a href="../Link_definition/index.html">Link_definition</a></li><li><a href="../Inline/index.html">Inline</a></li><li><a href="../Block/index.html">Block</a></li><li><a href="../Doc/index.html">Doc</a></li><li><a href="../Mapper/index.html">Mapper</a></li><li><a href="../Folder/index.html">Folder</a></li></ul></li><li><a href="../../Cmarkit_commonmark/index.html">Cmarkit_commonmark</a></li><li><a href="../../Cmarkit_html/index.html">Cmarkit_html</a></li><li><a href="../../Cmarkit_latex/index.html">Cmarkit_latex</a></li><li><a href="../../Cmarkit_renderer/index.html">Cmarkit_renderer</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="label"><a href="#label" class="anchor"></a>Labels</h2><div class="odoc-spec"><div class="spec type anchored" id="type-key"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> key</span><span> = string</span></code></div><div class="spec-doc"><p>The type for label keys. These are <a href="https://spec.commonmark.org/0.30/#link-label">link labels</a> normalized for <a href="https://spec.commonmark.org/0.30/#matches">matching</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for <a href="https://spec.commonmark.org/0.30/#link-label">link labels</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?meta</span>:<a href="../Meta/index.html#type-t">Meta.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">key</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Block_line/index.html#type-tight">Block_line.tight</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make key text</code> is a label with key <code>id</code> and unormalized text <code>text</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_meta"><a href="#val-with_meta" class="anchor"></a><code><span><span class="keyword">val</span> with_meta : <span><a href="../Meta/index.html#type-t">Meta.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>with_meta m l</code> is <code>l</code> with meta <code>m</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta"><a href="#val-meta" class="anchor"></a><code><span><span class="keyword">val</span> meta : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Meta/index.html#type-t">Meta.t</a></span></code></div><div class="spec-doc"><p><code>meta k</code> is metadata for <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-key"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-key">key</a></span></code></div><div class="spec-doc"><p><code>key_id l</code> is the label's key. If <code>l</code> comes out of a parse this <code>l</code>'s normalized <a href="#val-text"><code>text</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-text"><a href="#val-text" class="anchor"></a><code><span><span class="keyword">val</span> text : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Block_line/index.html#type-tight">Block_line.tight</a> list</span></span></code></div><div class="spec-doc"><p><code>text l</code> is the text of <code>l</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-text_to_string"><a href="#val-text_to_string" class="anchor"></a><code><span><span class="keyword">val</span> text_to_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>text_to_string l</code> is the lines of <a href="#val-text"><code>text</code></a> separated by spaces. In contrast to <a href="#val-key"><code>key</code></a> this has not gone throught <a href="https://spec.commonmark.org/0.30/#matches">normalization</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare l0 l1</code> is <code>String.compare (key l0) (key l1)</code>.</p></div></div><h2 id="definitions"><a href="#definitions" class="anchor"></a>Definitions</h2><p>A label definition is the content referenced by its <a href="#val-key"><code>key</code></a>.</p><p>Labels are defined in documents via footnotes and link reference definitions. Additional label definitions can be added before parsing starts by using the <code>defs</code> argument of <a href="../Doc/index.html#val-of_string"><code>Doc.of_string</code></a>. They can also be manipulated and created on the fly during parsing by using a <a href="#resolvers" title="resolvers">resolver</a>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-def"><a href="#type-def" class="anchor"></a><code><span><span class="keyword">type</span> def</span><span> = </span><span>..</span></code></div><div class="spec-doc"><p>The type for label definitions. See for example <a href="../Link_definition/index.html#extension-Def"><code>Link_definition.Def</code></a> or <a href="../Block/Footnote/index.html#extension-Def"><code>Block.Footnote.Def</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Map"><a href="#module-Map" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Map/index.html">Map</a></span><span> : <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Map/module-type-S/index.html">Map.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Map/module-type-S/index.html#type-key">key</a> := <a href="#type-key">key</a></span></span></code></div><div class="spec-doc"><p>Label key maps.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-defs"><a href="#type-defs" class="anchor"></a><code><span><span class="keyword">type</span> defs</span><span> = <span><a href="#type-def">def</a> <a href="Map/index.html#type-t">Map.t</a></span></span></code></div><div class="spec-doc"><p>The type for label definitions. Maps label keys to their definition.</p></div></div><h2 id="resolvers"><a href="#resolvers" class="anchor"></a>Resolvers</h2><p>To have more control over the label definitions used in a document, the <code>defs</code> argument of <a href="../Doc/index.html#val-of_string"><code>Doc.of_string</code></a> can be specified to pre-populate the label definitions used during parsing; for example with those of a previously parsed document.</p><p>In addition the <code>resolver</code> argument can be specified to:</p><ol><li>Alter or suppress label definitions made by link reference definitions and footnote definitions. It can also be used to warn, by side effect, on multiple label definitions.</li><li>Alter, or suppress label references on reference links and images ‚Äì which happen after all label definitions have been made. You can define the actual label that will be used for resolving the reference to its definition.</li></ol><p>In particular 2. can be used to create synthetic label definitions on undefined label references. This provides the ability to treat the very liberal <a href="https://spec.commonmark.org/0.30/#link-label">link label</a> syntax as a domain specific language of yours (e.g. for data binding).</p><p>Note that parsing is not finished when resolvers are invoked this is the reason why you don't get access to the definition's data during resolution.</p><p>See <a href="#resolver_example" title="resolver_example">an example</a>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-context"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span><span> = </span><span>[ </span></code><ol><li id="type-context.Def" class="def variant constructor anchored"><a href="#type-context.Def" class="anchor"></a><code><span>| </span><span>`Def <span class="keyword">of</span> <span><a href="#type-t">t</a> option</span> * <a href="#type-t">t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Label definitions</p><span class="comment-delim">*)</span></div></li><li id="type-context.Ref" class="def variant constructor anchored"><a href="#type-context.Ref" class="anchor"></a><code><span>| </span><span>`Ref <span class="keyword">of</span> <span>[ `Link <span>| `Image</span> ]</span> * <a href="#type-t">t</a> * <span><a href="#type-t">t</a> option</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Label references</p><span class="comment-delim">*)</span></div></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for resolver contexts. See <a href="#type-resolver"><code>resolver</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-resolver"><a href="#type-resolver" class="anchor"></a><code><span><span class="keyword">type</span> resolver</span><span> = <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>The type for resolvers. <code>context</code> is:</p><ul><li><code>`Def (prev, current)</code> when we just hit a <a href="https://spec.commonmark.org/0.30/#link-reference-definitions">link reference definition</a> or <a href="../index.html#ext_footnote_def" title="ext_footnote_def">footnote definition</a> that defines the label <code>current</code>. If there is already a definition for <code>current</code>'s <a href="#val-key"><code>key</code></a> it is provided in <code>prev</code> (whose <a href="#val-meta"><code>meta</code></a> has the location of the definition if you parse with locations). If <code>None</code> is returned the <code>current</code> definition is ignored, and definition <code>prev</code> (if any) is kept for the document. If <code>Some l</code> is returned <code>l</code>'s key will be bound to the parsed definition for <code>current</code> in <a href="../Doc/index.html#val-defs"><code>Doc.defs</code></a> at the end of parsing. The result of the resolver is stored in the abstract syntax tree and available via <a href="../Link_definition/index.html#val-defined_label"><code>Link_definition.defined_label</code></a> and <a href="../Block/Footnote/index.html#val-defined_label"><code>Block.Footnote.defined_label</code></a>.</li><li><code>`Ref (kind, ref, def)</code> when we just hit a link or image referencing label <code>ref</code>. <code>def</code> is the label defining <code>ref</code>'s <a href="#val-key"><code>key</code></a> in the document (if any). The result of the resolver is the label stored for resolving the reference to its definition in the resulting <a href="../Inline/Link/index.html"><code>Inline.Link</code></a> node; <code>None</code> means that <code>label</code> is undefined and the inline becomes <a href="../Inline/index.html#extension-Text"><code>Inline.Text</code></a> like in CommonMark.</li></ul><p>See <a href="#resolver_example" title="resolver_example">an example</a> and the <a href="#val-default_resolver"><code>default_resolver</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_resolver"><a href="#val-default_resolver" class="anchor"></a><code><span><span class="keyword">val</span> default_resolver : <a href="#type-resolver">resolver</a></span></code></div><div class="spec-doc"><p><code>default_resolver</code> is the default resolver.</p><p>This resolves according to the CommonMark specification. The first label definition always takes over subsequent ones and resolution is left untouched (i.e. a label has to be defined in the document to be used):</p><pre class="language-ocaml"><code>let default_resolver = function
| `Def (None, l) -&gt; Some l
| `Def (Some _, _) -&gt; None (* Previous takes over *)
| `Ref (_, _, def) -&gt; def</code></pre></div></div><h2 id="resolver_example"><a href="#resolver_example" class="anchor"></a>Resolver example</h2><p>In this example we assume references to undefined labels denote links to pages or media in our wiki and want to process them them later via a <a href="../Mapper/index.html" title="Mapper">tree transformation</a> or in a <a href="../../Cmarkit_renderer/index.html#example" title="example">renderer extension</a>.</p><p>We devise a resolver to create synthetic labels on any undefined label so that the CommonMark parser does not turn them into text.</p><pre class="language-ocaml"><code>let wikilink = Cmarkit.Meta.key () (* A meta key to recognize them *)

let make_wikilink label = (* Just a placeholder label definition *)
  let meta = Cmarkit.Meta.tag wikilink (Cmarkit.Label.meta label) in
  Cmarkit.Label.with_meta meta label

let with_wikilinks = function
| `Def _ as ctx -&gt; Cmarkit.Label.default_resolver ctx
| `Ref (_, _, (Some _ as def)) -&gt; def (* As per doc definition *)
| `Ref (_, ref, None) -&gt; Some (make_wikilink ref)</code></pre></div></body></html>
