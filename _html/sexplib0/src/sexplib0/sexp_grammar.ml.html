<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: sexp_grammar.ml (sexplib0.src.sexplib0)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">sexplib0</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; sexplib0 &#x00BB; sexp_grammar.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>sexp_grammar.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">sexplib0</a><ul><li>Library <code>sexplib0</code><ul><li><a href="../../sexplib0/Sexplib0/index.html">Sexplib0</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>sexplib0<ul><li><a href="sexp.ml.html">sexp.ml</a></li><li><a href="sexp_conv.ml.html">sexp_conv.ml</a></li><li><a href="sexp_conv_error.ml.html">sexp_conv_error.ml</a></li><li><a href="sexp_conv_grammar.ml.html">sexp_conv_grammar.ml</a></li><li><a href="sexp_conv_record.ml.html">sexp_conv_record.ml</a></li><li><a href="#" class="current_unit">sexp_grammar.ml</a></li><li><a href="sexpable.ml.html">sexpable.ml</a></li><li><a href="sexplib0.ml.html">sexplib0.ml</a></li><li><a href="sexplib0__.ml.html">sexplib0__.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
</code><code class="source_code"><span><span class="DOCSTRING">(** Representation of S-expression grammars *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This module defines a representation for s-expression grammars. Using ppx_sexp_conv
    and [[@@deriving sexp_grammar]] produces a grammar that is compatible with the derived
    [of_sexp] for a given type.

    As with other derived definitions, polymorphic types derive a function that takes a
    grammar for each type argument and produces a grammar for the monomorphized type.

    Monomorphic types derive a grammar directly. To avoid top-level side effects,
    [[@@deriving sexp_grammar]] wraps grammars in the [Lazy] constructor as needed.

    This type may change over time as our needs for expressive grammars change. We will
    attempt to make changes backward-compatible, or at least provide a reasonable upgrade
    path. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LBRACKETATATAT">[@@@</span><span class="LIDENT">warning</span> <span class="STRING">&quot;-30&quot;</span><span class="RBRACKET">]</span> <span class="COMMENT">(* allow duplicate field names *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a sexp. *)</span><span class="EOL">
</span><span id="type-grammar"><span class="TYPE">type</span> <span class="LIDENT">grammar</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Any"><span class="BAR">|</span> <span class="UIDENT">Any</span> <span class="OF">of</span> <span class="LIDENT">string</span></span> <span class="DOCSTRING">(** accepts any sexp; string is a type name for human readability *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Bool"><span class="BAR">|</span> <span class="UIDENT">Bool</span></span> <span class="DOCSTRING">(** accepts the atoms &quot;true&quot; or &quot;false&quot;, modulo capitalization *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Char"><span class="BAR">|</span> <span class="UIDENT">Char</span></span> <span class="DOCSTRING">(** accepts any single-character atom *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Integer"><span class="BAR">|</span> <span class="UIDENT">Integer</span></span> <span class="DOCSTRING">(** accepts any atom matching ocaml integer syntax, regardless of bit width *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Float"><span class="BAR">|</span> <span class="UIDENT">Float</span></span> <span class="DOCSTRING">(** accepts any atom matching ocaml float syntax *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-String"><span class="BAR">|</span> <span class="UIDENT">String</span></span> <span class="DOCSTRING">(** accepts any atom *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Option"><span class="BAR">|</span> <span class="UIDENT">Option</span> <span class="OF">of</span> <span class="LIDENT">grammar</span></span> <span class="DOCSTRING">(** accepts an option, both [None] vs [Some _] and [()] vs [(_)]. *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-List"><span class="BAR">|</span> <span class="UIDENT">List</span> <span class="OF">of</span> <span class="LIDENT">list_grammar</span></span> <span class="DOCSTRING">(** accepts a list *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Variant"><span class="BAR">|</span> <span class="UIDENT">Variant</span> <span class="OF">of</span> <span class="LIDENT">variant</span></span> <span class="DOCSTRING">(** accepts clauses keyed by a leading or sole atom *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Union"><span class="BAR">|</span> <span class="UIDENT">Union</span> <span class="OF">of</span> <span class="LIDENT">grammar</span> <span class="LIDENT">list</span></span> <span class="DOCSTRING">(** accepts a sexp if any of the listed grammars accepts it *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Tagged"><span class="BAR">|</span> <span class="UIDENT">Tagged</span> <span class="OF">of</span> <span class="LIDENT">grammar</span> <span class="LIDENT">with_tag</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** annotates a grammar with a client-specific key/value pair *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Tyvar"><span class="BAR">|</span> <span class="UIDENT">Tyvar</span> <span class="OF">of</span> <span class="LIDENT">string</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Name of a type variable, e.g. [Tyvar &quot;a&quot;] for ['a]. Only meaningful when the body of
      the innermost enclosing [defn] defines a corresponding type variable. *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Tycon"><span class="BAR">|</span> <span class="UIDENT">Tycon</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">grammar</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="LIDENT">defn</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Type constructor applied to arguments, and its definition.

      For example, writing [Tycon (&quot;tree&quot;, [ Integer ], defns)] represents [int tree], for
      whatever [tree] is defined as in [defns]. The following defines [tree] as a binary
      tree with the parameter type stored at the leaves.

      {[
        let defns =
          [ { tycon = &quot;tree&quot;
            ; tyvars = [&quot;a&quot;]
            ; grammar =
                Variant
                  { name_kind = Capitalized
                  ; clauses =
                      [ { name = &quot;Node&quot;
                        ; args = Cons (Recursive (&quot;node&quot;, [Tyvar &quot;a&quot;]), Empty)
                        }
                      ; { name = &quot;Leaf&quot;
                        ; args = Cons (Recursive (&quot;leaf&quot;, [Tyvar &quot;a&quot;]), Empty)
                        }
                      ]
                  }
            }
          ; { tycon = &quot;node&quot;
            ; tyvars = [&quot;a&quot;]
            ; grammar = List (Many (Recursive &quot;tree&quot;, [Tyvar &quot;a&quot;]))
            }
          ; { tycon = &quot;leaf&quot;
            ; tyvars = [&quot;a&quot;]
            ; grammar = [Tyvar &quot;a&quot;]
            }
          ]
        ;;
      ]}

      To illustrate the meaning of [Tycon] with respect to [defns], and to demonstrate one
      way to access them, it is equivalent to expand the definition of &quot;tree&quot; one level
      and move the [defns] to enclosed recursive references:

      {[
        Tycon (&quot;tree&quot;, [ Integer ], defns)
        --&gt;
        Variant
          { name_kind = Capitalized
          ; clauses =
              [ { name = &quot;Node&quot;
                ; args = Cons (Tycon (&quot;node&quot;, [Tyvar &quot;a&quot;], defns), Empty)
                }
              ; { name = &quot;Leaf&quot;
                ; args = Cons (Tycon (&quot;leaf&quot;, [Tyvar &quot;a&quot;], defns), Empty)
                }
              ]
          }
      ]}

      This transformation exposes the structure of a grammar with recursive references,
      while preserving the meaning of recursively-defined elements. *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Recursive"><span class="BAR">|</span> <span class="UIDENT">Recursive</span> <span class="OF">of</span> <span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">grammar</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Type constructor applied to arguments. Used to denote recursive type references.
      Only meaningful when used inside the [defn]s of a [Tycon] grammar, to refer to a
      type constructor in the nearest enclosing [defn] list. *)</span><span class="EOL">
</span>  <span id="type-grammar.constructor-Lazy"><span class="BAR">|</span> <span class="UIDENT">Lazy</span> <span class="OF">of</span> <span class="LIDENT">grammar</span> <span class="LIDENT">lazy_t</span></span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Lazily computed grammar. Use [Lazy] to avoid top-level side effects. To define
      recursive grammars, use [Recursive] instead. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a list of sexps. *)</span><span class="EOL">
</span><span id="type-list_grammar"><span class="AND">and</span> <span class="LIDENT">list_grammar</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-list_grammar.constructor-Empty"><span class="BAR">|</span> <span class="UIDENT">Empty</span></span> <span class="DOCSTRING">(** accepts an empty list of sexps *)</span><span class="EOL">
</span>  <span id="type-list_grammar.constructor-Cons"><span class="BAR">|</span> <span class="UIDENT">Cons</span> <span class="OF">of</span> <span class="LIDENT">grammar</span> <span class="STAR">*</span> <span class="LIDENT">list_grammar</span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** accepts a non-empty list with head and tail matching the given grammars *)</span><span class="EOL">
</span>  <span id="type-list_grammar.constructor-Many"><span class="BAR">|</span> <span class="UIDENT">Many</span> <span class="OF">of</span> <span class="LIDENT">grammar</span></span> <span class="DOCSTRING">(** accepts zero or more sexps, each matching the given grammar *)</span><span class="EOL">
</span>  <span id="type-list_grammar.constructor-Fields"><span class="BAR">|</span> <span class="UIDENT">Fields</span> <span class="OF">of</span> <span class="LIDENT">record</span></span></span> <span class="DOCSTRING">(** accepts sexps representing fields of a record *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Case sensitivity options for names of variant constructors. *)</span><span class="EOL">
</span><span id="type-case_sensitivity"><span class="AND">and</span> <span class="LIDENT">case_sensitivity</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-case_sensitivity.constructor-Case_insensitive"><span class="BAR">|</span> <span class="UIDENT">Case_insensitive</span></span> <span class="DOCSTRING">(** Comparison is case insensitive. Used for custom parsers. *)</span><span class="EOL">
</span>  <span id="type-case_sensitivity.constructor-Case_sensitive"><span class="BAR">|</span> <span class="UIDENT">Case_sensitive</span></span> <span class="DOCSTRING">(** Comparison is case sensitive. Used for polymorphic variants. *)</span><span class="EOL">
</span>  <span id="type-case_sensitivity.constructor-Case_sensitive_except_first_character"><span class="BAR">|</span> <span class="UIDENT">Case_sensitive_except_first_character</span></span></span><span class="EOL">
</span>  <span class="DOCSTRING">(** Comparison is case insensitive for the first character and case sensitive afterward.
      Used for regular variants. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of variants. Accepts any sexp matching one of the clauses. *)</span><span class="EOL">
</span><span id="type-variant"><span class="AND">and</span> <span class="LIDENT">variant</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_21"><span class="LIDENT">case_sensitivity</span> <span class="COLON">:</span> <span class="LIDENT">case_sensitivity</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_15"><span class="LIDENT">clauses</span> <span class="COLON">:</span> <span class="LIDENT">clause</span> <span class="LIDENT">with_tag_list</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a single variant clause. Accepts sexps based on the [clause_kind]. *)</span><span class="EOL">
</span><span id="type-clause"><span class="AND">and</span> <span class="LIDENT">clause</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_17"><span class="LIDENT">name</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_10"><span class="LIDENT">clause_kind</span> <span class="COLON">:</span> <span class="LIDENT">clause_kind</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a single variant clause's contents. [Atom_clause] accepts an atom matching
    the clause's name. [List_clause] accepts a list whose head is an atom matching the
    clause's name and whose tail matches [args]. The clause's name is matched modulo the
    variant's [name_kind]. *)</span><span class="EOL">
</span><span id="type-clause_kind"><span class="AND">and</span> <span class="LIDENT">clause_kind</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-clause_kind.constructor-Atom_clause"><span class="BAR">|</span> <span class="UIDENT">Atom_clause</span></span><span class="EOL">
</span>  <span id="type-clause_kind.constructor-List_clause"><span class="BAR">|</span> <span class="UIDENT">List_clause</span> <span class="OF">of</span> <span class="LBRACE">{</span> <span id="def_20"><span class="LIDENT">args</span> <span class="COLON">:</span> <span class="LIDENT">list_grammar</span></span> <span class="RBRACE">}</span></span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a record. Accepts any list of sexps specifying each of the fields,
    regardless of order. If [allow_extra_fields] is specified, ignores sexps with names
    not found in [fields]. *)</span><span class="EOL">
</span><span id="type-record"><span class="AND">and</span> <span class="LIDENT">record</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_7"><span class="LIDENT">allow_extra_fields</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_8"><span class="LIDENT">fields</span> <span class="COLON">:</span> <span class="LIDENT">field</span> <span class="LIDENT">with_tag_list</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a record field. A field must show up exactly once in a record if
    [required], or at most once otherwise. Accepts a list headed by [name] as an atom,
    followed by sexps matching [args]. *)</span><span class="EOL">
</span><span id="type-field"><span class="AND">and</span> <span class="LIDENT">field</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_12"><span class="LIDENT">name</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_9"><span class="LIDENT">required</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_11"><span class="LIDENT">args</span> <span class="COLON">:</span> <span class="LIDENT">list_grammar</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar tagged with client-specific key/value pair. *)</span><span class="EOL">
</span><span id="type-with_tag"><span class="AND">and</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">with_tag</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_18"><span class="LIDENT">key</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_19"><span class="LIDENT">value</span> <span class="COLON">:</span> <a href="sexp.ml.html#type-t"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_14"><span class="LIDENT">grammar</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-with_tag_list"><span class="AND">and</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">with_tag_list</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-with_tag_list.constructor-Tag"><span class="BAR">|</span> <span class="UIDENT">Tag</span> <span class="OF">of</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">with_tag_list</span> <span class="LIDENT">with_tag</span></span><span class="EOL">
</span>  <span id="type-with_tag_list.constructor-No_tag"><span class="BAR">|</span> <span class="UIDENT">No_tag</span> <span class="OF">of</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Grammar of a recursive type definition. Names the [tycon] being defined, and the
    [tyvars] it takes as parameters. Specifies the [grammar] of the [tycon]. The grammar
    may refer to any of the [tyvars], and to any of the [tycon]s from the same set of
    [Recursive] definitions. *)</span><span class="EOL">
</span><span id="type-defn"><span class="AND">and</span> <span class="LIDENT">defn</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span id="def_5"><span class="LIDENT">tycon</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_6"><span class="LIDENT">tyvars</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="EOL">
</span>  <span class="SEMI">;</span></span> <span id="def_13"><span class="LIDENT">grammar</span> <span class="COLON">:</span> <span class="LIDENT">grammar</span></span><span class="EOL">
</span>  <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Top-level grammar type. Has a phantom type parameter to associate each grammar with
    the type its sexps represent. This makes it harder to apply grammars to the wrong
    type, while grammars can still be easily coerced to a new type if needed. *)</span><span class="EOL">
</span><span id="type-t"><span class="TYPE">type</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span id="def_16"><span class="LIDENT">untyped</span> <span class="COLON">:</span> <span class="LIDENT">grammar</span></span> <span class="RBRACE">}</span> <span class="LBRACKETATAT">[@@</span><span class="LIDENT">unboxed</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-coerce"><span class="LIDENT">coerce</span></span> <span class="LPAREN">(</span><span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">b</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">untyped</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_t_1"><span class="LIDENT">t</span></span> <span class="COLON">:</span> <span class="LIDENT">a</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="COLON">:</span> <span class="LIDENT">b</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <a href="#local_t_1"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-tag"><span class="LIDENT">tag</span></span> <span class="LPAREN">(</span><span class="TYPE">type</span> <span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LBRACE">{</span> <span class="LIDENT">untyped</span> <span class="EQUAL">=</span> <span id="local_grammar_2"><span class="LIDENT">grammar</span></span> <span class="RBRACE">}</span> <span class="COLON">:</span> <span class="LIDENT">a</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="TILDE">~</span><span id="local_key_3"><span class="LIDENT">key</span></span> <span class="TILDE">~</span><span id="local_value_4"><span class="LIDENT">value</span></span> <span class="COLON">:</span> <span class="LIDENT">a</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <span class="LIDENT">untyped</span> <span class="EQUAL">=</span> <span class="UIDENT">Tagged</span> <span class="LBRACE">{</span> <a href="#local_key_3"><span class="LIDENT">key</span></a><span class="SEMI">;</span> <a href="#local_value_4"><span class="LIDENT">value</span></a><span class="SEMI">;</span> <a href="#local_grammar_2"><span class="LIDENT">grammar</span></a> <span class="RBRACE">}</span> <span class="RBRACE">}</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This reserved key is used for all tags generated from doc comments. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-doc_comment_tag"><span class="LIDENT">doc_comment_tag</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.doc_comment&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This reserved key can be used to associate a type name with a grammar. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-type_name_tag"><span class="LIDENT">type_name_tag</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.type_name&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This reserved key indicates that a sexp represents a key/value association. The tag's
    value is ignored. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-assoc_tag"><span class="LIDENT">assoc_tag</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.assoc&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This reserved key indicates that a sexp is a key in a key/value association. The tag's
    value is ignored. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-assoc_key_tag"><span class="LIDENT">assoc_key_tag</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.assoc.key&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** This reserved key indicates that a sexp is a value in a key/value association. The
    tag's value is ignored. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-assoc_value_tag"><span class="LIDENT">assoc_value_tag</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.assoc.value&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** When the key is set to [Atom &quot;false&quot;] for a variant clause, that clause should not be
    suggested in auto-completion based on the sexp grammar. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-completion_suggested"><span class="LIDENT">completion_suggested</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;sexp_grammar.completion-suggested&quot;</span><span class="EOL">
</span></span></code></pre></body></html>
