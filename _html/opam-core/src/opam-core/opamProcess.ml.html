<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: opamProcess.ml (opam-core.src.opam-core)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">opam-core</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; opam-core &#x00BB; opamProcess.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>opamProcess.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">opam-core</a><ul><li>Library <code>opam-core</code><ul><li><a href="../../opam-core/OpamACL/index.html">OpamACL</a></li><li><a href="../../opam-core/OpamCached/index.html">OpamCached</a></li><li><a href="../../opam-core/OpamCompat/index.html">OpamCompat</a></li><li><a href="../../opam-core/OpamConsole/index.html">OpamConsole</a></li><li><a href="../../opam-core/OpamCoreConfig/index.html">OpamCoreConfig</a></li><li><a href="../../opam-core/OpamCoreConfigDeveloper/index.html">OpamCoreConfigDeveloper</a></li><li><a href="../../opam-core/OpamDirTrack/index.html">OpamDirTrack</a></li><li><a href="../../opam-core/OpamFilename/index.html">OpamFilename</a></li><li><a href="../../opam-core/OpamHash/index.html">OpamHash</a></li><li><a href="../../opam-core/OpamJson/index.html">OpamJson</a></li><li><a href="../../opam-core/OpamParallel/index.html">OpamParallel</a></li><li><a href="../../opam-core/OpamProcess/index.html">OpamProcess</a></li><li><a href="../../opam-core/OpamSHA/index.html">OpamSHA</a></li><li><a href="../../opam-core/OpamSWHID/index.html">OpamSWHID</a></li><li><a href="../../opam-core/OpamStd/index.html">OpamStd</a></li><li><a href="../../opam-core/OpamStubs/index.html">OpamStubs</a></li><li><a href="../../opam-core/OpamStubsTypes/index.html">OpamStubsTypes</a></li><li><a href="../../opam-core/OpamSystem/index.html">OpamSystem</a></li><li><a href="../../opam-core/OpamUrl/index.html">OpamUrl</a></li><li><a href="../../opam-core/OpamVersion/index.html">OpamVersion</a></li><li><a href="../../opam-core/OpamVersionCompare/index.html">OpamVersionCompare</a></li><li><a href="../../opam-core/OpamVersionInfo/index.html">OpamVersionInfo</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>opam-core<ul><li><a href="opamACL.ml.html">opamACL.ml</a></li><li><a href="opamCached.ml.html">opamCached.ml</a></li><li><a href="opamCompat.ml.html">opamCompat.ml</a></li><li><a href="opamConsole.ml.html">opamConsole.ml</a></li><li><a href="opamCoreConfig.ml.html">opamCoreConfig.ml</a></li><li><a href="opamCoreConfigDeveloper.ml.html">opamCoreConfigDeveloper.ml</a></li><li><a href="opamDirTrack.ml.html">opamDirTrack.ml</a></li><li><a href="opamFilename.ml.html">opamFilename.ml</a></li><li><a href="opamHash.ml.html">opamHash.ml</a></li><li><a href="opamJson.ml.html">opamJson.ml</a></li><li><a href="opamParallel.ml.html">opamParallel.ml</a></li><li><a href="#" class="current_unit">opamProcess.ml</a></li><li><a href="opamSHA.ml.html">opamSHA.ml</a></li><li><a href="opamSWHID.ml.html">opamSWHID.ml</a></li><li><a href="opamStd.ml.html">opamStd.ml</a></li><li><a href="opamStubs.ml.html">opamStubs.ml</a></li><li><a href="opamStubsTypes.ml.html">opamStubsTypes.ml</a></li><li><a href="opamSystem.ml.html">opamSystem.ml</a></li><li><a href="opamUrl.ml.html">opamUrl.ml</a></li><li><a href="opamVersion.ml.html">opamVersion.ml</a></li><li><a href="opamVersionCompare.ml.html">opamVersionCompare.ml</a></li><li><a href="opamVersionInfo.ml.html">opamVersionInfo.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
<a id="L496" class="source_line" href="#L496">496</a>
<a id="L497" class="source_line" href="#L497">497</a>
<a id="L498" class="source_line" href="#L498">498</a>
<a id="L499" class="source_line" href="#L499">499</a>
<a id="L500" class="source_line" href="#L500">500</a>
<a id="L501" class="source_line" href="#L501">501</a>
<a id="L502" class="source_line" href="#L502">502</a>
<a id="L503" class="source_line" href="#L503">503</a>
<a id="L504" class="source_line" href="#L504">504</a>
<a id="L505" class="source_line" href="#L505">505</a>
<a id="L506" class="source_line" href="#L506">506</a>
<a id="L507" class="source_line" href="#L507">507</a>
<a id="L508" class="source_line" href="#L508">508</a>
<a id="L509" class="source_line" href="#L509">509</a>
<a id="L510" class="source_line" href="#L510">510</a>
<a id="L511" class="source_line" href="#L511">511</a>
<a id="L512" class="source_line" href="#L512">512</a>
<a id="L513" class="source_line" href="#L513">513</a>
<a id="L514" class="source_line" href="#L514">514</a>
<a id="L515" class="source_line" href="#L515">515</a>
<a id="L516" class="source_line" href="#L516">516</a>
<a id="L517" class="source_line" href="#L517">517</a>
<a id="L518" class="source_line" href="#L518">518</a>
<a id="L519" class="source_line" href="#L519">519</a>
<a id="L520" class="source_line" href="#L520">520</a>
<a id="L521" class="source_line" href="#L521">521</a>
<a id="L522" class="source_line" href="#L522">522</a>
<a id="L523" class="source_line" href="#L523">523</a>
<a id="L524" class="source_line" href="#L524">524</a>
<a id="L525" class="source_line" href="#L525">525</a>
<a id="L526" class="source_line" href="#L526">526</a>
<a id="L527" class="source_line" href="#L527">527</a>
<a id="L528" class="source_line" href="#L528">528</a>
<a id="L529" class="source_line" href="#L529">529</a>
<a id="L530" class="source_line" href="#L530">530</a>
<a id="L531" class="source_line" href="#L531">531</a>
<a id="L532" class="source_line" href="#L532">532</a>
<a id="L533" class="source_line" href="#L533">533</a>
<a id="L534" class="source_line" href="#L534">534</a>
<a id="L535" class="source_line" href="#L535">535</a>
<a id="L536" class="source_line" href="#L536">536</a>
<a id="L537" class="source_line" href="#L537">537</a>
<a id="L538" class="source_line" href="#L538">538</a>
<a id="L539" class="source_line" href="#L539">539</a>
<a id="L540" class="source_line" href="#L540">540</a>
<a id="L541" class="source_line" href="#L541">541</a>
<a id="L542" class="source_line" href="#L542">542</a>
<a id="L543" class="source_line" href="#L543">543</a>
<a id="L544" class="source_line" href="#L544">544</a>
<a id="L545" class="source_line" href="#L545">545</a>
<a id="L546" class="source_line" href="#L546">546</a>
<a id="L547" class="source_line" href="#L547">547</a>
<a id="L548" class="source_line" href="#L548">548</a>
<a id="L549" class="source_line" href="#L549">549</a>
<a id="L550" class="source_line" href="#L550">550</a>
<a id="L551" class="source_line" href="#L551">551</a>
<a id="L552" class="source_line" href="#L552">552</a>
<a id="L553" class="source_line" href="#L553">553</a>
<a id="L554" class="source_line" href="#L554">554</a>
<a id="L555" class="source_line" href="#L555">555</a>
<a id="L556" class="source_line" href="#L556">556</a>
<a id="L557" class="source_line" href="#L557">557</a>
<a id="L558" class="source_line" href="#L558">558</a>
<a id="L559" class="source_line" href="#L559">559</a>
<a id="L560" class="source_line" href="#L560">560</a>
<a id="L561" class="source_line" href="#L561">561</a>
<a id="L562" class="source_line" href="#L562">562</a>
<a id="L563" class="source_line" href="#L563">563</a>
<a id="L564" class="source_line" href="#L564">564</a>
<a id="L565" class="source_line" href="#L565">565</a>
<a id="L566" class="source_line" href="#L566">566</a>
<a id="L567" class="source_line" href="#L567">567</a>
<a id="L568" class="source_line" href="#L568">568</a>
<a id="L569" class="source_line" href="#L569">569</a>
<a id="L570" class="source_line" href="#L570">570</a>
<a id="L571" class="source_line" href="#L571">571</a>
<a id="L572" class="source_line" href="#L572">572</a>
<a id="L573" class="source_line" href="#L573">573</a>
<a id="L574" class="source_line" href="#L574">574</a>
<a id="L575" class="source_line" href="#L575">575</a>
<a id="L576" class="source_line" href="#L576">576</a>
<a id="L577" class="source_line" href="#L577">577</a>
<a id="L578" class="source_line" href="#L578">578</a>
<a id="L579" class="source_line" href="#L579">579</a>
<a id="L580" class="source_line" href="#L580">580</a>
<a id="L581" class="source_line" href="#L581">581</a>
<a id="L582" class="source_line" href="#L582">582</a>
<a id="L583" class="source_line" href="#L583">583</a>
<a id="L584" class="source_line" href="#L584">584</a>
<a id="L585" class="source_line" href="#L585">585</a>
<a id="L586" class="source_line" href="#L586">586</a>
<a id="L587" class="source_line" href="#L587">587</a>
<a id="L588" class="source_line" href="#L588">588</a>
<a id="L589" class="source_line" href="#L589">589</a>
<a id="L590" class="source_line" href="#L590">590</a>
<a id="L591" class="source_line" href="#L591">591</a>
<a id="L592" class="source_line" href="#L592">592</a>
<a id="L593" class="source_line" href="#L593">593</a>
<a id="L594" class="source_line" href="#L594">594</a>
<a id="L595" class="source_line" href="#L595">595</a>
<a id="L596" class="source_line" href="#L596">596</a>
<a id="L597" class="source_line" href="#L597">597</a>
<a id="L598" class="source_line" href="#L598">598</a>
<a id="L599" class="source_line" href="#L599">599</a>
<a id="L600" class="source_line" href="#L600">600</a>
<a id="L601" class="source_line" href="#L601">601</a>
<a id="L602" class="source_line" href="#L602">602</a>
<a id="L603" class="source_line" href="#L603">603</a>
<a id="L604" class="source_line" href="#L604">604</a>
<a id="L605" class="source_line" href="#L605">605</a>
<a id="L606" class="source_line" href="#L606">606</a>
<a id="L607" class="source_line" href="#L607">607</a>
<a id="L608" class="source_line" href="#L608">608</a>
<a id="L609" class="source_line" href="#L609">609</a>
<a id="L610" class="source_line" href="#L610">610</a>
<a id="L611" class="source_line" href="#L611">611</a>
<a id="L612" class="source_line" href="#L612">612</a>
<a id="L613" class="source_line" href="#L613">613</a>
<a id="L614" class="source_line" href="#L614">614</a>
<a id="L615" class="source_line" href="#L615">615</a>
<a id="L616" class="source_line" href="#L616">616</a>
<a id="L617" class="source_line" href="#L617">617</a>
<a id="L618" class="source_line" href="#L618">618</a>
<a id="L619" class="source_line" href="#L619">619</a>
<a id="L620" class="source_line" href="#L620">620</a>
<a id="L621" class="source_line" href="#L621">621</a>
<a id="L622" class="source_line" href="#L622">622</a>
<a id="L623" class="source_line" href="#L623">623</a>
<a id="L624" class="source_line" href="#L624">624</a>
<a id="L625" class="source_line" href="#L625">625</a>
<a id="L626" class="source_line" href="#L626">626</a>
<a id="L627" class="source_line" href="#L627">627</a>
<a id="L628" class="source_line" href="#L628">628</a>
<a id="L629" class="source_line" href="#L629">629</a>
<a id="L630" class="source_line" href="#L630">630</a>
<a id="L631" class="source_line" href="#L631">631</a>
<a id="L632" class="source_line" href="#L632">632</a>
<a id="L633" class="source_line" href="#L633">633</a>
<a id="L634" class="source_line" href="#L634">634</a>
<a id="L635" class="source_line" href="#L635">635</a>
<a id="L636" class="source_line" href="#L636">636</a>
<a id="L637" class="source_line" href="#L637">637</a>
<a id="L638" class="source_line" href="#L638">638</a>
<a id="L639" class="source_line" href="#L639">639</a>
<a id="L640" class="source_line" href="#L640">640</a>
<a id="L641" class="source_line" href="#L641">641</a>
<a id="L642" class="source_line" href="#L642">642</a>
<a id="L643" class="source_line" href="#L643">643</a>
<a id="L644" class="source_line" href="#L644">644</a>
<a id="L645" class="source_line" href="#L645">645</a>
<a id="L646" class="source_line" href="#L646">646</a>
<a id="L647" class="source_line" href="#L647">647</a>
<a id="L648" class="source_line" href="#L648">648</a>
<a id="L649" class="source_line" href="#L649">649</a>
<a id="L650" class="source_line" href="#L650">650</a>
<a id="L651" class="source_line" href="#L651">651</a>
<a id="L652" class="source_line" href="#L652">652</a>
<a id="L653" class="source_line" href="#L653">653</a>
<a id="L654" class="source_line" href="#L654">654</a>
<a id="L655" class="source_line" href="#L655">655</a>
<a id="L656" class="source_line" href="#L656">656</a>
<a id="L657" class="source_line" href="#L657">657</a>
<a id="L658" class="source_line" href="#L658">658</a>
<a id="L659" class="source_line" href="#L659">659</a>
<a id="L660" class="source_line" href="#L660">660</a>
<a id="L661" class="source_line" href="#L661">661</a>
<a id="L662" class="source_line" href="#L662">662</a>
<a id="L663" class="source_line" href="#L663">663</a>
<a id="L664" class="source_line" href="#L664">664</a>
<a id="L665" class="source_line" href="#L665">665</a>
<a id="L666" class="source_line" href="#L666">666</a>
<a id="L667" class="source_line" href="#L667">667</a>
<a id="L668" class="source_line" href="#L668">668</a>
<a id="L669" class="source_line" href="#L669">669</a>
<a id="L670" class="source_line" href="#L670">670</a>
<a id="L671" class="source_line" href="#L671">671</a>
<a id="L672" class="source_line" href="#L672">672</a>
<a id="L673" class="source_line" href="#L673">673</a>
<a id="L674" class="source_line" href="#L674">674</a>
<a id="L675" class="source_line" href="#L675">675</a>
<a id="L676" class="source_line" href="#L676">676</a>
<a id="L677" class="source_line" href="#L677">677</a>
<a id="L678" class="source_line" href="#L678">678</a>
<a id="L679" class="source_line" href="#L679">679</a>
<a id="L680" class="source_line" href="#L680">680</a>
<a id="L681" class="source_line" href="#L681">681</a>
<a id="L682" class="source_line" href="#L682">682</a>
<a id="L683" class="source_line" href="#L683">683</a>
<a id="L684" class="source_line" href="#L684">684</a>
<a id="L685" class="source_line" href="#L685">685</a>
<a id="L686" class="source_line" href="#L686">686</a>
<a id="L687" class="source_line" href="#L687">687</a>
<a id="L688" class="source_line" href="#L688">688</a>
<a id="L689" class="source_line" href="#L689">689</a>
<a id="L690" class="source_line" href="#L690">690</a>
<a id="L691" class="source_line" href="#L691">691</a>
<a id="L692" class="source_line" href="#L692">692</a>
<a id="L693" class="source_line" href="#L693">693</a>
<a id="L694" class="source_line" href="#L694">694</a>
<a id="L695" class="source_line" href="#L695">695</a>
<a id="L696" class="source_line" href="#L696">696</a>
<a id="L697" class="source_line" href="#L697">697</a>
<a id="L698" class="source_line" href="#L698">698</a>
<a id="L699" class="source_line" href="#L699">699</a>
<a id="L700" class="source_line" href="#L700">700</a>
<a id="L701" class="source_line" href="#L701">701</a>
<a id="L702" class="source_line" href="#L702">702</a>
<a id="L703" class="source_line" href="#L703">703</a>
<a id="L704" class="source_line" href="#L704">704</a>
<a id="L705" class="source_line" href="#L705">705</a>
<a id="L706" class="source_line" href="#L706">706</a>
<a id="L707" class="source_line" href="#L707">707</a>
<a id="L708" class="source_line" href="#L708">708</a>
<a id="L709" class="source_line" href="#L709">709</a>
<a id="L710" class="source_line" href="#L710">710</a>
<a id="L711" class="source_line" href="#L711">711</a>
<a id="L712" class="source_line" href="#L712">712</a>
<a id="L713" class="source_line" href="#L713">713</a>
<a id="L714" class="source_line" href="#L714">714</a>
<a id="L715" class="source_line" href="#L715">715</a>
<a id="L716" class="source_line" href="#L716">716</a>
<a id="L717" class="source_line" href="#L717">717</a>
<a id="L718" class="source_line" href="#L718">718</a>
<a id="L719" class="source_line" href="#L719">719</a>
<a id="L720" class="source_line" href="#L720">720</a>
<a id="L721" class="source_line" href="#L721">721</a>
<a id="L722" class="source_line" href="#L722">722</a>
<a id="L723" class="source_line" href="#L723">723</a>
<a id="L724" class="source_line" href="#L724">724</a>
<a id="L725" class="source_line" href="#L725">725</a>
<a id="L726" class="source_line" href="#L726">726</a>
<a id="L727" class="source_line" href="#L727">727</a>
<a id="L728" class="source_line" href="#L728">728</a>
<a id="L729" class="source_line" href="#L729">729</a>
<a id="L730" class="source_line" href="#L730">730</a>
<a id="L731" class="source_line" href="#L731">731</a>
<a id="L732" class="source_line" href="#L732">732</a>
<a id="L733" class="source_line" href="#L733">733</a>
<a id="L734" class="source_line" href="#L734">734</a>
<a id="L735" class="source_line" href="#L735">735</a>
<a id="L736" class="source_line" href="#L736">736</a>
<a id="L737" class="source_line" href="#L737">737</a>
<a id="L738" class="source_line" href="#L738">738</a>
<a id="L739" class="source_line" href="#L739">739</a>
<a id="L740" class="source_line" href="#L740">740</a>
<a id="L741" class="source_line" href="#L741">741</a>
<a id="L742" class="source_line" href="#L742">742</a>
<a id="L743" class="source_line" href="#L743">743</a>
<a id="L744" class="source_line" href="#L744">744</a>
<a id="L745" class="source_line" href="#L745">745</a>
<a id="L746" class="source_line" href="#L746">746</a>
<a id="L747" class="source_line" href="#L747">747</a>
<a id="L748" class="source_line" href="#L748">748</a>
<a id="L749" class="source_line" href="#L749">749</a>
<a id="L750" class="source_line" href="#L750">750</a>
<a id="L751" class="source_line" href="#L751">751</a>
<a id="L752" class="source_line" href="#L752">752</a>
<a id="L753" class="source_line" href="#L753">753</a>
<a id="L754" class="source_line" href="#L754">754</a>
<a id="L755" class="source_line" href="#L755">755</a>
<a id="L756" class="source_line" href="#L756">756</a>
<a id="L757" class="source_line" href="#L757">757</a>
<a id="L758" class="source_line" href="#L758">758</a>
<a id="L759" class="source_line" href="#L759">759</a>
<a id="L760" class="source_line" href="#L760">760</a>
<a id="L761" class="source_line" href="#L761">761</a>
<a id="L762" class="source_line" href="#L762">762</a>
<a id="L763" class="source_line" href="#L763">763</a>
<a id="L764" class="source_line" href="#L764">764</a>
<a id="L765" class="source_line" href="#L765">765</a>
<a id="L766" class="source_line" href="#L766">766</a>
<a id="L767" class="source_line" href="#L767">767</a>
<a id="L768" class="source_line" href="#L768">768</a>
<a id="L769" class="source_line" href="#L769">769</a>
<a id="L770" class="source_line" href="#L770">770</a>
<a id="L771" class="source_line" href="#L771">771</a>
<a id="L772" class="source_line" href="#L772">772</a>
<a id="L773" class="source_line" href="#L773">773</a>
<a id="L774" class="source_line" href="#L774">774</a>
<a id="L775" class="source_line" href="#L775">775</a>
<a id="L776" class="source_line" href="#L776">776</a>
<a id="L777" class="source_line" href="#L777">777</a>
<a id="L778" class="source_line" href="#L778">778</a>
<a id="L779" class="source_line" href="#L779">779</a>
<a id="L780" class="source_line" href="#L780">780</a>
<a id="L781" class="source_line" href="#L781">781</a>
<a id="L782" class="source_line" href="#L782">782</a>
<a id="L783" class="source_line" href="#L783">783</a>
<a id="L784" class="source_line" href="#L784">784</a>
<a id="L785" class="source_line" href="#L785">785</a>
<a id="L786" class="source_line" href="#L786">786</a>
<a id="L787" class="source_line" href="#L787">787</a>
<a id="L788" class="source_line" href="#L788">788</a>
<a id="L789" class="source_line" href="#L789">789</a>
<a id="L790" class="source_line" href="#L790">790</a>
<a id="L791" class="source_line" href="#L791">791</a>
<a id="L792" class="source_line" href="#L792">792</a>
<a id="L793" class="source_line" href="#L793">793</a>
<a id="L794" class="source_line" href="#L794">794</a>
<a id="L795" class="source_line" href="#L795">795</a>
<a id="L796" class="source_line" href="#L796">796</a>
<a id="L797" class="source_line" href="#L797">797</a>
<a id="L798" class="source_line" href="#L798">798</a>
<a id="L799" class="source_line" href="#L799">799</a>
<a id="L800" class="source_line" href="#L800">800</a>
<a id="L801" class="source_line" href="#L801">801</a>
<a id="L802" class="source_line" href="#L802">802</a>
<a id="L803" class="source_line" href="#L803">803</a>
<a id="L804" class="source_line" href="#L804">804</a>
<a id="L805" class="source_line" href="#L805">805</a>
<a id="L806" class="source_line" href="#L806">806</a>
<a id="L807" class="source_line" href="#L807">807</a>
<a id="L808" class="source_line" href="#L808">808</a>
<a id="L809" class="source_line" href="#L809">809</a>
<a id="L810" class="source_line" href="#L810">810</a>
<a id="L811" class="source_line" href="#L811">811</a>
<a id="L812" class="source_line" href="#L812">812</a>
<a id="L813" class="source_line" href="#L813">813</a>
<a id="L814" class="source_line" href="#L814">814</a>
<a id="L815" class="source_line" href="#L815">815</a>
<a id="L816" class="source_line" href="#L816">816</a>
<a id="L817" class="source_line" href="#L817">817</a>
<a id="L818" class="source_line" href="#L818">818</a>
<a id="L819" class="source_line" href="#L819">819</a>
<a id="L820" class="source_line" href="#L820">820</a>
<a id="L821" class="source_line" href="#L821">821</a>
<a id="L822" class="source_line" href="#L822">822</a>
<a id="L823" class="source_line" href="#L823">823</a>
<a id="L824" class="source_line" href="#L824">824</a>
<a id="L825" class="source_line" href="#L825">825</a>
<a id="L826" class="source_line" href="#L826">826</a>
<a id="L827" class="source_line" href="#L827">827</a>
<a id="L828" class="source_line" href="#L828">828</a>
<a id="L829" class="source_line" href="#L829">829</a>
<a id="L830" class="source_line" href="#L830">830</a>
<a id="L831" class="source_line" href="#L831">831</a>
<a id="L832" class="source_line" href="#L832">832</a>
<a id="L833" class="source_line" href="#L833">833</a>
<a id="L834" class="source_line" href="#L834">834</a>
<a id="L835" class="source_line" href="#L835">835</a>
<a id="L836" class="source_line" href="#L836">836</a>
<a id="L837" class="source_line" href="#L837">837</a>
<a id="L838" class="source_line" href="#L838">838</a>
<a id="L839" class="source_line" href="#L839">839</a>
<a id="L840" class="source_line" href="#L840">840</a>
<a id="L841" class="source_line" href="#L841">841</a>
<a id="L842" class="source_line" href="#L842">842</a>
<a id="L843" class="source_line" href="#L843">843</a>
<a id="L844" class="source_line" href="#L844">844</a>
<a id="L845" class="source_line" href="#L845">845</a>
<a id="L846" class="source_line" href="#L846">846</a>
<a id="L847" class="source_line" href="#L847">847</a>
<a id="L848" class="source_line" href="#L848">848</a>
<a id="L849" class="source_line" href="#L849">849</a>
<a id="L850" class="source_line" href="#L850">850</a>
<a id="L851" class="source_line" href="#L851">851</a>
<a id="L852" class="source_line" href="#L852">852</a>
<a id="L853" class="source_line" href="#L853">853</a>
<a id="L854" class="source_line" href="#L854">854</a>
<a id="L855" class="source_line" href="#L855">855</a>
<a id="L856" class="source_line" href="#L856">856</a>
<a id="L857" class="source_line" href="#L857">857</a>
<a id="L858" class="source_line" href="#L858">858</a>
<a id="L859" class="source_line" href="#L859">859</a>
<a id="L860" class="source_line" href="#L860">860</a>
<a id="L861" class="source_line" href="#L861">861</a>
<a id="L862" class="source_line" href="#L862">862</a>
<a id="L863" class="source_line" href="#L863">863</a>
<a id="L864" class="source_line" href="#L864">864</a>
<a id="L865" class="source_line" href="#L865">865</a>
<a id="L866" class="source_line" href="#L866">866</a>
<a id="L867" class="source_line" href="#L867">867</a>
<a id="L868" class="source_line" href="#L868">868</a>
<a id="L869" class="source_line" href="#L869">869</a>
<a id="L870" class="source_line" href="#L870">870</a>
<a id="L871" class="source_line" href="#L871">871</a>
<a id="L872" class="source_line" href="#L872">872</a>
<a id="L873" class="source_line" href="#L873">873</a>
<a id="L874" class="source_line" href="#L874">874</a>
<a id="L875" class="source_line" href="#L875">875</a>
<a id="L876" class="source_line" href="#L876">876</a>
<a id="L877" class="source_line" href="#L877">877</a>
<a id="L878" class="source_line" href="#L878">878</a>
<a id="L879" class="source_line" href="#L879">879</a>
<a id="L880" class="source_line" href="#L880">880</a>
<a id="L881" class="source_line" href="#L881">881</a>
<a id="L882" class="source_line" href="#L882">882</a>
<a id="L883" class="source_line" href="#L883">883</a>
<a id="L884" class="source_line" href="#L884">884</a>
<a id="L885" class="source_line" href="#L885">885</a>
<a id="L886" class="source_line" href="#L886">886</a>
<a id="L887" class="source_line" href="#L887">887</a>
<a id="L888" class="source_line" href="#L888">888</a>
<a id="L889" class="source_line" href="#L889">889</a>
<a id="L890" class="source_line" href="#L890">890</a>
<a id="L891" class="source_line" href="#L891">891</a>
<a id="L892" class="source_line" href="#L892">892</a>
<a id="L893" class="source_line" href="#L893">893</a>
<a id="L894" class="source_line" href="#L894">894</a>
<a id="L895" class="source_line" href="#L895">895</a>
<a id="L896" class="source_line" href="#L896">896</a>
<a id="L897" class="source_line" href="#L897">897</a>
<a id="L898" class="source_line" href="#L898">898</a>
<a id="L899" class="source_line" href="#L899">899</a>
<a id="L900" class="source_line" href="#L900">900</a>
<a id="L901" class="source_line" href="#L901">901</a>
<a id="L902" class="source_line" href="#L902">902</a>
<a id="L903" class="source_line" href="#L903">903</a>
<a id="L904" class="source_line" href="#L904">904</a>
<a id="L905" class="source_line" href="#L905">905</a>
<a id="L906" class="source_line" href="#L906">906</a>
<a id="L907" class="source_line" href="#L907">907</a>
<a id="L908" class="source_line" href="#L908">908</a>
<a id="L909" class="source_line" href="#L909">909</a>
<a id="L910" class="source_line" href="#L910">910</a>
<a id="L911" class="source_line" href="#L911">911</a>
<a id="L912" class="source_line" href="#L912">912</a>
<a id="L913" class="source_line" href="#L913">913</a>
<a id="L914" class="source_line" href="#L914">914</a>
<a id="L915" class="source_line" href="#L915">915</a>
<a id="L916" class="source_line" href="#L916">916</a>
<a id="L917" class="source_line" href="#L917">917</a>
<a id="L918" class="source_line" href="#L918">918</a>
<a id="L919" class="source_line" href="#L919">919</a>
<a id="L920" class="source_line" href="#L920">920</a>
<a id="L921" class="source_line" href="#L921">921</a>
<a id="L922" class="source_line" href="#L922">922</a>
<a id="L923" class="source_line" href="#L923">923</a>
<a id="L924" class="source_line" href="#L924">924</a>
<a id="L925" class="source_line" href="#L925">925</a>
<a id="L926" class="source_line" href="#L926">926</a>
<a id="L927" class="source_line" href="#L927">927</a>
<a id="L928" class="source_line" href="#L928">928</a>
<a id="L929" class="source_line" href="#L929">929</a>
<a id="L930" class="source_line" href="#L930">930</a>
<a id="L931" class="source_line" href="#L931">931</a>
<a id="L932" class="source_line" href="#L932">932</a>
<a id="L933" class="source_line" href="#L933">933</a>
<a id="L934" class="source_line" href="#L934">934</a>
<a id="L935" class="source_line" href="#L935">935</a>
<a id="L936" class="source_line" href="#L936">936</a>
<a id="L937" class="source_line" href="#L937">937</a>
<a id="L938" class="source_line" href="#L938">938</a>
<a id="L939" class="source_line" href="#L939">939</a>
<a id="L940" class="source_line" href="#L940">940</a>
<a id="L941" class="source_line" href="#L941">941</a>
<a id="L942" class="source_line" href="#L942">942</a>
<a id="L943" class="source_line" href="#L943">943</a>
<a id="L944" class="source_line" href="#L944">944</a>
<a id="L945" class="source_line" href="#L945">945</a>
<a id="L946" class="source_line" href="#L946">946</a>
<a id="L947" class="source_line" href="#L947">947</a>
<a id="L948" class="source_line" href="#L948">948</a>
<a id="L949" class="source_line" href="#L949">949</a>
<a id="L950" class="source_line" href="#L950">950</a>
<a id="L951" class="source_line" href="#L951">951</a>
<a id="L952" class="source_line" href="#L952">952</a>
<a id="L953" class="source_line" href="#L953">953</a>
<a id="L954" class="source_line" href="#L954">954</a>
<a id="L955" class="source_line" href="#L955">955</a>
<a id="L956" class="source_line" href="#L956">956</a>
<a id="L957" class="source_line" href="#L957">957</a>
<a id="L958" class="source_line" href="#L958">958</a>
<a id="L959" class="source_line" href="#L959">959</a>
<a id="L960" class="source_line" href="#L960">960</a>
<a id="L961" class="source_line" href="#L961">961</a>
<a id="L962" class="source_line" href="#L962">962</a>
<a id="L963" class="source_line" href="#L963">963</a>
<a id="L964" class="source_line" href="#L964">964</a>
<a id="L965" class="source_line" href="#L965">965</a>
<a id="L966" class="source_line" href="#L966">966</a>
<a id="L967" class="source_line" href="#L967">967</a>
<a id="L968" class="source_line" href="#L968">968</a>
<a id="L969" class="source_line" href="#L969">969</a>
<a id="L970" class="source_line" href="#L970">970</a>
<a id="L971" class="source_line" href="#L971">971</a>
<a id="L972" class="source_line" href="#L972">972</a>
<a id="L973" class="source_line" href="#L973">973</a>
<a id="L974" class="source_line" href="#L974">974</a>
<a id="L975" class="source_line" href="#L975">975</a>
<a id="L976" class="source_line" href="#L976">976</a>
<a id="L977" class="source_line" href="#L977">977</a>
</code><code class="source_code"><span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*    Copyright 2012-2020 OCamlPro                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*    Copyright 2012 INRIA                                                *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*  All rights reserved. This file is distributed under the terms of the  *)</span><span class="EOL">
</span><span class="COMMENT">(*  GNU Lesser General Public License version 2.1, with the special       *)</span><span class="EOL">
</span><span class="COMMENT">(*  exception on linking described in the file LICENSE.                   *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-log"><span class="LIDENT">log</span></span> <span class="QUESTION">?</span><span id="local_level_1"><span class="LIDENT">level</span></span> <span id="local_fmt_2"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="opamConsole.ml.html#val-log"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">log</span></a> <span class="STRING">&quot;PROC&quot;</span> <span class="QUESTION">?</span><a href="#local_level_1"><span class="LIDENT">level</span></a> <a href="#local_fmt_2"><span class="LIDENT">fmt</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-default_env"><span class="LIDENT">default_env</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_f_3"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LAZY">lazy</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_env_4"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Env.val-raw_env"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">raw_env</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">cygbin</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_cygbin_5"><span class="LIDENT">cygbin</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="opamStd.ml.html#module-Env.val-cyg_env"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">cyg_env</span></a> <span class="TILDE">~</span><a href="#local_env_4"><span class="LIDENT">env</span></a> <span class="TILDE">~</span><a href="#local_cygbin_5"><span class="LIDENT">cygbin</span></a> <span class="LABEL">~git_location:</span><a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">git_location</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_env_4"><span class="LIDENT">env</span></a><span class="EOL">
</span>  <span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#val-force"><span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">force</span></a> <span class="LPAREN">(</span><a href="#local_f_3"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cygwin_create_process_env"><span class="LIDENT">cygwin_create_process_env</span></span> <span id="local_prog_6"><span class="LIDENT">prog</span></span> <span id="local_args_7"><span class="LIDENT">args</span></span> <span id="local_env_8"><span class="LIDENT">env</span></span> <span id="local_fd1_9"><span class="LIDENT">fd1</span></span> <span id="local_fd2_10"><span class="LIDENT">fd2</span></span> <span id="local_fd3_11"><span class="LIDENT">fd3</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="COMMENT">(*
   * Unix.create_process_env correctly converts arguments to a command line for
   * native Windows execution, but it does not correctly handle Cygwin's quoting
   * requirements.
   *
   * The process followed here is based on an analysis of the sources for the
   * Cygwin DLL (git://sourceware.org/git/newlib-cygwin.git,
   * winsup/cygwin/dcrt0.cc) and a lack of refutation on the Cygwin mailing list
   * in May 2016!
   *
   * In case this seems terminally stupid, it's worth noting that Cygwin's
   * implementation of the exec system calls do not pass argv using the Windows
   * command line, these weird and wonderful rules exist for corner cases and,
   * as here, for invocations from native Windows processes.
   *
   * There are two forms of escaping which can apply, controlled by the CYGWIN
   * environment variable option noglob.
   *
   * If none of the strings in argv contains the double-quote character, then
   * the process should be invoked with the noglob option (to ensure that no
   * characters are unexpectedly expanded). In this mode of escaping, it is
   * necessary to protect any whitespace characters (\r, \n, \t, and space
   * itself) by surrounding sequences of them with double-quotes). Additionally,
   * if any string in argv begins with the @ sign, this should be double-quoted.
   *
   * If any one of the strings in argv does contain a double-quote character,
   * then the process should be invoked with the glob option (this is the
   * default). Every string in argv should have double-quotes put around it. Any
   * double-quote characters within the string should be translated to &quot;'&quot;'&quot;.
   *
   * The reason for supporting both mechanisms is that the noglob method has
   * shorter command lines and Windows has an upper limit of 32767 characters
   * for the command line.
   *
   * COMBAK If the command line does exceed 32767 characters, then Cygwin allows
   *        a parameter beginning @ to refer to a file from which to read the
   *        rest of the command line. This support is not implemented at this
   *        time in OPAM.
   *
   * [This stray &quot; is here to terminate a previous part of the comment!]
   *
   * Automatically setting CYGWIN to at least contain winsymlinks:native was
   * also added later to make sure the native links are used.
   *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_make_args_12"><span class="LIDENT">make_args</span></span> <span id="local_argv_13"><span class="LIDENT">argv</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_b_14"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-create"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">128</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_gen_quote_15"><span class="LIDENT">gen_quote</span></span> <span class="TILDE">~</span><span id="local_quote_16"><span class="LIDENT">quote</span></span> <span class="TILDE">~</span><span id="local_pre_17"><span class="LIDENT">pre</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_post_18"><span class="LIDENT">post</span></span> <span class="EQUAL">=</span> <a href="#local_pre_17"><span class="LIDENT">pre</span></a><span class="RPAREN">)</span> <span id="local_s_19"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">3</span> <span class="STRING">&quot;gen_quote: %S&quot;</span> <a href="#local_s_19"><span class="LIDENT">s</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-clear"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">clear</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_l_20"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_s_19"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_f_21"><span class="LIDENT">f</span></span> <span id="local_i_22"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_j_23"><span class="LIDENT">j</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="TRY">try</span><span class="EOL">
</span>            <a href="opamStd.ml.html#module-OpamString.val-find_from"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">find_from</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_24"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-index"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">index</span></a> <a href="#local_quote_16"><span class="LIDENT">quote</span></a> <a href="#local_c_24"><span class="LIDENT">c</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">0</span> <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <a href="#local_s_19"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-succ"><span class="LIDENT">succ</span></a> <a href="#local_i_22"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <a href="#local_l_20"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_string"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_string</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-sub"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">sub</span></a> <a href="#local_s_19"><span class="LIDENT">s</span></a> <a href="#local_i_22"><span class="LIDENT">i</span></a> <span class="LPAREN">(</span><a href="#local_j_23"><span class="LIDENT">j</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_22"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_j_23"><span class="LIDENT">j</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_l_20"><span class="LIDENT">l</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_string"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_string</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a> <a href="#local_pre_17"><span class="LIDENT">pre</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_i_25"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="#local_j_23"><span class="LIDENT">j</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_j_26"><span class="LIDENT">j</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="TRY">try</span><span class="EOL">
</span>              <a href="opamStd.ml.html#module-OpamString.val-find_from"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">find_from</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_27"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-index"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">index</span></a> <a href="#local_quote_16"><span class="LIDENT">quote</span></a> <a href="#local_c_27"><span class="LIDENT">c</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="RPAREN">)</span> <a href="#local_s_19"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-succ"><span class="LIDENT">succ</span></a> <a href="#local_i_25"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <a href="#local_l_20"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_string"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_string</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-sub"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">sub</span></a> <a href="#local_s_19"><span class="LIDENT">s</span></a> <a href="#local_i_25"><span class="LIDENT">i</span></a> <span class="LPAREN">(</span><a href="#local_j_26"><span class="LIDENT">j</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_25"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_string"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_string</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a> <a href="#local_post_18"><span class="LIDENT">post</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="#local_j_26"><span class="LIDENT">j</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_l_20"><span class="LIDENT">l</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_f_21"><span class="LIDENT">f</span></a> <a href="#local_j_26"><span class="LIDENT">j</span></a><span class="EOL">
</span>          <span class="ELSE">else</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-contents"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a><span class="EOL">
</span>        <span class="END">end</span> <span class="ELSE">else</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-contents"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_b_14"><span class="LIDENT">b</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_r_28"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_s_19"><span class="LIDENT">s</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="STRING">&quot;&quot;</span> <span class="THEN">then</span><span class="EOL">
</span>          <span class="STRING">&quot;\&quot;\&quot;&quot;</span><span class="EOL">
</span>        <span class="ELSE">else</span><span class="EOL">
</span>          <a href="#local_f_21"><span class="LIDENT">f</span></a> <span class="INT">0</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">3</span> <span class="STRING">&quot;result: %S&quot;</span> <a href="#local_r_28"><span class="LIDENT">r</span></a><span class="SEMI">;</span> <a href="#local_r_28"><span class="LIDENT">r</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Setting noglob is causing some problems for ocamlbuild invoking Cygwin's
       find. The reason for using it is to try to keep command line lengths
       below the maximum, but for now disable the use of noglob. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="TRUE">true</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-exists"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">exists</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_29"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-index"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">index</span></a> <a href="#local_s_29"><span class="LIDENT">s</span></a> <span class="CHAR">'&quot;'</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">0</span> <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <a href="#local_argv_13"><span class="LIDENT">argv</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="STRING">&quot;\&quot;&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot;\&quot; \&quot;&quot;</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><a href="#local_gen_quote_15"><span class="LIDENT">gen_quote</span></a> <span class="LABEL">~quote:</span><span class="STRING">&quot;\&quot;&quot;</span> <span class="LABEL">~pre:</span><span class="STRING">&quot;\&quot;'&quot;</span> <span class="LABEL">~post:</span><span class="STRING">&quot;'\&quot;&quot;</span><span class="RPAREN">)</span> <a href="#local_argv_13"><span class="LIDENT">argv</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;\&quot;&quot;</span><span class="COMMA">,</span> <span class="FALSE">false</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><a href="#local_gen_quote_15"><span class="LIDENT">gen_quote</span></a> <span class="LABEL">~quote:</span><span class="STRING">&quot;\b\r\n &quot;</span> <span class="LABEL">~pre:</span><span class="STRING">&quot;\&quot;&quot;</span><span class="RPAREN">)</span> <a href="#local_argv_13"><span class="LIDENT">argv</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <span class="TRUE">true</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_412"><span class="LPAREN">(</span><span id="local_command_line_30"><span class="LIDENT">command_line</span></span><span class="COMMA">,</span> <span id="local_no_glob_31"><span class="LIDENT">no_glob</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="#local_make_args_12"><span class="LIDENT">make_args</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-to_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">to_list</span></a> <a href="#local_args_7"><span class="LIDENT">args</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">log</span> <span class="STRING">&quot;cygvoke(%sglob): %s&quot;</span> <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_no_glob_31"><span class="LIDENT">no_glob</span></a> <span class="THEN">then</span> <span class="STRING">&quot;no&quot;</span> <span class="ELSE">else</span> <span class="STRING">&quot;&quot;</span><span class="RPAREN">)</span> <a href="#local_command_line_30"><span class="LIDENT">command_line</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_32"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-to_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">to_list</span></a> <a href="#local_env_8"><span class="LIDENT">env</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_cygwin_set_33"><span class="LIDENT">cygwin_set</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_f_34"><span class="LIDENT">f</span></span> <span id="local_item_35"><span class="LIDENT">item</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_380"><span class="LPAREN">(</span><span id="local_key_36"><span class="LIDENT">key</span></span><span class="COMMA">,</span> <span id="local_value_37"><span class="LIDENT">value</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="opamStd.ml.html#module-OpamString.val-cut_at"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">cut_at</span></a> <a href="#local_item_35"><span class="LIDENT">item</span></a> <span class="CHAR">'='</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="UIDENT">Some</span> <span id="local_pair_38"><span class="LIDENT">pair</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pair_38"><span class="LIDENT">pair</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_item_35"><span class="LIDENT">item</span></a><span class="COMMA">,</span> <span class="STRING">&quot;&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-lowercase_ascii"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">lowercase_ascii</span></a> <a href="#local_key_36"><span class="LIDENT">key</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="STRING">&quot;cygwin&quot;</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="#local_key_36"><span class="LIDENT">key</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="STRING">&quot;CYGWIN&quot;</span> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_cygwin_set_33"><span class="LIDENT">cygwin_set</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="TRUE">true</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_settings_39"><span class="LIDENT">settings</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamString.val-split"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">split</span></a> <a href="#local_value_37"><span class="LIDENT">value</span></a> <span class="CHAR">' '</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_noglob_set_40"><span class="LIDENT">noglob_set</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_winsymlinks_set_41"><span class="LIDENT">winsymlinks_set</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_f_42"><span class="LIDENT">f</span></span> <span id="local_setting_43"><span class="LIDENT">setting</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_setting_44"><span class="LIDENT">setting</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-trim"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">trim</span></a> <a href="#local_setting_43"><span class="LIDENT">setting</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_405"><span id="local_setting_45"><span class="LIDENT">setting</span></span><span class="COMMA">,</span> <span id="local_value_46"><span class="LIDENT">value</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="opamStd.ml.html#module-OpamString.val-cut_at"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">cut_at</span></a> <a href="#local_setting_44"><span class="LIDENT">setting</span></a> <span class="CHAR">':'</span> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_setting_47"><span class="LIDENT">setting</span></span><span class="COMMA">,</span> <span id="local_value_48"><span class="LIDENT">value</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_setting_47"><span class="LIDENT">setting</span></a><span class="COMMA">,</span> <span class="UIDENT">Some</span> <a href="#local_value_48"><span class="LIDENT">value</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_setting_44"><span class="LIDENT">setting</span></a><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_setting_45"><span class="LIDENT">setting</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="STRING">&quot;glob&quot;</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="IF">if</span> <a href="#local_no_glob_31"><span class="LIDENT">no_glob</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Removing glob from %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <span class="FALSE">false</span><span class="EOL">
</span>              <span class="END">end</span> <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Leaving glob in %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <a href="#local_noglob_set_40"><span class="LIDENT">noglob_set</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>                <span class="TRUE">true</span><span class="EOL">
</span>              <span class="END">end</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="STRING">&quot;noglob&quot;</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="IF">if</span> <a href="#local_no_glob_31"><span class="LIDENT">no_glob</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Leaving noglob in %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <a href="#local_noglob_set_40"><span class="LIDENT">noglob_set</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>                <span class="TRUE">true</span><span class="EOL">
</span>              <span class="END">end</span> <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Removing noglob from %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <span class="FALSE">false</span><span class="EOL">
</span>              <span class="END">end</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="STRING">&quot;winsymlinks&quot;</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="BEGIN">begin</span> <span class="MATCH">match</span> <a href="#local_value_46"><span class="LIDENT">value</span></a> <span class="WITH">with</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;nativestrict&quot;</span> <span class="AS">as</span> <span id="local_value_49"><span class="LIDENT">value</span></span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;native&quot;</span> <span class="AS">as</span> <span id="local_value_50"><span class="LIDENT">value</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                  <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Leaving %s:%s in %s&quot;</span> <a href="#local_setting_45"><span class="LIDENT">setting</span></a> <a href="#local_value_50"><span class="LIDENT">value</span></a> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>                  <a href="#local_winsymlinks_set_41"><span class="LIDENT">winsymlinks_set</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>                  <span class="TRUE">true</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>              <span class="END">end</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="TRUE">true</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_settings_51"><span class="LIDENT">settings</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <a href="#local_f_42"><span class="LIDENT">f</span></a> <a href="#local_settings_39"><span class="LIDENT">settings</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_settings_52"><span class="LIDENT">settings</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_noglob_set_40"><span class="LIDENT">noglob_set</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_no_glob_31"><span class="LIDENT">no_glob</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>            <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Setting noglob in %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>            <span class="STRING">&quot;noglob&quot;</span><span class="COLONCOLON">::</span><a href="#local_settings_51"><span class="LIDENT">settings</span></a><span class="EOL">
</span>          <span class="END">end</span> <span class="ELSE">else</span><span class="EOL">
</span>            <a href="#local_settings_51"><span class="LIDENT">settings</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_settings_53"><span class="LIDENT">settings</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_winsymlinks_set_41"><span class="LIDENT">winsymlinks_set</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>            <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Setting winsymlinks:native in %s&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>            <a href="#local_settings_52"><span class="LIDENT">settings</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(@)"><span class="INFIXOP1">@</span></a> <span class="LBRACKET">[</span><span class="STRING">&quot;winsymlinks:native&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span>          <span class="END">end</span> <span class="ELSE">else</span><span class="EOL">
</span>            <a href="#local_settings_52"><span class="LIDENT">settings</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_settings_53"><span class="LIDENT">settings</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>          <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Removing %s completely&quot;</span> <a href="#local_key_36"><span class="LIDENT">key</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="UIDENT">None</span><span class="EOL">
</span>        <span class="END">end</span> <span class="ELSE">else</span><span class="EOL">
</span>          <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_key_36"><span class="LIDENT">key</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;=&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <a href="#local_settings_53"><span class="LIDENT">settings</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Some</span> <a href="#local_item_35"><span class="LIDENT">item</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_54"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamList.val-filter_map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter_map</span></a> <a href="#local_f_34"><span class="LIDENT">f</span></a> <a href="#local_env_32"><span class="LIDENT">env</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_55"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_cygwin_set_33"><span class="LIDENT">cygwin_set</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <a href="#local_env_54"><span class="LIDENT">env</span></a><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_no_glob_31"><span class="LIDENT">no_glob</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>        <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Adding CYGWIN=winsymlinks:native noglob&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="STRING">&quot;CYGWIN=winsymlinks:native noglob&quot;</span><span class="COLONCOLON">::</span><a href="#local_env_54"><span class="LIDENT">env</span></a><span class="EOL">
</span>      <span class="END">end</span> <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>        <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;Adding CYGWIN=winsymlinks:native&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="STRING">&quot;CYGWIN=winsymlinks:native&quot;</span><span class="COLONCOLON">::</span><a href="#local_env_54"><span class="LIDENT">env</span></a><span class="EOL">
</span>      <span class="END">end</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="opamStubs.ml.html#val-win_create_process"><span class="UIDENT">OpamStubs</span><span class="DOT">.</span><span class="LIDENT">win_create_process</span></a> <a href="#local_prog_6"><span class="LIDENT">prog</span></a> <a href="#local_command_line_30"><span class="LIDENT">command_line</span></a><span class="EOL">
</span>                               <span class="LPAREN">(</span><span class="UIDENT">Some</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot;\000&quot;</span> <a href="#local_env_55"><span class="LIDENT">env</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;\000&quot;</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>                               <a href="#local_fd1_9"><span class="LIDENT">fd1</span></a> <a href="#local_fd2_10"><span class="LIDENT">fd2</span></a> <a href="#local_fd3_11"><span class="LIDENT">fd3</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Shell commands *)</span><span class="EOL">
</span><span id="type-command"><span class="TYPE">type</span> <span class="LIDENT">command</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_413"><span class="LIDENT">cmd</span><span class="COLON">:</span> <span class="LIDENT">string</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_401"><span class="LIDENT">args</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_396"><span class="LIDENT">cmd_text</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_386"><span class="LIDENT">cmd_dir</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_403"><span class="LIDENT">cmd_env</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">array</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_399"><span class="LIDENT">cmd_stdin</span><span class="COLON">:</span> <span class="LIDENT">bool</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_407"><span class="LIDENT">cmd_stdout</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_408"><span class="LIDENT">cmd_verbose</span><span class="COLON">:</span> <span class="LIDENT">bool</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_388"><span class="LIDENT">cmd_name</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_379"><span class="LIDENT">cmd_metadata</span><span class="COLON">:</span> <span class="LPAREN">(</span><span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">string</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-string_of_command"><span class="LIDENT">string_of_command</span></span> <span id="local_c_56"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <span class="LPAREN">(</span><a href="#local_c_56"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd</span><span class="COLONCOLON">::</span><a href="#local_c_56"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">args</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-text_of_command"><span class="LIDENT">text_of_command</span></span> <span id="local_c_57"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <a href="#local_c_57"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd_text</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-default_verbose"><span class="LIDENT">default_verbose</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">verbose_level</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">2</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_verbose_command"><span class="LIDENT">is_verbose_command</span></span> <span id="local_c_58"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="LPAREN">(</span><span class="LIDENT">default_verbose</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_c_58"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd_verbose</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-make_command_text"><span class="LIDENT">make_command_text</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_color_59"><span class="LIDENT">color</span></span><span class="EQUAL">=</span><span class="BACKQUOTE">`</span><span class="LIDENT">green</span><span class="RPAREN">)</span> <span id="local_str_60"><span class="LIDENT">str</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_args_61"><span class="LIDENT">args</span></span><span class="EQUAL">=</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span id="local_cmd_62"><span class="LIDENT">cmd</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_summary_63"><span class="LIDENT">summary</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_64"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_s_64"><span class="LIDENT">s</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_s_64"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="CHAR">'-'</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-contains"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">contains</span></a> <a href="#local_s_64"><span class="LIDENT">s</span></a> <span class="CHAR">'/'</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-contains"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">contains</span></a> <a href="#local_s_64"><span class="LIDENT">s</span></a> <span class="CHAR">'='</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="#local_args_61"><span class="LIDENT">args</span></a><span class="EOL">
</span>    <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_hd_65"><span class="LIDENT">hd</span></span><span class="COLONCOLON">::</span><span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <span class="LBRACKET">[</span><a href="#local_cmd_62"><span class="LIDENT">cmd</span></a><span class="SEMI">;</span> <a href="#local_hd_65"><span class="LIDENT">hd</span></a><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cmd_62"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;[%s: %s]&quot;</span> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_59"><span class="LIDENT">color</span></a> <a href="#local_str_60"><span class="LIDENT">str</span></a><span class="RPAREN">)</span> <a href="#local_summary_63"><span class="LIDENT">summary</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-command"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span id="local_env_66"><span class="LIDENT">env</span></span> <span class="QUESTION">?</span><span id="local_verbose_67"><span class="LIDENT">verbose</span></span> <span class="QUESTION">?</span><span id="local_name_68"><span class="LIDENT">name</span></span> <span class="QUESTION">?</span><span id="local_metadata_69"><span class="LIDENT">metadata</span></span> <span class="QUESTION">?</span><span id="local_dir_70"><span class="LIDENT">dir</span></span> <span class="QUESTION">?</span><span id="local_allow_stdin_71"><span class="LIDENT">allow_stdin</span></span> <span class="QUESTION">?</span><span id="local_stdout_72"><span class="LIDENT">stdout</span></span> <span class="QUESTION">?</span><span id="local_text_73"><span class="LIDENT">text</span></span><span class="EOL">
</span>    <span id="local_cmd_74"><span class="LIDENT">cmd</span></span> <span id="local_args_75"><span class="LIDENT">args</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LBRACE">{</span> <a href="#local_cmd_74"><span class="LIDENT">cmd</span></a><span class="SEMI">;</span> <a href="#local_args_75"><span class="LIDENT">args</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">cmd_env</span><span class="EQUAL">=</span><a href="#local_env_66"><span class="LIDENT">env</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_verbose</span><span class="EQUAL">=</span><a href="#local_verbose_67"><span class="LIDENT">verbose</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_name</span><span class="EQUAL">=</span><a href="#local_name_68"><span class="LIDENT">name</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_metadata</span><span class="EQUAL">=</span><a href="#local_metadata_69"><span class="LIDENT">metadata</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">cmd_dir</span><span class="EQUAL">=</span><a href="#local_dir_70"><span class="LIDENT">dir</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_stdin</span><span class="EQUAL">=</span><a href="#local_allow_stdin_71"><span class="LIDENT">allow_stdin</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_stdout</span><span class="EQUAL">=</span><a href="#local_stdout_72"><span class="LIDENT">stdout</span></a><span class="SEMI">;</span> <span class="LIDENT">cmd_text</span><span class="EQUAL">=</span><a href="#local_text_73"><span class="LIDENT">text</span></a><span class="SEMI">;</span> <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Running processes *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_420"><span class="LIDENT">p_name</span>   <span class="COLON">:</span> <span class="LIDENT">string</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_377"><span class="LIDENT">p_args</span>   <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_415"><span class="LIDENT">p_pid</span>    <span class="COLON">:</span> <span class="LIDENT">int</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_411"><span class="LIDENT">p_cwd</span>    <span class="COLON">:</span> <span class="LIDENT">string</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_393"><span class="LIDENT">p_time</span>   <span class="COLON">:</span> <span class="LIDENT">float</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_410"><span class="LIDENT">p_stdout</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_418"><span class="LIDENT">p_stderr</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_392"><span class="LIDENT">p_env</span>    <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_414"><span class="LIDENT">p_info</span>   <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_400"><span class="LIDENT">p_metadata</span><span class="COLON">:</span> <span class="LPAREN">(</span><span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">string</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_385"><span class="LIDENT">p_verbose</span><span class="COLON">:</span> <span class="LIDENT">bool</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_384"><span class="LIDENT">p_tmp_files</span><span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-output_lines"><span class="LIDENT">output_lines</span></span> <span id="local_oc_76"><span class="LIDENT">oc</span></span> <span id="local_lines_77"><span class="LIDENT">lines</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_line_78"><span class="LIDENT">line</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-output_string"><span class="LIDENT">output_string</span></a> <a href="#local_oc_76"><span class="LIDENT">oc</span></a> <a href="#local_line_78"><span class="LIDENT">line</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-output_string"><span class="LIDENT">output_string</span></a> <a href="#local_oc_76"><span class="LIDENT">oc</span></a> <span class="STRING">&quot;\n&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-flush"><span class="LIDENT">flush</span></a> <a href="#local_oc_76"><span class="LIDENT">oc</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RPAREN">)</span> <a href="#local_lines_77"><span class="LIDENT">lines</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-output_string"><span class="LIDENT">output_string</span></a> <a href="#local_oc_76"><span class="LIDENT">oc</span></a> <span class="STRING">&quot;\n&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-flush"><span class="LIDENT">flush</span></a> <a href="#local_oc_76"><span class="LIDENT">oc</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-make_info"><span class="LIDENT">make_info</span></span> <span class="QUESTION">?</span><span id="local_code_79"><span class="LIDENT">code</span></span> <span class="QUESTION">?</span><span id="local_signal_80"><span class="LIDENT">signal</span></span><span class="EOL">
</span>    <span class="TILDE">~</span><span id="local_cmd_81"><span class="LIDENT">cmd</span></span> <span class="TILDE">~</span><span id="local_args_82"><span class="LIDENT">args</span></span> <span class="TILDE">~</span><span id="local_cwd_83"><span class="LIDENT">cwd</span></span> <span class="TILDE">~</span><span id="local_env_file_84"><span class="LIDENT">env_file</span></span> <span class="TILDE">~</span><span id="local_stdout_file_85"><span class="LIDENT">stdout_file</span></span> <span class="TILDE">~</span><span id="local_stderr_file_86"><span class="LIDENT">stderr_file</span></span> <span class="TILDE">~</span><span id="local_metadata_87"><span class="LIDENT">metadata</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_b_88"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_home_89"><span class="LIDENT">home</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamSys.val-home"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">home</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_print_90"><span class="LIDENT">print</span></span> <span id="local_name_91"><span class="LIDENT">name</span></span> <span id="local_str_92"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_str_93"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="opamStd.ml.html#module-OpamString.val-starts_with"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">starts_with</span></a> <span class="LABEL">~prefix:</span><a href="#local_home_89"><span class="LIDENT">home</span></a> <a href="#local_str_92"><span class="LIDENT">str</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="STRING">&quot;~&quot;</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><a href="opamStd.ml.html#module-OpamString.val-remove_prefix"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">remove_prefix</span></a> <span class="LABEL">~prefix:</span><a href="#local_home_89"><span class="LIDENT">home</span></a> <a href="#local_str_92"><span class="LIDENT">str</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <a href="#local_str_92"><span class="LIDENT">str</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_b_88"><span class="LIDENT">b</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><a href="#local_name_91"><span class="LIDENT">name</span></a><span class="COMMA">,</span> <a href="#local_str_93"><span class="LIDENT">str</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_b_88"><span class="LIDENT">b</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_print_opt_94"><span class="LIDENT">print_opt</span></span> <span id="local_name_95"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_s_96"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_print_90"><span class="LIDENT">print</span></a> <a href="#local_name_95"><span class="LIDENT">name</span></a> <a href="#local_s_96"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_k_97"><span class="LIDENT">k</span></span><span class="COMMA">,</span><span id="local_v_98"><span class="LIDENT">v</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_print_90"><span class="LIDENT">print</span></a> <a href="#local_k_97"><span class="LIDENT">k</span></a> <a href="#local_v_98"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_metadata_87"><span class="LIDENT">metadata</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_print_90"><span class="LIDENT">print</span></a>     <span class="STRING">&quot;path&quot;</span>         <a href="#local_cwd_83"><span class="LIDENT">cwd</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_print_90"><span class="LIDENT">print</span></a>     <span class="STRING">&quot;command&quot;</span>      <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <span class="LPAREN">(</span><a href="#local_cmd_81"><span class="LIDENT">cmd</span></a> <span class="COLONCOLON">::</span> <a href="#local_args_82"><span class="LIDENT">args</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;exit-code&quot;</span>    <span class="LPAREN">(</span><a href="opamStd.ml.html#module-Option.val-map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="#local_code_79"><span class="LIDENT">code</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;signalled&quot;</span>    <span class="LPAREN">(</span><a href="opamStd.ml.html#module-Option.val-map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="#local_signal_80"><span class="LIDENT">signal</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;env-file&quot;</span>     <a href="#local_env_file_84"><span class="LIDENT">env_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_stderr_file_86"><span class="LIDENT">stderr_file</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_stdout_file_85"><span class="LIDENT">stdout_file</span></a> <span class="THEN">then</span><span class="EOL">
</span>    <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;output-file&quot;</span>  <a href="#local_stdout_file_85"><span class="LIDENT">stdout_file</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;stdout-file&quot;</span>  <a href="#local_stdout_file_85"><span class="LIDENT">stdout_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_print_opt_94"><span class="LIDENT">print_opt</span></a> <span class="STRING">&quot;stderr-file&quot;</span>  <a href="#local_stderr_file_86"><span class="LIDENT">stderr_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_b_88"><span class="LIDENT">b</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-string_of_info"><span class="LIDENT">string_of_info</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_color_99"><span class="LIDENT">color</span></span><span class="EQUAL">=</span><span class="BACKQUOTE">`</span><span class="LIDENT">yellow</span><span class="RPAREN">)</span> <span id="local_info_100"><span class="LIDENT">info</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_b_101"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-create"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">1024</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_k_102"><span class="LIDENT">k</span></span><span class="COMMA">,</span><span id="local_v_103"><span class="LIDENT">v</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-bprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">bprintf</span></a> <a href="#local_b_101"><span class="LIDENT">b</span></a> <span class="STRING">&quot;%s %-20s %s\n&quot;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_99"><span class="LIDENT">color</span></a> <span class="STRING">&quot;#&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_99"><span class="LIDENT">color</span></a> <a href="#local_k_102"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <a href="#local_v_103"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_info_100"><span class="LIDENT">info</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-contents"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_b_101"><span class="LIDENT">b</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-resolve_command"><span class="LIDENT">resolve_command</span></span> <span class="QUESTION">?</span><span id="local_env_104"><span class="LIDENT">env</span></span> <span class="QUESTION">?</span><span id="local_dir_105"><span class="LIDENT">dir</span></span> <span id="local_name_106"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_107"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_env_104"><span class="LIDENT">env</span></a> <span class="WITH">with</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">default_env</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_108"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_108"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="opamStd.ml.html#module-OpamSys.val-resolve_command"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">resolve_command</span></a> <span class="TILDE">~</span><a href="#local_env_107"><span class="LIDENT">env</span></a> <span class="QUESTION">?</span><a href="#local_dir_105"><span class="LIDENT">dir</span></a> <a href="#local_name_106"><span class="LIDENT">name</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmd</span> <span id="local_cmd_109"><span class="LIDENT">cmd</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_cmd_109"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Denied</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-create_process_env"><span class="LIDENT">create_process_env</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a> <span class="THEN">then</span><span class="EOL">
</span>    <span class="FUN">fun</span> <span id="local_cmd_110"><span class="LIDENT">cmd</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="opamStd.ml.html#module-Option.val-map_default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map_default</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamSys.val-is_cygwin_variant"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">is_cygwin_variant</span></a><span class="EOL">
</span>             <span class="OPTLABEL">?search_in_first:</span><span class="LPAREN">(</span><a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">cygbin</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>             <span class="FALSE">false</span><span class="EOL">
</span>             <span class="LPAREN">(</span><span class="LIDENT">resolve_command</span> <a href="#local_cmd_110"><span class="LIDENT">cmd</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>        <span class="LIDENT">cygwin_create_process_env</span> <a href="#local_cmd_110"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">create_process_env</span> <a href="#local_cmd_110"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>  <span class="ELSE">else</span><span class="EOL">
</span>    <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">create_process_env</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** [create cmd args] create a new process to execute the command
    [cmd] with arguments [args]. If [stdout_file] or [stderr_file] are
    set, the channels are redirected to the corresponding files.  The
    outputs are discarded is [verbose] is set to false. The current
    environment can also be overridden if [env] is set. The environment
    which is used to run the process is recorded into [env_file] (if
    set). *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-create"><span class="LIDENT">create</span></span> <span class="QUESTION">?</span><span id="local_info_file_111"><span class="LIDENT">info_file</span></span> <span class="QUESTION">?</span><span id="local_env_file_112"><span class="LIDENT">env_file</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_allow_stdin_113"><span class="LIDENT">allow_stdin</span></span><span class="EQUAL">=</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_stdout_file_114"><span class="LIDENT">stdout_file</span></span> <span class="QUESTION">?</span><span id="local_stderr_file_115"><span class="LIDENT">stderr_file</span></span> <span class="QUESTION">?</span><span id="local_env_116"><span class="LIDENT">env</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_metadata_117"><span class="LIDENT">metadata</span></span><span class="EQUAL">=</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_dir_118"><span class="LIDENT">dir</span></span><span class="EOL">
</span>    <span class="TILDE">~</span><span id="local_verbose_119"><span class="LIDENT">verbose</span></span> <span class="TILDE">~</span><span id="local_tmp_files_120"><span class="LIDENT">tmp_files</span></span> <span id="local_cmd_121"><span class="LIDENT">cmd</span></span> <span id="local_args_122"><span class="LIDENT">args</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_nothing_123"><span class="LIDENT">nothing</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_tee_124"><span class="LIDENT">tee</span></span> <span id="local_f_125"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_flags_126"><span class="LIDENT">flags</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">O_WRONLY</span><span class="SEMI">;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">O_CREAT</span><span class="SEMI">;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">O_APPEND</span><span class="SEMI">;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">O_SHARE_DELETE</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fd_127"><span class="LIDENT">fd</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">openfile</span> <a href="#local_f_125"><span class="LIDENT">f</span></a> <a href="#local_flags_126"><span class="LIDENT">flags</span></a> <span class="INT">0o644</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_close_fd_128"><span class="LIDENT">close_fd</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">close</span> <a href="#local_fd_127"><span class="LIDENT">fd</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_fd_127"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <a href="#local_close_fd_128"><span class="LIDENT">close_fd</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_oldcwd_129"><span class="LIDENT">oldcwd</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-getcwd"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">getcwd</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_cwd_130"><span class="LIDENT">cwd</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <a href="#local_oldcwd_129"><span class="LIDENT">oldcwd</span></a> <a href="#local_dir_118"><span class="LIDENT">dir</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_with_chdir_131"><span class="LIDENT">with_chdir</span></span> <span id="local_dir_132"><span class="LIDENT">dir</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_dir_132"><span class="LIDENT">dir</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_f_133"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_133"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_dir_134"><span class="LIDENT">dir</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">chdir</span> <a href="#local_dir_134"><span class="LIDENT">dir</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="opamStd.ml.html#module-Exn.val-finally"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Exn</span><span class="DOT">.</span><span class="LIDENT">finally</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">chdir</span> <a href="#local_oldcwd_129"><span class="LIDENT">oldcwd</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_with_chdir_131"><span class="LIDENT">with_chdir</span></a> <a href="#local_dir_118"><span class="LIDENT">dir</span></a> <span class="INFIXOP1">@@</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_395"><span id="local_stdin_fd_135"><span class="LIDENT">stdin_fd</span></span><span class="COMMA">,</span><span id="local_close_stdin_136"><span class="LIDENT">close_stdin</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_allow_stdin_113"><span class="LIDENT">allow_stdin</span></a> <span class="THEN">then</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">stdin</span><span class="COMMA">,</span> <a href="#local_nothing_123"><span class="LIDENT">nothing</span></a> <span class="ELSE">else</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_391"><span id="local_fd_137"><span class="LIDENT">fd</span></span><span class="COMMA">,</span><span id="local_outfd_138"><span class="LIDENT">outfd</span></span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">pipe</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_close_stdin_139"><span class="LIDENT">close_stdin</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">close</span> <a href="#local_fd_137"><span class="LIDENT">fd</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">close</span> <a href="#local_outfd_138"><span class="LIDENT">outfd</span></a><span class="SEMI">;</span> <a href="#local_fd_137"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <a href="#local_close_stdin_139"><span class="LIDENT">close_stdin</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_382"><span id="local_stdout_fd_140"><span class="LIDENT">stdout_fd</span></span><span class="COMMA">,</span> <span id="local_close_stdout_141"><span class="LIDENT">close_stdout</span></span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_stdout_file_114"><span class="LIDENT">stdout_file</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">stdout</span><span class="COMMA">,</span> <a href="#local_nothing_123"><span class="LIDENT">nothing</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_f_142"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_tee_124"><span class="LIDENT">tee</span></a> <a href="#local_f_142"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_376"><span id="local_stderr_fd_143"><span class="LIDENT">stderr_fd</span></span><span class="COMMA">,</span> <span id="local_close_stderr_144"><span class="LIDENT">close_stderr</span></span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_stderr_file_115"><span class="LIDENT">stderr_file</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">stderr</span><span class="COMMA">,</span> <a href="#local_nothing_123"><span class="LIDENT">nothing</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_f_145"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_stdout_file_114"><span class="LIDENT">stdout_file</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="UIDENT">Some</span> <a href="#local_f_145"><span class="LIDENT">f</span></a> <span class="THEN">then</span> <a href="#local_stdout_fd_140"><span class="LIDENT">stdout_fd</span></a><span class="COMMA">,</span> <a href="#local_nothing_123"><span class="LIDENT">nothing</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <a href="#local_tee_124"><span class="LIDENT">tee</span></a> <a href="#local_f_145"><span class="LIDENT">f</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_146"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_env_116"><span class="LIDENT">env</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">default_env</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_147"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_147"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_time_148"><span class="LIDENT">time</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* write the env file before running the command*)</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_env_file_112"><span class="LIDENT">env_file</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_f_149"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_chan_150"><span class="LIDENT">chan</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-open_out"><span class="LIDENT">open_out</span></a> <a href="#local_f_149"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_env_151"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-to_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">to_list</span></a> <a href="#local_env_146"><span class="LIDENT">env</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="COMMENT">(* Remove dubious variables *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_env_152"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_line_153"><span class="LIDENT">line</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamString.val-contains_char"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">contains_char</span></a> <a href="#local_line_153"><span class="LIDENT">line</span></a> <span class="CHAR">'$'</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_env_151"><span class="LIDENT">env</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">output_lines</span> <a href="#local_chan_150"><span class="LIDENT">chan</span></a> <a href="#local_env_152"><span class="LIDENT">env</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_out"><span class="LIDENT">close_out</span></a> <a href="#local_chan_150"><span class="LIDENT">chan</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* write the info file *)</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_info_file_111"><span class="LIDENT">info_file</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span>   <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_f_154"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_chan_155"><span class="LIDENT">chan</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-open_out"><span class="LIDENT">open_out</span></a> <a href="#local_f_154"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_info_156"><span class="LIDENT">info</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LIDENT">make_info</span> <span class="TILDE">~</span><a href="#local_cmd_121"><span class="LIDENT">cmd</span></a> <span class="TILDE">~</span><a href="#local_args_122"><span class="LIDENT">args</span></a> <span class="TILDE">~</span><a href="#local_cwd_130"><span class="LIDENT">cwd</span></a> <span class="TILDE">~</span><a href="#local_env_file_112"><span class="LIDENT">env_file</span></a> <span class="TILDE">~</span><a href="#local_stdout_file_114"><span class="LIDENT">stdout_file</span></a> <span class="TILDE">~</span><a href="#local_stderr_file_115"><span class="LIDENT">stderr_file</span></a> <span class="TILDE">~</span><a href="#local_metadata_117"><span class="LIDENT">metadata</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-output_string"><span class="LIDENT">output_string</span></a> <a href="#local_chan_155"><span class="LIDENT">chan</span></a> <span class="LPAREN">(</span><span class="LIDENT">string_of_info</span> <a href="#local_info_156"><span class="LIDENT">info</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_out"><span class="LIDENT">close_out</span></a> <a href="#local_chan_155"><span class="LIDENT">chan</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_pid_157"><span class="LIDENT">pid</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_404"><span id="local_cmd_158"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span> <span id="local_args_159"><span class="LIDENT">args</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a> <span class="THEN">then</span><span class="EOL">
</span>        <span class="TRY">try</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_actual_command_160"><span class="LIDENT">actual_command</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-file_exists"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">file_exists</span></a> <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a> <span class="THEN">then</span><span class="EOL">
</span>              <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>            <span class="ELSE">else</span> <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-file_exists"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">file_exists</span></a> <span class="LPAREN">(</span><a href="#local_cmd_121"><span class="LIDENT">cmd</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;.exe&quot;</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>              <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;.exe&quot;</span><span class="EOL">
</span>            <span class="ELSE">else</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Exit</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_390"><span id="local_actual_image_161"><span class="LIDENT">actual_image</span></span><span class="COMMA">,</span> <span id="local_args_162"><span class="LIDENT">args</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_c_163"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-open_in"><span class="LIDENT">open_in</span></a> <a href="#local_actual_command_160"><span class="LIDENT">actual_command</span></a> <span class="IN">in</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-set_binary_mode_in"><span class="LIDENT">set_binary_mode_in</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>            <span class="TRY">try</span><span class="EOL">
</span>              <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-really_input_string"><span class="LIDENT">really_input_string</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a> <span class="INT">2</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="STRING">&quot;#!&quot;</span> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <span class="COMMENT">(* The input_line will only fail for a 2-byte file consisting of exactly #! (with no \n), which is acceptable! *)</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_l_164"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-trim"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">trim</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-input_line"><span class="LIDENT">input_line</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="def_417"><span id="local_cmd_165"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span> <span id="local_arg_166"><span class="LIDENT">arg</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>                  <span class="TRY">try</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_i_167"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-index"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">index</span></a> <a href="#local_l_164"><span class="LIDENT">l</span></a> <span class="CHAR">' '</span> <span class="IN">in</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_cmd_168"><span class="LIDENT">cmd</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/filename.ml.html#module-Sysdeps"><span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">basename</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-trim"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">trim</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-sub"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">sub</span></a> <a href="#local_l_164"><span class="LIDENT">l</span></a> <span class="INT">0</span> <a href="#local_i_167"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_arg_169"><span class="LIDENT">arg</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-trim"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">trim</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-sub"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">sub</span></a> <a href="#local_l_164"><span class="LIDENT">l</span></a> <a href="#local_i_167"><span class="LIDENT">i</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_l_164"><span class="LIDENT">l</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_167"><span class="LIDENT">i</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                    <span class="IF">if</span> <a href="#local_cmd_168"><span class="LIDENT">cmd</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="STRING">&quot;env&quot;</span> <span class="THEN">then</span><span class="EOL">
</span>                      <a href="#local_arg_169"><span class="LIDENT">arg</span></a><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="EOL">
</span>                    <span class="ELSE">else</span><span class="EOL">
</span>                      <a href="#local_cmd_168"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <span class="UIDENT">Some</span> <a href="#local_arg_169"><span class="LIDENT">arg</span></a><span class="EOL">
</span>                  <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                    <a href="../../../ocaml-base-compiler/src/stdlib/filename.ml.html#module-Sysdeps"><span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">basename</span></a> <a href="#local_l_164"><span class="LIDENT">l</span></a><span class="COMMA">,</span> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>                <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_in"><span class="LIDENT">close_in</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <span class="TRY">try</span><span class="EOL">
</span>                  <span class="LET">let</span> <span id="local_cmd_170"><span class="LIDENT">cmd</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <a href="#local_cmd_165"><span class="LIDENT">cmd</span></a> <span class="LPAREN">(</span><span class="LIDENT">resolve_command</span> <a href="#local_cmd_165"><span class="LIDENT">cmd</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                  <span class="COMMENT">(*Printf.eprintf &quot;Deduced %s =&gt; %s to be executed via %s\n%!&quot; cmd actual_command cmd;*)</span><span class="EOL">
</span>                  <span class="LET">let</span> <span id="local_args_171"><span class="LIDENT">args</span></span> <span class="EQUAL">=</span> <a href="#local_actual_command_160"><span class="LIDENT">actual_command</span></a><span class="COLONCOLON">::</span><a href="#local_args_122"><span class="LIDENT">args</span></a> <span class="IN">in</span><span class="EOL">
</span>                  <a href="#local_cmd_170"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <a href="opamStd.ml.html#module-Option.val-map_default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map_default</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_arg_172"><span class="LIDENT">arg</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_arg_172"><span class="LIDENT">arg</span></a><span class="COLONCOLON">::</span><a href="#local_args_171"><span class="LIDENT">args</span></a><span class="RPAREN">)</span> <a href="#local_args_171"><span class="LIDENT">args</span></a> <a href="#local_arg_166"><span class="LIDENT">arg</span></a><span class="EOL">
</span>                <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                  <span class="COMMENT">(* Script interpreter isn't available - fall back *)</span><span class="EOL">
</span>                  <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Exit</span><span class="EOL">
</span>              <span class="END">end</span> <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>                <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_in"><span class="LIDENT">close_in</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>                <a href="#local_actual_command_160"><span class="LIDENT">actual_command</span></a><span class="COMMA">,</span> <a href="#local_args_122"><span class="LIDENT">args</span></a><span class="EOL">
</span>              <span class="END">end</span><span class="EOL">
</span>            <span class="WITH">with</span> <span class="UIDENT">End_of_file</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_in"><span class="LIDENT">close_in</span></a> <a href="#local_c_163"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>              <span class="COMMENT">(* A two-byte image can't be executable! *)</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Exit</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="COMMENT">(*Printf.eprintf &quot;Final deduction: %s -&gt; %s\n%!&quot; cmd actual_image;*)</span><span class="EOL">
</span>          <a href="#local_actual_image_161"><span class="LIDENT">actual_image</span></a><span class="COMMA">,</span> <a href="#local_args_162"><span class="LIDENT">args</span></a><span class="EOL">
</span>        <span class="WITH">with</span> <span class="UIDENT">Exit</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* Fall back to default behaviour if anything went wrong - almost certainly means a broken package *)</span><span class="EOL">
</span>          <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <a href="#local_args_122"><span class="LIDENT">args</span></a><span class="EOL">
</span>      <span class="ELSE">else</span><span class="EOL">
</span>        <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <a href="#local_args_122"><span class="LIDENT">args</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="TRY">try</span><span class="EOL">
</span>      <span class="LIDENT">create_process_env</span><span class="EOL">
</span>        <a href="#local_cmd_158"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-of_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">of_list</span></a> <span class="LPAREN">(</span><a href="#local_cmd_158"><span class="LIDENT">cmd</span></a> <span class="COLONCOLON">::</span> <a href="#local_args_159"><span class="LIDENT">args</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="#local_env_146"><span class="LIDENT">env</span></a><span class="EOL">
</span>        <a href="#local_stdin_fd_135"><span class="LIDENT">stdin_fd</span></a> <a href="#local_stdout_fd_140"><span class="LIDENT">stdout_fd</span></a> <a href="#local_stderr_fd_143"><span class="LIDENT">stderr_fd</span></a><span class="EOL">
</span>    <span class="WITH">with</span> <span id="local_e_173"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#local_close_stdin_136"><span class="LIDENT">close_stdin</span></a>  <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_close_stdout_141"><span class="LIDENT">close_stdout</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_close_stderr_144"><span class="LIDENT">close_stderr</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_173"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_close_stdin_136"><span class="LIDENT">close_stdin</span></a>  <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_close_stdout_141"><span class="LIDENT">close_stdout</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_close_stderr_144"><span class="LIDENT">close_stderr</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LBRACE">{</span><span class="EOL">
</span>    <span class="LIDENT">p_name</span>   <span class="EQUAL">=</span> <a href="#local_cmd_121"><span class="LIDENT">cmd</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_args</span>   <span class="EQUAL">=</span> <a href="#local_args_122"><span class="LIDENT">args</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_pid</span>    <span class="EQUAL">=</span> <a href="#local_pid_157"><span class="LIDENT">pid</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_cwd</span>    <span class="EQUAL">=</span> <a href="#local_cwd_130"><span class="LIDENT">cwd</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_time</span>   <span class="EQUAL">=</span> <a href="#local_time_148"><span class="LIDENT">time</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_stdout</span> <span class="EQUAL">=</span> <a href="#local_stdout_file_114"><span class="LIDENT">stdout_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_stderr</span> <span class="EQUAL">=</span> <a href="#local_stderr_file_115"><span class="LIDENT">stderr_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_env</span>    <span class="EQUAL">=</span> <a href="#local_env_file_112"><span class="LIDENT">env_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_info</span>   <span class="EQUAL">=</span> <a href="#local_info_file_111"><span class="LIDENT">info_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_metadata</span> <span class="EQUAL">=</span> <a href="#local_metadata_117"><span class="LIDENT">metadata</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_verbose</span> <span class="EQUAL">=</span> <a href="#local_verbose_119"><span class="LIDENT">verbose</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">p_tmp_files</span> <span class="EQUAL">=</span> <a href="#local_tmp_files_120"><span class="LIDENT">tmp_files</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-result"><span class="TYPE">type</span> <span class="LIDENT">result</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_409"><span class="LIDENT">r_code</span>     <span class="COLON">:</span> <span class="LIDENT">int</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_419"><span class="LIDENT">r_signal</span>   <span class="COLON">:</span> <span class="LIDENT">int</span> <span class="LIDENT">option</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_402"><span class="LIDENT">r_duration</span> <span class="COLON">:</span> <span class="LIDENT">float</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_387"><span class="LIDENT">r_info</span>     <span class="COLON">:</span> <span class="LPAREN">(</span><span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">string</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_416"><span class="LIDENT">r_stdout</span>   <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_406"><span class="LIDENT">r_stderr</span>   <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span id="def_381"><span class="LIDENT">r_cleanup</span>  <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="LIDENT">list</span><span class="SEMI">;</span></span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-empty_result"><span class="LIDENT">empty_result</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span class="LIDENT">r_code</span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_signal</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_duration</span> <span class="EQUAL">=</span> <span class="FLOAT">0.</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_info</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_stdout</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_stderr</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">r_cleanup</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span><span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* XXX: the function might block for ever for some channels kinds *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-read_lines"><span class="LIDENT">read_lines</span></span> <span id="local_f_174"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ic_175"><span class="LIDENT">ic</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-open_in"><span class="LIDENT">open_in</span></a> <a href="#local_f_174"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_lines_176"><span class="LIDENT">lines</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="TRY">try</span><span class="EOL">
</span>        <span class="WHILE">while</span> <span class="TRUE">true</span> <span class="DO">do</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_line_177"><span class="LIDENT">line</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-input_line"><span class="LIDENT">input_line</span></a> <a href="#local_ic_175"><span class="LIDENT">ic</span></a> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_lines_176"><span class="LIDENT">lines</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_line_177"><span class="LIDENT">line</span></a> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_lines_176"><span class="LIDENT">lines</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="DONE">done</span><span class="EOL">
</span>      <span class="WITH">with</span> <span class="UIDENT">End_of_file</span> <span class="BAR">|</span> <span class="UIDENT">Sys_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_in"><span class="LIDENT">close_in</span></a> <a href="#local_ic_175"><span class="LIDENT">ic</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_lines_176"><span class="LIDENT">lines</span></a><span class="EOL">
</span>  <span class="WITH">with</span> <span class="UIDENT">Sys_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Compat function (Windows) *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-interrupt"><span class="LIDENT">interrupt</span></span> <span id="local_p_178"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a> <span class="THEN">then</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">kill</span> <a href="#local_p_178"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigkill"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">sigkill</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">kill</span> <a href="#local_p_178"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigint"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">sigint</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-run_background"><span class="LIDENT">run_background</span></span> <span id="local_command_179"><span class="LIDENT">command</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_374"><span class="LBRACE">{</span> <span id="local_cmd_180"><span class="LIDENT">cmd</span></span><span class="SEMI">;</span> <span id="local_args_181"><span class="LIDENT">args</span></span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">cmd_env</span><span class="EQUAL">=</span><span id="local_env_183"><span class="LIDENT">env</span></span><span class="SEMI">;</span> <span class="LIDENT">cmd_verbose</span><span class="EQUAL">=</span><span class="UNDERSCORE">_</span><span class="SEMI">;</span> <span class="LIDENT">cmd_name</span><span class="EQUAL">=</span><span id="local_name_186"><span class="LIDENT">name</span></span><span class="SEMI">;</span> <span class="LIDENT">cmd_text</span><span class="EQUAL">=</span><span class="UNDERSCORE">_</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">cmd_metadata</span><span class="EQUAL">=</span><span id="local_metadata_187"><span class="LIDENT">metadata</span></span><span class="SEMI">;</span> <span class="LIDENT">cmd_dir</span><span class="EQUAL">=</span><span id="local_dir_182"><span class="LIDENT">dir</span></span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">cmd_stdin</span><span class="EQUAL">=</span><span id="local_allow_stdin_184"><span class="LIDENT">allow_stdin</span></span><span class="SEMI">;</span> <span id="local_cmd_stdout_185"><span class="LIDENT">cmd_stdout</span></span> <span class="RBRACE">}</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_command_179"><span class="LIDENT">command</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_verbose_188"><span class="LIDENT">verbose</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_verbose_command</span> <a href="#local_command_179"><span class="LIDENT">command</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_allow_stdin_189"><span class="LIDENT">allow_stdin</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="FALSE">false</span> <a href="#local_allow_stdin_184"><span class="LIDENT">allow_stdin</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_190"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_env_183"><span class="LIDENT">env</span></a> <span class="WITH">with</span> <span class="UIDENT">Some</span> <span id="local_e_191"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_e_191"><span class="LIDENT">e</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">default_env</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_file_192"><span class="LIDENT">file</span></span> <span id="local_ext_193"><span class="LIDENT">ext</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_name_186"><span class="LIDENT">name</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_n_194"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_d_195"><span class="LIDENT">d</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/filename.ml.html#module-Sysdeps"><span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">is_relative</span></a> <a href="#local_n_194"><span class="LIDENT">n</span></a> <span class="THEN">then</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_dir_182"><span class="LIDENT">dir</span></a> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_d_196"><span class="LIDENT">d</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_d_196"><span class="LIDENT">d</span></a><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">log_dir</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/filename.ml.html#val-concat"><span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <a href="#local_d_195"><span class="LIDENT">d</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;%s.%s&quot;</span> <a href="#local_n_194"><span class="LIDENT">n</span></a> <a href="#local_ext_193"><span class="LIDENT">ext</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_394"><span id="local_stdout_file_197"><span class="LIDENT">stdout_file</span></span><span class="COMMA">,</span> <span id="local_stderr_file_198"><span class="LIDENT">stderr_file</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_err_199"><span class="LIDENT">err</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_file_192"><span class="LIDENT">file</span></a> <span class="STRING">&quot;err&quot;</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_cmd_stdout_185"><span class="LIDENT">cmd_stdout</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_out_200"><span class="LIDENT">out</span></span> <span class="EQUAL">=</span> <a href="#local_file_192"><span class="LIDENT">file</span></a> <span class="STRING">&quot;out&quot;</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">merged_output</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="#local_out_200"><span class="LIDENT">out</span></a><span class="COMMA">,</span> <a href="#local_out_200"><span class="LIDENT">out</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="ELSE">else</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="#local_out_200"><span class="LIDENT">out</span></a><span class="COMMA">,</span> <a href="#local_err_199"><span class="LIDENT">err</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_out_201"><span class="LIDENT">out</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_out_201"><span class="LIDENT">out</span></a><span class="COMMA">,</span> <a href="#local_err_199"><span class="LIDENT">err</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_file_202"><span class="LIDENT">env_file</span></span>    <span class="EQUAL">=</span> <a href="#local_file_192"><span class="LIDENT">file</span></a> <span class="STRING">&quot;env&quot;</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_info_file_203"><span class="LIDENT">info_file</span></span>   <span class="EQUAL">=</span> <a href="#local_file_192"><span class="LIDENT">file</span></a> <span class="STRING">&quot;info&quot;</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_tmp_files_204"><span class="LIDENT">tmp_files</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="opamStd.ml.html#module-OpamList.val-filter_some"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter_some</span></a> <span class="LBRACKET">[</span><span class="EOL">
</span>      <a href="#local_info_file_203"><span class="LIDENT">info_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_env_file_202"><span class="LIDENT">env_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_stderr_file_198"><span class="LIDENT">stderr_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_cmd_stdout_185"><span class="LIDENT">cmd_stdout</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="UIDENT">None</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_stderr_file_198"><span class="LIDENT">stderr_file</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_stdout_file_197"><span class="LIDENT">stdout_file</span></a> <span class="THEN">then</span> <span class="UIDENT">None</span><span class="EOL">
</span>      <span class="ELSE">else</span> <a href="#local_stdout_file_197"><span class="LIDENT">stdout_file</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_env_190"><span class="LIDENT">env</span></a> <span class="QUESTION">?</span><a href="#local_info_file_203"><span class="LIDENT">info_file</span></a> <span class="QUESTION">?</span><a href="#local_env_file_202"><span class="LIDENT">env_file</span></a> <span class="QUESTION">?</span><a href="#local_stdout_file_197"><span class="LIDENT">stdout_file</span></a> <span class="QUESTION">?</span><a href="#local_stderr_file_198"><span class="LIDENT">stderr_file</span></a> <span class="TILDE">~</span><a href="#local_verbose_188"><span class="LIDENT">verbose</span></a> <span class="QUESTION">?</span><a href="#local_metadata_187"><span class="LIDENT">metadata</span></a><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_allow_stdin_189"><span class="LIDENT">allow_stdin</span></a> <span class="QUESTION">?</span><a href="#local_dir_182"><span class="LIDENT">dir</span></a> <span class="TILDE">~</span><a href="#local_tmp_files_204"><span class="LIDENT">tmp_files</span></a> <a href="#local_cmd_180"><span class="LIDENT">cmd</span></a> <a href="#local_args_181"><span class="LIDENT">args</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-dry_run_background"><span class="LIDENT">dry_run_background</span></span> <span id="local_c_205"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span class="LIDENT">p_name</span>   <span class="EQUAL">=</span> <a href="#local_c_205"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_args</span>   <span class="EQUAL">=</span> <a href="#local_c_205"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">args</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_pid</span>    <span class="EQUAL">=</span> <span class="MINUS">-</span><span class="INT">1</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_cwd</span>    <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-getcwd"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">getcwd</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_c_205"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd_dir</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_time</span>   <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_stdout</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_stderr</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_env</span>    <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_info</span>   <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_metadata</span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="#local_c_205"><span class="LIDENT">c</span></a><span class="DOT">.</span><span class="LIDENT">cmd_metadata</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_verbose</span> <span class="EQUAL">=</span> <span class="LIDENT">is_verbose_command</span> <a href="#local_c_205"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">p_tmp_files</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span><span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-verbose_print_cmd"><span class="LIDENT">verbose_print_cmd</span></span> <span id="local_p_206"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="opamConsole.ml.html#val-msg"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">msg</span></a> <span class="STRING">&quot;%s %s %s%s\n&quot;</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <span class="BACKQUOTE">`</span><span class="LIDENT">yellow</span> <span class="STRING">&quot;+&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <a href="#local_p_206"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_name</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamList.val-concat_map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">concat_map</span></a> <span class="STRING">&quot; &quot;</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;%S&quot;</span><span class="RPAREN">)</span> <a href="#local_p_206"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_args</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_p_206"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_cwd</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-getcwd"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">getcwd</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>     <span class="ELSE">else</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot; (CWD=%s)&quot;</span> <a href="#local_p_206"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_cwd</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-verbose_print_out"><span class="LIDENT">verbose_print_out</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_pfx_207"><span class="LIDENT">pfx</span></span> <span class="EQUAL">=</span> <span class="LAZY">lazy</span> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <span class="BACKQUOTE">`</span><span class="LIDENT">yellow</span> <span class="STRING">&quot;- &quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_s_208"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="opamConsole.ml.html#val-msg"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">msg</span></a> <span class="STRING">&quot;%s%s\n&quot;</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#val-force"><span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">force</span></a> <a href="#local_pfx_207"><span class="LIDENT">pfx</span></a><span class="RPAREN">)</span> <a href="#local_s_208"><span class="LIDENT">s</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Semi-synchronous printing of the output of a command *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="def_378"><span id="val-set_verbose_f"><span class="LIDENT">set_verbose_f</span></span><span class="COMMA">,</span> <span id="val-print_verbose_f"><span class="LIDENT">print_verbose_f</span></span><span class="COMMA">,</span> <span id="val-isset_verbose_f"><span class="LIDENT">isset_verbose_f</span></span><span class="COMMA">,</span> <span id="val-stop_verbose_f"><span class="LIDENT">stop_verbose_f</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_verbose_f_209"><span class="LIDENT">verbose_f</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_stop_210"><span class="LIDENT">stop</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_verbose_f_209"><span class="LIDENT">verbose_f</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_ics_211"><span class="LIDENT">ics</span></span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-close_in_noerr"><span class="LIDENT">close_in_noerr</span></a> <a href="#local_ics_211"><span class="LIDENT">ics</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_verbose_f_209"><span class="LIDENT">verbose_f</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_set_212"><span class="LIDENT">set</span></span> <span id="local_files_213"><span class="LIDENT">files</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_stop_210"><span class="LIDENT">stop</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* implem relies on sigalrm, not implemented on win32.
       This will fall back to buffered output. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="ELSE">else</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_files_214"><span class="LIDENT">files</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamList.val-sort_nodup"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">sort_nodup</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-compare"><span class="LIDENT">compare</span></a> <a href="#local_files_213"><span class="LIDENT">files</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ics_215"><span class="LIDENT">ics</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-open_in_gen"><span class="LIDENT">open_in_gen</span></a> <span class="LBRACKET">[</span><span class="UIDENT">Open_nonblock</span><span class="SEMI">;</span><span class="UIDENT">Open_rdonly</span><span class="SEMI">;</span><span class="UIDENT">Open_text</span><span class="SEMI">;</span><span class="UIDENT">Open_creat</span><span class="RBRACKET">]</span> <span class="INT">0o600</span><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="#local_files_214"><span class="LIDENT">files</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_f_216"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_ic_217"><span class="LIDENT">ic</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="TRY">try</span> <span class="WHILE">while</span> <span class="TRUE">true</span> <span class="DO">do</span> <span class="LIDENT">verbose_print_out</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-input_line"><span class="LIDENT">input_line</span></a> <a href="#local_ic_217"><span class="LIDENT">ic</span></a><span class="RPAREN">)</span> <span class="DONE">done</span><span class="EOL">
</span>          <span class="WITH">with</span> <span class="UIDENT">End_of_file</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-flush"><span class="LIDENT">flush</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-stdout"><span class="LIDENT">stdout</span></a><span class="EOL">
</span>        <span class="RPAREN">)</span> <a href="#local_ics_215"><span class="LIDENT">ics</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_verbose_f_209"><span class="LIDENT">verbose_f</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_ics_215"><span class="LIDENT">ics</span></a><span class="COMMA">,</span> <a href="#local_f_216"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_print_218"><span class="LIDENT">print</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_verbose_f_209"><span class="LIDENT">verbose_f</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_f_219"><span class="LIDENT">f</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_219"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_isset_220"><span class="LIDENT">isset</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_verbose_f_209"><span class="LIDENT">verbose_f</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_flush_and_stop_221"><span class="LIDENT">flush_and_stop</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_print_218"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="#local_stop_210"><span class="LIDENT">stop</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_set_212"><span class="LIDENT">set</span></a><span class="COMMA">,</span> <a href="#local_print_218"><span class="LIDENT">print</span></a><span class="COMMA">,</span> <a href="#local_isset_220"><span class="LIDENT">isset</span></a><span class="COMMA">,</span> <a href="#local_flush_and_stop_221"><span class="LIDENT">flush_and_stop</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-set_verbose_process"><span class="LIDENT">set_verbose_process</span></span> <span id="local_p_222"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_p_222"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_verbose</span> <span class="THEN">then</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fs_223"><span class="LIDENT">fs</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamList.val-filter_some"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter_some</span></a> <span class="LBRACKET">[</span><a href="#local_p_222"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stdout</span><span class="SEMI">;</span><a href="#local_p_222"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stderr</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_fs_223"><span class="LIDENT">fs</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LIDENT">verbose_print_cmd</span> <a href="#local_p_222"><span class="LIDENT">p</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">set_verbose_f</span> <a href="#local_fs_223"><span class="LIDENT">fs</span></a><span class="EOL">
</span>    <span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-exit_status"><span class="LIDENT">exit_status</span></span> <span id="local_p_224"><span class="LIDENT">p</span></span> <span id="local_return_225"><span class="LIDENT">return</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_duration_226"><span class="LIDENT">duration</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-.)"><span class="MINUSDOT">-.</span></a> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_time</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_stdout_227"><span class="LIDENT">stdout</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-Option.val-map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LIDENT">read_lines</span> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stdout</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_stderr_228"><span class="LIDENT">stderr</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-Option.val-map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LIDENT">read_lines</span> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stderr</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_cleanup_229"><span class="LIDENT">cleanup</span></span> <span class="EQUAL">=</span> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_tmp_files</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_398"><span id="local_code_230"><span class="LIDENT">code</span></span><span class="COMMA">,</span><span id="local_signal_231"><span class="LIDENT">signal</span></span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_return_225"><span class="LIDENT">return</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WEXITED</span> <span id="local_r_232"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_r_232"><span class="LIDENT">r</span></a><span class="COMMA">,</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WSIGNALED</span> <span id="local_s_233"><span class="LIDENT">s</span></span> <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WSTOPPED</span> <span id="local_s_234"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <a href="#local_s_234"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">isset_verbose_f</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>    <span class="LIDENT">stop_verbose_f</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_verbose</span> <span class="THEN">then</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">verbose_print_out</span> <a href="#local_stdout_227"><span class="LIDENT">stdout</span></a><span class="SEMI">;</span><span class="EOL">
</span>     <span class="IF">if</span> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stdout</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stderr</span> <span class="THEN">then</span><span class="EOL">
</span>     <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">verbose_print_out</span> <a href="#local_stderr_228"><span class="LIDENT">stderr</span></a><span class="SEMI">;</span><span class="EOL">
</span>     <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-flush"><span class="LIDENT">flush</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-stdout"><span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="LIDENT">stdout</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_info_235"><span class="LIDENT">info</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">make_info</span> <span class="QUESTION">?</span><a href="#local_code_230"><span class="LIDENT">code</span></a> <span class="QUESTION">?</span><a href="#local_signal_231"><span class="LIDENT">signal</span></a><span class="EOL">
</span>      <span class="LABEL">~cmd:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_name</span> <span class="LABEL">~args:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_args</span> <span class="LABEL">~cwd:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_cwd</span> <span class="LABEL">~metadata:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_metadata</span><span class="EOL">
</span>      <span class="LABEL">~env_file:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_env</span> <span class="LABEL">~stdout_file:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stdout</span> <span class="LABEL">~stderr_file:</span><a href="#local_p_224"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_stderr</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LBRACE">{</span><span class="EOL">
</span>    <span class="LIDENT">r_code</span>     <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.val-default"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">default</span></a> <span class="INT">256</span> <a href="#local_code_230"><span class="LIDENT">code</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_signal</span>   <span class="EQUAL">=</span> <a href="#local_signal_231"><span class="LIDENT">signal</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_duration</span> <span class="EQUAL">=</span> <a href="#local_duration_226"><span class="LIDENT">duration</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_info</span>     <span class="EQUAL">=</span> <a href="#local_info_235"><span class="LIDENT">info</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_stdout</span>   <span class="EQUAL">=</span> <a href="#local_stdout_227"><span class="LIDENT">stdout</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_stderr</span>   <span class="EQUAL">=</span> <a href="#local_stderr_228"><span class="LIDENT">stderr</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">r_cleanup</span>  <span class="EQUAL">=</span> <a href="#local_cleanup_229"><span class="LIDENT">cleanup</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-safe_wait"><span class="LIDENT">safe_wait</span></span> <span id="local_fallback_pid_236"><span class="LIDENT">fallback_pid</span></span> <span id="local_f_237"><span class="LIDENT">f</span></span> <span id="local_x_238"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_sh_239"><span class="LIDENT">sh</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="LIDENT">isset_verbose_f</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_hndl_240"><span class="LIDENT">hndl</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LIDENT">print_verbose_f</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-signal"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">signal</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigalrm"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">sigalrm</span></a> <span class="LPAREN">(</span><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="UIDENT">Signal_handle</span> <a href="#local_hndl_240"><span class="LIDENT">hndl</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_cleanup_241"><span class="LIDENT">cleanup</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_sh_239"><span class="LIDENT">sh</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_sh_242"><span class="LIDENT">sh</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">alarm</span> <span class="INT">0</span><span class="RPAREN">)</span><span class="SEMI">;</span> <span class="COMMENT">(* cancels the alarm *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-set_signal"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">set_signal</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-sigalrm"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">sigalrm</span></a> <a href="#local_sh_242"><span class="LIDENT">sh</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_243"><span class="LIDENT">aux</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_sh_239"><span class="LIDENT">sh</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="UIDENT">None</span> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">alarm</span> <span class="INT">1</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="MATCH">match</span><span class="EOL">
</span>      <span class="TRY">try</span> <a href="#local_f_237"><span class="LIDENT">f</span></a> <a href="#local_x_238"><span class="LIDENT">x</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">EINTR</span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_aux_243"><span class="LIDENT">aux</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="COMMENT">(* handled signal *)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">ECHILD</span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LIDENT">log</span> <span class="STRING">&quot;Warn: no child to wait for %d&quot;</span> <a href="#local_fallback_pid_236"><span class="LIDENT">fallback_pid</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_fallback_pid_236"><span class="LIDENT">fallback_pid</span></a><span class="COMMA">,</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WEXITED</span> <span class="INT">256</span><span class="EOL">
</span>      <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WSTOPPED</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* shouldn't happen as we don't use WUNTRACED *)</span><span class="EOL">
</span>        <a href="#local_aux_243"><span class="LIDENT">aux</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_r_244"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_r_244"><span class="LIDENT">r</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="LET">let</span> <span id="local_r_245"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <a href="#local_aux_243"><span class="LIDENT">aux</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span> <a href="#local_cleanup_241"><span class="LIDENT">cleanup</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="#local_r_245"><span class="LIDENT">r</span></a><span class="EOL">
</span>  <span class="WITH">with</span> <span id="local_e_246"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cleanup_241"><span class="LIDENT">cleanup</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_246"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-wait"><span class="LIDENT">wait</span></span> <span id="local_p_247"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">set_verbose_process</span> <a href="#local_p_247"><span class="LIDENT">p</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_383"><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_return_248"><span class="LIDENT">return</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">safe_wait</span> <a href="#local_p_247"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">waitpid</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <a href="#local_p_247"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">exit_status</span> <a href="#local_p_247"><span class="LIDENT">p</span></a> <a href="#local_return_248"><span class="LIDENT">return</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-dontwait"><span class="LIDENT">dontwait</span></span> <span id="local_p_249"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">safe_wait</span> <a href="#local_p_249"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">waitpid</span> <span class="LBRACKET">[</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">WNOHANG</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <a href="#local_p_249"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="INT">0</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_return_250"><span class="LIDENT">return</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">exit_status</span> <a href="#local_p_249"><span class="LIDENT">p</span></a> <a href="#local_return_250"><span class="LIDENT">return</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-dead_childs"><span class="LIDENT">dead_childs</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-create"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">13</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-wait_one"><span class="LIDENT">wait_one</span></span> <span id="local_processes_251"><span class="LIDENT">processes</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_processes_251"><span class="LIDENT">processes</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Invalid_argument</span> <span class="STRING">&quot;wait_one&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_389"><span id="local_p_252"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span id="local_return_253"><span class="LIDENT">return</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="TRY">try</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_p_254"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-find"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_p_255"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-mem"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">mem</span></a> <span class="LIDENT">dead_childs</span> <a href="#local_p_255"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span><span class="RPAREN">)</span> <a href="#local_processes_251"><span class="LIDENT">processes</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_return_256"><span class="LIDENT">return</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-find"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <span class="LIDENT">dead_childs</span> <a href="#local_p_254"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-remove"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">remove</span></a> <span class="LIDENT">dead_childs</span> <a href="#local_p_254"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_p_254"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="#local_return_256"><span class="LIDENT">return</span></a><span class="EOL">
</span>    <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_257"><span class="LIDENT">aux</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="def_397"><span id="local_pid_258"><span class="LIDENT">pid</span></span><span class="COMMA">,</span> <span id="local_return_259"><span class="LIDENT">return</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <span class="COMMENT">(* No Unix.wait on Windows, so use a stub wrapping
               WaitForMultipleObjects *)</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="def_375"><span id="local_pids_260"><span class="LIDENT">pids</span></span><span class="COMMA">,</span> <span id="local_len_261"><span class="LIDENT">len</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_f_262"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_l_263"><span class="LIDENT">l</span></span><span class="COMMA">,</span> <span id="local_n_264"><span class="LIDENT">n</span></span><span class="RPAREN">)</span> <span id="local_t_265"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="#local_t_265"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span><span class="COLONCOLON">::</span><a href="#local_l_263"><span class="LIDENT">l</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-succ"><span class="LIDENT">succ</span></a> <a href="#local_n_264"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <a href="#local_f_262"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="COMMA">,</span> <span class="INT">0</span><span class="RPAREN">)</span> <a href="#local_processes_251"><span class="LIDENT">processes</span></a><span class="EOL">
</span>            <span class="IN">in</span><span class="EOL">
</span>            <a href="opamStubs.ml.html#val-waitpids"><span class="UIDENT">OpamStubs</span><span class="DOT">.</span><span class="LIDENT">waitpids</span></a> <a href="#local_pids_260"><span class="LIDENT">pids</span></a> <a href="#local_len_261"><span class="LIDENT">len</span></a><span class="EOL">
</span>          <span class="ELSE">else</span><span class="EOL">
</span>            <span class="LIDENT">safe_wait</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-hd"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">hd</span></a> <a href="#local_processes_251"><span class="LIDENT">processes</span></a><span class="RPAREN">)</span><span class="DOT">.</span><span class="LIDENT">p_pid</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">wait</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="TRY">try</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_p_266"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-find"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_p_267"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_p_267"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_pid</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_pid_258"><span class="LIDENT">pid</span></a><span class="RPAREN">)</span> <a href="#local_processes_251"><span class="LIDENT">processes</span></a> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_p_266"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="#local_return_259"><span class="LIDENT">return</span></a><span class="EOL">
</span>        <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/hashtbl.ml.html#val-add"><span class="UIDENT">Hashtbl</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LIDENT">dead_childs</span> <a href="#local_pid_258"><span class="LIDENT">pid</span></a> <a href="#local_return_259"><span class="LIDENT">return</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_aux_257"><span class="LIDENT">aux</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_aux_257"><span class="LIDENT">aux</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_p_252"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_verbose</span> <span class="THEN">then</span> <span class="LIDENT">verbose_print_cmd</span> <a href="#local_p_252"><span class="LIDENT">p</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_p_252"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <span class="LIDENT">exit_status</span> <a href="#local_p_252"><span class="LIDENT">p</span></a> <a href="#local_return_253"><span class="LIDENT">return</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-dry_wait_one"><span class="LIDENT">dry_wait_one</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="LBRACE">{</span><span class="LIDENT">p_pid</span> <span class="EQUAL">=</span> <span class="MINUS">-</span><span class="INT">1</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span><span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_p_268"><span class="LIDENT">p</span></span> <span class="COLONCOLON">::</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_p_268"><span class="LIDENT">p</span></a><span class="DOT">.</span><span class="LIDENT">p_verbose</span> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="LIDENT">verbose_print_cmd</span> <a href="#local_p_268"><span class="LIDENT">p</span></a><span class="SEMI">;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-flush"><span class="LIDENT">flush</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-stdout"><span class="LIDENT">stdout</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_p_268"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <span class="LIDENT">empty_result</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Invalid_argument</span> <span class="STRING">&quot;dry_wait_one&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-run"><span class="LIDENT">run</span></span> <span id="local_command_269"><span class="LIDENT">command</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_command_270"><span class="LIDENT">command</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_command_269"><span class="LIDENT">command</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="LIDENT">cmd_stdin</span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Option.module-Op"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="UIDENT">Op</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_command_269"><span class="LIDENT">command</span></a><span class="DOT">.</span><span class="LIDENT">cmd_stdin</span> <a href="opamStd.ml.html#module-Option.module-Op.val-(++)"><span class="INFIXOP2">++</span></a> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/sys.ml.html#val-win32"><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">win32</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_p_271"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span> <span class="LIDENT">run_background</span> <a href="#local_command_270"><span class="LIDENT">command</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="LIDENT">wait</span> <a href="#local_p_271"><span class="LIDENT">p</span></a> <span class="WITH">with</span> <span id="local_e_272"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LPAREN">(</span><span class="TRY">try</span> <span class="LIDENT">dontwait</span> <a href="#local_p_271"><span class="LIDENT">p</span></a> <span class="WITH">with</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_272"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="COMMENT">(* still running *)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="TRY">try</span> <span class="LIDENT">interrupt</span> <a href="#local_p_271"><span class="LIDENT">p</span></a> <span class="WITH">with</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_272"><span class="LIDENT">e</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_272"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_failure"><span class="LIDENT">is_failure</span></span> <span id="local_r_273"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <a href="#local_r_273"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_code</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="INT">0</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_r_273"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_signal</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_success"><span class="LIDENT">is_success</span></span> <span id="local_r_274"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="LIDENT">is_failure</span> <a href="#local_r_274"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-safe_unlink"><span class="LIDENT">safe_unlink</span></span> <span id="local_f_275"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span><span class="EOL">
</span>    <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;safe_unlink: %s&quot;</span> <a href="#local_f_275"><span class="LIDENT">f</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">unlink</span> <a href="#local_f_275"><span class="LIDENT">f</span></a><span class="EOL">
</span>  <span class="WITH">with</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">log</span> <span class="LABEL">~level:</span><span class="INT">2</span> <span class="STRING">&quot;safe_unlink: %s (FAILED)&quot;</span> <a href="#local_f_275"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cleanup"><span class="LIDENT">cleanup</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_force_276"><span class="LIDENT">force</span></span><span class="EQUAL">=</span><span class="FALSE">false</span><span class="RPAREN">)</span> <span id="local_r_277"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_force_276"><span class="LIDENT">force</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-debug"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">debug</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LIDENT">is_success</span> <a href="#local_r_277"><span class="LIDENT">r</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">safe_unlink</span> <a href="#local_r_277"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_cleanup</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-check_success_and_cleanup"><span class="LIDENT">check_success_and_cleanup</span></span> <span id="local_r_278"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LIDENT">safe_unlink</span> <a href="#local_r_278"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_cleanup</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">is_success</span> <a href="#local_r_278"><span class="LIDENT">r</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-log_line_limit"><span class="LIDENT">log_line_limit</span></span> <span class="EQUAL">=</span> <span class="INT">5</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(*)"><span class="STAR">*</span></a> <span class="INT">80</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-truncate_str"><span class="LIDENT">truncate_str</span></span> <span class="EQUAL">=</span> <span class="STRING">&quot;[...]&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Truncate long lines *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-truncate_line"><span class="LIDENT">truncate_line</span></span> <span id="local_str_279"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_str_279"><span class="LIDENT">str</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <span class="LIDENT">log_line_limit</span> <span class="THEN">then</span><span class="EOL">
</span>    <a href="#local_str_279"><span class="LIDENT">str</span></a><span class="EOL">
</span>  <span class="ELSE">else</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-sub"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">sub</span></a> <a href="#local_str_279"><span class="LIDENT">str</span></a> <span class="INT">0</span> <span class="LPAREN">(</span><span class="LIDENT">log_line_limit</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <span class="LIDENT">truncate_str</span><span class="RPAREN">)</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LIDENT">truncate_str</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Take the last [n] elements of [l] (trying to keep an unindented header line
   for context, like diff) *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-truncate"><span class="LIDENT">truncate</span></span> <span id="local_l_280"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unindented_281"><span class="LIDENT">unindented</span></span> <span id="local_s_282"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-length"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_s_282"><span class="LIDENT">s</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_s_282"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="CHAR">' '</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_s_282"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="CHAR">'\t'</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_cut_283"><span class="LIDENT">cut</span></span> <span id="local_n_284"><span class="LIDENT">n</span></span> <span id="local_acc_285"><span class="LIDENT">acc</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span id="local_x_286"><span class="LIDENT">x</span></span><span class="RBRACKET">]</span> <span class="WHEN">when</span> <a href="#local_n_284"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">truncate_line</span> <a href="#local_x_286"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="WHEN">when</span> <a href="#local_n_284"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">truncate_str</span> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_x_287"><span class="LIDENT">x</span></span><span class="COLONCOLON">::</span><span id="local_l_288"><span class="LIDENT">l</span></span> <span class="WHEN">when</span> <a href="#local_n_284"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">1</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_unindented_281"><span class="LIDENT">unindented</span></a> <a href="#local_x_287"><span class="LIDENT">x</span></a> <span class="THEN">then</span> <span class="LIDENT">truncate_str</span> <span class="COLONCOLON">::</span> <span class="LIDENT">truncate_line</span> <a href="#local_x_287"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a> <span class="ELSE">else</span><span class="EOL">
</span>       <span class="TRY">try</span> <span class="LIDENT">truncate_line</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-find"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find</span></a> <a href="#local_unindented_281"><span class="LIDENT">unindented</span></a> <a href="#local_l_288"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <span class="LIDENT">truncate_str</span> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="EOL">
</span>       <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">truncate_str</span> <span class="COLONCOLON">::</span> <span class="LIDENT">truncate_line</span> <a href="#local_x_287"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_x_289"><span class="LIDENT">x</span></span><span class="COLONCOLON">::</span><span id="local_r_290"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cut_283"><span class="LIDENT">cut</span></a> <span class="LPAREN">(</span><a href="#local_n_284"><span class="LIDENT">n</span></a><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a><span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LIDENT">truncate_line</span> <a href="#local_x_289"><span class="LIDENT">x</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_285"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_r_290"><span class="LIDENT">r</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_291"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="opamCoreConfig.ml.html"><span class="UIDENT">OpamCoreConfig</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="opamCoreConfig.ml.html#val-r"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">errlog_length</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_len_291"><span class="LIDENT">len</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <span class="INT">0</span> <span class="THEN">then</span> <a href="#local_l_280"><span class="LIDENT">l</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <a href="#local_cut_283"><span class="LIDENT">cut</span></a> <a href="#local_len_291"><span class="LIDENT">len</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_l_280"><span class="LIDENT">l</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-string_of_result"><span class="LIDENT">string_of_result</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_color_292"><span class="LIDENT">color</span></span><span class="EQUAL">=</span><span class="BACKQUOTE">`</span><span class="LIDENT">yellow</span><span class="RPAREN">)</span> <span id="local_r_293"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_b_294"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-create"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="INT">2048</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_print_295"><span class="LIDENT">print</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_string"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_string</span></a> <a href="#local_b_294"><span class="LIDENT">b</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_println_296"><span class="LIDENT">println</span></span> <span id="local_str_297"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_print_295"><span class="LIDENT">print</span></a> <a href="#local_str_297"><span class="LIDENT">str</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-add_char"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">add_char</span></a> <a href="#local_b_294"><span class="LIDENT">b</span></a> <span class="CHAR">'\n'</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>  <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><span class="LIDENT">string_of_info</span> <span class="TILDE">~</span><a href="#local_color_292"><span class="LIDENT">color</span></a> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_info</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stdout</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stderr</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stdout</span> <span class="THEN">then</span><span class="EOL">
</span>      <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_292"><span class="LIDENT">color</span></a> <span class="STRING">&quot;### output ###\n&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_292"><span class="LIDENT">color</span></a> <span class="STRING">&quot;### stdout ###\n&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_298"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_292"><span class="LIDENT">color</span></a> <span class="STRING">&quot;# &quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_println_296"><span class="LIDENT">println</span></a> <a href="#local_s_298"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="LIDENT">truncate</span> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stdout</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stderr</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stderr</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stdout</span> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_292"><span class="LIDENT">color</span></a> <span class="STRING">&quot;### stderr ###\n&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_299"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_print_295"><span class="LIDENT">print</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-colorise"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">colorise</span></a> <a href="#local_color_292"><span class="LIDENT">color</span></a> <span class="STRING">&quot;# &quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_println_296"><span class="LIDENT">println</span></a> <a href="#local_s_299"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="LIDENT">truncate</span> <a href="#local_r_293"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stderr</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/buffer.ml.html#val-contents"><span class="UIDENT">Buffer</span><span class="DOT">.</span><span class="LIDENT">contents</span></a> <a href="#local_b_294"><span class="LIDENT">b</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-result_summary"><span class="LIDENT">result_summary</span></span> <span id="local_r_300"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;%S exited with code %d%s&quot;</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="TRY">try</span> <a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="STRING">&quot;command&quot;</span> <a href="#local_r_300"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_info</span><span class="EOL">
</span>     <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;command&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>    <a href="#local_r_300"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_code</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_r_300"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_code</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span> <span class="ELSE">else</span><span class="EOL">
</span>     <span class="MATCH">match</span> <a href="#local_r_300"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stderr</span><span class="COMMA">,</span> <a href="#local_r_300"><span class="LIDENT">r</span></a><span class="DOT">.</span><span class="LIDENT">r_stdout</span> <span class="WITH">with</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="LBRACKET">[</span><span id="local_e_301"><span class="LIDENT">e</span></span><span class="RBRACKET">]</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="COMMA">,</span> <span class="LBRACKET">[</span><span id="local_e_302"><span class="LIDENT">e</span></span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot; \&quot;%s\&quot;&quot;</span> <a href="#local_e_302"><span class="LIDENT">e</span></a><span class="EOL">
</span>     <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="COMMA">,</span> <span id="local_es_303"><span class="LIDENT">es</span></span> <span class="BAR">|</span> <span id="local_es_304"><span class="LIDENT">es</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>       <span class="TRY">try</span><span class="EOL">
</span>         <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot; \&quot;%s\&quot;&quot;</span><span class="EOL">
</span>           <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-find"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">find</span></a><span class="EOL">
</span>              <a href="../../../re/src/re/re.ml.html"><span class="UIDENT">Re</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="../../../re/src/re/core.ml.html#val-execp"><span class="LIDENT">execp</span></a> <span class="LPAREN">(</span><a href="../../../re/src/re/core.ml.html#local_compile_100"><span class="LIDENT">compile</span></a> <span class="LPAREN">(</span><a href="../../../re/src/re/ast.ml.html#module-Export.val-seq"><span class="LIDENT">seq</span></a> <span class="LBRACKET">[</span> <a href="../../../re/src/re/ast.ml.html#module-Export.val-bos"><span class="LIDENT">bos</span></a><span class="SEMI">;</span> <a href="../../../re/src/re/ast.ml.html#module-Export.val-rep"><span class="LIDENT">rep</span></a> <span class="LPAREN">(</span><a href="../../../re/src/re/ast.ml.html#module-Export.val-diff"><span class="LIDENT">diff</span></a> <a href="../../../re/src/re/core.ml.html#local_any_7"><span class="LIDENT">any</span></a> <a href="../../../re/src/re/core.ml.html#local_alpha_11"><span class="LIDENT">alpha</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>                                        <a href="../../../re/src/re/ast.ml.html#module-Export.val-no_case"><span class="LIDENT">no_case</span></a> <span class="LPAREN">(</span><a href="../../../re/src/re/ast.ml.html#module-Export.val-str"><span class="LIDENT">str</span></a> <span class="STRING">&quot;error&quot;</span><span class="RPAREN">)</span> <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_es_304"><span class="LIDENT">es</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>       <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Higher-level interface to allow parallelism *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Job"><span class="MODULE">module</span> <span class="UIDENT">Job</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Job.module-Op"><span class="MODULE">module</span> <span class="UIDENT">Op</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Job.module-Op.type-job"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">job</span> <span class="EQUAL">=</span> <span class="COMMENT">(* Open the variant type *)</span><span class="EOL">
</span>      <span id="module-Job.module-Op.type-job.constructor-Done"><span class="BAR">|</span> <span class="UIDENT">Done</span> <span class="OF">of</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span><span class="EOL">
</span>      <span id="module-Job.module-Op.type-job.constructor-Run"><span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="OF">of</span> <span class="LIDENT">command</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="LIDENT">result</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">job</span><span class="RPAREN">)</span></span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* Parallelise shell commands *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Job.module-Op.val-(@@&gt;)"><span class="LPAREN">(</span><span class="INFIXOP1">@@&gt;</span><span class="RPAREN">)</span></span> <span id="local_command_305"><span class="LIDENT">command</span></span> <span id="local_f_306"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_command_305"><span class="LIDENT">command</span></a><span class="COMMA">,</span> <a href="#local_f_306"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* Sequentialise jobs *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Job.module-Op.val-(@@+)"><span class="LPAREN">(</span><span class="INFIXOP1">@@+</span><span class="RPAREN">)</span></span> <span id="local_job1_307"><span class="LIDENT">job1</span></span> <span id="local_fjob2_308"><span class="LIDENT">fjob2</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_job1_307"><span class="LIDENT">job1</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_x_309"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fjob2_308"><span class="LIDENT">fjob2</span></a> <a href="#local_x_309"><span class="LIDENT">x</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_310"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span><span id="local_cont_311"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_cmd_310"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <span class="FUN">fun</span> <span id="local_r_312"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cont_311"><span class="LIDENT">cont</span></a> <a href="#local_r_312"><span class="LIDENT">r</span></a> <span class="INFIXOP1">@@+</span> <a href="#local_fjob2_308"><span class="LIDENT">fjob2</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Job.module-Op.val-(@@|)"><span class="LPAREN">(</span><span class="INFIXOP1">@@|</span><span class="RPAREN">)</span></span> <span id="local_job_313"><span class="LIDENT">job</span></span> <span id="local_f_314"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="#local_job_313"><span class="LIDENT">job</span></a> <span class="INFIXOP1">@@+</span> <span class="FUN">fun</span> <span id="local_x_315"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Done</span> <span class="LPAREN">(</span><a href="#local_f_314"><span class="LIDENT">f</span></a> <a href="#local_x_315"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="OPEN">open</span> <span class="UIDENT">Op</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-run"><span class="LIDENT">run</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_316"><span class="LIDENT">aux</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_x_317"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_317"><span class="LIDENT">x</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_318"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span><span id="local_cont_319"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="opamStd.ml.html#module-Option.val-iter"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="IF">if</span> <a href="opamConsole.ml.html#val-disp_status_line"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">disp_status_line</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>             <a href="opamConsole.ml.html#val-status_line"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">status_line</span></a> <span class="STRING">&quot;Processing: %s&quot;</span><span class="EOL">
</span>           <span class="ELSE">else</span> <span class="IF">if</span> <a href="opamConsole.ml.html#val-verbose"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">verbose</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>             <a href="opamConsole.ml.html#val-msg"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">msg</span></a> <span class="STRING">&quot;%s\n&quot;</span><span class="EOL">
</span>           <span class="ELSE">else</span> <span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">text_of_command</span> <a href="#local_cmd_318"><span class="LIDENT">cmd</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_r_320"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <span class="LIDENT">run</span> <a href="#local_cmd_318"><span class="LIDENT">cmd</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_k_321"><span class="LIDENT">k</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="TRY">try</span> <a href="#local_cont_319"><span class="LIDENT">cont</span></a> <a href="#local_r_320"><span class="LIDENT">r</span></a><span class="EOL">
</span>          <span class="WITH">with</span> <span id="local_e_322"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="LIDENT">cleanup</span> <a href="#local_r_320"><span class="LIDENT">r</span></a><span class="SEMI">;</span><span class="EOL">
</span>            <a href="opamConsole.ml.html#val-clear_status"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">clear_status</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_322"><span class="LIDENT">e</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">cleanup</span> <a href="#local_r_320"><span class="LIDENT">r</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="opamConsole.ml.html#val-clear_status"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">clear_status</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_aux_316"><span class="LIDENT">aux</span></a> <a href="#local_k_321"><span class="LIDENT">k</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_aux_316"><span class="LIDENT">aux</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Job.val-dry_run"><span class="LIDENT">dry_run</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_x_323"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_323"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local__command_324"><span class="LIDENT">_command</span></span><span class="COMMA">,</span><span id="local_cont_325"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">dry_run</span> <span class="LPAREN">(</span><a href="#local_cont_325"><span class="LIDENT">cont</span></a> <span class="LIDENT">empty_result</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Job.val-catch"><span class="LIDENT">catch</span></span> <span id="local_handler_326"><span class="LIDENT">handler</span></span> <span id="local_fjob_327"><span class="LIDENT">fjob</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="TRY">try</span> <span class="MATCH">match</span> <a href="#local_fjob_327"><span class="LIDENT">fjob</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_x_328"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Done</span> <a href="#local_x_328"><span class="LIDENT">x</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_329"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span><span id="local_cont_330"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_cmd_329"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <span class="FUN">fun</span> <span id="local_r_331"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">catch</span> <a href="#local_handler_326"><span class="LIDENT">handler</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cont_330"><span class="LIDENT">cont</span></a> <a href="#local_r_331"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="WITH">with</span> <span id="local_e_332"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_handler_326"><span class="LIDENT">handler</span></a> <a href="#local_e_332"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-ignore_errors"><span class="LIDENT">ignore_errors</span></span> <span class="TILDE">~</span><span id="local_default_333"><span class="LIDENT">default</span></span> <span class="QUESTION">?</span><span id="local_message_334"><span class="LIDENT">message</span></span> <span id="local_job_335"><span class="LIDENT">job</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">catch</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_336"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="opamStd.ml.html#module-Exn.val-fatal"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Exn</span><span class="DOT">.</span><span class="LIDENT">fatal</span></a> <a href="#local_e_336"><span class="LIDENT">e</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="opamStd.ml.html#module-Option.val-iter"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><a href="opamConsole.ml.html#val-error"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">error</span></a> <span class="STRING">&quot;%s&quot;</span><span class="RPAREN">)</span> <a href="#local_message_334"><span class="LIDENT">message</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">Done</span> <a href="#local_default_333"><span class="LIDENT">default</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="#local_job_335"><span class="LIDENT">job</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Job.val-finally"><span class="LIDENT">finally</span></span> <span id="local_fin_337"><span class="LIDENT">fin</span></span> <span id="local_fjob_338"><span class="LIDENT">fjob</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="TRY">try</span> <span class="MATCH">match</span> <a href="#local_fjob_338"><span class="LIDENT">fjob</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_x_339"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fin_337"><span class="LIDENT">fin</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span> <span class="UIDENT">Done</span> <a href="#local_x_339"><span class="LIDENT">x</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_340"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span><span id="local_cont_341"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_cmd_340"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span> <span class="FUN">fun</span> <span id="local_r_342"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">finally</span> <a href="#local_fin_337"><span class="LIDENT">fin</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_cont_341"><span class="LIDENT">cont</span></a> <a href="#local_r_342"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="WITH">with</span> <span id="local_e_343"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fin_337"><span class="LIDENT">fin</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_e_343"><span class="LIDENT">e</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-of_list"><span class="LIDENT">of_list</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_keep_going_344"><span class="LIDENT">keep_going</span></span><span class="EQUAL">=</span><span class="FALSE">false</span><span class="RPAREN">)</span> <span id="local_l_345"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_346"><span class="LIDENT">aux</span></span> <span id="local_err_347"><span class="LIDENT">err</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Done</span> <a href="#local_err_347"><span class="LIDENT">err</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_cmd_348"><span class="LIDENT">cmd</span></span><span class="COLONCOLON">::</span><span id="local_commands_349"><span class="LIDENT">commands</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_cont_350"><span class="LIDENT">cont</span></span> <span class="EQUAL">=</span> <span class="FUN">fun</span> <span id="local_r_351"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="IF">if</span> <span class="LIDENT">is_success</span> <a href="#local_r_351"><span class="LIDENT">r</span></a> <span class="THEN">then</span> <a href="#local_aux_346"><span class="LIDENT">aux</span></a> <a href="#local_err_347"><span class="LIDENT">err</span></a> <a href="#local_commands_349"><span class="LIDENT">commands</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_keep_going_344"><span class="LIDENT">keep_going</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_aux_346"><span class="LIDENT">aux</span></a> <a href="opamStd.ml.html#module-Option.module-Op"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="UIDENT">Op</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_err_347"><span class="LIDENT">err</span></a> <a href="opamStd.ml.html#module-Option.module-Op.val-(++)"><span class="INFIXOP2">++</span></a> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_cmd_348"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_r_351"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_commands_349"><span class="LIDENT">commands</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="UIDENT">Done</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_cmd_348"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_r_351"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_cmd_348"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_cont_350"><span class="LIDENT">cont</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_aux_346"><span class="LIDENT">aux</span></a> <span class="UIDENT">None</span> <a href="#local_l_345"><span class="LIDENT">l</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-of_fun_list"><span class="LIDENT">of_fun_list</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_keep_going_352"><span class="LIDENT">keep_going</span></span><span class="EQUAL">=</span><span class="FALSE">false</span><span class="RPAREN">)</span> <span id="local_l_353"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_aux_354"><span class="LIDENT">aux</span></span> <span id="local_err_355"><span class="LIDENT">err</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Done</span> <a href="#local_err_355"><span class="LIDENT">err</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_cmdf_356"><span class="LIDENT">cmdf</span></span><span class="COLONCOLON">::</span><span id="local_commands_357"><span class="LIDENT">commands</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_cmd_358"><span class="LIDENT">cmd</span></span> <span class="EQUAL">=</span> <a href="#local_cmdf_356"><span class="LIDENT">cmdf</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_cont_359"><span class="LIDENT">cont</span></span> <span class="EQUAL">=</span> <span class="FUN">fun</span> <span id="local_r_360"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="IF">if</span> <span class="LIDENT">is_success</span> <a href="#local_r_360"><span class="LIDENT">r</span></a> <span class="THEN">then</span> <a href="#local_aux_354"><span class="LIDENT">aux</span></a> <a href="#local_err_355"><span class="LIDENT">err</span></a> <a href="#local_commands_357"><span class="LIDENT">commands</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_keep_going_352"><span class="LIDENT">keep_going</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_aux_354"><span class="LIDENT">aux</span></a> <a href="opamStd.ml.html#module-Option.module-Op"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Option</span><span class="DOT">.</span><span class="UIDENT">Op</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_err_355"><span class="LIDENT">err</span></a> <a href="opamStd.ml.html#module-Option.module-Op.val-(++)"><span class="INFIXOP2">++</span></a> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_cmd_358"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_r_360"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_commands_357"><span class="LIDENT">commands</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="UIDENT">Done</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="#local_cmd_358"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_r_360"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="UIDENT">Run</span> <span class="LPAREN">(</span><a href="#local_cmd_358"><span class="LIDENT">cmd</span></a><span class="COMMA">,</span><a href="#local_cont_359"><span class="LIDENT">cont</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_aux_354"><span class="LIDENT">aux</span></a> <span class="UIDENT">None</span> <a href="#local_l_353"><span class="LIDENT">l</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-seq"><span class="LIDENT">seq</span></span> <span id="local_job_361"><span class="LIDENT">job</span></span> <span id="local_start_362"><span class="LIDENT">start</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="INFIXOP1">@@+</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">Done</span> <a href="#local_start_362"><span class="LIDENT">start</span></a><span class="RPAREN">)</span> <a href="#local_job_361"><span class="LIDENT">job</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Job.val-seq_map"><span class="LIDENT">seq_map</span></span> <span id="local_f_363"><span class="LIDENT">f</span></span> <span id="local_l_364"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_job_365"><span class="LIDENT">job</span></span> <span id="local_x_366"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_job_365"><span class="LIDENT">job</span></a> <span class="INFIXOP1">@@+</span> <span class="FUN">fun</span> <span id="local_acc_367"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_363"><span class="LIDENT">f</span></a> <a href="#local_x_366"><span class="LIDENT">x</span></a> <span class="INFIXOP1">@@|</span> <span class="FUN">fun</span> <span id="local_y_368"><span class="LIDENT">y</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_y_368"><span class="LIDENT">y</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_367"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="UIDENT">Done</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <a href="#local_l_364"><span class="LIDENT">l</span></a><span class="EOL">
</span>    <span class="INFIXOP1">@@|</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Job.val-with_text"><span class="LIDENT">with_text</span></span> <span id="local_text_369"><span class="LIDENT">text</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Done</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_j_370"><span class="LIDENT">j</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_j_370"><span class="LIDENT">j</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_371"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span> <span id="local_cont_372"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span class="LBRACE">{</span><a href="#local_cmd_371"><span class="LIDENT">cmd</span></a> <span class="WITH">with</span> <span class="LIDENT">cmd_text</span> <span class="EQUAL">=</span> <span class="UIDENT">Some</span> <a href="#local_text_369"><span class="LIDENT">text</span></a><span class="RBRACE">}</span><span class="COMMA">,</span> <span class="FUN">fun</span> <span id="local_r_373"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">with_text</span> <a href="#local_text_369"><span class="LIDENT">text</span></a> <span class="LPAREN">(</span><a href="#local_cont_372"><span class="LIDENT">cont</span></a> <a href="#local_r_373"><span class="LIDENT">r</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-job"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">job</span> <span class="EQUAL">=</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="UIDENT">Job</span><span class="DOT">.</span><span class="UIDENT">Op</span><span class="DOT">.</span><span class="LIDENT">job</span></span><span class="EOL">
</span></span></code></pre></body></html>
