<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cmarkit (cmarkit.cmarkit.Cmarkit)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../sherlodoc_db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">Cmarkit  <span class="version">v0.3.0</span></a> &#x00BB; Library <code>cmarkit</code> &#x00BB; Cmarkit</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Cmarkit</span></code></h1><p>CommonMark parser and abstract syntax tree.</p><p>See <span class="xref-unresolved" title="index.quick">examples</span>.</p><p><b>References.</b></p><ul><li>John MacFarlane. <em><a href="https://spec.commonmark.org/0.30/">CommonMark Spec</a></em>. Version 0.30, 2021</li></ul></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#ast">Abstract syntax tree</a></li><li><a href="#maps_and_folds">Maps and folds</a></li><li><a href="#extensions">Extensions</a><ul><li><a href="#ext_strikethrough">Strikethrough</a></li><li><a href="#ext_math">Math</a><ul><li><a href="#ext_math_inline">Inline math</a></li><li><a href="#ext_math_display">Display math</a></li></ul></li><li><a href="#ext_list_task_items">List task items</a></li><li><a href="#ext_tables">Tables</a></li><li><a href="#ext_footnotes">Footnotes</a><ul><li><a href="#ext_footnote_def">Definition</a></li><li><a href="#ext_footnote_ref">References</a></li></ul></li></ul></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">Cmarkit  <span class="version">v0.3.0</span></a><ul><li>Library <code>cmarkit</code><ul><li><a href="#" class="current_unit">Cmarkit</a><ul><li><a href="Textloc/index.html">Textloc</a></li><li><a href="Meta/index.html">Meta</a></li><li><a href="Layout/index.html">Layout</a></li><li><a href="Block_line/index.html">Block_line</a></li><li><a href="Label/index.html">Label</a></li><li><a href="Link_definition/index.html">Link_definition</a></li><li><a href="Inline/index.html">Inline</a></li><li><a href="Block/index.html">Block</a></li><li><a href="Doc/index.html">Doc</a></li><li><a href="Mapper/index.html">Mapper</a></li><li><a href="Folder/index.html">Folder</a></li></ul></li><li><a href="../Cmarkit_commonmark/index.html">Cmarkit_commonmark</a></li><li><a href="../Cmarkit_html/index.html">Cmarkit_html</a></li><li><a href="../Cmarkit_latex/index.html">Cmarkit_latex</a></li><li><a href="../Cmarkit_renderer/index.html">Cmarkit_renderer</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="ast"><a href="#ast" class="anchor"></a>Abstract syntax tree</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Textloc"><a href="#module-Textloc" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Textloc/index.html">Textloc</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Text locations.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Meta"><a href="#module-Meta" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Meta/index.html">Meta</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Node metadata.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-node"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a node</span></span><span> = <span class="type-var">'a</span> * <a href="Meta/index.html#type-t">Meta.t</a></span></code></div><div class="spec-doc"><p>The type for abstract syntax tree nodes. The data of type <code>'a</code> and its metadata.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Layout"><a href="#module-Layout" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Layout/index.html">Layout</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Types for layout information.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Block_line"><a href="#module-Block_line" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Block_line/index.html">Block_line</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Block lines.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Label"><a href="#module-Label" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Label/index.html">Label</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Labels.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Link_definition"><a href="#module-Link_definition" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Link_definition/index.html">Link_definition</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Link definitions.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Inline"><a href="#module-Inline" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Inline/index.html">Inline</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Inlines.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Block"><a href="#module-Block" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Block/index.html">Block</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Blocks.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Doc"><a href="#module-Doc" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Doc/index.html">Doc</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Documents (and parser).</p></div></div><h2 id="maps_and_folds"><a href="#maps_and_folds" class="anchor"></a>Maps and folds</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Mapper"><a href="#module-Mapper" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Mapper/index.html">Mapper</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Abstract syntax tree mappers.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Folder"><a href="#module-Folder" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Folder/index.html">Folder</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Abstract syntax tree folders.</p></div></div><h2 id="extensions"><a href="#extensions" class="anchor"></a>Extensions</h2><p>For some documents, bare CommonMark just misses it. The extensions are here to make it hit the mark. To enable them use <a href="Doc/index.html#val-of_string"><code>Doc.of_string</code></a> with <code>strict:false</code>.</p><p>Please note the following:</p><ol><li>There is no plan to provide an extension mechanism at the parsing level. A lot can already be achieved by using <a href="Label/index.html#resolvers" title="resolvers">reference resolvers</a>, abusing code fences, post-processing the abstract syntax tree, or <a href="../Cmarkit_renderer/index.html#example" title="example">extending</a> the renderers.</li><li>In order to minimize dialects and extension interaction oddities, there is no plan to allow to selectively enable extensions.</li><li>If one day the CommonMark specification standardizes a set of extensions. <code>Cmarkit</code> will support those.</li><li>In the short term, there is no plan to support more extensions than those that are listed here.</li></ol><h3 id="ext_strikethrough"><a href="#ext_strikethrough" class="anchor"></a>Strikethrough</h3><p>According to <a href="https://pandoc.org/MANUAL.html#strikeout"><code>pandoc</code></a>.</p><pre>Strikethrough your ~~perfect~~ imperfect thoughts.</pre><p>Inline text delimited between two <code>~~</code> gets into an <a href="Inline/index.html#extension-Ext_strikethrough"><code>Inline.Ext_strikethrough</code></a> node.</p><p>The text delimited by <code>~~</code> cannot start or end with <a href="https://spec.commonmark.org/0.30/#unicode-whitespace-character">Unicode whitespace</a>. When a closer can close multiple openers, the neareast opener is closed. Strikethrough inlines can be nested.</p><h3 id="ext_math"><a href="#ext_math" class="anchor"></a>Math</h3><p>According to a mix of <a href="https://pandoc.org/MANUAL.html#extension-tex_math_dollars"><code>pandoc</code></a>, <a href="https://docs.gitlab.com/ee/user/markdown.html#math">GLFM</a>, <a href="https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/writing-mathematical-expressions">GFM</a>.</p><h4 id="ext_math_inline"><a href="#ext_math_inline" class="anchor"></a>Inline math</h4><pre>This is an inline $\sqrt(x - 1)$ math expression.</pre><p>Inline text delimited between <code>$</code> gets into an <a href="Inline/index.html#extension-Ext_math_span"><code>Inline.Ext_math_span</code></a> node.</p><p>The text delimited by <code>$</code> cannot start and end with <a href="https://spec.commonmark.org/0.30/#unicode-whitespace-character">Unicode whitespace</a>. Inline math cannot be nested, after an opener the nearest (non-escaped) closing delimiter matches. Otherwise it is parsed in essence like a <a href="https://spec.commonmark.org/0.30/#code-spans">code span</a>.</p><h4 id="ext_math_display"><a href="#ext_math_display" class="anchor"></a>Display math</h4><pre>It's better to get that $$ \left( \sum_{k=1}^n a_k b_k \right)^2 $$
on its own line. A math block may also be more convenient:

```math
\left( \sum_{k=1}^n a_k b_k \right)^2 &lt; \Phi
```</pre><p>Inline text delimited by <code>$$</code> gets into a <a href="Inline/index.html#extension-Ext_math_span"><code>Inline.Ext_math_span</code></a> with the <a href="Inline/Math_span/index.html#val-display"><code>Inline.Math_span.display</code></a> property set to <code>true</code>. Alternatively code blocks whose <a href="Block/Code_block/index.html#val-language_of_info_string" title="Block.Code_block.language_of_info_string">language</a> is <code>math</code> get into in <a href="Block/index.html#extension-Ext_math_block"><code>Block.Ext_math_block</code></a> blocks.</p><p>In contrast to <code>$</code>, the text delimited by <code>$$</code> can start and end with whitespace, however it can't contain a blank line. Display math cannot be nested, after an opener the nearest (non-escaped) closing delimiter matches. Otherwise it's parsed in essence like a <a href="https://spec.commonmark.org/0.30/#code-spans">code span</a>.</p><h3 id="ext_list_task_items"><a href="#ext_list_task_items" class="anchor"></a>List task items</h3><p>According to a mix of <a href="https://github.com/mity/md4c/blob/master/test/tasklists.txt">md4c</a>, <a href="https://docs.gitlab.com/ee/user/markdown.html#task-lists">GLFM</a>, <a href="https://github.github.com/gfm/#task-list-item">GFM</a> and personal ad-hoc brewery.</p><pre>* [ ] That's unchecked.
* [x] That's checked.
* [~] That's cancelled.</pre><p>If a list item starts with up to three space, followed by followed by <code>[</code>, a single Unicode character, <code>]</code> and a space (the space can be omitted if the line is empty, but subsequent indentation considers there was one). The Unicode character gets stored in <a href="Block/List_item/index.html#val-ext_task_marker"><code>Block.List_item.ext_task_marker</code></a> and counts as one column regardless of the character's render width. The task marker including the final space is considered part of the list marker as far as subsequent indentation is concerned.</p><p>The Unicode character indicates the status of the task. That's up to the client but the function <a href="Block/List_item/index.html#val-task_status_of_task_marker"><code>Block.List_item.task_status_of_task_marker</code></a> which is used by the built-in renderers makes the following choices:</p><ul><li>Unchecked: <code>' '</code> (U+0020).</li><li>Checked: <code>'x'</code> (U+0078), <code>'X'</code> (U+0058), <code>'‚úì'</code> (U+2713, CHECK MARK), <code>'‚úî'</code> (U+2714, HEAVY CHECK MARK), <code>'êÑÇ'</code> (U+10102, AEGEAN CHECK MARK), <code>'üó∏'</code> (U+1F5F8, LIGHT CHECK MARK).</li><li>Cancelled: <code>'~'</code> (U+007E).</li><li>Other: any other character, interpretation left to clients or renderers (built-in ones equate it with done).</li></ul><h3 id="ext_tables"><a href="#ext_tables" class="anchor"></a>Tables</h3><p>According to <a href="https://htmlpreview.github.io/?https://github.com/jgm/djot/blob/master/doc/syntax.html#pipe-table">djot</a>.</p><pre>| # |      Name | Description           |                    Link |
|:-:|----------:|:----------------------|------------------------:|
| 1 |     OCaml | The OCaml website     |     &lt;https://ocaml.org&gt; |
| 2 |   Haskell | The Haskell website   |   &lt;https://haskell.org&gt; |
| 3 |       MDN | Web dev docs | &lt;https://developer.mozilla.org/&gt; |
| 4 | Wikipedia | The Free Encyclopedia | &lt;https://wikipedia.org&gt; |</pre><p>A table is a sequence of rows, each row starts and ends with a (non-escaped) pipe <code>|</code> character. The first row can't be indented by more than three spaces of indentation, subsequent rows can be arbitrarily indented. Blanks after the final pipe are allowed.</p><p>Each row of the table contains cells separated by (non-escaped) pipe <code>|</code> characters. Pipes embedded in inlines constructs do not count as separators (the parsing strategy is to parse the row as an inline, split the result on the <code>|</code> present in <em>toplevel</em> text nodes and strip initial and trailing blanks in cells). The number of <code>|</code> separators plus 1 determines the number of columns of a row. The number of columns of a table is the greatest number of columns of its rows.</p><p>A separator line is a row in which every cell content is made only of one or more <code>-</code> optionally prefixed and suffixed by <code>:</code>. These rows are not data, they indicate alignment of data in their cell for subsequent rows (multiple separator lines in a single table are allowed) and that the previous line (if any) was a row of column headers. <code>:-</code> is left aligned <code>-:</code> is right aligned, <code>:-:</code> is centered. If there's no alignement specified it's left aligned.</p><p>Tables are stored in <a href="Block/index.html#extension-Ext_table"><code>Block.Ext_table</code></a> nodes.</p><h3 id="ext_footnotes"><a href="#ext_footnotes" class="anchor"></a>Footnotes</h3><p>According to <a href="https://htmlpreview.github.io/?https://github.com/jgm/djot/blob/master/doc/syntax.html#footnotes">djot</a> for the footnote contents.</p><pre>This is a footnote in history[^1] with mutiple references[^1].
Footnotes are not [very special][^1] references.

 [^1]: Footnotes can have
lazy continuation lines and multiple paragraphs.

  If you start one column after the left bracket, blocks still get
  into the footnote.

 But this is no longer the footnote.</pre><p>Footnotes go through the label resolution mecanism and share the same namespace as link references (including the <code>^</code>). They end up being defined in the <a href="Doc/index.html#val-defs"><code>Doc.defs</code></a> as <a href="Block/Footnote/index.html#extension-Def"><code>Block.Footnote.Def</code></a> definitions. Footnote references are simply made by using <a href="Inline/index.html#extension-Link"><code>Inline.Link</code></a> with the corresponding labels.</p><h4 id="ext_footnote_def"><a href="#ext_footnote_def" class="anchor"></a>Definition</h4><p>A footnote definition starts with a (single line) <a href="https://spec.commonmark.org/0.30/#link-label">link label</a> followed by <code>:</code>. The label must start with a <code>^</code>. Footnote labels go through the label <a href="Label/index.html#resolvers" title="resolvers">resolution</a> mechanism.</p><p>All subsequent lines indented one column further than the start of the label (i.e. starting on the <code>^</code>) get into the footnote. Lazy continuation lines are supported.</p><p>The result is stored in the document's <a href="Doc/index.html#val-defs"><code>Doc.defs</code></a> in <a href="Block/Footnote/index.html#extension-Def"><code>Block.Footnote.Def</code></a> cases and it's position in the documentation witnessed by a <a href="Block/index.html#extension-Ext_footnote_definition"><code>Block.Ext_footnote_definition</code></a> node which is kept for layout.</p><h4 id="ext_footnote_ref"><a href="#ext_footnote_ref" class="anchor"></a>References</h4><p>Footnote references are simply reference links with the footnote label. Linking text on footnotes is allowed. Shortcut and collapsed references to footnotes are rendered specially by <a href="../Cmarkit_html/index.html"><code>Cmarkit_html</code></a>.</p></div></body></html>
