<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: nonnegative.ml (ocamlgraph.src.ocamlgraph)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">ocamlgraph</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; ocamlgraph &#x00BB; nonnegative.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>nonnegative.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">ocamlgraph</a><ul><li>Library <code>ocamlgraph</code><ul><li><a href="../../ocamlgraph/Graph/index.html">Graph</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>ocamlgraph<ul><li><a href="blocks.ml.html">blocks.ml</a></li><li><a href="builder.ml.html">builder.ml</a></li><li><a href="chaoticIteration.ml.html">chaoticIteration.ml</a></li><li><a href="classic.ml.html">classic.ml</a></li><li><a href="clique.ml.html">clique.ml</a></li><li><a href="cliquetree.ml.html">cliquetree.ml</a></li><li><a href="coloring.ml.html">coloring.ml</a></li><li><a href="components.ml.html">components.ml</a></li><li><a href="contraction.ml.html">contraction.ml</a></li><li><a href="cycles.ml.html">cycles.ml</a></li><li><a href="dGraphModel.ml.html">dGraphModel.ml</a></li><li><a href="dGraphRandModel.ml.html">dGraphRandModel.ml</a></li><li><a href="dGraphSubTree.ml.html">dGraphSubTree.ml</a></li><li><a href="dGraphTreeLayout.ml.html">dGraphTreeLayout.ml</a></li><li><a href="dGraphTreeModel.ml.html">dGraphTreeModel.ml</a></li><li><a href="delaunay.ml.html">delaunay.ml</a></li><li><a href="dominator.ml.html">dominator.ml</a></li><li><a href="dot.ml.html">dot.ml</a></li><li><a href="dot_lexer.ml.html">dot_lexer.ml</a></li><li><a href="dot_parser.ml.html">dot_parser.ml</a></li><li><a href="eulerian.ml.html">eulerian.ml</a></li><li><a href="fixpoint.ml.html">fixpoint.ml</a></li><li><a href="flow.ml.html">flow.ml</a></li><li><a href="gmap.ml.html">gmap.ml</a></li><li><a href="gml.ml.html">gml.ml</a></li><li><a href="graph.ml.html">graph.ml</a></li><li><a href="graph__.ml.html">graph__.ml</a></li><li><a href="graphml.ml.html">graphml.ml</a></li><li><a href="graphviz.ml.html">graphviz.ml</a></li><li><a href="imperative.ml.html">imperative.ml</a></li><li><a href="kruskal.ml.html">kruskal.ml</a></li><li><a href="leaderlist.ml.html">leaderlist.ml</a></li><li><a href="mcs_m.ml.html">mcs_m.ml</a></li><li><a href="md.ml.html">md.ml</a></li><li><a href="merge.ml.html">merge.ml</a></li><li><a href="mincut.ml.html">mincut.ml</a></li><li><a href="minsep.ml.html">minsep.ml</a></li><li><a href="#" class="current_unit">nonnegative.ml</a></li><li><a href="oper.ml.html">oper.ml</a></li><li><a href="pack.ml.html">pack.ml</a></li><li><a href="path.ml.html">path.ml</a></li><li><a href="persistent.ml.html">persistent.ml</a></li><li><a href="prim.ml.html">prim.ml</a></li><li><a href="rand.ml.html">rand.ml</a></li><li><a href="strat.ml.html">strat.ml</a></li><li><a href="topological.ml.html">topological.ml</a></li><li><a href="traverse.ml.html">traverse.ml</a></li><li><a href="util.ml.html">util.ml</a></li><li><a href="weakTopological.ml.html">weakTopological.ml</a></li><li><a href="xDot.ml.html">xDot.ml</a></li><li><a href="xDotDraw.ml.html">xDotDraw.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
<a id="L496" class="source_line" href="#L496">496</a>
<a id="L497" class="source_line" href="#L497">497</a>
<a id="L498" class="source_line" href="#L498">498</a>
<a id="L499" class="source_line" href="#L499">499</a>
<a id="L500" class="source_line" href="#L500">500</a>
<a id="L501" class="source_line" href="#L501">501</a>
<a id="L502" class="source_line" href="#L502">502</a>
<a id="L503" class="source_line" href="#L503">503</a>
<a id="L504" class="source_line" href="#L504">504</a>
<a id="L505" class="source_line" href="#L505">505</a>
<a id="L506" class="source_line" href="#L506">506</a>
<a id="L507" class="source_line" href="#L507">507</a>
<a id="L508" class="source_line" href="#L508">508</a>
<a id="L509" class="source_line" href="#L509">509</a>
<a id="L510" class="source_line" href="#L510">510</a>
<a id="L511" class="source_line" href="#L511">511</a>
<a id="L512" class="source_line" href="#L512">512</a>
<a id="L513" class="source_line" href="#L513">513</a>
<a id="L514" class="source_line" href="#L514">514</a>
<a id="L515" class="source_line" href="#L515">515</a>
<a id="L516" class="source_line" href="#L516">516</a>
<a id="L517" class="source_line" href="#L517">517</a>
<a id="L518" class="source_line" href="#L518">518</a>
<a id="L519" class="source_line" href="#L519">519</a>
<a id="L520" class="source_line" href="#L520">520</a>
<a id="L521" class="source_line" href="#L521">521</a>
<a id="L522" class="source_line" href="#L522">522</a>
<a id="L523" class="source_line" href="#L523">523</a>
<a id="L524" class="source_line" href="#L524">524</a>
<a id="L525" class="source_line" href="#L525">525</a>
<a id="L526" class="source_line" href="#L526">526</a>
<a id="L527" class="source_line" href="#L527">527</a>
<a id="L528" class="source_line" href="#L528">528</a>
<a id="L529" class="source_line" href="#L529">529</a>
<a id="L530" class="source_line" href="#L530">530</a>
<a id="L531" class="source_line" href="#L531">531</a>
<a id="L532" class="source_line" href="#L532">532</a>
<a id="L533" class="source_line" href="#L533">533</a>
<a id="L534" class="source_line" href="#L534">534</a>
<a id="L535" class="source_line" href="#L535">535</a>
<a id="L536" class="source_line" href="#L536">536</a>
<a id="L537" class="source_line" href="#L537">537</a>
<a id="L538" class="source_line" href="#L538">538</a>
<a id="L539" class="source_line" href="#L539">539</a>
<a id="L540" class="source_line" href="#L540">540</a>
<a id="L541" class="source_line" href="#L541">541</a>
<a id="L542" class="source_line" href="#L542">542</a>
<a id="L543" class="source_line" href="#L543">543</a>
<a id="L544" class="source_line" href="#L544">544</a>
<a id="L545" class="source_line" href="#L545">545</a>
<a id="L546" class="source_line" href="#L546">546</a>
<a id="L547" class="source_line" href="#L547">547</a>
<a id="L548" class="source_line" href="#L548">548</a>
<a id="L549" class="source_line" href="#L549">549</a>
<a id="L550" class="source_line" href="#L550">550</a>
<a id="L551" class="source_line" href="#L551">551</a>
<a id="L552" class="source_line" href="#L552">552</a>
<a id="L553" class="source_line" href="#L553">553</a>
<a id="L554" class="source_line" href="#L554">554</a>
<a id="L555" class="source_line" href="#L555">555</a>
<a id="L556" class="source_line" href="#L556">556</a>
<a id="L557" class="source_line" href="#L557">557</a>
<a id="L558" class="source_line" href="#L558">558</a>
<a id="L559" class="source_line" href="#L559">559</a>
<a id="L560" class="source_line" href="#L560">560</a>
<a id="L561" class="source_line" href="#L561">561</a>
<a id="L562" class="source_line" href="#L562">562</a>
<a id="L563" class="source_line" href="#L563">563</a>
<a id="L564" class="source_line" href="#L564">564</a>
<a id="L565" class="source_line" href="#L565">565</a>
<a id="L566" class="source_line" href="#L566">566</a>
<a id="L567" class="source_line" href="#L567">567</a>
<a id="L568" class="source_line" href="#L568">568</a>
<a id="L569" class="source_line" href="#L569">569</a>
<a id="L570" class="source_line" href="#L570">570</a>
<a id="L571" class="source_line" href="#L571">571</a>
<a id="L572" class="source_line" href="#L572">572</a>
<a id="L573" class="source_line" href="#L573">573</a>
<a id="L574" class="source_line" href="#L574">574</a>
<a id="L575" class="source_line" href="#L575">575</a>
<a id="L576" class="source_line" href="#L576">576</a>
<a id="L577" class="source_line" href="#L577">577</a>
<a id="L578" class="source_line" href="#L578">578</a>
<a id="L579" class="source_line" href="#L579">579</a>
<a id="L580" class="source_line" href="#L580">580</a>
<a id="L581" class="source_line" href="#L581">581</a>
<a id="L582" class="source_line" href="#L582">582</a>
<a id="L583" class="source_line" href="#L583">583</a>
<a id="L584" class="source_line" href="#L584">584</a>
<a id="L585" class="source_line" href="#L585">585</a>
<a id="L586" class="source_line" href="#L586">586</a>
<a id="L587" class="source_line" href="#L587">587</a>
<a id="L588" class="source_line" href="#L588">588</a>
<a id="L589" class="source_line" href="#L589">589</a>
<a id="L590" class="source_line" href="#L590">590</a>
<a id="L591" class="source_line" href="#L591">591</a>
<a id="L592" class="source_line" href="#L592">592</a>
<a id="L593" class="source_line" href="#L593">593</a>
<a id="L594" class="source_line" href="#L594">594</a>
<a id="L595" class="source_line" href="#L595">595</a>
<a id="L596" class="source_line" href="#L596">596</a>
<a id="L597" class="source_line" href="#L597">597</a>
<a id="L598" class="source_line" href="#L598">598</a>
<a id="L599" class="source_line" href="#L599">599</a>
<a id="L600" class="source_line" href="#L600">600</a>
<a id="L601" class="source_line" href="#L601">601</a>
<a id="L602" class="source_line" href="#L602">602</a>
<a id="L603" class="source_line" href="#L603">603</a>
<a id="L604" class="source_line" href="#L604">604</a>
<a id="L605" class="source_line" href="#L605">605</a>
<a id="L606" class="source_line" href="#L606">606</a>
<a id="L607" class="source_line" href="#L607">607</a>
<a id="L608" class="source_line" href="#L608">608</a>
<a id="L609" class="source_line" href="#L609">609</a>
<a id="L610" class="source_line" href="#L610">610</a>
<a id="L611" class="source_line" href="#L611">611</a>
<a id="L612" class="source_line" href="#L612">612</a>
<a id="L613" class="source_line" href="#L613">613</a>
<a id="L614" class="source_line" href="#L614">614</a>
<a id="L615" class="source_line" href="#L615">615</a>
<a id="L616" class="source_line" href="#L616">616</a>
<a id="L617" class="source_line" href="#L617">617</a>
<a id="L618" class="source_line" href="#L618">618</a>
<a id="L619" class="source_line" href="#L619">619</a>
<a id="L620" class="source_line" href="#L620">620</a>
<a id="L621" class="source_line" href="#L621">621</a>
<a id="L622" class="source_line" href="#L622">622</a>
<a id="L623" class="source_line" href="#L623">623</a>
<a id="L624" class="source_line" href="#L624">624</a>
<a id="L625" class="source_line" href="#L625">625</a>
<a id="L626" class="source_line" href="#L626">626</a>
<a id="L627" class="source_line" href="#L627">627</a>
<a id="L628" class="source_line" href="#L628">628</a>
<a id="L629" class="source_line" href="#L629">629</a>
<a id="L630" class="source_line" href="#L630">630</a>
<a id="L631" class="source_line" href="#L631">631</a>
<a id="L632" class="source_line" href="#L632">632</a>
<a id="L633" class="source_line" href="#L633">633</a>
<a id="L634" class="source_line" href="#L634">634</a>
<a id="L635" class="source_line" href="#L635">635</a>
<a id="L636" class="source_line" href="#L636">636</a>
<a id="L637" class="source_line" href="#L637">637</a>
<a id="L638" class="source_line" href="#L638">638</a>
<a id="L639" class="source_line" href="#L639">639</a>
<a id="L640" class="source_line" href="#L640">640</a>
<a id="L641" class="source_line" href="#L641">641</a>
<a id="L642" class="source_line" href="#L642">642</a>
<a id="L643" class="source_line" href="#L643">643</a>
<a id="L644" class="source_line" href="#L644">644</a>
<a id="L645" class="source_line" href="#L645">645</a>
<a id="L646" class="source_line" href="#L646">646</a>
<a id="L647" class="source_line" href="#L647">647</a>
<a id="L648" class="source_line" href="#L648">648</a>
<a id="L649" class="source_line" href="#L649">649</a>
<a id="L650" class="source_line" href="#L650">650</a>
<a id="L651" class="source_line" href="#L651">651</a>
<a id="L652" class="source_line" href="#L652">652</a>
<a id="L653" class="source_line" href="#L653">653</a>
<a id="L654" class="source_line" href="#L654">654</a>
<a id="L655" class="source_line" href="#L655">655</a>
<a id="L656" class="source_line" href="#L656">656</a>
<a id="L657" class="source_line" href="#L657">657</a>
<a id="L658" class="source_line" href="#L658">658</a>
<a id="L659" class="source_line" href="#L659">659</a>
<a id="L660" class="source_line" href="#L660">660</a>
<a id="L661" class="source_line" href="#L661">661</a>
<a id="L662" class="source_line" href="#L662">662</a>
<a id="L663" class="source_line" href="#L663">663</a>
<a id="L664" class="source_line" href="#L664">664</a>
<a id="L665" class="source_line" href="#L665">665</a>
<a id="L666" class="source_line" href="#L666">666</a>
<a id="L667" class="source_line" href="#L667">667</a>
<a id="L668" class="source_line" href="#L668">668</a>
<a id="L669" class="source_line" href="#L669">669</a>
<a id="L670" class="source_line" href="#L670">670</a>
<a id="L671" class="source_line" href="#L671">671</a>
<a id="L672" class="source_line" href="#L672">672</a>
<a id="L673" class="source_line" href="#L673">673</a>
<a id="L674" class="source_line" href="#L674">674</a>
<a id="L675" class="source_line" href="#L675">675</a>
<a id="L676" class="source_line" href="#L676">676</a>
<a id="L677" class="source_line" href="#L677">677</a>
<a id="L678" class="source_line" href="#L678">678</a>
<a id="L679" class="source_line" href="#L679">679</a>
<a id="L680" class="source_line" href="#L680">680</a>
<a id="L681" class="source_line" href="#L681">681</a>
</code><code class="source_code"><span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*  Ocamlgraph: a generic graph library for OCaml                         *)</span><span class="EOL">
</span><span class="COMMENT">(*  Copyright (C) 2004-2010                                               *)</span><span class="EOL">
</span><span class="COMMENT">(*  Sylvain Conchon, Jean-Christophe Filliatre and Julien Signoles        *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*  This software is free software; you can redistribute it and/or        *)</span><span class="EOL">
</span><span class="COMMENT">(*  modify it under the terms of the GNU Library General Public           *)</span><span class="EOL">
</span><span class="COMMENT">(*  License version 2.1, with the special exception on linking            *)</span><span class="EOL">
</span><span class="COMMENT">(*  described in file LICENSE.                                            *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*  This software is distributed in the hope that it will be useful,      *)</span><span class="EOL">
</span><span class="COMMENT">(*  but WITHOUT ANY WARRANTY; without even the implied warranty of        *)</span><span class="EOL">
</span><span class="COMMENT">(*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                  *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* This module is a contribution of Yuto Takei *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Imperative"><span class="MODULE">module</span> <span class="UIDENT">Imperative</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="COLON">:</span> <span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">IM</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">W</span><span class="COLON">:</span> <span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">WEIGHT</span> <span class="WITH">with</span> <span id="def_384"><span class="TYPE">type</span> <span class="LIDENT">edge</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Imperative.module-S"><span class="MODULE">module</span> <span class="UIDENT">S</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/set.ml.html#module-Make"><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-Imperative.module-M"><span class="MODULE">module</span> <span class="UIDENT">M</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/map.ml.html#module-Make"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Imperative.module-V"><span class="MODULE">module</span> <span class="UIDENT">V</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span></span><span class="EOL">
</span>  <span id="module-Imperative.module-E"><span class="MODULE">module</span> <span class="UIDENT">E</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* [G.t] represents graph itself.  [unit M.t] maintains a list of
     source vertices to keep track of distances for all vertices.
     [(G.E.t option * W.t) M.t M.t] holds mappings for all vertices,
     each of which contains its shortest-path tree ancestor (parent)
     and a distances from source vertices. *)</span><span class="EOL">
</span>  <span id="module-Imperative.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#type-ref"><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">ref</span></a> <span class="STAR">*</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#type-ref"><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span> <span class="STAR">*</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">ref</span></a></span><span class="EOL">
</span>  <span id="module-Imperative.type-edge"><span class="TYPE">type</span> <span class="LIDENT">edge</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">edge</span></span><span class="EOL">
</span>  <span id="module-Imperative.type-vertex"><span class="TYPE">type</span> <span class="LIDENT">vertex</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">vertex</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-sov"><span class="LIDENT">sov</span></span> <span id="local_v_1"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/obj.ml.html#val-magic"><span class="UIDENT">Obj</span><span class="DOT">.</span><span class="LIDENT">magic</span></a> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">label</span> <a href="#local_v_1"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-dump_cycle"><span class="LIDENT">dump_cycle</span></span> <span id="local_cycle_2"><span class="LIDENT">cycle</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_v0_3"><span class="LIDENT">v0</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-hd"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">hd</span></a> <a href="#local_cycle_2"><span class="LIDENT">cycle</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="STRING">&quot;(&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_v0_3"><span class="LIDENT">v0</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;)&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_v1_4"><span class="LIDENT">v1</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_v_5"><span class="LIDENT">v</span></span> <span id="local_e_6"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="ASSERT">assert</span> <span class="LPAREN">(</span><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">compare</span> <a href="#local_v_5"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_6"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_v_7"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_6"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="STRING">&quot;-(&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_v_7"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;)&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_v_7"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_v0_3"><span class="LIDENT">v0</span></a> <a href="#local_cycle_2"><span class="LIDENT">cycle</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="ASSERT">assert</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_v0_3"><span class="LIDENT">v0</span></a> <a href="#local_v1_4"><span class="LIDENT">v1</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="STRING">&quot;\n&quot;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-dump_set"><span class="LIDENT">dump_set</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">iter</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_8"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_x_8"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;, &quot;</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-dump"><span class="LIDENT">dump</span></span> <span class="LPAREN">(</span><span id="local_src_9"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_10"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="STRING">&quot;====================\nS: &quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">dump_set</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_9"><span class="LIDENT">src</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="STRING">&quot;\nMap:&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">iter</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_k_11"><span class="LIDENT">k</span></span> <span id="local_v_12"><span class="LIDENT">v</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="STRING">&quot;\n  &quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_k_11"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;: &quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">iter</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_k_13"><span class="LIDENT">k</span></span> <span class="LPAREN">(</span><span id="local_origin_14"><span class="LIDENT">origin</span></span><span class="COMMA">,</span> <span id="local_dist_15"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="EOL">
</span>              <span class="STRING">&quot;(&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_k_13"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;&gt;&gt;&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_origin_14"><span class="LIDENT">origin</span></a> <span class="WITH">with</span><span class="EOL">
</span>               <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;---&quot;</span><span class="EOL">
</span>               <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_16"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_16"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;&gt;&quot;</span><span class="EOL">
</span>                           <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_16"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;:&quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/obj.ml.html#val-magic"><span class="UIDENT">Obj</span><span class="DOT">.</span><span class="LIDENT">magic</span></a> <a href="#local_dist_15"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;) &quot;</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_v_12"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_10"><span class="LIDENT">dist</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="STRING">&quot;\n&quot;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* If an edge is going to be added to the graph, which will cause
     a negative cycle, raises [Negative_cycle] with edges that can
     form such the cycle. *)</span><span class="EOL">
</span>  <span id="module-Imperative.exception-Negative_cycle"><span class="EXCEPTION">exception</span> <span class="UIDENT">Negative_cycle</span> <span class="OF">of</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-create"><span class="LIDENT">create</span></span> <span class="QUESTION">?</span><span id="local_size_17"><span class="LIDENT">size</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_g_18"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_size_17"><span class="LIDENT">size</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_size_19"><span class="LIDENT">size</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_size_19"><span class="LIDENT">size</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="#local_g_18"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-copy"><span class="LIDENT">copy</span></span> <span class="LPAREN">(</span><span id="local_g_20"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_21"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_22"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">copy</span> <a href="#local_g_20"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_21"><span class="LIDENT">src</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_22"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-clear"><span class="LIDENT">clear</span></span> <span class="LPAREN">(</span><span id="local_g_23"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_24"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_25"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">clear</span> <a href="#local_g_23"><span class="LIDENT">g</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_src_24"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_dist_25"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-add_vertex"><span class="LIDENT">add_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_26"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_27"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_28"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v_29"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Before adding vertex to the graph, make sure that the vertex
       is not in the graph.  If already in the graph, just do
       nothing and return as is. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_vertex</span> <a href="#local_g_26"><span class="LIDENT">g</span></a> <a href="#local_v_29"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="COMMENT">(* Add a vertex to the original one *)</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_vertex</span> <a href="#local_g_26"><span class="LIDENT">g</span></a> <a href="#local_v_29"><span class="LIDENT">v</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* The new vertex will immediately be added to the source list *)</span><span class="EOL">
</span>      <a href="#local_src_27"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_29"><span class="LIDENT">v</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_27"><span class="LIDENT">src</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* The new edge should contain a distance mapping with only
         from myself with distance zero. *)</span><span class="EOL">
</span>      <a href="#local_dist_28"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_29"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_29"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_28"><span class="LIDENT">dist</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_27"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_28"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Imperative.val-propagate"><span class="LIDENT">propagate</span></span> <span class="LPAREN">(</span><span id="local_g_30"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_31"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_32"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_q_33"><span class="LIDENT">q</span></span> <span id="local_start_34"><span class="LIDENT">start</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-is_empty"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">is_empty</span></a> <a href="#local_q_33"><span class="LIDENT">q</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><a href="#local_g_30"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_31"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_32"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_376"><span class="LPAREN">(</span><span id="local_v1_35"><span class="LIDENT">v1</span></span><span class="COMMA">,</span> <span id="local_v1src_36"><span class="LIDENT">v1src</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-pop"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">pop</span></a> <a href="#local_q_33"><span class="LIDENT">q</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v1dist_37"><span class="LIDENT">v1dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_35"><span class="LIDENT">v1</span></a> <a href="#local_dist_32"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dist_38"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_39"><span class="LIDENT">e</span></span> <span id="local_dist_40"><span class="LIDENT">dist</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_v2_41"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_39"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_v2dist_42"><span class="LIDENT">v2dist</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <a href="#local_dist_40"><span class="LIDENT">dist</span></a> <span class="THEN">then</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <a href="#local_dist_40"><span class="LIDENT">dist</span></a> <span class="ELSE">else</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="COMMENT">(* Compare distances from given source vertices.
                   If relax happens, record it to the new list. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_374"><span class="LPAREN">(</span><span id="local_v2dist_43"><span class="LIDENT">v2dist</span></span><span class="COMMA">,</span> <span id="local_nextSrc_44"><span class="LIDENT">nextSrc</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_45"><span class="LIDENT">x</span></span> <span class="LPAREN">(</span><span id="local_v2dist_46"><span class="LIDENT">v2dist</span></span><span class="COMMA">,</span> <span id="local_nextSrc_47"><span class="LIDENT">nextSrc</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="def_387"><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_dev1_48"><span class="LIDENT">dev1</span></span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_45"><span class="LIDENT">x</span></a> <a href="#local_v1dist_37"><span class="LIDENT">v1dist</span></a> <span class="IN">in</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_ndev2_49"><span class="LIDENT">ndev2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_dev1_48"><span class="LIDENT">dev1</span></a> <span class="LPAREN">(</span><span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">weight</span> <a href="#local_e_39"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_improvement_50"><span class="LIDENT">improvement</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>                <span class="TRY">try</span><span class="EOL">
</span>                  <span class="LET">let</span> <span id="def_375"><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_dev2_51"><span class="LIDENT">dev2</span></span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_45"><span class="LIDENT">x</span></a> <a href="#local_v2dist_46"><span class="LIDENT">v2dist</span></a> <span class="IN">in</span><span class="EOL">
</span>                  <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">compare</span> <a href="#local_ndev2_49"><span class="LIDENT">ndev2</span></a> <a href="#local_dev2_51"><span class="LIDENT">dev2</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span><span class="EOL">
</span>                <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span> <span class="IN">in</span><span class="EOL">
</span>              <span class="IF">if</span> <a href="#local_improvement_50"><span class="LIDENT">improvement</span></a> <span class="THEN">then</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_v2dist_52"><span class="LIDENT">v2dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_45"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_e_39"><span class="LIDENT">e</span></a><span class="COMMA">,</span> <a href="#local_ndev2_49"><span class="LIDENT">ndev2</span></a><span class="RPAREN">)</span> <a href="#local_v2dist_46"><span class="LIDENT">v2dist</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_nextSrc_53"><span class="LIDENT">nextSrc</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_45"><span class="LIDENT">x</span></a> <a href="#local_nextSrc_47"><span class="LIDENT">nextSrc</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="#local_v2dist_52"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_53"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="ELSE">else</span><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="#local_v2dist_46"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_47"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="RPAREN">)</span> <a href="#local_v1src_36"><span class="LIDENT">v1src</span></a> <span class="LPAREN">(</span><a href="#local_v2dist_42"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="IF">if</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_nextSrc_44"><span class="LIDENT">nextSrc</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_dist_40"><span class="LIDENT">dist</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_start_34"><span class="LIDENT">start</span></a> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <span class="COMMENT">(* Propagation reaches back to the starting node, which
               immediately means presence of a negative cycle. *)</span><span class="EOL">
</span><span class="EOL">
</span>            <span class="COMMENT">(* We should use one of 'src' to traverse to the start node *)</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_dist_54"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <a href="#local_v2dist_43"><span class="LIDENT">v2dist</span></a> <a href="#local_dist_40"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_cycle_55"><span class="LIDENT">cycle</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_56"><span class="LIDENT">s</span></span> <span id="local_x_57"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                <span class="LET">let</span> <span class="REC">rec</span> <span id="local_build_cycle_58"><span class="LIDENT">build_cycle</span></span> <span id="local_x_59"><span class="LIDENT">x</span></span> <span id="local_ret_60"><span class="LIDENT">ret</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>                  <span class="MATCH">match</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_s_56"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_59"><span class="LIDENT">x</span></a> <a href="#local_dist_54"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_61"><span class="LIDENT">e</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_y_62"><span class="LIDENT">y</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_61"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_cycle_63"><span class="LIDENT">cycle</span></span> <span class="EQUAL">=</span> <a href="#local_e_61"><span class="LIDENT">e</span></a> <span class="COLONCOLON">::</span> <a href="#local_ret_60"><span class="LIDENT">ret</span></a> <span class="IN">in</span><span class="EOL">
</span>                    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_start_34"><span class="LIDENT">start</span></a> <a href="#local_y_62"><span class="LIDENT">y</span></a> <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_cycle_63"><span class="LIDENT">cycle</span></a><span class="EOL">
</span>                    <span class="ELSE">else</span> <a href="#local_build_cycle_58"><span class="LIDENT">build_cycle</span></a> <a href="#local_y_62"><span class="LIDENT">y</span></a> <a href="#local_cycle_63"><span class="LIDENT">cycle</span></a><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="MATCH">match</span> <a href="#local_x_57"><span class="LIDENT">x</span></a> <span class="WITH">with</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_build_cycle_58"><span class="LIDENT">build_cycle</span></a> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_57"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <a href="#local_nextSrc_44"><span class="LIDENT">nextSrc</span></a> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_cycle_64"><span class="LIDENT">cycle</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_cycle_55"><span class="LIDENT">cycle</span></a> <span class="WITH">with</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_x_65"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_65"><span class="LIDENT">x</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>            <span class="LIDENT">dump_cycle</span> <a href="#local_cycle_64"><span class="LIDENT">cycle</span></a><span class="SEMI">;</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Negative_cycle</span> <a href="#local_cycle_64"><span class="LIDENT">cycle</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="ELSE">else</span><span class="EOL">
</span>            <span class="BEGIN">begin</span><span class="EOL">
</span>              <span class="COMMENT">(* TODO: Some room for improvement.
                 If queue has (v2, s) already, technically we can merge
                 nextSrc into s, so that the number of propagation can be
                 reduced. *)</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-push"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">push</span></a> <span class="LPAREN">(</span><a href="#local_v2_41"><span class="LIDENT">v2</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_44"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span> <a href="#local_q_33"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>              <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_41"><span class="LIDENT">v2</span></a> <a href="#local_v2dist_43"><span class="LIDENT">v2dist</span></a> <a href="#local_dist_40"><span class="LIDENT">dist</span></a><span class="EOL">
</span>            <span class="END">end</span><span class="EOL">
</span>        <span class="RPAREN">)</span> <a href="#local_g_30"><span class="LIDENT">g</span></a> <a href="#local_v1_35"><span class="LIDENT">v1</span></a> <a href="#local_dist_32"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_30"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_31"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_38"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_33"><span class="LIDENT">q</span></a> <a href="#local_start_34"><span class="LIDENT">start</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-m_cardinal"><span class="LIDENT">m_cardinal</span></span> <span id="local_m_66"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="UNDERSCORE">_</span> <span id="local_acc_67"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_67"><span class="LIDENT">acc</span></a><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a><span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_m_66"><span class="LIDENT">m</span></a> <span class="INT">0</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-set_of_map"><span class="LIDENT">set_of_map</span></span> <span id="local_m_68"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_k_69"><span class="LIDENT">k</span></span> <span class="UNDERSCORE">_</span> <span id="local_acc_70"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_k_69"><span class="LIDENT">k</span></a> <a href="#local_acc_70"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_m_68"><span class="LIDENT">m</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-add_edge_internal"><span class="LIDENT">add_edge_internal</span></span> <span class="LPAREN">(</span><span id="local_g_71"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_72"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_73"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_74"><span class="LIDENT">v1</span></span> <span id="local_v2_75"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Distance mappings at v1 *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dv1_76"><span class="LIDENT">dv1</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_74"><span class="LIDENT">v1</span></a> <a href="#local_dist_73"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* To reduce the amount of codes, we just start propagation from
       v1. Of course, this can be optimized by starting from v2. But
       it may duplicate the same code in multiple places in the
       file. In addition, such an optimization only cost for small
       amount, which precisely is the operations to relax edges from
       v1, other than which have been existed before this
       [add_edge_e] call. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_q_77"><span class="LIDENT">q</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-create"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* We need to check whether v2 should be kept in the source list
       or not.  That is, if there maybe a cycle with v1, the
       distance from v1 should be still maintained. Otherwise,
       simply ignore the distance from v2 *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="LIDENT">m_cardinal</span> <a href="#local_dv1_76"><span class="LIDENT">dv1</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">1</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_75"><span class="LIDENT">v2</span></a> <a href="#local_dv1_76"><span class="LIDENT">dv1</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="COMMENT">(* Now we definitely introduced a loop (and possibly non-negative)!
         Let me see if this would be negative or not... *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v1_74"><span class="LIDENT">v1</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_75"><span class="LIDENT">v2</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_77"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_71"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_72"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_73"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_77"><span class="LIDENT">q</span></a> <a href="#local_v1_74"><span class="LIDENT">v1</span></a><span class="EOL">
</span>    <span class="RPAREN">)</span> <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="COMMENT">(* Or even if we fall back to else-clause here, the edge addition
               may have introduced a cycle. Anyway, we need to check if one is
               newly created or not at [propagate] *)</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_377"><span class="LPAREN">(</span><span id="local_src_78"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_79"><span class="LIDENT">dist</span></span><span class="COMMA">,</span> <span id="local_dv1_80"><span class="LIDENT">dv1</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_75"><span class="LIDENT">v2</span></a> <a href="#local_src_72"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>          <span class="COMMENT">(* If v2 isn't one of the source vertices, just simply do
             propagation. *)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="#local_src_72"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_73"><span class="LIDENT">dist</span></a><span class="COMMA">,</span> <a href="#local_dv1_76"><span class="LIDENT">dv1</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span><span class="EOL">
</span>          <span class="COMMENT">(* We can exclude v2 from the list of source because
             one can reach v2 from some other vertex. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_src_81"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v2_75"><span class="LIDENT">v2</span></a> <a href="#local_src_72"><span class="LIDENT">src</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="COMMENT">(* Note that following line can be skipped only if the
             user don't remove vertex. Otherwise, such operation
             like [add_edge g v1 v2] &gt; [remove_vertex g v2] &gt;
             [add_vertex g v2] can result in unexpected
             behavior. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_dist_82"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v2_75"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span> <a href="#local_dist_73"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="COMMENT">(* We need to re-obtain the distance mappings at v1,
             since it can be changed by the line above. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_dv1_83"><span class="LIDENT">dv1</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_74"><span class="LIDENT">v1</span></a> <a href="#local_dist_82"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="#local_src_81"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_82"><span class="LIDENT">dist</span></a><span class="COMMA">,</span> <a href="#local_dv1_83"><span class="LIDENT">dv1</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* Now let's start propagation. *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v1_74"><span class="LIDENT">v1</span></a><span class="COMMA">,</span> <span class="LIDENT">set_of_map</span> <a href="#local_dv1_80"><span class="LIDENT">dv1</span></a><span class="RPAREN">)</span> <a href="#local_q_77"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_71"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_78"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_79"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_77"><span class="LIDENT">q</span></a> <a href="#local_v1_74"><span class="LIDENT">v1</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-add_edge_e"><span class="LIDENT">add_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_84"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_85"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_86"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_e_87"><span class="LIDENT">e</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Before adding edge to the graph, make sure that the edge is
       not in the graph.  If already in the graph, just do nothing
       and return as is. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_84"><span class="LIDENT">g</span></a> <a href="#local_e_87"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="COMMENT">(* Vertices involved *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v1_88"><span class="LIDENT">v1</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_87"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v2_89"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_87"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">add_vertex</span> <span class="LPAREN">(</span><a href="#local_g_84"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_85"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_86"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LBRACKET">[</span><a href="#local_v1_88"><span class="LIDENT">v1</span></a> <span class="SEMI">;</span> <a href="#local_v2_89"><span class="LIDENT">v2</span></a><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="BEGIN">begin</span> <span class="TRY">try</span><span class="EOL">
</span>          <span class="COMMENT">(* Because we can restore the graph by calling [G.remove_edge_e]
             even in case of failure, we first add it by [G.add_edge_e]. *)</span><span class="EOL">
</span>          <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_edge_e</span> <a href="#local_g_84"><span class="LIDENT">g</span></a> <a href="#local_e_87"><span class="LIDENT">e</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_371"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_src'_90"><span class="LIDENT">src'</span></span><span class="COMMA">,</span> <span id="local_dist'_91"><span class="LIDENT">dist'</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="LIDENT">add_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_84"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_85"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_86"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_v1_88"><span class="LIDENT">v1</span></a> <a href="#local_v2_89"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_src_85"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_src'_90"><span class="LIDENT">src'</span></a><span class="SEMI">;</span> <a href="#local_dist_86"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_dist'_91"><span class="LIDENT">dist'</span></a><span class="EOL">
</span>        <span class="WITH">with</span> <span id="local_exp_92"><span class="LIDENT">exp</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* In case of excecption, restore the graph by removing the
             edge, and rethrow the exception. *)</span><span class="EOL">
</span>          <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge_e</span> <a href="#local_g_84"><span class="LIDENT">g</span></a> <a href="#local_e_87"><span class="LIDENT">e</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_exp_92"><span class="LIDENT">exp</span></a><span class="EOL">
</span>      <span class="END">end</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_85"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_86"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-add_edge"><span class="LIDENT">add_edge</span></span> <span class="LPAREN">(</span><span id="local_g_93"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_94"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_95"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_96"><span class="LIDENT">v1</span></span> <span id="local_v2_97"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge_e] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_93"><span class="LIDENT">g</span></a> <a href="#local_v1_96"><span class="LIDENT">v1</span></a> <a href="#local_v2_97"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">add_vertex</span> <span class="LPAREN">(</span><a href="#local_g_93"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_94"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_95"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LBRACKET">[</span><a href="#local_v1_96"><span class="LIDENT">v1</span></a> <span class="SEMI">;</span> <a href="#local_v2_97"><span class="LIDENT">v2</span></a><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="BEGIN">begin</span> <span class="TRY">try</span><span class="EOL">
</span>          <span class="COMMENT">(* Because we cannot know the default value for edge length,
             we first try to add one by [G.add_edge]. If there occurs an
             exception, restore the graph by [G.remove_edge] since there
             were no other connections between [v1] and [v2]. *)</span><span class="EOL">
</span>          <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_edge</span> <a href="#local_g_93"><span class="LIDENT">g</span></a> <a href="#local_v1_96"><span class="LIDENT">v1</span></a> <a href="#local_v2_97"><span class="LIDENT">v2</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_381"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_src'_98"><span class="LIDENT">src'</span></span><span class="COMMA">,</span> <span id="local_dist'_99"><span class="LIDENT">dist'</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="LIDENT">add_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_93"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_94"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_95"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_v1_96"><span class="LIDENT">v1</span></a> <a href="#local_v2_97"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_src_94"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_src'_98"><span class="LIDENT">src'</span></a><span class="SEMI">;</span> <a href="#local_dist_95"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_dist'_99"><span class="LIDENT">dist'</span></a><span class="EOL">
</span>        <span class="WITH">with</span> <span id="local_exp_100"><span class="LIDENT">exp</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* In case of excecption, restore the graph by removing the
             edge, and rethrow the exception. *)</span><span class="EOL">
</span>          <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge</span> <a href="#local_g_93"><span class="LIDENT">g</span></a> <a href="#local_v1_96"><span class="LIDENT">v1</span></a> <a href="#local_v2_97"><span class="LIDENT">v2</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_exp_100"><span class="LIDENT">exp</span></a><span class="EOL">
</span>      <span class="END">end</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_94"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_95"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-remove_edge_internal"><span class="LIDENT">remove_edge_internal</span></span> <span class="LPAREN">(</span><span id="local_g_101"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_102"><span class="LIDENT">src</span></span><span class="RPAREN">)</span> <span id="local_v2_103"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Actually, we need to rebuild the distance table, rather than
       traverse precedants to remove the edge. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_q_104"><span class="LIDENT">q</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-create"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="STRING">&quot;dump: &quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">dump_set</span> <a href="#local_src_102"><span class="LIDENT">src</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dist_105"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_106"><span class="LIDENT">x</span></span> <span id="local_dist_107"><span class="LIDENT">dist</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-print_string"><span class="LIDENT">print_string</span></a> <span class="LPAREN">(</span><span class="STRING">&quot;source: &quot;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="LPAREN">(</span><span class="LIDENT">sov</span> <a href="#local_x_106"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <span class="STRING">&quot;\n&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_x_106"><span class="LIDENT">x</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_106"><span class="LIDENT">x</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_104"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_106"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_106"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="#local_dist_107"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_src_102"><span class="LIDENT">src</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span>  <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_380"><span id="local_g_108"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_109"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_110"><span class="LIDENT">dist</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_101"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_102"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_105"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_104"><span class="LIDENT">q</span></a> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">choose</span> <a href="#local_src_102"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_103"><span class="LIDENT">v2</span></a> <a href="#local_dist_110"><span class="LIDENT">dist</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_108"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_109"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_110"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v2_103"><span class="LIDENT">v2</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_103"><span class="LIDENT">v2</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_104"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_src_111"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_103"><span class="LIDENT">v2</span></a> <a href="#local_src_109"><span class="LIDENT">src</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dist_112"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_103"><span class="LIDENT">v2</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_103"><span class="LIDENT">v2</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="#local_dist_110"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_108"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_111"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_112"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_104"><span class="LIDENT">q</span></a> <a href="#local_v2_103"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-remove_edge_e"><span class="LIDENT">remove_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_113"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_114"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_115"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_e_116"><span class="LIDENT">e</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge_e] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_113"><span class="LIDENT">g</span></a> <a href="#local_e_116"><span class="LIDENT">e</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge_e</span> <a href="#local_g_113"><span class="LIDENT">g</span></a> <a href="#local_e_116"><span class="LIDENT">e</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* Vertices involved *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v2_117"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_116"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_372"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_src'_118"><span class="LIDENT">src'</span></span><span class="COMMA">,</span> <span id="local_dist'_119"><span class="LIDENT">dist'</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="LIDENT">remove_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_113"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_114"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <a href="#local_v2_117"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_src_114"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_src'_118"><span class="LIDENT">src'</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_dist_115"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_dist'_119"><span class="LIDENT">dist'</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_114"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_115"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-remove_edge"><span class="LIDENT">remove_edge</span></span> <span class="LPAREN">(</span><span id="local_g_120"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_121"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_122"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_123"><span class="LIDENT">v1</span></span> <span id="local_v2_124"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_120"><span class="LIDENT">g</span></a> <a href="#local_v1_123"><span class="LIDENT">v1</span></a> <a href="#local_v2_124"><span class="LIDENT">v2</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge</span> <a href="#local_g_120"><span class="LIDENT">g</span></a> <a href="#local_v1_123"><span class="LIDENT">v1</span></a> <a href="#local_v2_124"><span class="LIDENT">v2</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_383"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_src'_125"><span class="LIDENT">src'</span></span><span class="COMMA">,</span> <span id="local_dist'_126"><span class="LIDENT">dist'</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="LIDENT">remove_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_120"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_121"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <a href="#local_v2_124"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_src_121"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_src'_125"><span class="LIDENT">src'</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_dist_122"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="#local_dist'_126"><span class="LIDENT">dist'</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_121"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_122"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-remove_vertex"><span class="LIDENT">remove_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_127"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_128"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_129"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v_130"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_vertex</span> <a href="#local_g_127"><span class="LIDENT">g</span></a> <a href="#local_v_130"><span class="LIDENT">v</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="COMMENT">(* [remove_vertex] first deletes all outgoing edges from [v] *)</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_succ_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_131"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">remove_edge_e</span> <span class="LPAREN">(</span><a href="#local_g_127"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_128"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_129"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_e_131"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <a href="#local_g_127"><span class="LIDENT">g</span></a> <a href="#local_v_130"><span class="LIDENT">v</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="COMMENT">(* Then after, deletes all incoming edges to [v] *)</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_pred_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_132"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">remove_edge_e</span> <span class="LPAREN">(</span><a href="#local_g_127"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_128"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_129"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_e_132"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <a href="#local_g_127"><span class="LIDENT">g</span></a> <a href="#local_v_130"><span class="LIDENT">v</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="COMMENT">(* Note that we are iterating on [g] that is being modified during
               iteration. We can do such an above iteration since G is here
               permanent. Do not try this for imperative graph. *)</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* Now we can feel free to delete [v]. *)</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_vertex</span> <a href="#local_g_127"><span class="LIDENT">g</span></a> <a href="#local_v_130"><span class="LIDENT">v</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_src_128"><span class="LIDENT">src</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v_130"><span class="LIDENT">v</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_128"><span class="LIDENT">src</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_dist_129"><span class="LIDENT">dist</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v_130"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v_130"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_129"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">dump</span> <span class="LPAREN">(</span><a href="#local_src_128"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_129"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-map_vertex"><span class="LIDENT">map_vertex</span></span> <span id="local_f_133"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_134"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_135"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_136"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_map_map_137"><span class="LIDENT">map_map</span></span> <span id="local_update_138"><span class="LIDENT">update</span></span> <span id="local_m_139"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_v_140"><span class="LIDENT">v</span></span> <span id="local_m_141"><span class="LIDENT">m</span></span> <span id="local_acc_142"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <span class="LPAREN">(</span><a href="#local_f_133"><span class="LIDENT">f</span></a> <a href="#local_v_140"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_update_138"><span class="LIDENT">update</span></a> <a href="#local_m_141"><span class="LIDENT">m</span></a><span class="RPAREN">)</span> <a href="#local_acc_142"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_m_139"><span class="LIDENT">m</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_369"><span class="LPAREN">(</span><span id="local_g_143"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_144"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_145"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">map_vertex</span> <a href="#local_f_133"><span class="LIDENT">f</span></a> <a href="#local_g_134"><span class="LIDENT">g</span></a><span class="COMMA">,</span><span class="EOL">
</span>                          <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_v_146"><span class="LIDENT">v</span></span> <span id="local_acc_147"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <span class="LPAREN">(</span><a href="#local_f_133"><span class="LIDENT">f</span></a> <a href="#local_v_146"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_acc_147"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_src_135"><span class="LIDENT">src</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="COMMA">,</span><span class="EOL">
</span>                          <span class="LET">let</span> <span id="local_update_148"><span class="LIDENT">update</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>                            <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_v_149"><span class="LIDENT">v</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_v_149"><span class="LIDENT">v</span></a><span class="EOL">
</span>                            <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_150"><span class="LIDENT">e</span></span><span class="COMMA">,</span> <span id="local_w_151"><span class="LIDENT">w</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                              <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_f_133"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_150"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">label</span> <a href="#local_e_150"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_f_133"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_150"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="COMMA">,</span> <a href="#local_w_151"><span class="LIDENT">w</span></a><span class="EOL">
</span>                          <span class="IN">in</span><span class="EOL">
</span>                          <a href="#local_map_map_137"><span class="LIDENT">map_map</span></a> <span class="LPAREN">(</span><a href="#local_map_map_137"><span class="LIDENT">map_map</span></a> <a href="#local_update_148"><span class="LIDENT">update</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dist_136"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="#local_g_143"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_src_144"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_dist_145"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_pred_e"><span class="LIDENT">fold_pred_e</span></span> <span id="local_f_152"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_153"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_pred_e</span> <a href="#local_f_152"><span class="LIDENT">f</span></a> <a href="#local_g_153"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_pred_e"><span class="LIDENT">iter_pred_e</span></span> <span id="local_f_154"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_155"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_pred_e</span> <a href="#local_f_154"><span class="LIDENT">f</span></a> <a href="#local_g_155"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_succ_e"><span class="LIDENT">fold_succ_e</span></span> <span id="local_f_156"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_157"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ_e</span> <a href="#local_f_156"><span class="LIDENT">f</span></a> <a href="#local_g_157"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_succ_e"><span class="LIDENT">iter_succ_e</span></span> <span id="local_f_158"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_159"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_succ_e</span> <a href="#local_f_158"><span class="LIDENT">f</span></a> <a href="#local_g_159"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_pred"><span class="LIDENT">fold_pred</span></span> <span id="local_f_160"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_161"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_pred</span> <a href="#local_f_160"><span class="LIDENT">f</span></a> <a href="#local_g_161"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_succ"><span class="LIDENT">fold_succ</span></span> <span id="local_f_162"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_163"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ</span> <a href="#local_f_162"><span class="LIDENT">f</span></a> <a href="#local_g_163"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_pred"><span class="LIDENT">iter_pred</span></span> <span id="local_f_164"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_165"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_pred</span> <a href="#local_f_164"><span class="LIDENT">f</span></a> <a href="#local_g_165"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_succ"><span class="LIDENT">iter_succ</span></span> <span id="local_f_166"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_167"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_succ</span> <a href="#local_f_166"><span class="LIDENT">f</span></a> <a href="#local_g_167"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_edges_e"><span class="LIDENT">fold_edges_e</span></span> <span id="local_f_168"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_169"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_edges_e</span> <a href="#local_f_168"><span class="LIDENT">f</span></a> <a href="#local_g_169"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_edges_e"><span class="LIDENT">iter_edges_e</span></span> <span id="local_f_170"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_171"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_edges_e</span> <a href="#local_f_170"><span class="LIDENT">f</span></a> <a href="#local_g_171"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_edges"><span class="LIDENT">fold_edges</span></span> <span id="local_f_172"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_173"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_edges</span> <a href="#local_f_172"><span class="LIDENT">f</span></a> <a href="#local_g_173"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_edges"><span class="LIDENT">iter_edges</span></span> <span id="local_f_174"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_175"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_edges</span> <a href="#local_f_174"><span class="LIDENT">f</span></a> <a href="#local_g_175"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-fold_vertex"><span class="LIDENT">fold_vertex</span></span> <span id="local_f_176"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_177"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_vertex</span> <a href="#local_f_176"><span class="LIDENT">f</span></a> <a href="#local_g_177"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-iter_vertex"><span class="LIDENT">iter_vertex</span></span> <span id="local_f_178"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_179"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_vertex</span> <a href="#local_f_178"><span class="LIDENT">f</span></a> <a href="#local_g_179"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-pred_e"><span class="LIDENT">pred_e</span></span> <span class="LPAREN">(</span><span id="local_g_180"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred_e</span> <a href="#local_g_180"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-succ_e"><span class="LIDENT">succ_e</span></span> <span class="LPAREN">(</span><span id="local_g_181"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">succ_e</span> <a href="#local_g_181"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-pred"><span class="LIDENT">pred</span></span> <span class="LPAREN">(</span><span id="local_g_182"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred</span> <a href="#local_g_182"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-succ"><span class="LIDENT">succ</span></span> <span class="LPAREN">(</span><span id="local_g_183"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">succ</span> <a href="#local_g_183"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-find_all_edges"><span class="LIDENT">find_all_edges</span></span> <span class="LPAREN">(</span><span id="local_g_184"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">find_all_edges</span> <a href="#local_g_184"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-find_edge"><span class="LIDENT">find_edge</span></span> <span class="LPAREN">(</span><span id="local_g_185"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">find_edge</span> <a href="#local_g_185"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-mem_edge_e"><span class="LIDENT">mem_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_186"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_186"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-mem_edge"><span class="LIDENT">mem_edge</span></span> <span class="LPAREN">(</span><span id="local_g_187"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_187"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-mem_vertex"><span class="LIDENT">mem_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_188"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_vertex</span> <a href="#local_g_188"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-in_degree"><span class="LIDENT">in_degree</span></span> <span class="LPAREN">(</span><span id="local_g_189"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">in_degree</span> <a href="#local_g_189"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-out_degree"><span class="LIDENT">out_degree</span></span> <span class="LPAREN">(</span><span id="local_g_190"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">out_degree</span> <a href="#local_g_190"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-nb_edges"><span class="LIDENT">nb_edges</span></span> <span class="LPAREN">(</span><span id="local_g_191"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_edges</span> <a href="#local_g_191"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-nb_vertex"><span class="LIDENT">nb_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_192"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_vertex</span> <a href="#local_g_192"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-is_empty"><span class="LIDENT">is_empty</span></span> <span class="LPAREN">(</span><span id="local_g_193"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_g_193"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Imperative.val-is_directed"><span class="LIDENT">is_directed</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">is_directed</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Imperative.module-Mark"><span class="MODULE">module</span> <span class="UIDENT">Mark</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Imperative.module-Mark.type-graph"><span class="TYPE">type</span> <span class="LIDENT">graph</span> <span class="EQUAL">=</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>    <span id="module-Imperative.module-Mark.type-vertex"><span class="TYPE">type</span> <span class="LIDENT">vertex</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">vertex</span></span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Imperative.module-Mark.val-clear"><span class="LIDENT">clear</span></span> <span id="local_g_194"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LET">let</span> <span id="def_366"><span class="LPAREN">(</span><span id="local_g_195"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="#local_g_194"><span class="LIDENT">g</span></a> <span class="IN">in</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">Mark</span><span class="DOT">.</span><span class="LIDENT">clear</span> <a href="#local_g_195"><span class="LIDENT">g</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Imperative.module-Mark.val-get"><span class="LIDENT">get</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">Mark</span><span class="DOT">.</span><span class="LIDENT">get</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Imperative.module-Mark.val-set"><span class="LIDENT">set</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">Mark</span><span class="DOT">.</span><span class="LIDENT">set</span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Persistent"><span class="MODULE">module</span> <span class="UIDENT">Persistent</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="COLON">:</span> <span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">P</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">W</span><span class="COLON">:</span> <span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">WEIGHT</span> <span class="WITH">with</span> <span id="def_386"><span class="TYPE">type</span> <span class="LIDENT">edge</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Persistent.module-S"><span class="MODULE">module</span> <span class="UIDENT">S</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/set.ml.html#module-Make"><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-Persistent.module-M"><span class="MODULE">module</span> <span class="UIDENT">M</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/map.ml.html#module-Make"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Persistent.module-E"><span class="MODULE">module</span> <span class="UIDENT">E</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span></span><span class="EOL">
</span>  <span id="module-Persistent.module-V"><span class="MODULE">module</span> <span class="UIDENT">V</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* [G.t] represents graph itself.  [unit M.t] maintains a list of
     source vertices to keep track of distances for all vertices.
     [(G.E.t option * W.t) M.t M.t] holds mappings for all vertices,
     each of which contains its shortest-path tree ancestor (parent)
     and a distances from source vertices. *)</span><span class="EOL">
</span>  <span id="module-Persistent.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span> <span class="STAR">*</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="module-Persistent.type-edge"><span class="TYPE">type</span> <span class="LIDENT">edge</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">edge</span></span><span class="EOL">
</span>  <span id="module-Persistent.type-vertex"><span class="TYPE">type</span> <span class="LIDENT">vertex</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">vertex</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* If an edge is going to be added to the graph, which will cause
     a negative cycle, raises [Negative_cycle] with edges that can
     form such the cycle. *)</span><span class="EOL">
</span>  <span id="module-Persistent.exception-Negative_cycle"><span class="EXCEPTION">exception</span> <span class="UIDENT">Negative_cycle</span> <span class="OF">of</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-empty"><span class="LIDENT">empty</span></span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_g_196"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_src_197"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dist_198"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="#local_g_196"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_197"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_198"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-add_vertex"><span class="LIDENT">add_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_199"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_200"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_201"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v_202"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Before adding vertex to the graph, make sure that the vertex
       is not in the graph.  If already in the graph, just do
       nothing and return as is. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_vertex</span> <a href="#local_g_199"><span class="LIDENT">g</span></a> <a href="#local_v_202"><span class="LIDENT">v</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_199"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_200"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_201"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="COMMENT">(* Add a vertex to the original one *)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_vertex</span> <a href="#local_g_199"><span class="LIDENT">g</span></a> <a href="#local_v_202"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="COMMA">,</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* The new vertex will immediately be added to the source list *)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_202"><span class="LIDENT">v</span></a> <a href="#local_src_200"><span class="LIDENT">src</span></a><span class="RPAREN">)</span><span class="COMMA">,</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* The new edge should contain a distance mapping with only
         from myself with distance zero. *)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_202"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_202"><span class="LIDENT">v</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="#local_dist_201"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Persistent.val-propagate"><span class="LIDENT">propagate</span></span> <span class="LPAREN">(</span><span id="local_g_203"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_204"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_205"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_q_206"><span class="LIDENT">q</span></span> <span id="local_start_207"><span class="LIDENT">start</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-is_empty"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">is_empty</span></a> <a href="#local_q_206"><span class="LIDENT">q</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><a href="#local_g_203"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_204"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_205"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_382"><span class="LPAREN">(</span><span id="local_v1_208"><span class="LIDENT">v1</span></span><span class="COMMA">,</span> <span id="local_v1src_209"><span class="LIDENT">v1src</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-pop"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">pop</span></a> <a href="#local_q_206"><span class="LIDENT">q</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v1dist_210"><span class="LIDENT">v1dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_208"><span class="LIDENT">v1</span></a> <a href="#local_dist_205"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dist_211"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_212"><span class="LIDENT">e</span></span> <span id="local_dist_213"><span class="LIDENT">dist</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_v2_214"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_212"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_v2dist_215"><span class="LIDENT">v2dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v2_214"><span class="LIDENT">v2</span></a> <a href="#local_dist_213"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="COMMENT">(* Compare distances from given source vertices.
                   If relax happens, record it to the new list. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="def_370"><span class="LPAREN">(</span><span id="local_v2dist_216"><span class="LIDENT">v2dist</span></span><span class="COMMA">,</span> <span id="local_nextSrc_217"><span class="LIDENT">nextSrc</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_218"><span class="LIDENT">x</span></span> <span class="LPAREN">(</span><span id="local_v2dist_219"><span class="LIDENT">v2dist</span></span><span class="COMMA">,</span> <span id="local_nextSrc_220"><span class="LIDENT">nextSrc</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="def_379"><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_dev1_221"><span class="LIDENT">dev1</span></span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_218"><span class="LIDENT">x</span></a> <a href="#local_v1dist_210"><span class="LIDENT">v1dist</span></a> <span class="IN">in</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_ndev2_222"><span class="LIDENT">ndev2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_dev1_221"><span class="LIDENT">dev1</span></a> <span class="LPAREN">(</span><span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">weight</span> <a href="#local_e_212"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_improvement_223"><span class="LIDENT">improvement</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>                <span class="TRY">try</span><span class="EOL">
</span>                  <span class="LET">let</span> <span id="def_385"><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_dev2_224"><span class="LIDENT">dev2</span></span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_218"><span class="LIDENT">x</span></a> <a href="#local_v2dist_219"><span class="LIDENT">v2dist</span></a> <span class="IN">in</span><span class="EOL">
</span>                  <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">compare</span> <a href="#local_ndev2_222"><span class="LIDENT">ndev2</span></a> <a href="#local_dev2_224"><span class="LIDENT">dev2</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span><span class="EOL">
</span>                <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span> <span class="IN">in</span><span class="EOL">
</span>              <span class="IF">if</span> <a href="#local_improvement_223"><span class="LIDENT">improvement</span></a> <span class="THEN">then</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_v2dist_225"><span class="LIDENT">v2dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_218"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_e_212"><span class="LIDENT">e</span></a><span class="COMMA">,</span> <a href="#local_ndev2_222"><span class="LIDENT">ndev2</span></a><span class="RPAREN">)</span> <a href="#local_v2dist_219"><span class="LIDENT">v2dist</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_nextSrc_226"><span class="LIDENT">nextSrc</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_218"><span class="LIDENT">x</span></a> <a href="#local_nextSrc_220"><span class="LIDENT">nextSrc</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="#local_v2dist_225"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_226"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="ELSE">else</span><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="#local_v2dist_219"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_220"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="RPAREN">)</span> <a href="#local_v1src_209"><span class="LIDENT">v1src</span></a> <span class="LPAREN">(</span><a href="#local_v2dist_215"><span class="LIDENT">v2dist</span></a><span class="COMMA">,</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>          <span class="IF">if</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_nextSrc_217"><span class="LIDENT">nextSrc</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_dist_213"><span class="LIDENT">dist</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_start_207"><span class="LIDENT">start</span></a> <a href="#local_v2_214"><span class="LIDENT">v2</span></a> <span class="THEN">then</span><span class="EOL">
</span>            <span class="COMMENT">(* Propagation reaches back to the starting node, which
               immediately means presence of a negative cycle. *)</span><span class="EOL">
</span><span class="EOL">
</span>            <span class="COMMENT">(* We should use one of 'src' to traverse to the start node *)</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_s_227"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">choose</span> <a href="#local_nextSrc_217"><span class="LIDENT">nextSrc</span></a> <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span class="REC">rec</span> <span id="local_build_cycle_228"><span class="LIDENT">build_cycle</span></span> <span id="local_x_229"><span class="LIDENT">x</span></span> <span id="local_ret_230"><span class="LIDENT">ret</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>              <span class="MATCH">match</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_s_227"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_x_229"><span class="LIDENT">x</span></a> <a href="#local_dist_213"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_231"><span class="LIDENT">e</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_y_232"><span class="LIDENT">y</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_231"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_cycle_233"><span class="LIDENT">cycle</span></span> <span class="EQUAL">=</span> <a href="#local_e_231"><span class="LIDENT">e</span></a> <span class="COLONCOLON">::</span> <a href="#local_ret_230"><span class="LIDENT">ret</span></a> <span class="IN">in</span><span class="EOL">
</span>                <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_start_207"><span class="LIDENT">start</span></a> <a href="#local_y_232"><span class="LIDENT">y</span></a> <span class="THEN">then</span> <a href="#local_cycle_233"><span class="LIDENT">cycle</span></a><span class="EOL">
</span>                <span class="ELSE">else</span> <a href="#local_build_cycle_228"><span class="LIDENT">build_cycle</span></a> <a href="#local_y_232"><span class="LIDENT">y</span></a> <a href="#local_cycle_233"><span class="LIDENT">cycle</span></a><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Negative_cycle</span> <span class="LPAREN">(</span><a href="#local_build_cycle_228"><span class="LIDENT">build_cycle</span></a> <a href="#local_v2_214"><span class="LIDENT">v2</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="ELSE">else</span><span class="EOL">
</span>            <span class="BEGIN">begin</span><span class="EOL">
</span>              <span class="COMMENT">(* TODO: Some room for improvement.
                 If queue has (v2, s) already, technically we can merge
                 nextSrc into s, so that the number of propagation can be
                 reduced. *)</span><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-push"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">push</span></a> <span class="LPAREN">(</span><a href="#local_v2_214"><span class="LIDENT">v2</span></a><span class="COMMA">,</span> <a href="#local_nextSrc_217"><span class="LIDENT">nextSrc</span></a><span class="RPAREN">)</span> <a href="#local_q_206"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>              <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_214"><span class="LIDENT">v2</span></a> <a href="#local_v2dist_216"><span class="LIDENT">v2dist</span></a> <a href="#local_dist_213"><span class="LIDENT">dist</span></a><span class="EOL">
</span>            <span class="END">end</span><span class="EOL">
</span>        <span class="RPAREN">)</span> <a href="#local_g_203"><span class="LIDENT">g</span></a> <a href="#local_v1_208"><span class="LIDENT">v1</span></a> <a href="#local_dist_205"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_203"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_204"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_211"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_206"><span class="LIDENT">q</span></a> <a href="#local_start_207"><span class="LIDENT">start</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-m_cardinal"><span class="LIDENT">m_cardinal</span></span> <span id="local_m_234"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="UNDERSCORE">_</span> <span id="local_acc_235"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_235"><span class="LIDENT">acc</span></a><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a><span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_m_234"><span class="LIDENT">m</span></a> <span class="INT">0</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-set_of_map"><span class="LIDENT">set_of_map</span></span> <span id="local_m_236"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_k_237"><span class="LIDENT">k</span></span> <span class="UNDERSCORE">_</span> <span id="local_acc_238"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_k_237"><span class="LIDENT">k</span></a> <a href="#local_acc_238"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_m_236"><span class="LIDENT">m</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-add_edge_internal"><span class="LIDENT">add_edge_internal</span></span> <span class="LPAREN">(</span><span id="local_g_239"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_240"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_241"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_242"><span class="LIDENT">v1</span></span> <span id="local_v2_243"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Distance mappings at v1 *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dv1_244"><span class="LIDENT">dv1</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_242"><span class="LIDENT">v1</span></a> <a href="#local_dist_241"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* To reduce the amount of codes, we just start propagation from
       v1. Of course, this can be optimized by starting from v2. But
       it may duplicate the same code in multiple places in the
       file. In addition, such an optimization only cost for small
       amount, which precisely is the operations to relax edges from
       v1, other than which have been existed before this
       [add_edge_e] call. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_q_245"><span class="LIDENT">q</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-create"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* We need to check whether v2 should be kept in the source list
       or not.  That is, if there maybe a cycle with v1, the
       distance from v1 should be still maintained. Otherwise,
       simply ignore the distance from v2 *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="LIDENT">m_cardinal</span> <a href="#local_dv1_244"><span class="LIDENT">dv1</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">1</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_243"><span class="LIDENT">v2</span></a> <a href="#local_dv1_244"><span class="LIDENT">dv1</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="COMMENT">(* Now we definitely introduced a loop (but possibly non-negative)!
         Let me see if this would be negative or not... *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v1_242"><span class="LIDENT">v1</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_243"><span class="LIDENT">v2</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_245"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_239"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_240"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_241"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_245"><span class="LIDENT">q</span></a> <a href="#local_v1_242"><span class="LIDENT">v1</span></a><span class="EOL">
</span>    <span class="RPAREN">)</span> <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="COMMENT">(* Or even if we fall back to else-clause here, the edge addition
               may have introduced a cycle. Anyway, we need to check if one is
               newly created or not at [propagate] *)</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_364"><span class="LPAREN">(</span><span id="local_src_246"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_247"><span class="LIDENT">dist</span></span><span class="COMMA">,</span> <span id="local_dv1_248"><span class="LIDENT">dv1</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_243"><span class="LIDENT">v2</span></a> <a href="#local_src_240"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>          <span class="COMMENT">(* If v2 isn't one of the source vertices, just simply do
             propagation. *)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="#local_src_240"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_241"><span class="LIDENT">dist</span></a><span class="COMMA">,</span> <a href="#local_dv1_244"><span class="LIDENT">dv1</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span><span class="EOL">
</span>          <span class="COMMENT">(* We can exclude v2 from the list of source because
                   one can reach v2 from some other vertex. *)</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v2_243"><span class="LIDENT">v2</span></a> <a href="#local_src_240"><span class="LIDENT">src</span></a><span class="RPAREN">)</span><span class="COMMA">,</span><span class="EOL">
</span><span class="EOL">
</span>           <span class="COMMENT">(* Note that following line can be skipped only if the
              user don't remove vertex. Otherwise, such operation
              like [add_edge g v1 v2] &gt; [remove_vertex g v2] &gt;
              [add_vertex g v2] can result in unexpected
              behaviour. *)</span><span class="EOL">
</span>           <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v2_243"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span> <a href="#local_dist_241"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="COMMA">,</span><span class="EOL">
</span><span class="EOL">
</span>           <span class="COMMENT">(* We need to re-obtain the distance mappings at v1,
                    since it can be changed by the line above. *)</span><span class="EOL">
</span>           <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v1_242"><span class="LIDENT">v1</span></a> <a href="#local_dist_241"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* Now let's start propagation. *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v1_242"><span class="LIDENT">v1</span></a><span class="COMMA">,</span> <span class="LIDENT">set_of_map</span> <a href="#local_dv1_248"><span class="LIDENT">dv1</span></a><span class="RPAREN">)</span> <a href="#local_q_245"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_239"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_246"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_247"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_245"><span class="LIDENT">q</span></a> <a href="#local_v1_242"><span class="LIDENT">v1</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-add_edge_e"><span class="LIDENT">add_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_249"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_250"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_251"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_e_252"><span class="LIDENT">e</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Before adding edge to the graph, make sure that the edge is
       not in the graph.  If already in the graph, just do nothing
       and return as is. *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_249"><span class="LIDENT">g</span></a> <a href="#local_e_252"><span class="LIDENT">e</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_249"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_250"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_251"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="COMMENT">(* Vertices involved *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v1_253"><span class="LIDENT">v1</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_252"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v2_254"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_252"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_365"><span class="LPAREN">(</span><span id="local_g_255"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_256"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_257"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a><span class="EOL">
</span>          <span class="LIDENT">add_vertex</span> <span class="LPAREN">(</span><a href="#local_g_249"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_250"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_251"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <span class="LBRACKET">[</span><a href="#local_v1_253"><span class="LIDENT">v1</span></a> <span class="SEMI">;</span> <a href="#local_v2_254"><span class="LIDENT">v2</span></a><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_g_258"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_edge_e</span> <a href="#local_g_255"><span class="LIDENT">g</span></a> <a href="#local_e_252"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">add_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_258"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_256"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_257"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_v1_253"><span class="LIDENT">v1</span></a> <a href="#local_v2_254"><span class="LIDENT">v2</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-add_edge"><span class="LIDENT">add_edge</span></span> <span class="LPAREN">(</span><span id="local_g_259"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_260"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_261"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_262"><span class="LIDENT">v1</span></span> <span id="local_v2_263"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge_e] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_259"><span class="LIDENT">g</span></a> <a href="#local_v1_262"><span class="LIDENT">v1</span></a> <a href="#local_v2_263"><span class="LIDENT">v2</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_259"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_260"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_261"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_368"><span class="LPAREN">(</span><span id="local_g_264"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_265"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_266"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a><span class="EOL">
</span>          <span class="LIDENT">add_vertex</span> <span class="LPAREN">(</span><a href="#local_g_259"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_260"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_261"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <span class="LBRACKET">[</span><a href="#local_v1_262"><span class="LIDENT">v1</span></a> <span class="SEMI">;</span> <a href="#local_v2_263"><span class="LIDENT">v2</span></a><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_g_267"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">add_edge</span> <a href="#local_g_264"><span class="LIDENT">g</span></a> <a href="#local_v1_262"><span class="LIDENT">v1</span></a> <a href="#local_v2_263"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">add_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_267"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_265"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_266"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_v1_262"><span class="LIDENT">v1</span></a> <a href="#local_v2_263"><span class="LIDENT">v2</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-remove_edge_internal"><span class="LIDENT">remove_edge_internal</span></span> <span class="LPAREN">(</span><span id="local_g_268"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_269"><span class="LIDENT">src</span></span><span class="RPAREN">)</span> <span id="local_v2_270"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Actually, we need to rebuild the distance table, rather than
       traverse precedants to remove the edge. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_q_271"><span class="LIDENT">q</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-create"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">create</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dist_272"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_273"><span class="LIDENT">x</span></span> <span id="local_dist_274"><span class="LIDENT">dist</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_x_273"><span class="LIDENT">x</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_273"><span class="LIDENT">x</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_271"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_273"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_x_273"><span class="LIDENT">x</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="#local_dist_274"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_src_269"><span class="LIDENT">src</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span>  <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_363"><span id="local_g_275"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_276"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_277"><span class="LIDENT">dist</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_268"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_269"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_272"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_271"><span class="LIDENT">q</span></a> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">choose</span> <a href="#local_src_269"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_v2_270"><span class="LIDENT">v2</span></a> <a href="#local_dist_277"><span class="LIDENT">dist</span></a> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_275"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_276"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_277"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/queue.ml.html#val-add"><span class="UIDENT">Queue</span><span class="DOT">.</span><span class="LIDENT">add</span></a> <span class="LPAREN">(</span><a href="#local_v2_270"><span class="LIDENT">v2</span></a><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_270"><span class="LIDENT">v2</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_q_271"><span class="LIDENT">q</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_src_278"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_270"><span class="LIDENT">v2</span></a> <a href="#local_src_276"><span class="LIDENT">src</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dist_279"><span class="LIDENT">dist</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_270"><span class="LIDENT">v2</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v2_270"><span class="LIDENT">v2</span></a> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">W</span><span class="DOT">.</span><span class="LIDENT">zero</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span> <a href="#local_dist_277"><span class="LIDENT">dist</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">propagate</span> <span class="LPAREN">(</span><a href="#local_g_275"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_278"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_279"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span> <a href="#local_q_271"><span class="LIDENT">q</span></a> <a href="#local_v2_270"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-remove_edge_e"><span class="LIDENT">remove_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_280"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_281"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_282"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_e_283"><span class="LIDENT">e</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge_e] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_280"><span class="LIDENT">g</span></a> <a href="#local_e_283"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_280"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_281"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_282"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_g_284"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge_e</span> <a href="#local_g_280"><span class="LIDENT">g</span></a> <a href="#local_e_283"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="COMMENT">(* Vertices involved *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_v2_285"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_283"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LIDENT">remove_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_284"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_281"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <a href="#local_v2_285"><span class="LIDENT">v2</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-remove_edge"><span class="LIDENT">remove_edge</span></span> <span class="LPAREN">(</span><span id="local_g_286"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_287"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_288"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span id="local_v1_289"><span class="LIDENT">v1</span></span> <span id="local_v2_290"><span class="LIDENT">v2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Same as [add_edge] *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_286"><span class="LIDENT">g</span></a> <a href="#local_v1_289"><span class="LIDENT">v1</span></a> <a href="#local_v2_290"><span class="LIDENT">v2</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_g_286"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_287"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <a href="#local_dist_288"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_g_291"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_edge</span> <a href="#local_g_286"><span class="LIDENT">g</span></a> <a href="#local_v1_289"><span class="LIDENT">v1</span></a> <a href="#local_v2_290"><span class="LIDENT">v2</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">remove_edge_internal</span> <span class="LPAREN">(</span><a href="#local_g_291"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_src_287"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <a href="#local_v2_290"><span class="LIDENT">v2</span></a><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-remove_vertex"><span class="LIDENT">remove_vertex</span></span> <span id="local_t_292"><span class="LIDENT">t</span></span> <span id="local_v_293"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* [remove_vertex] first deletes all outgoing edges from [v] *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_373"><span class="LPAREN">(</span><span id="local_g_294"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="#local_t_292"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_t_295"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_296"><span class="LIDENT">e</span></span> <span id="local_t_297"><span class="LIDENT">t</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">remove_edge_e</span> <a href="#local_t_297"><span class="LIDENT">t</span></a> <a href="#local_e_296"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <a href="#local_g_294"><span class="LIDENT">g</span></a> <a href="#local_v_293"><span class="LIDENT">v</span></a> <a href="#local_t_292"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Then after, deletes all incoming edges to [v] *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_367"><span class="LPAREN">(</span><span id="local_g_298"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="#local_t_295"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_t_299"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_pred_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_e_300"><span class="LIDENT">e</span></span> <span id="local_t_301"><span class="LIDENT">t</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">remove_edge_e</span> <a href="#local_t_301"><span class="LIDENT">t</span></a> <a href="#local_e_300"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <a href="#local_g_298"><span class="LIDENT">g</span></a> <a href="#local_v_293"><span class="LIDENT">v</span></a> <a href="#local_t_295"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Note that we are iterating on [g] that is being modified during
       iteration. We can do such an above iteration since G is here
       permanent. Do not try this for imperative graph. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_378"><span class="LPAREN">(</span><span id="local_g_302"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_303"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_304"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span></span> <span class="EQUAL">=</span> <a href="#local_t_299"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* Now we can feel free to delete [v]. *)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">remove_vertex</span> <a href="#local_g_302"><span class="LIDENT">g</span></a> <a href="#local_v_293"><span class="LIDENT">v</span></a><span class="COMMA">,</span><span class="EOL">
</span>     <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v_293"><span class="LIDENT">v</span></a> <a href="#local_src_303"><span class="LIDENT">src</span></a><span class="RPAREN">)</span><span class="COMMA">,</span><span class="EOL">
</span>     <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_v_293"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_dist_304"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-map_vertex"><span class="LIDENT">map_vertex</span></span> <span id="local_f_305"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_306"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local_src_307"><span class="LIDENT">src</span></span><span class="COMMA">,</span> <span id="local_dist_308"><span class="LIDENT">dist</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_map_map_309"><span class="LIDENT">map_map</span></span> <span id="local_update_310"><span class="LIDENT">update</span></span> <span id="local_m_311"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_v_312"><span class="LIDENT">v</span></span> <span id="local_m_313"><span class="LIDENT">m</span></span> <span id="local_acc_314"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <span class="LPAREN">(</span><a href="#local_f_305"><span class="LIDENT">f</span></a> <a href="#local_v_312"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_update_310"><span class="LIDENT">update</span></a> <a href="#local_m_313"><span class="LIDENT">m</span></a><span class="RPAREN">)</span> <a href="#local_acc_314"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_m_311"><span class="LIDENT">m</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">map_vertex</span> <a href="#local_f_305"><span class="LIDENT">f</span></a> <a href="#local_g_306"><span class="LIDENT">g</span></a><span class="COMMA">,</span><span class="EOL">
</span>     <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_v_315"><span class="LIDENT">v</span></span> <span id="local_acc_316"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <span class="LPAREN">(</span><a href="#local_f_305"><span class="LIDENT">f</span></a> <a href="#local_v_315"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <a href="#local_acc_316"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_src_307"><span class="LIDENT">src</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="COMMA">,</span><span class="EOL">
</span>     <span class="LET">let</span> <span id="local_update_317"><span class="LIDENT">update</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_v_318"><span class="LIDENT">v</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_v_318"><span class="LIDENT">v</span></a><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_e_319"><span class="LIDENT">e</span></span><span class="COMMA">,</span> <span id="local_w_320"><span class="LIDENT">w</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_f_305"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_e_319"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">label</span> <a href="#local_e_319"><span class="LIDENT">e</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_f_305"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_e_319"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="COMMA">,</span> <a href="#local_w_320"><span class="LIDENT">w</span></a><span class="EOL">
</span>     <span class="IN">in</span><span class="EOL">
</span>     <a href="#local_map_map_309"><span class="LIDENT">map_map</span></a> <span class="LPAREN">(</span><a href="#local_map_map_309"><span class="LIDENT">map_map</span></a> <a href="#local_update_317"><span class="LIDENT">update</span></a><span class="RPAREN">)</span> <a href="#local_dist_308"><span class="LIDENT">dist</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* All below are wrappers *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_pred_e"><span class="LIDENT">fold_pred_e</span></span> <span id="local_f_321"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_322"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_pred_e</span> <a href="#local_f_321"><span class="LIDENT">f</span></a> <a href="#local_g_322"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_pred_e"><span class="LIDENT">iter_pred_e</span></span> <span id="local_f_323"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_324"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_pred_e</span> <a href="#local_f_323"><span class="LIDENT">f</span></a> <a href="#local_g_324"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_succ_e"><span class="LIDENT">fold_succ_e</span></span> <span id="local_f_325"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_326"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ_e</span> <a href="#local_f_325"><span class="LIDENT">f</span></a> <a href="#local_g_326"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_succ_e"><span class="LIDENT">iter_succ_e</span></span> <span id="local_f_327"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_328"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_succ_e</span> <a href="#local_f_327"><span class="LIDENT">f</span></a> <a href="#local_g_328"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_pred"><span class="LIDENT">fold_pred</span></span> <span id="local_f_329"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_330"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_pred</span> <a href="#local_f_329"><span class="LIDENT">f</span></a> <a href="#local_g_330"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_succ"><span class="LIDENT">fold_succ</span></span> <span id="local_f_331"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_332"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_succ</span> <a href="#local_f_331"><span class="LIDENT">f</span></a> <a href="#local_g_332"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_pred"><span class="LIDENT">iter_pred</span></span> <span id="local_f_333"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_334"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_pred</span> <a href="#local_f_333"><span class="LIDENT">f</span></a> <a href="#local_g_334"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_succ"><span class="LIDENT">iter_succ</span></span> <span id="local_f_335"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_336"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_succ</span> <a href="#local_f_335"><span class="LIDENT">f</span></a> <a href="#local_g_336"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_edges_e"><span class="LIDENT">fold_edges_e</span></span> <span id="local_f_337"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_338"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_edges_e</span> <a href="#local_f_337"><span class="LIDENT">f</span></a> <a href="#local_g_338"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_edges_e"><span class="LIDENT">iter_edges_e</span></span> <span id="local_f_339"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_340"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_edges_e</span> <a href="#local_f_339"><span class="LIDENT">f</span></a> <a href="#local_g_340"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_edges"><span class="LIDENT">fold_edges</span></span> <span id="local_f_341"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_342"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_edges</span> <a href="#local_f_341"><span class="LIDENT">f</span></a> <a href="#local_g_342"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_edges"><span class="LIDENT">iter_edges</span></span> <span id="local_f_343"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_344"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_edges</span> <a href="#local_f_343"><span class="LIDENT">f</span></a> <a href="#local_g_344"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-fold_vertex"><span class="LIDENT">fold_vertex</span></span> <span id="local_f_345"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_346"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_vertex</span> <a href="#local_f_345"><span class="LIDENT">f</span></a> <a href="#local_g_346"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-iter_vertex"><span class="LIDENT">iter_vertex</span></span> <span id="local_f_347"><span class="LIDENT">f</span></span> <span class="LPAREN">(</span><span id="local_g_348"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">iter_vertex</span> <a href="#local_f_347"><span class="LIDENT">f</span></a> <a href="#local_g_348"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-pred_e"><span class="LIDENT">pred_e</span></span> <span class="LPAREN">(</span><span id="local_g_349"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred_e</span> <a href="#local_g_349"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-succ_e"><span class="LIDENT">succ_e</span></span> <span class="LPAREN">(</span><span id="local_g_350"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">succ_e</span> <a href="#local_g_350"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-pred"><span class="LIDENT">pred</span></span> <span class="LPAREN">(</span><span id="local_g_351"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred</span> <a href="#local_g_351"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-succ"><span class="LIDENT">succ</span></span> <span class="LPAREN">(</span><span id="local_g_352"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">succ</span> <a href="#local_g_352"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-find_all_edges"><span class="LIDENT">find_all_edges</span></span> <span class="LPAREN">(</span><span id="local_g_353"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">find_all_edges</span> <a href="#local_g_353"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-find_edge"><span class="LIDENT">find_edge</span></span> <span class="LPAREN">(</span><span id="local_g_354"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">find_edge</span> <a href="#local_g_354"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-mem_edge_e"><span class="LIDENT">mem_edge_e</span></span> <span class="LPAREN">(</span><span id="local_g_355"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge_e</span> <a href="#local_g_355"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-mem_edge"><span class="LIDENT">mem_edge</span></span> <span class="LPAREN">(</span><span id="local_g_356"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_edge</span> <a href="#local_g_356"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-mem_vertex"><span class="LIDENT">mem_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_357"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">mem_vertex</span> <a href="#local_g_357"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-in_degree"><span class="LIDENT">in_degree</span></span> <span class="LPAREN">(</span><span id="local_g_358"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">in_degree</span> <a href="#local_g_358"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-out_degree"><span class="LIDENT">out_degree</span></span> <span class="LPAREN">(</span><span id="local_g_359"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">out_degree</span> <a href="#local_g_359"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-nb_edges"><span class="LIDENT">nb_edges</span></span> <span class="LPAREN">(</span><span id="local_g_360"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_edges</span> <a href="#local_g_360"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-nb_vertex"><span class="LIDENT">nb_vertex</span></span> <span class="LPAREN">(</span><span id="local_g_361"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_vertex</span> <a href="#local_g_361"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-is_empty"><span class="LIDENT">is_empty</span></span> <span class="LPAREN">(</span><span id="local_g_362"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_g_362"><span class="LIDENT">g</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Persistent.val-is_directed"><span class="LIDENT">is_directed</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">is_directed</span><span class="EOL">
</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span></span></code></pre></body></html>
