<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>dune (odoc.dune)</title><meta charset="utf-8"/><link rel="stylesheet" href="../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../';
let search_urls = ['sherlodoc_db.js','../sherlodoc.js'];
</script><script src="../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> ‚Äì <a href="../index.html">üè†</a> &#x00BB; <a href="index.html">The odoc documentation generator</a> &#x00BB; Dune and odoc</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1 id="dune-and-odoc"><a href="#dune-and-odoc" class="anchor"></a>Dune and odoc</h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#using_dune">Using Dune</a></li><li><a href="#library_wrapping">Dune's Library Wrapping</a></li><li><a href="#example">Example</a><ul><li><a href="#hand-written-top-level-module">Hand-Written Top-Level Module</a></li></ul></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="index.html">The odoc documentation generator</a><ul><li><a href="odoc_for_authors.html"><code>odoc</code> for Authors</a></li><li><a href="cheatsheet.html">Cheatsheet</a></li><li><a href="#" class="current_unit">Dune and odoc</a></li><li><a href="features.html">Language Features</a></li><li><a href="ocamldoc_differences.html">Markup Differences From OCamldoc</a></li><li><a href="interface.html"><code>odoc</code> Interface Guarantees</a></li><li><a href="driver.html">How to Drive <code>odoc</code></a></li><li><a href="json.html">JSON output</a></li><li><a href="deprecated/index.html">Deprecated features</a></li><li>Library <code>odoc.document</code><ul><li><a href="odoc.document/Odoc_document/index.html">Odoc_document</a></li></ul></li><li>Library <code>odoc.examples</code><ul><li><a href="odoc.examples/Odoc_examples/index.html">Odoc_examples</a></li></ul></li><li>Library <code>odoc.html</code><ul><li><a href="odoc.html/Odoc_html/index.html">Odoc_html</a></li></ul></li><li>Library <code>odoc.html_support_files</code><ul><li><a href="odoc.html_support_files/Odoc_html_support_files/index.html">Odoc_html_support_files</a></li></ul></li><li>Library <code>odoc.index</code><ul><li><a href="odoc.index/Odoc_index/index.html">Odoc_index</a></li></ul></li><li>Library <code>odoc.json_index</code><ul><li><a href="odoc.json_index/Odoc_json_index/index.html">Odoc_json_index</a></li></ul></li><li>Library <code>odoc.latex</code><ul><li><a href="odoc.latex/Odoc_latex/index.html">Odoc_latex</a></li></ul></li><li>Library <code>odoc.loader</code><ul><li><a href="odoc.loader/Odoc_loader/index.html">Odoc_loader</a></li></ul></li><li>Library <code>odoc.manpage</code><ul><li><a href="odoc.manpage/Odoc_manpage/index.html">Odoc_manpage</a></li></ul></li><li>Library <code>odoc.model</code><ul><li><a href="odoc.model/Odoc_model/index.html">Odoc_model</a></li></ul></li><li>Library <code>odoc.model_desc</code><ul><li><a href="odoc.model_desc/Odoc_model_desc/index.html">Odoc_model_desc</a></li></ul></li><li>Library <code>odoc.ocamlary</code><ul><li><a href="odoc.ocamlary/Ocamlary/index.html">Ocamlary</a></li></ul></li><li>Library <code>odoc.occurrences</code><ul><li><a href="odoc.occurrences/Odoc_occurrences/index.html">Odoc_occurrences</a></li></ul></li><li>Library <code>odoc.odoc</code><ul><li><a href="odoc.odoc/Odoc_odoc/index.html">Odoc_odoc</a></li></ul></li><li>Library <code>odoc.odoc_utils</code><ul><li><a href="odoc.odoc_utils/Odoc_utils/index.html">Odoc_utils</a></li></ul></li><li>Library <code>odoc.search</code><ul><li><a href="odoc.search/Odoc_search/index.html">Odoc_search</a></li></ul></li><li>Library <code>odoc.search_html_frontend</code><ul><li><a href="odoc.search_html_frontend/Odoc_html_frontend/index.html">Odoc_html_frontend</a></li></ul></li><li>Library <code>odoc.syntax_highlighter</code><ul><li><a href="odoc.syntax_highlighter/Syntax_highlighter/index.html">Syntax_highlighter</a></li></ul></li><li>Library <code>odoc.xref2</code><ul><li><a href="odoc.xref2/Odoc_xref2/index.html">Odoc_xref2</a></li></ul></li><li>Library <code>odoc.xref_test</code><ul><li><a href="odoc.xref_test/Odoc_xref_test/index.html">Odoc_xref_test</a></li></ul></li><li><a href="src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="using_dune"><a href="#using_dune" class="anchor"></a>Using Dune</h2><p>To create docs with <code>odoc</code> and Dune is straightforward, but there is an important point to know: Dune only creates docs for <em>public packages</em>, so you will need a <code>(public_name ...)</code> stanza in your libraries and a corresponding <code>lib.opam</code> file in the root of your project.</p><p>The following files are a simple example:</p><ul><li><p><code>dune-project</code></p><pre class="language-text"><code>(lang dune 2.0)</code></pre></li><li><p><code>dune</code></p><pre class="language-text"><code>(library
  (public_name lib))</code></pre></li><li><p><code>a.ml</code></p><pre class="language-ocaml"><code>(** Module A *)

type t = int (** My type *)</code></pre></li><li><code>lib.opam</code> - this file need only <em>exist</em>, i.e., <code>touch lib.opam</code> is sufficient.</li></ul><p>Dune creates the docs for these with this command:</p><pre class="language-sh"><code>$ dune build @doc</code></pre><p>The results will be in <code>_build/default/_doc/_html/</code>.</p><h2 id="library_wrapping"><a href="#library_wrapping" class="anchor"></a>Dune's Library Wrapping</h2><p>Dune has a feature whereby a library may be exposed under a single top-level module. This employs an OCaml feature where using the compiler flag <code>-no-alias-deps</code> will avoid introducing dependencies between compilation units.</p><p>We aim to reduce the potential name clashes of modules by only exposing one main module for library users, encapsulating all other modules as submodules, while still retaining the usual way of writing OCaml code with one module per file. These individual files are still compiled, installed, and available in the global namespace, but their names are prefixed with the library's name in order to reduce the possibility of clashes. These prefixed modules are not intended to be used directly, so Dune includes canonical tags for these modules for <code>odoc</code> to ensure they don't 'leak' into the documentation.</p><h2 id="example"><a href="#example" class="anchor"></a>Example</h2><p>Given two modules: <code>A</code> and <code>B</code>, with <code>B</code> referencing types declared in module <code>A</code>:</p><pre class="language-ocaml"><code>(** Module A *)
type t</code></pre><pre class="language-ocaml"><code>(** Module B *)
type t = A.t</code></pre><p>If these modules are to become part of a library called <code>Lib</code>, then Dune will compile these two as if their names were <code>Lib__A</code> and <code>Lib__B</code> and also create a file <code>lib.ml</code> containing the following:</p><pre class="language-ocaml"><code>(** @canonical Lib.A *)
module A = Lib__A

(** @canonical Lib.B *)
module B = Lib__B</code></pre><p>This will be the one module intended to be used directly by the library's users. This module is in fact compiled <em>first</em>, using the compiler flag <code>--no-alias-deps</code>, which allows it to be compiled without requiring <code>Lib__A</code> and <code>Lib__B</code> to be compiled first.</p><p>Dune will then compile <code>a.ml</code> and <code>b.ml</code>, in that order, but ask the compiler to name them <code>Lib__A</code> and <code>Lib__B</code>. It also 'opens' the module <code>Lib</code>, which is what allows <code>B</code> to refer to <code>A.t</code>.</p><p>When <code>odoc</code> is used to produce documentation for this, firstly all modules are compiled, but only one module is considered to be visible: <code>Lib</code>. All others have double underscores meaning they are hidden. Only the non-hidden module <code>Lib</code> is linked, and during this process, the the modules <code>A</code> and <code>B</code> are expanded because they are aliases of hidden modules. All references to <code>Lib__A</code> and <code>Lib__B</code> are replaced with the canonical paths <code>Lib.A</code> and <code>Lib.B</code>, so in this way, <code>odoc</code> presents the library as entirely contained within the module <code>Lib</code>.</p><h3 id="hand-written-top-level-module"><a href="#hand-written-top-level-module" class="anchor"></a>Hand-Written Top-Level Module</h3><p>In some cases it's desirable to hand-write the top-level library module. This is usually done because some modules in the library are intended to be internal only and not exposed. Dune will notice that a module exists with the library's name (<code>lib.ml</code> in this case), so instead it will create the file <code>lib__.ml</code>. Its contents are identical to the previous section, with aliases for all modules. Like before, the canonical tags on these aliases are references to <code>Lib.A</code> and <code>Lib.B</code>. These module should be present in <code>lib.ml</code> as module aliases. If these are <em>not</em> there, <code>odoc</code> won't be able to resolve the canonical references, and any items from these modules that are exposed elsewhere will be hidden. If the items are type aliases, they can be replaced, but otherwise they'll be rendered as unresolved links.</p><p>For example, consider the following module structure. First, the module <code>Unexposed</code> in file <code>unexposed.mli</code>:</p><pre class="language-ocaml"><code>(** Unexposed module *)

type t</code></pre><p>The module <code>Wrapping</code>, in file <code>wrapping.mli</code>:</p><pre class="language-ocaml"><code>(** Example of Dune's wrapping *)

type t = Unexposed.t

val f : Unexposed.t</code></pre><p>The library module that only exposes the module <code>Wrapping</code>:</p><pre class="language-ocaml"><code>module Wrapping = Wrapping</code></pre><p>This structure is rendered <a href="odoc.examples/Odoc_examples/Wrapping/index.html" title="Odoc_examples.Wrapping">here</a>.</p></div></body></html>
