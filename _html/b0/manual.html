<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>manual (b0.manual)</title><meta charset="utf-8"/><link rel="stylesheet" href="../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../';
let search_urls = ['sherlodoc_db.js','../sherlodoc.js'];
</script><script src="../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> ‚Äì <a href="../index.html">üè†</a> &#x00BB; <a href="index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; B0 manual</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1 id="b0-manual"><a href="#b0-manual" class="anchor"></a>B0 manual</h1><p>This manual provides a conceptual overview of the B0 system and explains the basic mechanics of B0 files and their definitions. See <span class="xref-unresolved" title="index.manuals">here</span> for other topics.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#intro">Introduction</a></li><li><a href="#b0_file">B0 files</a><ul><li><a href="#root_b0_file">Root B0 file</a></li><li><a href="#root_dir">Root and <code>_b0</code> directory</a></li><li><a href="#rel_paths">Relative file paths</a></li><li><a href="#inclusion">Including B0 files</a><ul><li><a href="#scope">Scopes</a></li><li><a href="#access">Access control and isolation</a></li><li><a href="#vendoring">Dependency vendoring</a></li></ul></li><li><a href="#libs">Using libraries</a></li><li><a href="#custom_defs">Custom local descriptions</a></li><li><a href="#boot">B0 file bootstrap</a></li></ul></li><li><a href="#definitions">B0 file definitions</a><ul><li><a href="#meta">Metadata</a></li><li><a href="#units">Build units</a></li><li><a href="#packs">Build packs</a><ul><li><a href="#default_pack">The <code>default</code> pack</a></li></ul></li><li><a href="#envs">Build environments</a><ul><li><a href="#default_env">The <code>default</code> environment</a></li><li><a href="#user_env">The <code>user</code> environment</a></li></ul></li><li><a href="#cmdlets">Cmdlets</a></li></ul></li><li><a href="#editor_support">Editor support</a><ul><li><a href="#emacs">Emacs</a></li></ul></li><li><a href="#b0_file_reference">B0 file reference</a><ul><li><a href="#b0_file_syntax">Syntax</a></li><li><a href="#directive_boot">Directive <code>@@@B0.boot</code></a></li><li><a href="#directive_include">Directive <code>@@@B0.include</code></a></li><li><a href="#directive_require">Directive <code>#require</code></a></li><li><a href="#directive_mod_use">Directive <code>#mod_use</code></a></li></ul></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="b00_manual.html">B00 manual</a></li><li><a href="cmdlet_manual.html">Cmdlet manual</a></li><li><a href="driver_dev.html">B0 driver development manual</a></li><li><a href="#" class="current_unit">B0 manual</a></li><li><a href="old_manual.html">B0 manual</a></li><li><a href="opam.html"><code>opam</code> support manual</a></li><li><a href="rationale.html">Why b0 ?</a></li><li><a href="release.html">B0 release support manual</a></li><li><a href="todo.html">Design considerations and todo</a></li><li><a href="unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="b0/B0_build/index.html">B0_build</a></li><li><a href="b0/B0_cli/index.html">B0_cli</a></li><li><a href="b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="b0/B0_def/index.html">B0_def</a></li><li><a href="b0/B0_dir/index.html">B0_dir</a></li><li><a href="b0/B0_driver/index.html">B0_driver</a></li><li><a href="b0/B0_file/index.html">B0_file</a></li><li><a href="b0/B0_meta/index.html">B0_meta</a></li><li><a href="b0/B0_pack/index.html">B0_pack</a></li><li><a href="b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="b0.b00/B00/index.html">B00</a></li><li><a href="b0.b00/B000/index.html">B000</a></li><li><a href="b0.b00/B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="b0.b00.kit/B00_base64/index.html">B00_base64</a></li><li><a href="b0.b00.kit/B00_cli/index.html">B00_cli</a></li><li><a href="b0.b00.kit/B00_cmark/index.html">B00_cmark</a></li><li><a href="b0.b00.kit/B00_editor/index.html">B00_editor</a></li><li><a href="b0.b00.kit/B00_fexts/index.html">B00_fexts</a></li><li><a href="b0.b00.kit/B00_findex/index.html">B00_findex</a></li><li><a href="b0.b00.kit/B00_github/index.html">B00_github</a></li><li><a href="b0.b00.kit/B00_htmlg/index.html">B00_htmlg</a></li><li><a href="b0.b00.kit/B00_http/index.html">B00_http</a></li><li><a href="b0.b00.kit/B00_jsoo/index.html">B00_jsoo</a></li><li><a href="b0.b00.kit/B00_lines/index.html">B00_lines</a></li><li><a href="b0.b00.kit/B00_ocaml/index.html">B00_ocaml</a></li><li><a href="b0.b00.kit/B00_odoc/index.html">B00_odoc</a></li><li><a href="b0.b00.kit/B00_os/index.html">B00_os</a></li><li><a href="b0.b00.kit/B00_pager/index.html">B00_pager</a></li><li><a href="b0.b00.kit/B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="b0.b00.kit/B00_rsync/index.html">B00_rsync</a></li><li><a href="b0.b00.kit/B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="b0.b00.kit/B00_serialk_sexp/index.html">B00_serialk_sexp</a></li><li><a href="b0.b00.kit/B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="b0.b00.kit/B00_trace/index.html">B00_trace</a></li><li><a href="b0.b00.kit/B00_vcs/index.html">B00_vcs</a></li><li><a href="b0.b00.kit/B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="b0.kit/B0_expect/index.html">B0_expect</a></li><li><a href="b0.kit/B0_jsoo/index.html">B0_jsoo</a></li><li><a href="b0.kit/B0_kit/index.html">B0_kit</a></li><li><a href="b0.kit/B0_ocaml/index.html">B0_ocaml</a></li><li><a href="b0.kit/B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="b0.kit/B0_opam/index.html">B0_opam</a></li><li><a href="b0.kit/B0_release/index.html">B0_release</a></li><li><a href="b0.kit/B0_srcs/index.html">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="intro"><a href="#intro" class="anchor"></a>Introduction</h2><p>B0 aims at liberating the programmer from the essential but tedious and brittle bureaucracy that surrounds the programming activity. It provides a system with a decent description language to devise modular and custom solutions to software construction and deployment problems.</p><p>B0 describes:</p><ul><li>Build environments.</li><li>Software configuration, build and testing.</li><li>Source or binary deployments.</li><li>Development life-cycle procedures.</li></ul><p>These descriptions are made in <em>B0 files</em> which we describe next.</p><h2 id="b0_file"><a href="#b0_file" class="anchor"></a>B0 files</h2><p>A B0 file is a syntactically valid OCaml file possibly prefixed by a few directives. The OCaml code creates definitions to describe the software by using the versioned <a href="b0.kit/B0_kit/index.html"><code>B0_kit</code></a> API and possibly other third-party OCaml libraries.</p><p>A B0 file is named <code>B0.ml</code> and is usually found at the root of the software project's source tree it describes.</p><p>The following is a simple <code>B0.ml</code> file that declares an executable to build from the OCaml <code>src/hello.ml</code> source and that uses the <code>cmdliner</code> OCaml library.</p><pre class="language-ocaml"><code>open B0_kit.V000

let cmdliner = B0_ocaml.libname &quot;cmdliner&quot;
let hello =
  let srcs = [`File &quot;src/hello.ml&quot;] in
  let requires = [cmdliner] in
  B0_ocaml.exe &quot;hello&quot; ~doc:&quot;Greeting tool&quot; ~srcs ~requires</code></pre><p>The definitions of B0 files are consulted and processed by <em>drivers</em>. The <code>b0</code> and <code>d0</code> tools distributed with B0 are examples of drivers. An API is provided to create custom driver, details can be found in the <a href="driver_dev.html" title="driver_dev">B0 driver development manual</a>.</p><h3 id="root_b0_file"><a href="#root_b0_file" class="anchor"></a>Root B0 file</h3><p>The B0 file executed by a driver is called the <em>root B0 file</em>. When a driver like <code>b0</code> is invoked in a current working directory <code>cwd</code>, the root B0 file is the <em>first</em> <code>B0.ml</code> file found starting at the <code>cwd</code> and moving upwards in parent directories.</p><p>The root B0 file can also be specified explicitely via the <code>--b0-file</code> option or the <code>B0_FILE</code> environment variable. The <code>b0 file</code> command allows to find out which root B0 file is determined by <code>b0</code> and provides a few actions on it:</p><pre>b0 file         # Show the absolute path to the root B0 file
b0 file edit    # Edit the root B0 file.
b0 file --help  # See all actions available on the B0 file</pre><h3 id="root_dir"><a href="#root_dir" class="anchor"></a>Root and <code>_b0</code> directory</h3><p>The <em>root directory</em> is the directory in which the <a href="#root_b0_file" title="root_b0_file">root B0 file</a> is found. The <code>b0 root</code> command shows that directly:</p><pre>b0 root  # Show the absolute path to the root directory, effectively
         # this is: dirname $(b0 file path)</pre><p>Most of the time the root directory is the root of a project's source tree. However as we will see below, a B0 file can gather multiple project definitions by <a href="#inclusion" title="inclusion">including</a> other B0 files. In this case the root directory may be unrelated to the directory of these B0 files and may well be empty.</p><p>The root directory is where the scratchable <em><code>_b0</code> directory</em> used by drivers to operate and store their results gets created by default. The location of the <code>_b0</code> directory can also be specified explicitely via the <code>--b0-dir</code> option or the <code>B0_DIR</code> environment variable. <code>_b0</code> directories should be ignored by version control systems:</p><pre>echo _b0 &gt;&gt; .gitignore  # Let git ignore the _b0 directory
echo _b0 &gt;&gt; .hgignore   # Let hg ignore the _b0 directory</pre><h3 id="rel_paths"><a href="#rel_paths" class="anchor"></a>Relative file paths</h3><p>Unless otherwise indicated relative file paths specified in definitions and directives of a specific B0 file are <em>always</em> relative to the directory of that B0 file.</p><p>In the B0 file example we gave above the <code>src/hello.ml</code> file is relative to the directory of the B0 file in which we wrote the definition.</p><h3 id="inclusion"><a href="#inclusion" class="anchor"></a>Including B0 files</h3><p>The <a href="#directive_include" title="directive_include"><code>@@@B0.include</code></a> directive provides a mecanism to compose B0 files. The intent of B0 file inclusion is to be able to aggregate independent software (sub)systems or to vendor dependencies. Include directives must be specified <em>at the start</em> of a B0 file, before comments or OCaml code.</p><p>For example the following <code>B0.ml</code> file includes the definitions of two other B0 files:</p><pre class="language-ocaml"><code>[@@@B0.include &quot;that&quot; &quot;../that-lib/B0.ml&quot;]
[@@@B0.include &quot;projects/proj/B0.ml&quot;]</code></pre><p>See the <code>b0 file gather</code> command if you need to quickly gather a bunch of B0 files.</p><h4 id="scope"><a href="#scope" class="anchor"></a>Scopes</h4><p>An included B0 file defines a named <em>scope</em> to which its definitions are added. Scope names are either specified explicitely or automatically derived from the directory name of the B0 file. In the example above the scope names are, in order, <code>that</code> and <code>proj</code>.</p><p>From the B0 file that includes, the syntax to access a definition named <code>d</code> in a scope <code>s</code> is <code>s.d</code>.</p><p>Scope names must be unique in a given B0 file and must not contain <code>'.'</code> characters. Definitions made in libraries are in their own library scope which is prefixed by <code>.</code>.</p><p><b>XXX</b> Idea: let local toplevel scopes and global scope clash and use <code>.bla</code> to disambiguate if that is the case (and let . denote the root scope).</p><h4 id="access"><a href="#access" class="anchor"></a>Access control and isolation</h4><p>At definition time a B0 file can only access definitions that are in its own scope or in the scope of the files it <code>@B00.include</code>s and recursively. This means that in any B0 file:</p><pre class="language-ocaml"><code>let all_units = B0_unit.list () (* get all units defined so far *)</code></pre><p>the value <code>all_units</code> depends only on the definitions and includes of the B0 file itself, however included it may itself be.</p><p>In the example above the two included B0 files cannot refer to the names of the other directly at definition time. However at build time their definitions may interact indirectly via metadata and build logic name resolution procedures which have access to the global scope, see <a href="#vendoring" title="vendoring">Dependency vendoring</a>.</p><p>Syntactically, the <em>OCaml</em> scope of included files is not accessible and always fully isolated: both includer and includee cannot access each other's OCaml identifiers. You can think of them as being wrapped in their own <code>module _ : sig end</code> module.</p><h4 id="vendoring"><a href="#vendoring" class="anchor"></a>Dependency vendoring</h4><p>Support for build dependency vendoring depends on the name resolutions procedure of the build logic you are using, there is no specific support for it in B0 except for the inclusion mecanism which allows to gather definitions from other B0 projects.</p><p>If the build logic you use is able to look in the definitions of the root B0 file for dependencies and use these instead of those found in the build environment then vendoring is simply a matter of <code>@@@B0.includ</code>ing the definitions of the dependencies to your B0 file.</p><p>A typical setup is to have at the root of a project:</p><pre>B0.ml
vendor/dep1/
vendor/dep2/
src/</pre><p>and to start your project's <code>B0.ml</code> file with:</p><pre class="language-ocaml"><code>[@@@B0.include &quot;vendor/dep1/B0.ml&quot;]
[@@@B0.include &quot;vendor/dep2/B0.ml&quot;]
...</code></pre><p>Since dependencies may have vendored dependencies themselves, coherence issues may arise. You may have to define new consistent and locked <a href="#packs" title="packs">build packs</a> in the root B0 file in order to exclude conflicting dependencies.</p><p><b>XXX</b> What about introducing <code>@@@B0.exclude</code> directives to exclude scopes (by name).</p><h3 id="libs"><a href="#libs" class="anchor"></a>Using libraries</h3><p>B0 is a modular and extensible system. It is <em>expected</em> for third-parties to define build and deployment logics and distribute them as libraries.</p><p>Any OCaml library available in the <code>OCAMLPATH</code> can be used in a B0 file by requiring it via the <a href="#directive_require" title="directive_require">#require</a> directive. <code>#require</code> directives must be specified <em>at the start</em> of the file, before comments or OCaml code.</p><p>For example:</p><pre class="language-ocaml"><code>#require &quot;mylib&quot;</code></pre><p>instructs to lookup library <code>mylib</code> in the <code>OCAMLPATH</code> and use it to compile the B0 file.</p><h3 id="custom_defs"><a href="#custom_defs" class="anchor"></a>Custom local descriptions</h3><p>Project specific descriptions and build logics should not clutter your B0 files. It's a good idea to put these in their own file an simply import the source in the B0 file via the the <a href="#directive_mod_use" title="directive_mod_use">#mod_use</a> directive.</p><p><code>#mod_use</code> directives must be specified <em>at the start</em> of the file before comments or OCaml code and they can't define B0 definitions, only functions that produce them. <b>TODO</b> sort out scope/allow defs or not.</p><p>By convention these definitions should be in a <code>B0</code> directory alongside the <code>B0.ml</code> file. For example here we have support for <code>that-tool</code> in <code>B0/that_tool.ml</code>.</p><pre class="language-ocaml"><code>#mod_use &quot;B0/that_tool.ml&quot;

let hello =
  let doc = &quot;hello exe produced by that-tool&quot; in
  let srcs = [&quot;src/bla.tt&quot;] in
  That_tool.exe ~name:&quot;hello&quot; ~doc ~srcs</code></pre><p>The <code>#mod_use</code> directive simply creates a module with that file name and the contents of the file spliced in there. If present a corresponding <code>B0/that_tool.mli</code> file constrains the interface of that module accordingly.</p><h3 id="boot"><a href="#boot" class="anchor"></a>B0 file bootstrap</h3><p>A B0 file is an OCaml source and may need <a href="#libs" title="libs">additional</a> OCaml libraries. This means it needs an OCaml compiler in the user <code>PATH</code> and the <code>#require</code>d libraries in the <code>OCAMLPATH</code>.</p><p>Making sure these libraries are available is the purpose of B0 file boostrapping. The <a href="#directive_boot" title="directive_boot"><code>@@@B0.boot</code></a> directive allows to specify a system to run in order to install the B0 file prerequisites.</p><p>For example the following directive:</p><pre class="language-ocaml"><code>[@@@B0.boot &quot;opam&quot; &quot;my-logic&gt;=1.0.0&quot;]</code></pre><p>indicates the B0 file needs the <code>my-logic</code> package to be installed with version greater or equal than 1.0.0. The syntax for opam package names and constraints follows that of the <code>opam install</code> command.</p><p>This declaration allows to install the B0 file prerequisites by invoking:</p><pre class="language-ocaml"><code>b0 file boot --opam</code></pre><h2 id="definitions"><a href="#definitions" class="anchor"></a>B0 file definitions</h2><p>This section provides a high-level view of the definitions made in B0 files to describe the software.</p><p>B0 definitions are named and <em>static</em>. The latter means they need to be defined during the initialisation of the B0 file. This allows end-user to query and act upon them from the command line or other user interfaces.</p><h3 id="meta"><a href="#meta" class="anchor"></a>Metadata</h3><p>All definitions in B0 have a metadata dictionary of type <a href="b0/B0_meta/index.html#type-t"><code>B0_meta.t</code></a> attached. Metadata is used to drive build logics, deployments and custom procedures.</p><p>The type <a href="b0/B0_meta/index.html#type-t"><code>B0_meta.t</code></a> is a simple type-safe heterogenous value map. A few <a href="b0/B0_meta/index.html#std" title="std">standard keys</a> are provided, consider using these before defining your own. Also consult <a href="b0.kit/B0_kit/index.html"><code>B0_kit</code></a> and libraries of build logic which may define more.</p><h3 id="units"><a href="#units" class="anchor"></a>Build units</h3><p>A build unit gathers sets of related low-level build operations (e.g. tool spawns). Typical build units are sequences of commands that build a library, an executable, etc.</p><p>Build units structure builds in well identified fragments, they form the smallest unit of build that can be be requested for building by the user.</p><p>They are given a build directory in <code>_b0</code> according to the build environment and their name where they should ‚Äì¬†but are not required¬†‚Äì to output their results.</p><p>Read the <a href="page-build_unit_manual">build unit manual</a>.</p><h3 id="packs"><a href="#packs" class="anchor"></a>Build packs</h3><p>A build pack gathers a set of <a href="#units" title="units">build units</a>. Build packs have no formal operational functionality in the system. It is just a way to list build units under a name and perform coarse grained actions on them. Note that a build unit can belong to more than one pack.</p><p>Here are example of pack usage in the system:</p><ul><li>Define convenience subsets, possibly locked, of units to build. These builds can then be easily triggered via the <code>-p</code> option of <code>b0 build</code>.</li><li>Define metadata and build units to create a distribution package. For example opam package files can be generated from build packs, see the <a href="opam.html" title="opam">B0 <code>opam</code> manual</a>.</li><li>Define build prerequisites for actions and deployments</li></ul><h4 id="default_pack"><a href="#default_pack" class="anchor"></a>The <code>default</code> pack</h4><p>The <code>default</code> pack defines the build units that are built when a bare <code>b0 build</code> is invoked.</p><h3 id="envs"><a href="#envs" class="anchor"></a>Build environments</h3><h4 id="default_env"><a href="#default_env" class="anchor"></a>The <code>default</code> environment</h4><h4 id="user_env"><a href="#user_env" class="anchor"></a>The <code>user</code> environment</h4><h3 id="cmdlets"><a href="#cmdlets" class="anchor"></a>Cmdlets</h3><p>Cmdlets are convenience named commands you can define and directely invoke via</p><pre class="language-ocaml"><code>b0 -- NAME ‚Ä¶</code></pre><p>If your development practice needs a bit of shell scripting here and there, consider rewriting them in a decent programming language as cmdlets.</p><p>Read the <a href="page-cmdlet_manual">cmdlet manual</a>.</p><h2 id="editor_support"><a href="#editor_support" class="anchor"></a>Editor support</h2><h3 id="emacs"><a href="#emacs" class="anchor"></a>Emacs</h3><p>The logic below guesses a compilation command the first time you invoke compilation mode depending on the current buffer file.</p><pre>(require 'compile)

(defun guess-compile-command ()
  &quot;Guess a compilation command from the buffer file&quot;
  (if buffer-file-name
      (cond
       ((locate-dominating-file buffer-file-name &quot;B0.ml&quot;) &quot;b0 &quot;)
       ((locate-dominating-file buffer-file-name &quot;dune-project&quot;)
        &quot;dune build &quot;)
       ((locate-dominating-file buffer-file-name &quot;Makefile&quot;) &quot;make &quot;)
       ((locate-dominating-file buffer-file-name &quot;BRZO&quot;) &quot;brzo -b &quot;)
       (t
        (concat &quot;brzo --root &quot; (file-name-directory buffer-file-name) &quot; -b &quot;)))
    &quot;&quot;))

(setq compile-command '(guess-compile-command))</pre><h2 id="b0_file_reference"><a href="#b0_file_reference" class="anchor"></a>B0 file reference</h2><p>The following parts can be distinguished in a B0 file:</p><ol><li>The initial sequence of directives. Before any comment or OCaml construct.</li><li>The OCaml unit implementation.</li></ol><p>The order is important. Directives that are mentioned after the OCaml unit implementation starts are either silently ignored (<code>@@@B0.*</code> directives) or produce compilation errors (<code>#*</code> directives).</p><h3 id="b0_file_syntax"><a href="#b0_file_syntax" class="anchor"></a>Syntax</h3><p>A B0 file is white space (no comments) separated directives followed by an <a href="http://caml.inria.fr/pub/docs/manual-ocaml-4.09/compunit.html#unit-implementation">OCaml unit implementation</a>.</p><p>Using an <a href="https://tools.ietf.org/html/rfc5234">RFC 5234</a> grammar this reads as:</p><pre>b0_file    = *(ws directive) ws unit-implementation
directive  = dir-boot / dir-inc / dir-req
dir-boot   = &quot;[@@@B0.boot&quot; *(ws dstring) ws &quot;]&quot;
dir-inc    = &quot;[@@@B0.include&quot; *(ws dstring) ws &quot;]&quot;
dir-req    = &quot;#require&quot; ws dstring
dir-moduse = &quot;#mod_use&quot; ws dstring
dstring    = %x22 dchar *dchar %x22
dchar      = escape / cont / ws / %x21 / %x23-%x5B / %x5D-%x7E / %x80-xFF
escape     = %x5C (%x20 / %x22 / %x5C)
cont       = %x5C nl ws
ws         = *(%x20 / %x09 / %x0A / %x0B / %x0C / %x0D)
nl         = %x0A / %x0D / %x0D %x0A
unit-implementation = ... ; See the syntax in the OCaml manual</pre><h3 id="directive_boot"><a href="#directive_boot" class="anchor"></a>Directive <code>@@@B0.boot</code></h3><p>The syntax of the <code>@@@B0.boot</code> directive is:</p><pre class="language-ocaml"><code>[@@@B0.boot &quot;SYSTEM&quot; &quot;ARG&quot;... ]</code></pre><p>At the moment the only known value for <code>&quot;SYSTEM&quot;</code> is <code>&quot;opam&quot;</code> and its argument names are packages constraints using the same syntax as the <code>opam install</code> command:</p><pre class="language-ocaml"><code>[@@@B0.boot &quot;opam&quot; &quot;PKG&quot;... ]</code></pre><p>This indicates the <code>opam</code> package <code>PKG</code> need to be installed in order to compile the B0 file.</p><h3 id="directive_include"><a href="#directive_include" class="anchor"></a>Directive <code>@@@B0.include</code></h3><p>The syntax of the <code>@@@B0.include</code> directive is one of:</p><pre class="language-ocaml"><code>[@@@B0.include &quot;PATH&quot;]
[@@@B0.include &quot;NAME&quot; &quot;PATH&quot;]</code></pre><p>The semantics is to include in the B0 file the definitions of the B0 file at <code>&quot;PATH&quot;</code> in a scope named <code>&quot;NAME&quot;</code>. If <code>&quot;NAME&quot;</code> is is not specified the directory name of the included B0 file is used.</p><p><code>&quot;NAME&quot;</code> must be unique among the B0 files included in the file and must not contain <code>'.'</code> characters.</p><h3 id="directive_require"><a href="#directive_require" class="anchor"></a>Directive <code>#require</code></h3><p>The syntax of the <code>#require</code> directive is:</p><pre class="language-ocaml"><code>#require &quot;LIB&quot;</code></pre><p>The semantics is to compile and link the B0 file against library <code>LIB</code>, looked up in the <code>OCAMLPATH</code>. At the moment library <code>LIB</code>'s dependencies must be manually <code>#required</code> aswell.</p><h3 id="directive_mod_use"><a href="#directive_mod_use" class="anchor"></a>Directive <code>#mod_use</code></h3><p>The syntax of the <code>#mod_use</code> directive is:</p><pre class="language-ocaml"><code>#mod_use &quot;PATH&quot;</code></pre><p>The semantics is to define a module with the contents of <code>PATH</code> at that location. The name of the module is defined by <a href="b0.b00.kit/B00_ocaml/Mod/Name/index.html#mangled" title="mangled">mangling</a> the file name of <code>PATH</code>.</p><p>For example assuming the <code>PATH</code> is <code>B0/file.ml</code>, the directive expands to:</p><pre class="language-ocaml"><code>module File = struct
#1 &quot;B0/file.ml&quot;
(* contents of B0/file.ml *)
end</code></pre><p>If <code>PATH</code> has a corresponding <code>.mli</code> file in the same directory the directive expands to:</p><pre class="language-ocaml"><code>module File : sig
#line 1 &quot;B0/file.mli&quot;
(* contents of B0/file.mli *)
end = struct
#line 1 &quot;B0/file.ml&quot;
(* contents of B0/file.ml *)
end</code></pre></div></body></html>
