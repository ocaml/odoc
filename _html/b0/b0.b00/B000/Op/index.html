<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Op (b0.b0.b00.B000.Op)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../sherlodoc_db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../index.html">üè†</a> &#x00BB; <a href="../../../index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; Library <code>b0.b00</code> &#x00BB; <a href="../index.html">B000</a> &#x00BB; Op</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>B000.Op</span></code></h1><p>Build operations.</p><p>This module provides a type for <em>specifying</em> operations and their result. Operation execution and caching are respectively handled by the <a href="../Exec/index.html"><code>Exec</code></a> and <a href="../Reviver/index.html"><code>Reviver</code></a> modules.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#op_status">Operation status</a></li><li><a href="#op">Operations</a></li><li><a href="#upd">Updating the build operation</a></li><li><a href="#set_map">Operation sets and map</a></li><li><a href="#analyze">Analyzing operations</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="../../../b00_manual.html">B00 manual</a></li><li><a href="../../../cmdlet_manual.html">Cmdlet manual</a></li><li><a href="../../../driver_dev.html">B0 driver development manual</a></li><li><a href="../../../manual.html">B0 manual</a></li><li><a href="../../../old_manual.html">B0 manual</a></li><li><a href="../../../opam.html"><code>opam</code> support manual</a></li><li><a href="../../../rationale.html">Why b0 ?</a></li><li><a href="../../../release.html">B0 release support manual</a></li><li><a href="../../../todo.html">Design considerations and todo</a></li><li><a href="../../../unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="../../../b0/B0_build/index.html">B0_build</a></li><li><a href="../../../b0/B0_cli/index.html">B0_cli</a></li><li><a href="../../../b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="../../../b0/B0_def/index.html">B0_def</a></li><li><a href="../../../b0/B0_dir/index.html">B0_dir</a></li><li><a href="../../../b0/B0_driver/index.html">B0_driver</a></li><li><a href="../../../b0/B0_file/index.html">B0_file</a></li><li><a href="../../../b0/B0_meta/index.html">B0_meta</a></li><li><a href="../../../b0/B0_pack/index.html">B0_pack</a></li><li><a href="../../../b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="../../../b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="../../../b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="../../../b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="../../../b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="../../../b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="../../../b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="../../../b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="../../../b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="../../../b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="../../../b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="../../../b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="../../../b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="../../../b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="../../B00/index.html">B00</a></li><li><a href="../index.html">B000</a><ul><li><a href="../Trash/index.html">Trash</a></li><li><a href="../File_cache/index.html">File_cache</a></li><li><a href="#" class="current_unit">Op</a><ul><li><a href="Copy/index.html">Copy</a></li><li><a href="Delete/index.html">Delete</a></li><li><a href="Mkdir/index.html">Mkdir</a></li><li><a href="Notify/index.html">Notify</a></li><li><a href="Read/index.html">Read</a></li><li><a href="Spawn/index.html">Spawn</a></li><li><a href="Wait_files/index.html">Wait_files</a></li><li><a href="Write/index.html">Write</a></li><li><a href="Set/index.html">Set</a></li><li><a href="Map/index.html">Map</a></li></ul></li><li><a href="../Reviver/index.html">Reviver</a></li><li><a href="../Guard/index.html">Guard</a></li><li><a href="../Exec/index.html">Exec</a></li></ul></li><li><a href="../../B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="../../../b0.b00.kit/B00_base64/index.html">B00_base64</a></li><li><a href="../../../b0.b00.kit/B00_cli/index.html">B00_cli</a></li><li><a href="../../../b0.b00.kit/B00_cmark/index.html">B00_cmark</a></li><li><a href="../../../b0.b00.kit/B00_editor/index.html">B00_editor</a></li><li><a href="../../../b0.b00.kit/B00_fexts/index.html">B00_fexts</a></li><li><a href="../../../b0.b00.kit/B00_findex/index.html">B00_findex</a></li><li><a href="../../../b0.b00.kit/B00_github/index.html">B00_github</a></li><li><a href="../../../b0.b00.kit/B00_htmlg/index.html">B00_htmlg</a></li><li><a href="../../../b0.b00.kit/B00_http/index.html">B00_http</a></li><li><a href="../../../b0.b00.kit/B00_jsoo/index.html">B00_jsoo</a></li><li><a href="../../../b0.b00.kit/B00_lines/index.html">B00_lines</a></li><li><a href="../../../b0.b00.kit/B00_ocaml/index.html">B00_ocaml</a></li><li><a href="../../../b0.b00.kit/B00_odoc/index.html">B00_odoc</a></li><li><a href="../../../b0.b00.kit/B00_os/index.html">B00_os</a></li><li><a href="../../../b0.b00.kit/B00_pager/index.html">B00_pager</a></li><li><a href="../../../b0.b00.kit/B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="../../../b0.b00.kit/B00_rsync/index.html">B00_rsync</a></li><li><a href="../../../b0.b00.kit/B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="../../../b0.b00.kit/B00_serialk_sexp/index.html">B00_serialk_sexp</a></li><li><a href="../../../b0.b00.kit/B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="../../../b0.b00.kit/B00_trace/index.html">B00_trace</a></li><li><a href="../../../b0.b00.kit/B00_vcs/index.html">B00_vcs</a></li><li><a href="../../../b0.b00.kit/B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="../../../b0.kit/B0_expect/index.html">B0_expect</a></li><li><a href="../../../b0.kit/B0_jsoo/index.html">B0_jsoo</a></li><li><a href="../../../b0.kit/B0_kit/index.html">B0_kit</a></li><li><a href="../../../b0.kit/B0_ocaml/index.html">B0_ocaml</a></li><li><a href="../../../b0.kit/B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="../../../b0.kit/B0_opam/index.html">B0_opam</a></li><li><a href="../../../b0.kit/B0_release/index.html">B0_release</a></li><li><a href="../../../b0.kit/B0_srcs/index.html">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="../../../b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="op_status"><a href="#op_status" class="anchor"></a>Operation status</h2><div class="odoc-spec"><div class="spec type anchored" id="type-failure"><a href="#type-failure" class="anchor"></a><code><span><span class="keyword">type</span> failure</span><span> = </span></code><ol><li id="type-failure.Exec" class="def variant constructor anchored"><a href="#type-failure.Exec" class="anchor"></a><code><span>| </span><span><span class="constructor">Exec</span> <span class="keyword">of</span> <span>string option</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Execution failure with a potential error msg.</p><span class="comment-delim">*)</span></div></li><li id="type-failure.Missing_writes" class="def variant constructor anchored"><a href="#type-failure.Missing_writes" class="anchor"></a><code><span>| </span><span><span class="constructor">Missing_writes</span> <span class="keyword">of</span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Write specification failure.</p><span class="comment-delim">*)</span></div></li><li id="type-failure.Missing_reads" class="def variant constructor anchored"><a href="#type-failure.Missing_reads" class="anchor"></a><code><span>| </span><span><span class="constructor">Missing_reads</span> <span class="keyword">of</span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Read synchronisation failure.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The type for operation failures.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-status"><a href="#type-status" class="anchor"></a><code><span><span class="keyword">type</span> status</span><span> = </span></code><ol><li id="type-status.Aborted" class="def variant constructor anchored"><a href="#type-status.Aborted" class="anchor"></a><code><span>| </span><span><span class="constructor">Aborted</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Aborted due to prerequisite failure.</p><span class="comment-delim">*)</span></div></li><li id="type-status.Done" class="def variant constructor anchored"><a href="#type-status.Done" class="anchor"></a><code><span>| </span><span><span class="constructor">Done</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Executed successfully.</p><span class="comment-delim">*)</span></div></li><li id="type-status.Failed" class="def variant constructor anchored"><a href="#type-status.Failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Failed</span> <span class="keyword">of</span> <a href="#type-failure">failure</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Executed unsuccessfully.</p><span class="comment-delim">*)</span></div></li><li id="type-status.Waiting" class="def variant constructor anchored"><a href="#type-status.Waiting" class="anchor"></a><code><span>| </span><span><span class="constructor">Waiting</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Waiting for execution.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The type for operation statuses.</p></div></div><h2 id="op"><a href="#op" class="anchor"></a>Operations</h2><div class="odoc-spec"><div class="spec type anchored" id="type-id"><a href="#type-id" class="anchor"></a><code><span><span class="keyword">type</span> id</span><span> = int</span></code></div><div class="spec-doc"><p>The type for build operation identifiers.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-mark"><a href="#type-mark" class="anchor"></a><code><span><span class="keyword">type</span> mark</span><span> = string</span></code></div><div class="spec-doc"><p>The type for build operation marks. Marks have no special semantics they are just used to label operations for UI purposes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for build operations.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-op"><a href="#type-op" class="anchor"></a><code><span><span class="keyword">type</span> op</span><span> = <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Again.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Copy"><a href="#module-Copy" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Copy/index.html">Copy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>File copy.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Delete"><a href="#module-Delete" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Delete/index.html">Delete</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Path deletion.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Mkdir"><a href="#module-Mkdir" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Mkdir/index.html">Mkdir</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Directory creation.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Notify"><a href="#module-Notify" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Notify/index.html">Notify</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>End-user notifications.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Read"><a href="#module-Read" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Read/index.html">Read</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>File reads.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Spawn"><a href="#module-Spawn" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Spawn/index.html">Spawn</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Tool spawns.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Wait_files"><a href="#module-Wait_files" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Wait_files/index.html">Wait_files</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Waiting on files.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Write"><a href="#module-Write" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Write/index.html">Write</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>File writes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-kind"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> kind</span><span> = </span></code><ol><li id="type-kind.Copy" class="def variant constructor anchored"><a href="#type-kind.Copy" class="anchor"></a><code><span>| </span><span><span class="constructor">Copy</span> <span class="keyword">of</span> <a href="Copy/index.html#type-t">Copy.t</a></span></code></li><li id="type-kind.Delete" class="def variant constructor anchored"><a href="#type-kind.Delete" class="anchor"></a><code><span>| </span><span><span class="constructor">Delete</span> <span class="keyword">of</span> <a href="Delete/index.html#type-t">Delete.t</a></span></code></li><li id="type-kind.Mkdir" class="def variant constructor anchored"><a href="#type-kind.Mkdir" class="anchor"></a><code><span>| </span><span><span class="constructor">Mkdir</span> <span class="keyword">of</span> <a href="Mkdir/index.html#type-t">Mkdir.t</a></span></code></li><li id="type-kind.Notify" class="def variant constructor anchored"><a href="#type-kind.Notify" class="anchor"></a><code><span>| </span><span><span class="constructor">Notify</span> <span class="keyword">of</span> <a href="Notify/index.html#type-t">Notify.t</a></span></code></li><li id="type-kind.Read" class="def variant constructor anchored"><a href="#type-kind.Read" class="anchor"></a><code><span>| </span><span><span class="constructor">Read</span> <span class="keyword">of</span> <a href="Read/index.html#type-t">Read.t</a></span></code></li><li id="type-kind.Spawn" class="def variant constructor anchored"><a href="#type-kind.Spawn" class="anchor"></a><code><span>| </span><span><span class="constructor">Spawn</span> <span class="keyword">of</span> <a href="Spawn/index.html#type-t">Spawn.t</a></span></code></li><li id="type-kind.Wait_files" class="def variant constructor anchored"><a href="#type-kind.Wait_files" class="anchor"></a><code><span>| </span><span><span class="constructor">Wait_files</span> <span class="keyword">of</span> <a href="Wait_files/index.html#type-t">Wait_files.t</a></span></code></li><li id="type-kind.Write" class="def variant constructor anchored"><a href="#type-kind.Write" class="anchor"></a><code><span>| </span><span><span class="constructor">Write</span> <span class="keyword">of</span> <a href="Write/index.html#type-t">Write.t</a></span></code></li></ol></div><div class="spec-doc"><p>The type for operation kinds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind_name"><a href="#val-kind_name" class="anchor"></a><code><span><span class="keyword">val</span> kind_name : <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>kind_name k</code> is an end user name for kind <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-v"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : 
  <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">mark</span>:<a href="#type-mark">mark</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time_created</span>:<a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time_started</span>:<a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">duration</span>:<a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">revived</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">status</span>:<a href="#type-status">status</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">reads</span>:<span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">writes</span>:<span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">writes_manifest_root</span>:<span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">hash</span>:<a href="../../../b0.std/B0_std/Hash/index.html#type-t">B0_std.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?post_exec</span>:<span>(<span><a href="#type-op">op</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?k</span>:<span>(<span><a href="#type-op">op</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>v</code> constructs an operation. See the corresponding accessors for the semantics of various arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-kind">kind</a></span></code></div><div class="spec-doc"><p><code>kind o</code> is <code>o</code>'s kind.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>equal o0 o1</code> is <code>id o0 = id o1</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare o0 o1</code> is <code>compare (id o0) (id o1)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-id"><a href="#val-id" class="anchor"></a><code><span><span class="keyword">val</span> id : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-id">id</a></span></code></div><div class="spec-doc"><p><code>id o</code> is the identifier of operation <code>o</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mark"><a href="#val-mark" class="anchor"></a><code><span><span class="keyword">val</span> mark : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>mark o</code> is the mark of <code>o</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-time_created"><a href="#val-time_created" class="anchor"></a><code><span><span class="keyword">val</span> time_created : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a></span></code></div><div class="spec-doc"><p><code>time_created o</code> is <code>o</code>'s creation time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-time_started"><a href="#val-time_started" class="anchor"></a><code><span><span class="keyword">val</span> time_started : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a></span></code></div><div class="spec-doc"><p><code>time_started o</code> is <code>o</code>'s execution start time. This is different from <a href="../../../b0.std/B0_std/Mtime/Span/index.html#val-max_span"><code>B0_std.Mtime.Span.max_span</code></a> once the operation has been submitted for execution.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-time_ended"><a href="#val-time_ended" class="anchor"></a><code><span><span class="keyword">val</span> time_ended : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a></span></code></div><div class="spec-doc"><p><code>time_ended o</code> is <code>o</code>'s execution end time. This is different from <a href="../../../b0.std/B0_std/Mtime/Span/index.html#val-max_span"><code>B0_std.Mtime.Span.max_span</code></a> once the operation has been completed and collected.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-waited"><a href="#val-waited" class="anchor"></a><code><span><span class="keyword">val</span> waited : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a></span></code></div><div class="spec-doc"><p><code>waited</code> is <code>o</code>'s waiting time between creation and execution.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-duration"><a href="#val-duration" class="anchor"></a><code><span><span class="keyword">val</span> duration : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a></span></code></div><div class="spec-doc"><p><code>duration</code> is <code>o</code>'s execution duration time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-revived"><a href="#val-revived" class="anchor"></a><code><span><span class="keyword">val</span> revived : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>revived o</code> is <code>true</code> iff <code>o</code> was revived from a cache. Only relevant if <a href="#val-hash"><code>hash</code></a> is not <a href="../../../b0.std/B0_std/Hash/index.html#val-nil"><code>B0_std.Hash.nil</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-status"><a href="#val-status" class="anchor"></a><code><span><span class="keyword">val</span> status : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-status">status</a></span></code></div><div class="spec-doc"><p><code>status o</code> is <code>o</code> execution status.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reads"><a href="#val-reads" class="anchor"></a><code><span><span class="keyword">val</span> reads : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code></div><div class="spec-doc"><p><code>reads o</code> are the file paths read by the operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-writes"><a href="#val-writes" class="anchor"></a><code><span><span class="keyword">val</span> writes : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code></div><div class="spec-doc"><p><code>writes o</code> are the file paths written by <code>o</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-writes_manifest_root"><a href="#val-writes_manifest_root" class="anchor"></a><code><span><span class="keyword">val</span> writes_manifest_root : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> option</span></span></code></div><div class="spec-doc"><p><code>writes_manifest_root o</code> if <code>Some root</code>, the operation is cached using a manifest key. This means the <a href="#val-writes"><code>writes</code></a> made relative to <code>root</code> are stored along-side the cache key.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../b0.std/B0_std/Hash/index.html#type-t">B0_std.Hash.t</a></span></code></div><div class="spec-doc"><p><code>hash o</code> is the operation's hash. This is <a href="../../../b0.std/B0_std/Hash/index.html#val-nil"><code>B0_std.Hash.nil</code></a> before the operation hash has been effectively computed and set via <a href="#val-set_hash"><code>set_hash</code></a>. This remains <a href="../../../b0.std/B0_std/Hash/index.html#val-nil"><code>B0_std.Hash.nil</code></a> for operations that are not revivable.</p></div></div><h2 id="upd"><a href="#upd" class="anchor"></a>Updating the build operation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-invoke_k"><a href="#val-invoke_k" class="anchor"></a><code><span><span class="keyword">val</span> invoke_k : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>exec_k o ()</code> invokes and discards <code>o</code>'s continuation. Note that this does <b>not</b> protect against the continuation raising.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-discard_k"><a href="#val-discard_k" class="anchor"></a><code><span><span class="keyword">val</span> discard_k : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>discard o</code> discards <code>o</code>'s continuation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invoke_post_exec"><a href="#val-invoke_post_exec" class="anchor"></a><code><span><span class="keyword">val</span> invoke_post_exec : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>exec_post_exec o</code> invokes and discards <code>o</code>'s post execution hook. This hook called is right after the operation execution and, if applicable, <b>before</b> reviver recording. It is always called even if the operation fails or is revived (use <a href="#val-status"><code>status</code></a> and <a href="#val-revived"><code>revived</code></a> to check these conditions). Note that if the hook unexpectedly raises this turns <code>o</code> in to a failure.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-discard_post_exec"><a href="#val-discard_post_exec" class="anchor"></a><code><span><span class="keyword">val</span> discard_post_exec : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>discard_post_exec o</code> discards <code>o</code>'s post execution hook.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-abort"><a href="#val-abort" class="anchor"></a><code><span><span class="keyword">val</span> abort : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>abort o</code> sets the status of <code>o</code> to <a href="#type-status.Aborted"><code>Op.status.Aborted</code></a> and discards the operation closures (including kind specific ones).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_time_started"><a href="#val-set_time_started" class="anchor"></a><code><span><span class="keyword">val</span> set_time_started : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_time_started o t</code> sets <code>o</code>'s execution start time to <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_time_ended"><a href="#val-set_time_ended" class="anchor"></a><code><span><span class="keyword">val</span> set_time_ended : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Mtime/index.html#type-span">B0_std.Mtime.span</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_time_ended o t</code> sets <code>o</code>'s execution end time to <code>s</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_revived"><a href="#val-set_revived" class="anchor"></a><code><span><span class="keyword">val</span> set_revived : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_revived o b</code> sets <code>o</code>'s cache revival status to <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_status"><a href="#val-set_status" class="anchor"></a><code><span><span class="keyword">val</span> set_status : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-status">status</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_status o s</code> sets the execution status to <code>s</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_status_from_result"><a href="#val-set_status_from_result" class="anchor"></a><code><span><span class="keyword">val</span> set_status_from_result : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_status_from_result o r</code> sets status of operation <code>o</code> to <code>Executed</code> if <code>r</code> is <code>Ok _</code> and <code>Failed (Exec e)</code> if <code>r</code> is <code>Error e</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_reads"><a href="#val-set_reads" class="anchor"></a><code><span><span class="keyword">val</span> set_reads : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_reads t fs</code> sets the file paths read by <code>o</code> to <code>fs</code>. Note that this resets the <a href="#val-hash"><code>hash</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_writes"><a href="#val-set_writes" class="anchor"></a><code><span><span class="keyword">val</span> set_writes : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_writes t fs</code> sets the file paths written by <code>o</code> to <code>fs</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_writes_manifest_root"><a href="#val-set_writes_manifest_root" class="anchor"></a><code><span><span class="keyword">val</span> set_writes_manifest_root : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_writes_manifest_root t r</code> sets the writes manifest root to <code>r</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_hash"><a href="#val-set_hash" class="anchor"></a><code><span><span class="keyword">val</span> set_hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Hash/index.html#type-t">B0_std.Hash.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_hash o h</code> sets the operation hash to <code>h</code>.</p></div></div><h2 id="set_map"><a href="#set_map" class="anchor"></a>Operation sets and map</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Set"><a href="#module-Set" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Set/index.html">Set</a></span><span> : <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Set/module-type-S/index.html">Set.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Set/module-type-S/index.html#type-elt">elt</a> = <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Operation sets</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Map"><a href="#module-Map" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Map/index.html">Map</a></span><span> : <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Map/module-type-S/index.html">Map.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Map/module-type-S/index.html#type-key">key</a> = <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Operation maps</p></div></div><h2 id="analyze"><a href="#analyze" class="anchor"></a>Analyzing operations</h2><div class="odoc-spec"><div class="spec value anchored" id="val-did_not_write"><a href="#val-did_not_write" class="anchor"></a><code><span><span class="keyword">val</span> did_not_write : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code></div><div class="spec-doc"><p><code>did_not_write o</code> compares <a href="#val-writes"><code>writes</code></a> with the current state of the file system and reports those files that do not exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cannot_read"><a href="#val-cannot_read" class="anchor"></a><code><span><span class="keyword">val</span> cannot_read : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../b0.std/B0_std/Fpath/index.html#type-t">B0_std.Fpath.t</a> list</span></span></code></div><div class="spec-doc"><p><code>cannot_read o</code> compares <a href="#val-reads"><code>reads</code></a> with the current state of the file system and reports those files that cannot be read.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unready_reads"><a href="#val-unready_reads" class="anchor"></a><code><span><span class="keyword">val</span> unready_reads : 
  <span><span class="label">ready_roots</span>:<a href="../../../b0.std/B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../b0.std/B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></span></code></div><div class="spec-doc"><p><code>unready_reads os</code> are the file read by <code>os</code> that are not written by those and not in <code>ready_roots</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_write_maps"><a href="#val-read_write_maps" class="anchor"></a><code><span><span class="keyword">val</span> read_write_maps : 
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../../b0.std/B0_std/Fpath/Map/index.html#type-t">B0_std.Fpath.Map.t</a></span> * <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../../b0.std/B0_std/Fpath/Map/index.html#type-t">B0_std.Fpath.Map.t</a></span></span></code></div><div class="spec-doc"><p><code>read_write_maps ops</code> is <code>reads, writes</code> with <code>reads</code> mapping file paths to operations that reads them and <code>writes</code> mapping file paths to operations that write them.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_map"><a href="#val-write_map" class="anchor"></a><code><span><span class="keyword">val</span> write_map : <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../../b0.std/B0_std/Fpath/Map/index.html#type-t">B0_std.Fpath.Map.t</a></span></span></code></div><div class="spec-doc"><p><code>write_map os</code> is <code>snd (read_write_maps os)</code>. If one of the operation sets in the map is not a singleton the operations should likely not be run toghether.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_read_write_cycle"><a href="#val-find_read_write_cycle" class="anchor"></a><code><span><span class="keyword">val</span> find_read_write_cycle : <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-t">t</a> list</span> option</span></span></code></div><div class="spec-doc"><p><code>find_read_write_cycle os</code> is <code>Some cs</code> if there exists a read/write cycle among the operations <code>os</code>. This means each each element of <code>cs</code> writes a file read by its successor in the list with the successor of the last element being the first.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-aggregate_error"><a href="#type-aggregate_error" class="anchor"></a><code><span><span class="keyword">type</span> aggregate_error</span><span> = </span></code><ol><li id="type-aggregate_error.Failures" class="def variant constructor anchored"><a href="#type-aggregate_error.Failures" class="anchor"></a><code><span>| </span><span><span class="constructor">Failures</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Some operations failed.</p><span class="comment-delim">*)</span></div></li><li id="type-aggregate_error.Cycle" class="def variant constructor anchored"><a href="#type-aggregate_error.Cycle" class="anchor"></a><code><span>| </span><span><span class="constructor">Cycle</span> <span class="keyword">of</span> <span><a href="#type-t">t</a> list</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Dependency cycle.</p><span class="comment-delim">*)</span></div></li><li id="type-aggregate_error.Never_became_ready" class="def variant constructor anchored"><a href="#type-aggregate_error.Never_became_ready" class="anchor"></a><code><span>| </span><span><span class="constructor">Never_became_ready</span> <span class="keyword">of</span> <a href="../../../b0.std/B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Some files never became ready.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The type for errors related to a <em>list</em> of operations. This is:</p><ul><li><code>Failures</code>, if there is one or more operations in the list that <a href="#type-status.Failed"><code>Failed</code></a>.</li><li><code>Cycle ops</code>, if there is a set of <a href="#type-status.Waiting"><code>Waiting</code></a> operations in the list whose individual reads and writes leads to a dependency cycle. See also <a href="#val-find_read_write_cycle"><code>find_read_write_cycle</code></a>.</li><li><code>Never_became_ready fs</code>, with <code>fs</code> files that are in the reads of <a href="#type-status.Waiting"><code>Waiting</code></a> operations but are written by no operation from the list and were not made ready.</li></ul><p>Note that formally more than one of these conditions can be true at the same time. But <code>Never_became_ready</code> is only reported once the first two kind of errors have been ruled out. The reason is that those files that never became ready may be created by continuations of the failed or cyclic operations and reporting them would not lead the user to focus on the right cause.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_aggregate_error"><a href="#val-find_aggregate_error" class="anchor"></a><code><span><span class="keyword">val</span> find_aggregate_error : 
  <span><span class="label">ready_roots</span>:<a href="../../../b0.std/B0_std/Fpath/Set/index.html#type-t">B0_std.Fpath.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="#type-aggregate_error">aggregate_error</a>)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>find_aggregate_error ~ready_roots os</code> finds an aggregate error among the list of operation <code>os</code>, assuming files <code>ready_roots</code> were made ready. This is <code>Ok ()</code> if all operations <code>os</code> <a href="#type-status.Done"><code>B000.Op.status.Done</code></a>.</p></div></div></div></body></html>
