<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sexpq (b0.b0.b00.kit.B00_serialk_sexp.Sexpq)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../sherlodoc_db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../index.html">üè†</a> &#x00BB; <a href="../../../index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; Library <code>b0.b00.kit</code> &#x00BB; <a href="../index.html">B00_serialk_sexp</a> &#x00BB; Sexpq</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>B00_serialk_sexp.Sexpq</span></code></h1><p>S-expression queries.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#query_results">Result paths</a></li><li><a href="#query_errors">Query errors</a></li><li><a href="#queries">Queries</a></li><li><a href="#outcome">Success and failure</a></li><li><a href="#qcomb">Query combinators</a></li><li><a href="#qsexp">S-expression queries</a></li><li><a href="#qatom">Atom queries</a></li><li><a href="#qlist">List queries</a><ul><li><a href="#qlist_2">List index queries</a></li></ul></li><li><a href="#qdict">Dictionary queries</a></li><li><a href="#indices">Index queries</a></li><li><a href="#path_caret">Path and caret queries</a></li><li><a href="#ocaml">OCaml datatype encoding queries</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="../../../b00_manual.html">B00 manual</a></li><li><a href="../../../cmdlet_manual.html">Cmdlet manual</a></li><li><a href="../../../driver_dev.html">B0 driver development manual</a></li><li><a href="../../../manual.html">B0 manual</a></li><li><a href="../../../old_manual.html">B0 manual</a></li><li><a href="../../../opam.html"><code>opam</code> support manual</a></li><li><a href="../../../rationale.html">Why b0 ?</a></li><li><a href="../../../release.html">B0 release support manual</a></li><li><a href="../../../todo.html">Design considerations and todo</a></li><li><a href="../../../unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="../../../b0/B0_build/index.html">B0_build</a></li><li><a href="../../../b0/B0_cli/index.html">B0_cli</a></li><li><a href="../../../b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="../../../b0/B0_def/index.html">B0_def</a></li><li><a href="../../../b0/B0_dir/index.html">B0_dir</a></li><li><a href="../../../b0/B0_driver/index.html">B0_driver</a></li><li><a href="../../../b0/B0_file/index.html">B0_file</a></li><li><a href="../../../b0/B0_meta/index.html">B0_meta</a></li><li><a href="../../../b0/B0_pack/index.html">B0_pack</a></li><li><a href="../../../b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="../../../b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="../../../b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="../../../b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="../../../b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="../../../b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="../../../b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="../../../b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="../../../b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="../../../b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="../../../b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="../../../b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="../../../b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="../../../b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="../../../b0.b00/B00/index.html">B00</a></li><li><a href="../../../b0.b00/B000/index.html">B000</a></li><li><a href="../../../b0.b00/B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="../../B00_base64/index.html">B00_base64</a></li><li><a href="../../B00_cli/index.html">B00_cli</a></li><li><a href="../../B00_cmark/index.html">B00_cmark</a></li><li><a href="../../B00_editor/index.html">B00_editor</a></li><li><a href="../../B00_fexts/index.html">B00_fexts</a></li><li><a href="../../B00_findex/index.html">B00_findex</a></li><li><a href="../../B00_github/index.html">B00_github</a></li><li><a href="../../B00_htmlg/index.html">B00_htmlg</a></li><li><a href="../../B00_http/index.html">B00_http</a></li><li><a href="../../B00_jsoo/index.html">B00_jsoo</a></li><li><a href="../../B00_lines/index.html">B00_lines</a></li><li><a href="../../B00_ocaml/index.html">B00_ocaml</a></li><li><a href="../../B00_odoc/index.html">B00_odoc</a></li><li><a href="../../B00_os/index.html">B00_os</a></li><li><a href="../../B00_pager/index.html">B00_pager</a></li><li><a href="../../B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="../../B00_rsync/index.html">B00_rsync</a></li><li><a href="../../B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="../index.html">B00_serialk_sexp</a><ul><li><a href="../Sexp/index.html">Sexp</a></li><li><a href="../Sexpg/index.html">Sexpg</a></li><li><a href="#" class="current_unit">Sexpq</a></li></ul></li><li><a href="../../B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="../../B00_trace/index.html">B00_trace</a></li><li><a href="../../B00_vcs/index.html">B00_vcs</a></li><li><a href="../../B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="../../../b0.kit/B0_expect/index.html">B0_expect</a></li><li><a href="../../../b0.kit/B0_jsoo/index.html">B0_jsoo</a></li><li><a href="../../../b0.kit/B0_kit/index.html">B0_kit</a></li><li><a href="../../../b0.kit/B0_ocaml/index.html">B0_ocaml</a></li><li><a href="../../../b0.kit/B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="../../../b0.kit/B0_opam/index.html">B0_opam</a></li><li><a href="../../../b0.kit/B0_release/index.html">B0_release</a></li><li><a href="../../../b0.kit/B0_srcs/index.html">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="../../../b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="query_results"><a href="#query_results" class="anchor"></a>Result paths</h2><div class="odoc-spec"><div class="spec type anchored" id="type-path"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <span><span>(<a href="../Sexp/index.html#type-index">Sexp.index</a> * <a href="../Sexp/index.html#type-loc">Sexp.loc</a>)</span> list</span></span></code></div><div class="spec-doc"><p>The type for result paths. This is a sequence of indexing operations tupled with the source text location of the indexed s-expression in <b>reverse</b> order.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_path"><a href="#val-pp_path" class="anchor"></a><code><span><span class="keyword">val</span> pp_path : 
  <span><span class="optlabel">?pp_loc</span>:<span><a href="../Sexp/index.html#type-loc">Sexp.loc</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pp_key</span>:<span>string <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_path ~pp_loc ~pp_key ()</code> formats paths using <code>pp_loc</code> (defaults to <a href="../Sexp/index.html#val-pp_loc"><code>Sexp.pp_loc</code></a>) and <code>pp_key</code> to format the keys (defaults to <a href="../Sexp/index.html#val-pp_key"><code>Sexp.pp_key</code></a>).</p></div></div><h2 id="query_errors"><a href="#query_errors" class="anchor"></a>Query errors</h2><div class="odoc-spec"><div class="spec type anchored" id="type-error_kind"><a href="#type-error_kind" class="anchor"></a><code><span><span class="keyword">type</span> error_kind</span><span> = </span><span>[ </span></code><ol><li id="type-error_kind.Key_unbound" class="def variant constructor anchored"><a href="#type-error_kind.Key_unbound" class="anchor"></a><code><span>| </span><span>`Key_unbound <span class="keyword">of</span> string * <span>string list</span></span></code></li><li id="type-error_kind.Msg" class="def variant constructor anchored"><a href="#type-error_kind.Msg" class="anchor"></a><code><span>| </span><span>`Msg <span class="keyword">of</span> string</span></code></li><li id="type-error_kind.Nth_unbound" class="def variant constructor anchored"><a href="#type-error_kind.Nth_unbound" class="anchor"></a><code><span>| </span><span>`Nth_unbound <span class="keyword">of</span> int * int</span></code></li><li id="type-error_kind.Out_of_dom" class="def variant constructor anchored"><a href="#type-error_kind.Out_of_dom" class="anchor"></a><code><span>| </span><span>`Out_of_dom <span class="keyword">of</span> string * string * <span>string list</span></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for kinds of errors.</p><ul><li><code>`Key_unbound (k, dom)</code> on <code>k</code> that should have been in <code>dom</code> (if not empty).</li><li><code>`Msg m</code> an arbitrary message <code>m</code> (should not include position information).</li><li><code>`Nth_unbound (n, len)</code> on <code>n</code> an out of bound index in a list of length <code>len</code>.</li><li><code>`Out_of_dom (kind, v, dom)</code> on <code>v</code> of kind <code>kind</code> that should have been in <code>dom</code></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error_kind"><a href="#val-pp_error_kind" class="anchor"></a><code><span><span class="keyword">val</span> pp_error_kind : 
  <span><span class="optlabel">?pp_em</span>:<span>string <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pp_key</span>:<span>string <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-error_kind">error_kind</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_error_kind ~pp_loc ~pp_em ~pp_key ()</code> formats error kinds using <code>pp_loc</code> for locations, <code>pp_em</code> for emphasis and <code>pp_key</code> for keys.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = <a href="#type-error_kind">error_kind</a> * <span>(<a href="#type-path">path</a> * <a href="../Sexp/index.html#type-loc">Sexp.loc</a>)</span></span></code></div><div class="spec-doc"><p>The type for query errors. The error kind tupled with the path to the offending s-expression and the location of the s-expression.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : 
  <span><span class="optlabel">?pp_loc</span>:<span><a href="../Sexp/index.html#type-loc">Sexp.loc</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pp_path</span>:<span><a href="#type-path">path</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pp_error_kind</span>:<span><a href="#type-error_kind">error_kind</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pp_prefix</span>:<span>unit <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-error">error</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span></span></code></div><div class="spec-doc"><p><code>pp_error ~pp_loc ~pp_path ~pp_error_kind ~pp_prefix ()</code> formats errors using <code>pp_loc</code>, <code>pp_path</code> (defaults to <a href="#val-pp_path"><code>pp_path</code></a>), <code>pp_error_kind</code> (defaults to <a href="#val-pp_error_kind"><code>pp_error_kind</code></a>) and <code>pp_prefix</code> (defaults formats <code>&quot;Error: &quot;</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-error_to_string"><a href="#val-error_to_string" class="anchor"></a><code><span><span class="keyword">val</span> error_to_string : 
  <span><span class="optlabel">?pp_error</span>:<span><a href="#type-error">error</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>error_to_string ~pp_error r</code> converts an error in <code>r</code> to a string using <code>pp_error</code>, defaults to <a href="#val-pp_error"><code>pp_error</code></a>.</p></div></div><h2 id="queries"><a href="#queries" class="anchor"></a>Queries</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The type for s-expression queries. A query either succeeds against an s-expression with a value of type <code>'a</code> or it fails.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>query q s</code> is <code>Ok v</code> if the query <code>q</code> succeeds on <code>s</code> and <code>Error e</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query_at_path"><a href="#val-query_at_path" class="anchor"></a><code><span><span class="keyword">val</span> query_at_path : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Sexp/index.html#type-t">Sexp.t</a> * <a href="#type-path">path</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>query_at_path q (s, p)</code> is like <a href="#val-query"><code>query</code></a> except it assumes <code>s</code> is at path <code>p</code>. Use to further query s-expressions obtained with <a href="#val-sexp_with_path"><code>sexp_with_path</code></a> so that errors return the full path to errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query'"><a href="#val-query'" class="anchor"></a><code><span><span class="keyword">val</span> query' : <span><span class="optlabel">?pp_error</span>:<span><a href="#type-error">error</a> <a href="../Sexp/index.html#type-fmt">Sexp.fmt</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>query' q s</code> is like <a href="#val-query"><code>query</code></a> except the result is composed with <a href="#val-error_to_string"><code>error_to_string</code></a>.</p></div></div><h2 id="outcome"><a href="#outcome" class="anchor"></a>Success and failure</h2><div class="odoc-spec"><div class="spec value anchored" id="val-succeed"><a href="#val-succeed" class="anchor"></a><code><span><span class="keyword">val</span> succeed : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>succeed v</code> is a query that succeeds with value <code>v</code> on any s-expression.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span><a href="#type-error_kind">error_kind</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fail k</code> is a query that fails on any s-expression with error kind <code>k</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-failf"><a href="#val-failf" class="anchor"></a><code><span><span class="keyword">val</span> failf : <span><span><span>(<span class="type-var">'a</span>, <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Format/index.html#type-formatter">Format.formatter</a>, unit, <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-format4">format4</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>failf fmt ...</code> is <code>fail (`Msg m)</code> with <code>m</code> formatted according to <code>fmt</code>.</p></div></div><h2 id="qcomb"><a href="#qcomb" class="anchor"></a>Query combinators</h2><div class="odoc-spec"><div class="spec value anchored" id="val-app"><a href="#val-app" class="anchor"></a><code><span><span class="keyword">val</span> app : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>app fq q</code> queries an s-expression first with <code>fq</code> and then with <code>q</code> and applies the result of latter to the former.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-($)"><a href="#val-($)" class="anchor"></a><code><span><span class="keyword">val</span> ($) : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f $ v</code> is <code>app f v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span><span class="keyword">val</span> pair : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pair q0 q1</code> queries an s-expression first with <code>q0</code> and then with <code>q1</code> and returns the pair of their result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind q f</code> queries an s-expression with <code>q</code>, applies the result to <code>f</code> and re-queries the s-expression with the result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f q</code> is <code>app (succeed f) q</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-some"><a href="#val-some" class="anchor"></a><code><span><span class="keyword">val</span> some : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>some q</code> is <code>map Option.some q</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loc"><a href="#val-loc" class="anchor"></a><code><span><span class="keyword">val</span> loc : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span>(<a href="#type-path">path</a> * <a href="../Sexp/index.html#type-loc">Sexp.loc</a>)</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>loc q</code> queries with <code>q</code> an returns the result with the query path and source text location to the queried s-expression.</p></div></div><h2 id="qsexp"><a href="#qsexp" class="anchor"></a>S-expression queries</h2><p>Queries for s-expressions. These queries never fail.</p><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span><span class="label">atom</span>:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">list</span>:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fold ~atom ~list</code> queries atoms with <code>atom</code> and lists with <code>list</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp"><a href="#val-sexp" class="anchor"></a><code><span><span class="keyword">val</span> sexp : <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>sexp</code> queries any s-expression and returns its generic representation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_with_path"><a href="#val-sexp_with_path" class="anchor"></a><code><span><span class="keyword">val</span> sexp_with_path : <span><span>(<a href="../Sexp/index.html#type-t">Sexp.t</a> * <a href="#type-path">path</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>sexp_with_path</code> is like <a href="#val-sexp"><code>sexp</code></a> but also returns the path toy s-expression.</p></div></div><h2 id="qatom"><a href="#qatom" class="anchor"></a>Atom queries</h2><p>Queries for atoms. These queries fail on lists.</p><div class="odoc-spec"><div class="spec value anchored" id="val-atom"><a href="#val-atom" class="anchor"></a><code><span><span class="keyword">val</span> atom : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>atom</code> queries an atom as a string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-atom_to"><a href="#val-atom_to" class="anchor"></a><code><span><span class="keyword">val</span> atom_to : <span><span class="label">kind</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, string)</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#type-result">result</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>atom_to ~kind p</code> queries an atom and parses it with <code>p</code>. In case of <code>Error m</code> fails with message <code>m</code>. <code>kind</code> is the kind of value parsed, used for the error in case a list is found.</p></div></div><p><b>TODO.</b> Maybe combinators to devise an approriate parse function for <a href="#val-atom_to"><code>atom_to</code></a> are a better idea than the following two combinators.</p><div class="odoc-spec"><div class="spec value anchored" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span><span class="keyword">val</span> enum : <span><span class="label">kind</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>enum ~kind ss</code> queries an atom for one of the element of <code>ss</code> and fails otherwise. <code>kind</code> is for the kind of elements in <code>ss</code>, it used for error reporting.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enum_map"><a href="#val-enum_map" class="anchor"></a><code><span><span class="keyword">val</span> enum_map : <span><span class="label">kind</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Map/Make/index.html#type-t">Map.Make(String).t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>enum_map ~pp_elt ~kind sm</code> queries an atom for it's map in <code>sm</code> and fails if the atom is not bound in <code>sm</code>. <code>kind</code> is for the kind of elements in <code>sm</code>, it used for error reporting.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bool</code> queries an atom for one of <code>true</code> or <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int</code> queries an atom for an integer value parsed with <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#val-int_of_string"><code>int_of_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span>int32 <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int32</code> queries an atom for an integer value parsed with <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Int32/index.html#val-of_string"><code>Int32.of_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span>int64 <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int64</code> queries an atom for an integer value parsed with <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Int64/index.html#val-of_string"><code>Int64.of_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>float</code> queries an atom for a float value parsed with <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/index.html#val-float_of_string"><code>float_of_string</code></a>.</p></div></div><h2 id="qlist"><a href="#qlist" class="anchor"></a>List queries</h2><p>Queries for s-expression lists. These queries fail on atoms.</p><div class="odoc-spec"><div class="spec value anchored" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span><span class="keyword">val</span> is_empty : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>is_empty</code> queries a list for emptyness.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hd"><a href="#val-hd" class="anchor"></a><code><span><span class="keyword">val</span> hd : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>hd q</code> queries the head of a list with <code>q</code>. Fails on empty lists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tl"><a href="#val-tl" class="anchor"></a><code><span><span class="keyword">val</span> tl : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tail q</code> queries the tail of a list with <code>q</code>. Fails on empty lists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_list"><a href="#val-fold_list" class="anchor"></a><code><span><span class="keyword">val</span> fold_list : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fold_list f q acc</code> queries the elements of a list from left to right with <code>q</code> and folds the result with <code>f</code> starting with <code>acc</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>list q</code> queries the elements of a list with <code>q</code>.</p></div></div><h3 id="qlist_2"><a href="#qlist_2" class="anchor"></a>List index queries</h3><div class="odoc-spec"><div class="spec value anchored" id="val-nth"><a href="#val-nth" class="anchor"></a><code><span><span class="keyword">val</span> nth : <span><span class="optlabel">?absent</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>nth ?absent n q</code> queries the <code>n</code>th index of a list with <code>q</code>. If <code>n</code> is negative counts from the end of the list, so <code>-1</code> is the last list element. If the element does not exist this fails if <code>absent</code> is <code>None</code> and succeeds with <code>v</code> if <code>absent</code> is <code>Some v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete_nth"><a href="#val-delete_nth" class="anchor"></a><code><span><span class="keyword">val</span> delete_nth : <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delete_nth ~must_exist n</code> deletes the <code>n</code>th element of the list. If the element does not exist this fails when <code>must_exist</code> is <code>true</code> or returns the list unchanged when <code>must_exist</code> is <code>false</code>.</p></div></div><h2 id="qdict"><a href="#qdict" class="anchor"></a>Dictionary queries</h2><p>Queries for s-expression <span class="xref-unresolved" title="sex_dictionaries">dictionaries</span>. These queries fail on atoms.</p><div class="odoc-spec"><div class="spec value anchored" id="val-key"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span><span class="optlabel">?absent</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>key ?absent k q</code> queries the value of key <code>k</code> of a dictionary with <code>q</code>. If <code>k</code> is not bound this fails if <code>absent</code> is <code>None</code> and succeeds with <code>v</code> if <code>absent</code> is <code>Some v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete_key"><a href="#val-delete_key" class="anchor"></a><code><span><span class="keyword">val</span> delete_key : <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delete_key ~must_exist k</code> deletes key <code>k</code> from the dictionary. If <code>k</code> is not bound this fails when <code>must_exist</code> is <code>true</code> or returns the dictionary unchanged when <code>must_exist</code> is <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-key_dom"><a href="#val-key_dom" class="anchor"></a><code><span><span class="keyword">val</span> key_dom : <span><span class="label">validate</span>:<span><a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Set/Make/index.html#type-t">Set.Make(String).t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>key_dom validate</code> queries the key domain of a list of bindings. If <code>validate</code> is <code>Some dom</code>, the query fails if a key is not in <code>dom</code>. The query also fails if a binding is not well-formed. <code>pp_key</code> is used to format keys.</p><p><b>TODO.</b> Not really happy about this function, we lose the key locations which is useful for further deconstruction. Also maybe we rather want binding folds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-atomic"><a href="#val-atomic" class="anchor"></a><code><span><span class="keyword">val</span> atomic : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>atomic q</code> queries an atom or the atom of a singleton list with <code>q</code>. It fails on empty lists or non-singleton lists.</p><p>This is useful for singleton <a href="../index.html#sexp_dict" title="sexp_dict">dictionary</a> bindings. In error reporting treats the list as if it doesn't exist syntactically which is the case in dictionary bindings.</p></div></div><h2 id="indices"><a href="#indices" class="anchor"></a>Index queries</h2><div class="odoc-spec"><div class="spec value anchored" id="val-index"><a href="#val-index" class="anchor"></a><code><span><span class="keyword">val</span> index : <span><span class="optlabel">?absent</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-index">Sexp.index</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>index ?absent i q</code> queries the s-expression index <code>i</code> with <code>q</code> using <a href="#val-nth"><code>nth</code></a> or <a href="#val-key"><code>key</code></a> according to <code>i</code>. Fails on atoms.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete_index"><a href="#val-delete_index" class="anchor"></a><code><span><span class="keyword">val</span> delete_index : <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-index">Sexp.index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delete_index ~must_exist i</code> deletes the s-expression index <code>i</code> using <a href="#val-delete_nth"><code>delete_nth</code></a> or <a href="#val-delete_key"><code>delete_key</code></a> according to <code>i</code>.</p></div></div><h2 id="path_caret"><a href="#path_caret" class="anchor"></a>Path and caret queries</h2><p>These queries fail on indexing errors, that is if an atom gets indexed.</p><div class="odoc-spec"><div class="spec value anchored" id="val-path"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : <span><span class="optlabel">?absent</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-path">Sexp.path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>path p q</code> queries the s-expression found by <code>p</code> using <code>q</code>. If <code>p</code> can't be found this fails if <code>absent</code> is <code>None</code> and succeeds with <code>v</code> if <code>absent</code> is <code>Some v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-probe_path"><a href="#val-probe_path" class="anchor"></a><code><span><span class="keyword">val</span> probe_path : <span><a href="../Sexp/index.html#type-path">Sexp.path</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-path">path</a> * <a href="../Sexp/index.html#type-t">Sexp.t</a> * <a href="../Sexp/index.html#type-path">Sexp.path</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>probe_path p</code> is a query that probes for <code>p</code>'s existence. Except for indexing errors it always succeeds with <code>(sp, s, rem)</code>:</p><ul><li>If <code>p</code> is found, this is the path to <code>sp</code> to the found expression <code>s</code> and <code>rem</code> is empty.</li><li>If <code>p</code> is not found, this is the path <code>sp</code> that leads to the s-expression <code>s</code> that could not be indexed and <code>rem</code> has the indexes that could not be performed.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete_at_path"><a href="#val-delete_at_path" class="anchor"></a><code><span><span class="keyword">val</span> delete_at_path : <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-path">Sexp.path</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delete_at_path ~must_exist p</code> deletes the s-expression found by <code>p</code> from the queried s-expression. If the path does not exist this fails if <code>must_exist</code> is <code>true</code> and returns the s-expression itself if <code>must_exist</code> is <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-splice_at_path"><a href="#val-splice_at_path" class="anchor"></a><code><span><span class="keyword">val</span> splice_at_path : 
  <span><span class="optlabel">?stub</span>:<a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sexp/index.html#type-path">Sexp.path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rep</span>:<a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>splice_at_path ?stub ~must_exist p ~rep</code> replaces the s-expression found at <code>p</code> by splicing <code>rep</code>. If the path does not exist this fails if <code>must_exist</code> is <code>true</code> and the non-existing part of the path is created if <code>must_exist</code> is <code>false</code>. If elements need to be created <code>stub</code> (defaults to <code>Sexp.atom &quot;&quot;</code>) is used.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-splice_at_caret"><a href="#val-splice_at_caret" class="anchor"></a><code><span><span class="keyword">val</span> splice_at_caret : 
  <span><span class="optlabel">?stub</span>:<a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">must_exist</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sexp/index.html#type-caret">Sexp.caret</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rep</span>:<a href="../Sexp/index.html#type-t">Sexp.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sexp/index.html#type-t">Sexp.t</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>splice_caret ?stub ~must_exist p rep</code> splices the s-expression <code>rep</code> at the caret <code>p</code> of the s-expression. If path of the caret does not exist this fails if <code>must_exist</code> is <code>true</code> and the non-existing part of the path is created if <code>must_exist</code> is <code>false</code>. If atoms need to be create <code>stub</code> (defaults to <code>Sexp.atom &quot;&quot;</code>) is used.</p></div></div><h2 id="ocaml"><a href="#ocaml" class="anchor"></a>OCaml datatype encoding queries</h2><div class="odoc-spec"><div class="spec value anchored" id="val-option"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>option q</code> queries with <code>q</code> the value of an option represented according the encoding of <a href="../Sexpg/index.html#val-option"><code>Sexpg.option</code></a>.</p></div></div></div></body></html>
