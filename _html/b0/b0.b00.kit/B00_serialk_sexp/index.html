<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>B00_serialk_sexp (b0.b0.b00.kit.B00_serialk_sexp)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../sherlodoc_db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../../index.html">Up</a> ‚Äì <a href="../../../index.html">üè†</a> &#x00BB; <a href="../../index.html">B0  <span class="version">v0.0.5</span></a> &#x00BB; Library <code>b0.b00.kit</code> &#x00BB; B00_serialk_sexp</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>B00_serialk_sexp</span></code></h1><p>S-expression support.</p><p>The module <a href="Sexp/index.html"><code>Sexp</code></a> has an s-expression codec and general definitions for working with them. <a href="Sexpg/index.html"><code>Sexpg</code></a> generates s-expressions without going through a generic representation. <a href="Sexpq/index.html"><code>Sexpq</code></a> queries and updates generic representations with combinators.</p><p>Consult a <a href="#sexp_syntax" title="sexp_syntax">short introduction</a> to s-expressions and the syntax parsed by the codec, the encoding of <a href="#sexp_dict" title="sexp_dict">key-value dictionaries</a> supported by this module and the end-user syntax for <a href="#sexp_path_caret" title="sexp_path_caret">addressing and updating</a> s-expressions.</p><p>Open this module to use it, this only introduces modules in your scope.</p><p><b>Warning.</b> Serialization functions always assumes all OCaml strings in the data you provide is UTF-8 encoded. This is not checked by the module.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#api">API</a></li><li><a href="#sexp_dict">Dictionaries</a></li><li><a href="#sexp_path_caret">Path &amp; caret syntax</a></li><li><a href="#sexp_syntax">S-expression syntax</a><ul><li><a href="#sexp">S-expressions</a></li><li><a href="#whitespace">Whitespace</a></li><li><a href="#comments">Comments</a></li><li><a href="#atoms">Atoms</a></li><li><a href="#lists">Lists</a></li><li><a href="#grammar">Formal grammar</a></li></ul></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">B0  <span class="version">v0.0.5</span></a><ul><li><a href="../../b00_manual.html">B00 manual</a></li><li><a href="../../cmdlet_manual.html">Cmdlet manual</a></li><li><a href="../../driver_dev.html">B0 driver development manual</a></li><li><a href="../../manual.html">B0 manual</a></li><li><a href="../../old_manual.html">B0 manual</a></li><li><a href="../../opam.html"><code>opam</code> support manual</a></li><li><a href="../../rationale.html">Why b0 ?</a></li><li><a href="../../release.html">B0 release support manual</a></li><li><a href="../../todo.html">Design considerations and todo</a></li><li><a href="../../unit_manual.html">Build unit manual</a></li><li>Library <code>b0</code><ul><li><a href="../../b0/B0_build/index.html">B0_build</a></li><li><a href="../../b0/B0_cli/index.html">B0_cli</a></li><li><a href="../../b0/B0_cmdlet/index.html">B0_cmdlet</a></li><li><a href="../../b0/B0_def/index.html">B0_def</a></li><li><a href="../../b0/B0_dir/index.html">B0_dir</a></li><li><a href="../../b0/B0_driver/index.html">B0_driver</a></li><li><a href="../../b0/B0_file/index.html">B0_file</a></li><li><a href="../../b0/B0_meta/index.html">B0_meta</a></li><li><a href="../../b0/B0_pack/index.html">B0_pack</a></li><li><a href="../../b0/B0_unit/index.html">B0_unit</a></li></ul></li><li>Library <code>b0.b0</code><ul><li><a href="../../b0.b0/B0_b0/index.html">B0_b0</a></li><li><a href="../../b0.b0/B0_cmd_build/index.html">B0_cmd_build</a></li><li><a href="../../b0.b0/B0_cmd_cmd/index.html">B0_cmd_cmd</a></li><li><a href="../../b0.b0/B0_cmd_cmdlet/index.html">B0_cmd_cmdlet</a></li><li><a href="../../b0.b0/B0_cmd_delete/index.html">B0_cmd_delete</a></li><li><a href="../../b0.b0/B0_cmd_file/index.html">B0_cmd_file</a></li><li><a href="../../b0.b0/B0_cmd_list/index.html">B0_cmd_list</a></li><li><a href="../../b0.b0/B0_cmd_log/index.html">B0_cmd_log</a></li><li><a href="../../b0.b0/B0_cmd_pack/index.html">B0_cmd_pack</a></li><li><a href="../../b0.b0/B0_cmd_root/index.html">B0_cmd_root</a></li><li><a href="../../b0.b0/B0_cmd_scope/index.html">B0_cmd_scope</a></li><li><a href="../../b0.b0/B0_cmd_unit/index.html">B0_cmd_unit</a></li><li><a href="../../b0.b0/B0_main/index.html">B0_main</a></li></ul></li><li>Library <code>b0.b00</code><ul><li><a href="../../b0.b00/B00/index.html">B00</a></li><li><a href="../../b0.b00/B000/index.html">B000</a></li><li><a href="../../b0.b00/B000_conv/index.html">B000_conv</a></li></ul></li><li>Library <code>b0.b00.kit</code><ul><li><a href="../B00_base64/index.html">B00_base64</a></li><li><a href="../B00_cli/index.html">B00_cli</a></li><li><a href="../B00_cmark/index.html">B00_cmark</a></li><li><a href="../B00_editor/index.html">B00_editor</a></li><li><a href="../B00_fexts/index.html">B00_fexts</a></li><li><a href="../B00_findex/index.html">B00_findex</a></li><li><a href="../B00_github/index.html">B00_github</a></li><li><a href="../B00_htmlg/index.html">B00_htmlg</a></li><li><a href="../B00_http/index.html">B00_http</a></li><li><a href="../B00_jsoo/index.html">B00_jsoo</a></li><li><a href="../B00_lines/index.html">B00_lines</a></li><li><a href="../B00_ocaml/index.html">B00_ocaml</a></li><li><a href="../B00_odoc/index.html">B00_odoc</a></li><li><a href="../B00_os/index.html">B00_os</a></li><li><a href="../B00_pager/index.html">B00_pager</a></li><li><a href="../B00_pdf_viewer/index.html">B00_pdf_viewer</a></li><li><a href="../B00_rsync/index.html">B00_rsync</a></li><li><a href="../B00_serialk_json/index.html">B00_serialk_json</a></li><li><a href="#" class="current_unit">B00_serialk_sexp</a><ul><li><a href="Sexp/index.html">Sexp</a></li><li><a href="Sexpg/index.html">Sexpg</a></li><li><a href="Sexpq/index.html">Sexpq</a></li></ul></li><li><a href="../B00_serialk_text/index.html">B00_serialk_text</a></li><li><a href="../B00_trace/index.html">B00_trace</a></li><li><a href="../B00_vcs/index.html">B00_vcs</a></li><li><a href="../B00_www_browser/index.html">B00_www_browser</a></li></ul></li><li>Library <code>b0.kit</code><ul><li><a href="../../b0.kit/B0_expect/index.html">B0_expect</a></li><li><a href="../../b0.kit/B0_jsoo/index.html">B0_jsoo</a></li><li><a href="../../b0.kit/B0_kit/index.html">B0_kit</a></li><li><a href="../../b0.kit/B0_ocaml/index.html">B0_ocaml</a></li><li><a href="../../b0.kit/B0_ocaml_eco/index.html">B0_ocaml_eco</a></li><li><a href="../../b0.kit/B0_opam/index.html">B0_opam</a></li><li><a href="../../b0.kit/B0_release/index.html">B0_release</a></li><li><a href="../../b0.kit/B0_srcs/index.html">B0_srcs</a></li></ul></li><li>Library <code>b0.std</code><ul><li><a href="../../b0.std/B0_std/index.html">B0_std</a></li></ul></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="api"><a href="#api" class="anchor"></a>API</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Sexp"><a href="#module-Sexp" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sexp/index.html">Sexp</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>S-expression definitions and codec.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sexpg"><a href="#module-Sexpg" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sexpg/index.html">Sexpg</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>S-expression generation.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sexpq"><a href="#module-Sexpq" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sexpq/index.html">Sexpq</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>S-expression queries.</p></div></div><h2 id="sexp_dict"><a href="#sexp_dict" class="anchor"></a>Dictionaries</h2><p>An s-expression <em>dictionary</em> is a list of bindings. A <em>binding</em> is a list that starts with a <em>key</em> and the remaining elements of the list are the binding's <em>value</em>. For example in this binding:</p><pre>(key v0 v1 ...)</pre><p>The key is <code>key</code> and the value the possibly empty list <code>v0</code>, <code>v1</code>, ... of s-expressions. The <a href="Sexpq/index.html#qdict" title="qdict">API</a> for dictionaries represents the value by a fake (doesn't exist syntactically) s-expression list whose text location starts at the first element of the value.</p><h2 id="sexp_path_caret"><a href="#sexp_path_caret" class="anchor"></a>Path &amp; caret syntax</h2><p>Path and carets provide a way for end users to address s-expressions and edit locations.</p><p>A <em>path</em> is a sequence of <a href="#sexp_dict" title="sexp_dict">key</a> and list indexing operations. Applying the path to an s-expression leads to an s-expression or nothing if one of the indices does not exist, or an error if ones tries to index an atom.</p><p>A <em>caret</em> is a path and a spatial specification for the s-expression found by the path. The caret indicates either the void before that expression, the expression itself (over caret) or the void after it.</p><p>Here are a few examples of paths and carets, syntactically the charater <code>'v'</code> is used to denote the caret's insertion point before or after a path. There's no distinction between a path an over caret.</p><pre>Ocaml.libs        # value of key 'libs' of dictionary 'ocaml'
ocaml.v[libs]     # before the key binding (if any)
ocaml.[libs]v     # after the key binding (if any)

ocaml.libs.[0]    # first element of key 'libs' of dictionary 'ocaml'
ocaml.libs.v[0]   # before first element (if any)
ocaml.libs.[0]v   # after first element (if any)

ocaml.libs.[-1]   # last element of key 'libs' of dictionary 'ocaml'
ocaml.libs.v[-1]  # before last element (if any)
ocaml.libs.[-1]v  # after last element (if any)</pre><p>More formally a <em>path</em> is a <code>.</code> seperated list of indices.</p><p>An <em>index</em> is written <code>[i]</code>. <code>i</code> can a zero-based list index with negative indices counting from the end of the list (<code>-1</code> is the last element). Or <code>i</code> can be a dictionary key <code>key</code>. If there is no ambiguity, the surrounding brackets can be dropped.</p><p>A caret is a path whose last index brackets can be prefixed or suffixed by an insertion point, represented by the character <code>'v'</code>. This respectively denote the void before or after the s-expression found by the path.</p><p><b>Note.</b> The syntax has no form of quoting at the moment this means key names can't contain, <code>[</code>, <code>]</code>, or start with a number.</p><h2 id="sexp_syntax"><a href="#sexp_syntax" class="anchor"></a>S-expression syntax</h2><p>S-expressions are a general way of describing data via atoms (sequences of characters) and lists delimited by parentheses. Here are a few examples of s-expressions and their syntax:</p><pre>this-is-an_atom
(this is a list of seven atoms)
(this list contains (a nested) list)

; This is a comment
; Anything that follows a semi-colon is ignored until the next line

(this list ; has three atoms and an embeded ()
 comment)

&quot;this is a quoted atom, it can contain spaces ; and ()&quot;

&quot;quoted atoms can be split ^
 across lines or contain Unicode esc^u{0061}pes&quot;</pre><p>We define the syntax of s-expressions over a sequence of <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode characters</a> in which all US-ASCII control characters (U+0000..U+001F and U+007F) except <a href="#whitespace" title="whitespace">whitespace</a> are forbidden in unescaped form.</p><h3 id="sexp"><a href="#sexp" class="anchor"></a>S-expressions</h3><p>An <em>s-expression</em> is either an <a href="#atoms" title="atoms"><em>atom</em></a> or a <a href="#lists" title="lists"><em>list</em></a> of s-expressions interspaced with <a href="#whitespace" title="whitespace"><em>whitespace</em></a> and <a href="#comments" title="comments"><em>comments</em></a>. A <em>sequence of s-expressions</em> is a succession of s-expressions interspaced with whitespace and comments.</p><p>These elements are informally described below and finally made precise via an ABNF <a href="#grammar" title="grammar">grammar</a>.</p><h3 id="whitespace"><a href="#whitespace" class="anchor"></a>Whitespace</h3><p>Whitespace is a sequence of whitespace characters, namely, space <code>' '</code> (U+0020), tab <code>'\t'</code> (U+0009), line feed <code>'\n'</code> (U+000A), vertical tab <code>'\t'</code> (U+000B), form feed (U+000C) and carriage return <code>'\r'</code> (U+000D).</p><h3 id="comments"><a href="#comments" class="anchor"></a>Comments</h3><p>Unless it occurs inside an atom in quoted form (see below) anything that follows a semicolon <code>';'</code> (U+003B) is ignored until the next <em>end of line</em>, that is either a line feed <code>'\n'</code> (U+000A), a carriage return <code>'\r'</code> (U+000D) or a carriage return and a line feed <code>&quot;\r\n&quot;</code> (&lt;U+000D,U+000A&gt;).</p><pre>(this is not a comment) ; This is a comment
(this is not a comment)</pre><h3 id="atoms"><a href="#atoms" class="anchor"></a>Atoms</h3><p>An atom represents ground data as a string of Unicode characters. It can, via escapes, represent any sequence of Unicode characters, including control characters and U+0000. It cannot represent an arbitrary byte sequence except via a client-defined encoding convention (e.g. Base64 or hex encoding).</p><p>Atoms can be specified either via an unquoted or a quoted form. In unquoted form the atom is written without delimiters. In quoted form the atom is delimited by double quote <code>'&quot;'</code> (U+0022) characters, it is mandatory for atoms that contain <a href="#whitespace" title="whitespace">whitespace</a>, parentheses <code>'('</code> <code>')'</code>, semicolons <code>';'</code>, quotes <code>'&quot;'</code>, carets <code>'^'</code> or characters that need to be escaped.</p><pre>abc        ; a token for the atom &quot;abc&quot;
&quot;abc&quot;      ; a quoted token for the atom &quot;abc&quot;
&quot;abc; (d&quot;  ; a quoted token for the atom &quot;abc; (d&quot;
&quot;&quot;         ; the quoted token for the atom &quot;&quot;</pre><p>For atoms that do not need to be quoted, both their unquoted and quoted form represent the same string; e.g. the string <code>&quot;true&quot;</code> can be represented both by the atoms <em>true</em> and <em>&quot;true&quot;</em>. The empty string can only be represented in quoted form by <em>&quot;&quot;</em>.</p><p>In quoted form escapes are introduced by a caret <code>'^'</code>. Double quotes <code>'&quot;'</code> and carets <code>'^'</code> must always be escaped.</p><pre>&quot;^^&quot;             ; atom for ^
&quot;^n&quot;             ; atom for line feed U+000A
&quot;^u{0000}&quot;       ; atom for U+0000
&quot;^&quot;^u{1F42B}^&quot;&quot;  ; atom with a quote, U+1F42B and a quote</pre><p>The following escape sequences are recognized:</p><ul><li><code>&quot;^ &quot;</code> (&lt;U+005E,U+0020&gt;) for space <code>' '</code> (U+0020)</li><li><code>&quot;^\&quot;&quot;</code> (&lt;U+005E,U+0022&gt;) for double quote <code>'&quot;'</code> (U+0022) <b>mandatory</b></li><li><code>&quot;^^&quot;</code> (&lt;U+005E,U+005E&gt;) for caret <code>'^'</code> (U+005E) <b>mandatory</b></li><li><code>&quot;^n&quot;</code> (&lt;U+005E,U+006E&gt;) for line feed <code>'\n'</code> (U+000A)</li><li><code>&quot;^r&quot;</code> (&lt;U+005E,U+0072&gt;) for carriage return <code>'\r'</code> (U+000D)</li><li><code>&quot;^u{X}&quot;</code> with <code>X</code> is from 1 to at most 6 upper or lower case hexadecimal digits standing for the corresponding <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode character</a> U+X.</li><li>Any other character except line feed <code>'\n'</code> (U+000A) or carriage return <code>'\r'</code> (U+000D), following a caret is an illegal sequence of characters. In the two former cases the atom continues on the next line and white space is ignored.</li></ul><p>An atom in quoted form can be split across lines by using a caret <code>'^'</code> (U+005E) followed by a line feed <code>'\n'</code> (U+000A) or a carriage return <code>'\r'</code> (U+000D); any subsequent <a href="#whitespace" title="whitespace">whitespace</a> is ignored.</p><pre>&quot;^
  a^
  ^ &quot; ; the atom &quot;a &quot;</pre><p>The character ^ (U+005E) is used as an escape character rather than the usual \ (U+005C) in order to make quoted Windows¬Æ file paths decently readable and, not the least, utterly please DKM.</p><h3 id="lists"><a href="#lists" class="anchor"></a>Lists</h3><p>Lists are delimited by left <code>'('</code> (U+0028) and right <code>')'</code> (U+0029) parentheses. Their elements are s-expressions separated by optional <a href="#whitespace" title="whitespace">whitespace</a> and <a href="#comments" title="comments">comments</a>. For example:</p><pre>(a list (of four) expressions)
(a list(of four)expressions)
(&quot;a&quot;list(&quot;of&quot;four)expressions)
(a list (of ; This is a comment
four) expressions)
() ; the empty list</pre><h3 id="grammar"><a href="#grammar" class="anchor"></a>Formal grammar</h3><p>The following <a href="https://tools.ietf.org/html/rfc5234">RFC 5234</a> ABNF grammar is defined on a sequence of <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode characters</a>.</p><pre> sexp-seq = *(ws / comment / sexp)
     sexp = atom / list
     list = %x0028 sexp-seq %x0029
     atom = token / qtoken
    token = t-char *(t-char)
   qtoken = %x0022 *(q-char / escape / cont) %x0022
   escape = %x005E (%x0020 / %x0022 / %x005E / %x006E / %x0072 /
                    %x0075 %x007B unum %x007D)
     unum = 1*6(HEXDIG)
     cont = %x005E nl ws
       ws = *(ws-char)
  comment = %x003B *(c-char) nl
       nl = %x000A / %x000D / %x000D %x000A
   t-char = %x0021 / %x0023-0027 / %x002A-%x003A / %x003C-%x005D /
            %x005F-%x007E / %x0080-D7FF / %xE000-10FFFF
   q-char = t-char / ws-char / %x0028 / %x0029 / %x003B
  ws-char = %x0020 / %x0009 / %x000A / %x000B / %x000C / %x000D
   c-char = %x0009 / %x000B / %x000C / %x0020-D7FF / %xE000-10FFFF</pre><p>A few additional constraints not expressed by the grammar:</p><ul><li><code>unum</code> once interpreted as an hexadecimal number must be a <a href="http://unicode.org/glossary/#unicode_scalar_value">Unicode scalar value.</a></li><li>A comment can be ended by the end of the character sequence rather than <code>nl</code>.</li></ul></div></body></html>
