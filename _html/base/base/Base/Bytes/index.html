<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bytes (base.base.Base.Bytes)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../sherlodoc_db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../index.html">üè†</a> &#x00BB; <a href="../../../index.html">Base</a> &#x00BB; Library <code>base</code> &#x00BB; <a href="../index.html">Base</a> &#x00BB; Bytes</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Base.Bytes</span></code><a href="../../../src/base/bytes.ml.html" class="source_link">Source</a></h1><p>OCaml's byte sequence type, semantically similar to a <code>char array</code>, but taking less space in memory.</p><p>A byte sequence is a mutable data structure that contains a fixed-length sequence of bytes (of type <code>char</code>). Each byte can be indexed in constant time for reading or writing.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#common-interfaces">Common Interfaces</a><ul><li><a href="#unsafe">Unsafe conversions (for advanced users)</a></li></ul></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../index.html">Base</a><ul><li>Library <code>base</code><ul><li><a href="../index.html">Base</a><ul><li><a href="../Applicative/index.html">Applicative</a></li><li><a href="../Array/index.html">Array</a></li><li><a href="../Avltree/index.html">Avltree</a></li><li><a href="../Backtrace/index.html">Backtrace</a></li><li><a href="../Binary_search/index.html">Binary_search</a></li><li><a href="../Binary_searchable/index.html">Binary_searchable</a></li><li><a href="../Blit/index.html">Blit</a></li><li><a href="../Bool/index.html">Bool</a></li><li><a href="../Buffer/index.html">Buffer</a></li><li><a href="#" class="current_unit">Bytes</a><ul><li><a href="To_string/index.html">To_string</a></li><li><a href="From_string/index.html">From_string</a></li></ul></li><li><a href="../Char/index.html">Char</a></li><li><a href="../Comparable/index.html">Comparable</a></li><li><a href="../Comparator/index.html">Comparator</a></li><li><a href="../Comparisons/index.html">Comparisons</a></li><li><a href="../Container/index.html">Container</a></li><li><a href="../Either/index.html">Either</a></li><li><a href="../Equal/index.html">Equal</a></li><li><a href="../Error/index.html">Error</a></li><li><a href="../Exn/index.html">Exn</a></li><li><a href="../Field/index.html">Field</a></li><li><a href="../Float/index.html">Float</a></li><li><a href="../Floatable/index.html">Floatable</a></li><li><a href="../Fn/index.html">Fn</a></li><li><a href="../Formatter/index.html">Formatter</a></li><li><a href="../Hash/index.html">Hash</a></li><li><a href="../Hash_set/index.html">Hash_set</a></li><li><a href="../Hashable/index.html">Hashable</a></li><li><a href="../Hasher/index.html">Hasher</a></li><li><a href="../Hashtbl/index.html">Hashtbl</a></li><li><a href="../Identifiable/index.html">Identifiable</a></li><li><a href="../Indexed_container/index.html">Indexed_container</a></li><li><a href="../Info/index.html">Info</a></li><li><a href="../Int/index.html">Int</a></li><li><a href="../Int_conversions/index.html">Int_conversions</a></li><li><a href="../Int32/index.html">Int32</a></li><li><a href="../Int63/index.html">Int63</a></li><li><a href="../Int64/index.html">Int64</a></li><li><a href="../Intable/index.html">Intable</a></li><li><a href="../Int_math/index.html">Int_math</a></li><li><a href="../Invariant/index.html">Invariant</a></li><li><a href="../Lazy/index.html">Lazy</a></li><li><a href="../List/index.html">List</a></li><li><a href="../Map/index.html">Map</a></li><li><a href="../Maybe_bound/index.html">Maybe_bound</a></li><li><a href="../Monad/index.html">Monad</a></li><li><a href="../Nativeint/index.html">Nativeint</a></li><li><a href="../Nothing/index.html">Nothing</a></li><li><a href="../Option/index.html">Option</a></li><li><a href="../Option_array/index.html">Option_array</a></li><li><a href="../Or_error/index.html">Or_error</a></li><li><a href="../Ordered_collection_common/index.html">Ordered_collection_common</a></li><li><a href="../Ordering/index.html">Ordering</a></li><li><a href="../Poly/index.html">Poly</a></li><li><a href="../Popcount/index.html">Popcount</a></li><li><a href="../Pretty_printer/index.html">Pretty_printer</a></li><li><a href="../Printf/index.html">Printf</a></li><li><a href="../Linked_queue/index.html">Linked_queue</a></li><li><a href="../Queue/index.html">Queue</a></li><li><a href="../Random/index.html">Random</a></li><li><a href="../Ref/index.html">Ref</a></li><li><a href="../Result/index.html">Result</a></li><li><a href="../Sequence/index.html">Sequence</a></li><li><a href="../Set/index.html">Set</a></li><li><a href="../Sexpable/index.html">Sexpable</a></li><li><a href="../Sign/index.html">Sign</a></li><li><a href="../Sign_or_nan/index.html">Sign_or_nan</a></li><li><a href="../Source_code_position/index.html">Source_code_position</a></li><li><a href="../Stack/index.html">Stack</a></li><li><a href="../Staged/index.html">Staged</a></li><li><a href="../String/index.html">String</a></li><li><a href="../Stringable/index.html">Stringable</a></li><li><a href="../Sys/index.html">Sys</a></li><li><a href="../T/index.html">T</a></li><li><a href="../Type_equal/index.html">Type_equal</a></li><li><a href="../Uniform_array/index.html">Uniform_array</a></li><li><a href="../Unit/index.html">Unit</a></li><li><a href="../Uchar/index.html">Uchar</a></li><li><a href="../Variant/index.html">Variant</a></li><li><a href="../With_return/index.html">With_return</a></li><li><a href="../Word_size/index.html">Word_size</a></li><li><a href="../index.html#module-type-T">T</a></li><li><a href="../index.html#module-type-T1">T1</a></li><li><a href="../index.html#module-type-T2">T2</a></li><li><a href="../index.html#module-type-T3">T3</a></li><li><a href="../Sexp/index.html">Sexp</a></li><li><a href="../Export/index.html">Export</a></li><li><a href="../index.html#module-Continue_or_stop">Continue_or_stop</a></li></ul></li></ul></li><li>Library <code>base.base_internalhash_types</code><ul><li><a href="../../../base.base_internalhash_types/Base_internalhash_types/index.html">Base_internalhash_types</a></li></ul></li><li>Library <code>base.caml</code><ul><li><a href="../../../base.caml/Caml/index.html">Caml</a></li></ul></li><li>Library <code>base.md5</code><ul><li><a href="../../../base.md5/Md5_lib/index.html">Md5_lib</a></li></ul></li><li>Library <code>base.shadow_stdlib</code><ul><li><a href="../../../base.shadow_stdlib/Shadow_stdlib/index.html">Shadow_stdlib</a></li></ul></li><li><a href="../../../src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.type-t" class="source_link">Source</a><code><span><span class="keyword">type</span> t</span><span> = bytes</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-globalize"><a href="#val-globalize" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.val-globalize" class="source_link">Source</a><code><span><span class="keyword">val</span> globalize : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../../sexplib0/sexplib0/Sexplib0/Sexpable/module-type-S/index.html">Sexplib0.Sexpable.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../sexplib0/sexplib0/Sexplib0/Sexpable/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-t_of_sexp"><a href="#val-t_of_sexp" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.val-t_of_sexp" class="source_link">Source</a><code><span><span class="keyword">val</span> t_of_sexp : <span><a href="../../../../sexplib0/sexplib0/Sexplib0/Sexp/index.html#type-t">Sexplib0.Sexp.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.val-sexp_of_t" class="source_link">Source</a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../sexplib0/sexplib0/Sexplib0/Sexp/index.html#type-t">Sexplib0.Sexp.t</a></span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-t_sexp_grammar"><a href="#val-t_sexp_grammar" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.val-t_sexp_grammar" class="source_link">Source</a><code><span><span class="keyword">val</span> t_sexp_grammar : <span><a href="#type-t">t</a> <a href="../../../../sexplib0/sexplib0/Sexplib0/Sexp_grammar/index.html#type-t">Sexplib0.Sexp_grammar.t</a></span></span></code></div></div><h2 id="common-interfaces"><a href="#common-interfaces" class="anchor"></a>Common Interfaces</h2><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Blit/module-type-S/index.html">Blit.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Blit/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-blit"><a href="#val-blit" class="anchor"></a><a href="../../../src/base/blit.ml.html#module-Make_gen.val-blit" class="source_link">Source</a><code><span><span class="keyword">val</span> blit : <span><span class="label">src</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">src_pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">dst</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">dst_pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-blito"><a href="#val-blito" class="anchor"></a><a href="../../../src/base/blit.ml.html#module-Make_gen.val-blito" class="source_link">Source</a><code><span><span class="keyword">val</span> blito : 
  <span><span class="label">src</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?src_pos</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?src_len</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dst_pos</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unsafe_blit"><a href="#val-unsafe_blit" class="anchor"></a><a href="../../../src/base/blit.ml.html#module-Make_gen.val-unsafe_blit" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_blit : 
  <span><span class="label">src</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">src_pos</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dst_pos</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub"><a href="#val-sub" class="anchor"></a><a href="../../../src/base/blit.ml.html#module-Make_gen.val-sub" class="source_link">Source</a><code><span><span class="keyword">val</span> sub : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subo"><a href="#val-subo" class="anchor"></a><a href="../../../src/base/blit.ml.html#module-Make_gen.val-subo" class="source_link">Source</a><code><span><span class="keyword">val</span> subo : <span><span class="optlabel">?pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?len</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Comparable/module-type-S/index.html">Comparable.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Comparable/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Comparisons/module-type-S/index.html">Comparisons.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Comparisons/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Comparisons/module-type-Infix/index.html">Comparisons.Infix</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Comparisons/module-type-Infix/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;=)"><a href="#val-(&gt;=)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(&gt;=)" class="source_link">Source</a><code><span><span class="keyword">val</span> (&gt;=) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;=)"><a href="#val-(&lt;=)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(&lt;=)" class="source_link">Source</a><code><span><span class="keyword">val</span> (&lt;=) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(=)"><a href="#val-(=)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(=)" class="source_link">Source</a><code><span><span class="keyword">val</span> (=) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;)"><a href="#val-(&gt;)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(&gt;)" class="source_link">Source</a><code><span><span class="keyword">val</span> (&gt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;)"><a href="#val-(&lt;)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(&lt;)" class="source_link">Source</a><code><span><span class="keyword">val</span> (&lt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;&gt;)"><a href="#val-(&lt;&gt;)" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-(&lt;&gt;)" class="source_link">Source</a><code><span><span class="keyword">val</span> (&lt;&gt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal"><a href="#val-equal" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-equal" class="source_link">Source</a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-compare" class="source_link">Source</a><code><span><span class="keyword">val</span> compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare t1 t2</code> returns 0 if <code>t1</code> is equal to <code>t2</code>, a negative integer if <code>t1</code> is less than <code>t2</code>, and a positive integer if <code>t1</code> is greater than <code>t2</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min"><a href="#val-min" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-min" class="source_link">Source</a><code><span><span class="keyword">val</span> min : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max"><a href="#val-max" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-max" class="source_link">Source</a><code><span><span class="keyword">val</span> max : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-ascending"><a href="#val-ascending" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-ascending" class="source_link">Source</a><code><span><span class="keyword">val</span> ascending : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>ascending</code> is identical to <code>compare</code>. <code>descending x y = ascending y x</code>. These are intended to be mnemonic when used like <code>List.sort ~compare:ascending</code> and <code>List.sort ~cmp:descending</code>, since they cause the list to be sorted in ascending or descending order, respectively.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-descending"><a href="#val-descending" class="anchor"></a><a href="../../../src/base/import0.ml.html#module-Bytes_replace_polymorphic_compare.val-descending" class="source_link">Source</a><code><span><span class="keyword">val</span> descending : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-between"><a href="#val-between" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-between" class="source_link">Source</a><code><span><span class="keyword">val</span> between : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">low</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">high</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>between t ~low ~high</code> means <code>low &lt;= t &lt;= high</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clamp_exn"><a href="#val-clamp_exn" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-clamp_exn" class="source_link">Source</a><code><span><span class="keyword">val</span> clamp_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">min</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">max</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>clamp_exn t ~min ~max</code> returns <code>t'</code>, the closest value to <code>t</code> such that <code>between t' ~low:min ~high:max</code> is true.</p><p>Raises if <code>not (min &lt;= max)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clamp"><a href="#val-clamp" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-clamp" class="source_link">Source</a><code><span><span class="keyword">val</span> clamp : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">min</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">max</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../Or_error/index.html#type-t">Or_error.t</a></span></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Comparator/module-type-S/index.html">Comparator.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Comparator/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-comparator_witness"><a href="#type-comparator_witness" class="anchor"></a><a href="../../../src/base/comparator.ml.html#module-Make.type-comparator_witness" class="source_link">Source</a><code><span><span class="keyword">type</span> comparator_witness</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-comparator"><a href="#val-comparator" class="anchor"></a><a href="../../../src/base/comparator.ml.html#module-Make.val-comparator" class="source_link">Source</a><code><span><span class="keyword">val</span> comparator : <span><span>(<a href="#type-t">t</a>, <a href="#type-comparator_witness">comparator_witness</a>)</span> <a href="../Comparator/index.html#type-comparator">Comparator.comparator</a></span></span></code></div></div></details></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Stringable/module-type-S/index.html">Stringable.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Stringable/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-of_string"><a href="#val-of_string" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-of_string" class="source_link">Source</a><code><span><span class="keyword">val</span> of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_string"><a href="#val-to_string" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-to_string" class="source_link">Source</a><code><span><span class="keyword">val</span> to_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div></details></div><div class="odoc-include"><div class="spec-doc"><p>Note that <code>pp</code> allocates in order to preserve the state of the byte sequence it was initially called with.</p></div><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Pretty_printer/module-type-S/index.html">Pretty_printer.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Pretty_printer/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-T.val-pp" class="source_link">Source</a><code><span><span class="keyword">val</span> pp : <span><a href="../Formatter/index.html#type-t">Formatter.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Invariant/module-type-S/index.html">Invariant.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Invariant/module-type-S/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-invariant"><a href="#val-invariant" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-invariant" class="source_link">Source</a><code><span><span class="keyword">val</span> invariant : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-To_string"><a href="#module-To_string" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-To_string" class="source_link">Source</a><code><span><span class="keyword">module</span> <a href="To_string/index.html">To_string</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-From_string"><a href="#module-From_string" class="anchor"></a><a href="../../../src/base/bytes.ml.html#module-From_string" class="source_link">Source</a><code><span><span class="keyword">module</span> <a href="From_string/index.html">From_string</a></span><span> : <a href="../Blit/module-type-S_distinct/index.html">Blit.S_distinct</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Blit/module-type-S_distinct/index.html#type-src">src</a> := string</span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Blit/module-type-S_distinct/index.html#type-dst">dst</a> := <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-create" class="source_link">Source</a><code><span><span class="keyword">val</span> create : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create len</code> returns a newly-allocated and uninitialized byte sequence of length <code>len</code>. No guarantees are made about the contents of the return value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_local"><a href="#val-create_local" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-create_local" class="source_link">Source</a><code><span><span class="keyword">val</span> create_local : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create_local</code> is like <code>create</code>, but returns a stack-allocated <code>Bytes.t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-make" class="source_link">Source</a><code><span><span class="keyword">val</span> make : <span>int <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make len c</code> returns a newly-allocated byte sequence of length <code>len</code> filled with the byte <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-map" class="source_link">Source</a><code><span><span class="keyword">val</span> map : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span>char <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>map f t</code> applies function <code>f</code> to every byte, in order, and builds the byte sequence with the results returned by <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mapi"><a href="#val-mapi" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-mapi" class="source_link">Source</a><code><span><span class="keyword">val</span> mapi : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Like <code>map</code>, but passes each character's index to <code>f</code> along with the char.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy"><a href="#val-copy" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-copy" class="source_link">Source</a><code><span><span class="keyword">val</span> copy : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>copy t</code> returns a newly-allocated byte sequence that contains the same bytes as <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-init" class="source_link">Source</a><code><span><span class="keyword">val</span> init : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> char)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>init len ~f</code> returns a newly-allocated byte sequence of length <code>len</code> with index <code>i</code> in the sequence being initialized with the result of <code>f i</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_char_list"><a href="#val-of_char_list" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-of_char_list" class="source_link">Source</a><code><span><span class="keyword">val</span> of_char_list : <span><span>char list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>of_char_list l</code> returns a newly-allocated byte sequence where each byte in the sequence corresponds to the byte in <code>l</code> at the same index.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-length"><a href="#val-length" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-length" class="source_link">Source</a><code><span><span class="keyword">val</span> length : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>length t</code> returns the number of bytes in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-get" class="source_link">Source</a><code><span><span class="keyword">val</span> get : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> char</span></code></div><div class="spec-doc"><p><code>get t i</code> returns the <code>i</code>th byte of <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_get"><a href="#val-unsafe_get" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_get" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_get : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> char</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-set"><a href="#val-set" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-set" class="source_link">Source</a><code><span><span class="keyword">val</span> set : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set t i c</code> sets the <code>i</code>th byte of <code>t</code> to <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_set"><a href="#val-unsafe_set" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_set" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_set : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_get_int64"><a href="#val-unsafe_get_int64" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_get_int64" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_get_int64 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int64</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_set_int64"><a href="#val-unsafe_set_int64" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_set_int64" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_set_int64 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_get_int32"><a href="#val-unsafe_get_int32" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_get_int32" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_get_int32 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int32</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_set_int32"><a href="#val-unsafe_set_int32" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_set_int32" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_set_int32 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_get_int16"><a href="#val-unsafe_get_int16" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_get_int16" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_get_int16 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_set_int16"><a href="#val-unsafe_set_int16" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#module-Primitives.val-unsafe_set_int16" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_set_int16 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fill"><a href="#val-fill" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-fill" class="source_link">Source</a><code><span><span class="keyword">val</span> fill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>fill t ~pos ~len c</code> modifies <code>t</code> in place, replacing all the bytes from <code>pos</code> to <code>pos + len</code> with <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tr"><a href="#val-tr" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-tr" class="source_link">Source</a><code><span><span class="keyword">val</span> tr : <span><span class="label">target</span>:char <span class="arrow">&#45;&gt;</span></span> <span><span class="label">replacement</span>:char <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>tr ~target ~replacement t</code> modifies <code>t</code> in place, replacing every instance of <code>target</code> in <code>s</code> with <code>replacement</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tr_multi"><a href="#val-tr_multi" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-tr_multi" class="source_link">Source</a><code><span><span class="keyword">val</span> tr_multi : <span><span class="label">target</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">replacement</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <a href="../Staged/index.html#type-t">Staged.t</a></span></span></code></div><div class="spec-doc"><p><code>tr_multi ~target ~replacement</code> returns an in-place function that replaces every instance of a character in <code>target</code> with the corresponding character in <code>replacement</code>.</p><p>If <code>replacement</code> is shorter than <code>target</code>, it is lengthened by repeating its last character. Empty <code>replacement</code> is illegal unless <code>target</code> also is.</p><p>If <code>target</code> contains multiple copies of the same character, the last corresponding <code>replacement</code> character is used. Note that character ranges are <b>not</b> supported, so <code>~target:&quot;a-z&quot;</code> means the literal characters <code>'a'</code>, <code>'-'</code>, and <code>'z'</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_list"><a href="#val-to_list" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-to_list" class="source_link">Source</a><code><span><span class="keyword">val</span> to_list : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>char list</span></span></code></div><div class="spec-doc"><p><code>to_list t</code> returns the bytes in <code>t</code> as a list of chars.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_array"><a href="#val-to_array" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-to_array" class="source_link">Source</a><code><span><span class="keyword">val</span> to_array : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>char array</span></span></code></div><div class="spec-doc"><p><code>to_array t</code> returns the bytes in <code>t</code> as an array of chars.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-fold" class="source_link">Source</a><code><span><span class="keyword">val</span> fold : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">init</span>:<span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span></span></code></div><div class="spec-doc"><p><code>fold a ~f ~init:b</code> is <code>f a1 (f a2 (...))</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-foldi"><a href="#val-foldi" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-foldi" class="source_link">Source</a><code><span><span class="keyword">val</span> foldi : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">init</span>:<span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span></span></code></div><div class="spec-doc"><p><code>foldi</code> works similarly to <code>fold</code>, but also passes the index of each character to <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-contains"><a href="#val-contains" class="anchor"></a><a href="../../../src/base/bytes.ml.html#val-contains" class="source_link">Source</a><code><span><span class="keyword">val</span> contains : <span><span class="optlabel">?pos</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?len</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>contains ?pos ?len t c</code> returns <code>true</code> iff <code>c</code> appears in <code>t</code> between <code>pos</code> and <code>pos + len</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_length"><a href="#val-max_length" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-max_length" class="source_link">Source</a><code><span><span class="keyword">val</span> max_length : int</span></code></div><div class="spec-doc"><p>Maximum length of a byte sequence, which is architecture-dependent. Attempting to create a <code>Bytes</code> larger than this will raise an exception.</p></div></div><h3 id="unsafe"><a href="#unsafe" class="anchor"></a>Unsafe conversions (for advanced users)</h3><p>This section describes unsafe, low-level conversion functions between <code>bytes</code> and <code>string</code>. They might not copy the internal data; used improperly, they can break the immutability invariant on strings provided by the <code>-safe-string</code> option. They are available for expert library authors, but for most purposes you should use the always-correct <a href="#val-to_string"><code>Bytes.to_string</code></a> and <a href="#val-of_string"><code>Bytes.of_string</code></a> instead.</p><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_to_string"><a href="#val-unsafe_to_string" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-unsafe_to_string" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_to_string : <span><span class="label">no_mutation_while_string_reachable</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Unsafely convert a byte sequence into a string.</p><p>To reason about the use of <code>unsafe_to_string</code>, it is convenient to consider an &quot;ownership&quot; discipline. A piece of code that manipulates some data &quot;owns&quot; it; there are several disjoint ownership modes, including:</p><ul><li>Unique ownership: the data may be accessed and mutated</li><li>Shared ownership: the data has several owners, that may only access it, not mutate it.</li></ul><p>Unique ownership is linear: passing the data to another piece of code means giving up ownership (we cannot access the data again). A unique owner may decide to make the data shared (giving up mutation rights on it), but shared data may not become uniquely-owned again. <code>unsafe_to_string s</code> can only be used when the caller owns the byte sequence <code>s</code> -- either uniquely or as shared immutable data. The caller gives up ownership of <code>s</code>, and gains (the same mode of) ownership of the returned string. There are two valid use-cases that respect this ownership discipline:</p><ol><li><p>The first is creating a string by initializing and mutating a byte sequence that is never changed after initialization is performed.</p><pre class="language-ocaml"><code>let string_init len f : string =
  let s = Bytes.create len in
  for i = 0 to len - 1 do Bytes.set s i (f i) done;
  Bytes.unsafe_to_string ~no_mutation_while_string_reachable:s</code></pre><p>This function is safe because the byte sequence <code>s</code> will never be accessed or mutated after <code>unsafe_to_string</code> is called. The <code>string_init</code> code gives up ownership of <code>s</code>, and returns the ownership of the resulting string to its caller.</p><p>Note that it would be unsafe if <code>s</code> was passed as an additional parameter to the function <code>f</code> as it could escape this way and be mutated in the future -- <code>string_init</code> would give up ownership of <code>s</code> to pass it to <code>f</code>, and could not call <code>unsafe_to_string</code> safely.</p><p>We have provided the <a href="../String/index.html#val-init"><code>String.init</code></a>, <a href="../String/index.html#val-map"><code>String.map</code></a> and <a href="../String/index.html#val-mapi"><code>String.mapi</code></a> functions to cover most cases of building new strings. You should prefer those over <code>to_string</code> or <code>unsafe_to_string</code> whenever applicable.</p></li><li><p>The second is temporarily giving ownership of a byte sequence to a function that expects a uniquely owned string and returns ownership back, so that we can mutate the sequence again after the call ended.</p><pre class="language-ocaml"><code>let bytes_length (s : bytes) =
  String.length
    (Bytes.unsafe_to_string ~no_mutation_while_string_reachable:s)</code></pre><p>In this use-case, we do not promise that <code>s</code> will never be mutated after the call to <code>bytes_length s</code>. The <a href="../String/index.html#val-length"><code>String.length</code></a> function temporarily borrows unique ownership of the byte sequence (and sees it as a <code>string</code>), but returns this ownership back to the caller, which may assume that <code>s</code> is still a valid byte sequence after the call. Note that this is only correct because we know that <a href="../String/index.html#val-length"><code>String.length</code></a> does not capture its argument -- it could escape by a side-channel such as a memoization combinator. The caller may not mutate <code>s</code> while the string is borrowed (it has temporarily given up ownership). This affects concurrent programs, but also higher-order functions: if <a href="../String/index.html#val-length"><code>String.length</code></a> returned a closure to be called later, <code>s</code> should not be mutated until this closure is fully applied and returns ownership.</p></li></ol></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-unsafe_of_string_promise_no_mutation"><a href="#val-unsafe_of_string_promise_no_mutation" class="anchor"></a><a href="../../../src/base/bytes0.ml.html#val-unsafe_of_string_promise_no_mutation" class="source_link">Source</a><code><span><span class="keyword">val</span> unsafe_of_string_promise_no_mutation : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Unsafely convert a shared string to a byte sequence that should not be mutated.</p><p>The same ownership discipline that makes <code>unsafe_to_string</code> correct applies to <code>unsafe_of_string_promise_no_mutation</code>, however unique ownership of string values is extremely difficult to reason about correctly in practice. As such, one should always assume strings are shared, never uniquely owned (For example, string literals are implicitly shared by the compiler, so you never uniquely own them)</p><p>The only case we have reasonable confidence is safe is if the produced <code>bytes</code> is shared -- used as an immutable byte sequence. This is possibly useful for incremental migration of low-level programs that manipulate immutable sequences of bytes (for example <a href="../../../../ocaml-base-compiler/stdlib/Stdlib/Marshal/index.html#val-from_bytes"><code>Marshal.from_bytes</code></a>) and previously used the <code>string</code> type for this purpose.</p></div></div></div></body></html>
