<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: opamParallel.ml (opam-core.src.opam-core)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">opam-core</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; opam-core &#x00BB; opamParallel.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>opamParallel.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">opam-core</a><ul><li>Library <code>opam-core</code><ul><li><a href="../../opam-core/OpamACL/index.html">OpamACL</a></li><li><a href="../../opam-core/OpamCached/index.html">OpamCached</a></li><li><a href="../../opam-core/OpamCompat/index.html">OpamCompat</a></li><li><a href="../../opam-core/OpamConsole/index.html">OpamConsole</a></li><li><a href="../../opam-core/OpamCoreConfig/index.html">OpamCoreConfig</a></li><li><a href="../../opam-core/OpamCoreConfigDeveloper/index.html">OpamCoreConfigDeveloper</a></li><li><a href="../../opam-core/OpamDirTrack/index.html">OpamDirTrack</a></li><li><a href="../../opam-core/OpamFilename/index.html">OpamFilename</a></li><li><a href="../../opam-core/OpamHash/index.html">OpamHash</a></li><li><a href="../../opam-core/OpamJson/index.html">OpamJson</a></li><li><a href="../../opam-core/OpamParallel/index.html">OpamParallel</a></li><li><a href="../../opam-core/OpamProcess/index.html">OpamProcess</a></li><li><a href="../../opam-core/OpamSHA/index.html">OpamSHA</a></li><li><a href="../../opam-core/OpamSWHID/index.html">OpamSWHID</a></li><li><a href="../../opam-core/OpamStd/index.html">OpamStd</a></li><li><a href="../../opam-core/OpamStubs/index.html">OpamStubs</a></li><li><a href="../../opam-core/OpamStubsTypes/index.html">OpamStubsTypes</a></li><li><a href="../../opam-core/OpamSystem/index.html">OpamSystem</a></li><li><a href="../../opam-core/OpamUrl/index.html">OpamUrl</a></li><li><a href="../../opam-core/OpamVersion/index.html">OpamVersion</a></li><li><a href="../../opam-core/OpamVersionCompare/index.html">OpamVersionCompare</a></li><li><a href="../../opam-core/OpamVersionInfo/index.html">OpamVersionInfo</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>opam-core<ul><li><a href="opamACL.ml.html">opamACL.ml</a></li><li><a href="opamCached.ml.html">opamCached.ml</a></li><li><a href="opamCompat.ml.html">opamCompat.ml</a></li><li><a href="opamConsole.ml.html">opamConsole.ml</a></li><li><a href="opamCoreConfig.ml.html">opamCoreConfig.ml</a></li><li><a href="opamCoreConfigDeveloper.ml.html">opamCoreConfigDeveloper.ml</a></li><li><a href="opamDirTrack.ml.html">opamDirTrack.ml</a></li><li><a href="opamFilename.ml.html">opamFilename.ml</a></li><li><a href="opamHash.ml.html">opamHash.ml</a></li><li><a href="opamJson.ml.html">opamJson.ml</a></li><li><a href="#" class="current_unit">opamParallel.ml</a></li><li><a href="opamProcess.ml.html">opamProcess.ml</a></li><li><a href="opamSHA.ml.html">opamSHA.ml</a></li><li><a href="opamSWHID.ml.html">opamSWHID.ml</a></li><li><a href="opamStd.ml.html">opamStd.ml</a></li><li><a href="opamStubs.ml.html">opamStubs.ml</a></li><li><a href="opamStubsTypes.ml.html">opamStubsTypes.ml</a></li><li><a href="opamSystem.ml.html">opamSystem.ml</a></li><li><a href="opamUrl.ml.html">opamUrl.ml</a></li><li><a href="opamVersion.ml.html">opamVersion.ml</a></li><li><a href="opamVersionCompare.ml.html">opamVersionCompare.ml</a></li><li><a href="opamVersionInfo.ml.html">opamVersionInfo.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
</code><code class="source_code"><span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*    Copyright 2012-2019 OCamlPro                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*    Copyright 2012 INRIA                                                *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(*  All rights reserved. This file is distributed under the terms of the  *)</span><span class="EOL">
</span><span class="COMMENT">(*  GNU Lesser General Public License version 2.1, with the special       *)</span><span class="EOL">
</span><span class="COMMENT">(*  exception on linking described in the file LICENSE.                   *)</span><span class="EOL">
</span><span class="COMMENT">(*                                                                        *)</span><span class="EOL">
</span><span class="COMMENT">(**************************************************************************)</span><span class="EOL">
</span><span class="EOL">
</span><span class="OPEN">open</span> <a href="opamStd.ml.html#module-Op"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Op</span></a><span class="EOL">
</span><span class="OPEN">open</span> <a href="opamProcess.ml.html#module-Job.module-Op"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="UIDENT">Job</span><span class="DOT">.</span><span class="UIDENT">Op</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-log"><span class="LIDENT">log</span></span> <span id="local_fmt_1"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <a href="opamConsole.ml.html#val-log"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">log</span></a> <span class="STRING">&quot;PARALLEL&quot;</span> <a href="#local_fmt_1"><span class="LIDENT">fmt</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-slog"><span class="LIDENT">slog</span></span> <span class="EQUAL">=</span> <a href="opamConsole.ml.html#val-slog"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">slog</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="exception-Aborted"><span class="EXCEPTION">exception</span> <span class="UIDENT">Aborted</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-VERTEX"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">VERTEX</span> <span class="EQUAL">=</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <a href="opamStd.ml.html#module-type-OrderedType"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">OrderedType</span></a><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">COMPARABLE</span> <span class="WITH">with</span> <span id="def_247"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="COLONEQUAL">:=</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-dependency_label"><span class="TYPE">type</span> <span class="LIDENT">dependency_label</span> <span class="EQUAL">=</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-G"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">G</span> <span class="EQUAL">=</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">I</span> <span class="WITH">with</span> <span id="def_248"><span class="TYPE">type</span> <span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">label</span> <span class="EQUAL">=</span> <span class="LIDENT">dependency_label</span></span><span class="EOL">
</span>  <span id="module-type-G.module-Vertex"><span class="MODULE">module</span> <span class="UIDENT">Vertex</span><span class="COLON">:</span> <span class="UIDENT">VERTEX</span> <span class="WITH">with</span> <span id="def_251"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span></span></span><span class="EOL">
</span>  <span id="module-type-G.module-Topological"><span class="MODULE">module</span> <span class="UIDENT">Topological</span><span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>    <span id="module-type-G.module-Topological.val-fold"><span class="VAL">val</span> <span class="LIDENT">fold</span><span class="COLON">:</span> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span>  <span id="module-type-G.val-has_cycle"><span class="VAL">val</span> <span class="LIDENT">has_cycle</span><span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span></span><span class="EOL">
</span>  <span id="module-type-G.val-scc_list"><span class="VAL">val</span> <span class="LIDENT">scc_list</span><span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-SIG"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">SIG</span> <span class="EQUAL">=</span> <span class="SIG">sig</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-SIG.module-G"><span class="MODULE">module</span> <span class="UIDENT">G</span> <span class="COLON">:</span> <span class="UIDENT">G</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-SIG.val-iter"><span class="VAL">val</span> <span class="LIDENT">iter</span><span class="COLON">:</span><span class="EOL">
</span>    <span class="LIDENT">jobs</span><span class="COLON">:</span><span class="LIDENT">int</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">command</span><span class="COLON">:</span><span class="LPAREN">(</span><span class="LIDENT">pred</span><span class="COLON">:</span><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="opamProcess.ml.html#type-job"><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">job</span></a><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="OPTLABEL">?dry_run:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="OPTLABEL">?pools:</span><span class="LPAREN">(</span><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="LIDENT">int</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">unit</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-SIG.val-map"><span class="VAL">val</span> <span class="LIDENT">map</span><span class="COLON">:</span><span class="EOL">
</span>    <span class="LIDENT">jobs</span><span class="COLON">:</span><span class="LIDENT">int</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">command</span><span class="COLON">:</span><span class="LPAREN">(</span><span class="LIDENT">pred</span><span class="COLON">:</span><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="opamProcess.ml.html#type-job"><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">job</span></a><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="OPTLABEL">?dry_run:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="OPTLABEL">?pools:</span><span class="LPAREN">(</span><span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="LIDENT">int</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-SIG.exception-Errors"><span class="EXCEPTION">exception</span> <span class="UIDENT">Errors</span> <span class="OF">of</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="LIDENT">exn</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span id="module-type-SIG.exception-Cyclic"><span class="EXCEPTION">exception</span> <span class="UIDENT">Cyclic</span> <span class="OF">of</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Make"><span class="MODULE">module</span> <span class="UIDENT">Make</span> <span class="LPAREN">(</span><span class="UIDENT">G</span> <span class="COLON">:</span> <span class="UIDENT">G</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-G"><span class="MODULE">module</span> <span class="UIDENT">G</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.module-V"><span class="MODULE">module</span> <span class="UIDENT">V</span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">Vertex</span></span><span class="EOL">
</span>  <span id="module-Make.module-M"><span class="MODULE">module</span> <span class="UIDENT">M</span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Map.module-Make"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-Make.module-S"><span class="MODULE">module</span> <span class="UIDENT">S</span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-Set.module-Make"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Make.exception-Errors"><span class="EXCEPTION">exception</span> <span class="UIDENT">Errors</span> <span class="OF">of</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="LIDENT">exn</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span id="module-Make.exception-Cyclic"><span class="EXCEPTION">exception</span> <span class="UIDENT">Cyclic</span> <span class="OF">of</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="LIDENT">list</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="OPEN">open</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="UIDENT">Op</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Returns a map (node -&gt; return value) *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-aux_map"><span class="LIDENT">aux_map</span></span> <span class="TILDE">~</span><span id="local_jobs_2"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_3"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_dry_run_4"><span class="LIDENT">dry_run</span></span><span class="EQUAL">=</span><span class="FALSE">false</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_pools_5"><span class="LIDENT">pools</span></span><span class="EQUAL">=</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span id="local_g_6"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">log</span> <span class="STRING">&quot;Iterate over %a task(s) with %d process(es)&quot;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="LIDENT">slog</span> <a href="opamStd.ml.html#module-Op.val-(@@)"><span class="INFIXOP1">@@</span></a> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_vertex</span> <a href="opamStd.ml.html#module-Op.val-(@&gt;)"><span class="INFIXOP1">@&gt;</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a><span class="RPAREN">)</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <a href="#local_jobs_2"><span class="LIDENT">jobs</span></a><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_njobs_7"><span class="LIDENT">njobs</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">nb_vertex</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_all_jobs_8"><span class="LIDENT">all_jobs</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_vertex</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_pools_9"><span class="LIDENT">pools</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_defined_10"><span class="LIDENT">defined</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_elts_11"><span class="LIDENT">elts</span></span><span class="COMMA">,</span> <span id="local_jobs_12"><span class="LIDENT">jobs</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">of_list</span> <a href="#local_elts_11"><span class="LIDENT">elts</span></a><span class="COMMA">,</span> <a href="#local_jobs_12"><span class="LIDENT">jobs</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_pools_5"><span class="LIDENT">pools</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_default_13"><span class="LIDENT">default</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_acc_14"><span class="LIDENT">acc</span></span> <span class="LPAREN">(</span><span id="local_pool_15"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_14"><span class="LIDENT">acc</span></a> <span class="INFIXOP2">--</span> <a href="#local_pool_15"><span class="LIDENT">pool</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_all_jobs_8"><span class="LIDENT">all_jobs</span></a> <a href="#local_defined_10"><span class="LIDENT">defined</span></a><span class="COMMA">,</span> <a href="#local_jobs_2"><span class="LIDENT">jobs</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_default_13"><span class="LIDENT">default</span></a> <span class="COLONCOLON">::</span> <a href="#local_defined_10"><span class="LIDENT">defined</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">has_cycle</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_sccs_16"><span class="LIDENT">sccs</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">scc_list</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_sccs_17"><span class="LIDENT">sccs</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LPAREN">(</span><span class="FUNCTION">function</span> <span class="UNDERSCORE">_</span><span class="COLONCOLON">::</span><span class="UNDERSCORE">_</span><span class="COLONCOLON">::</span><span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span> <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <a href="#local_sccs_16"><span class="LIDENT">sccs</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Cyclic</span> <a href="#local_sccs_17"><span class="LIDENT">sccs</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_print_status_18"><span class="LIDENT">print_status</span></span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_finished_19"><span class="LIDENT">finished</span></span><span class="COLON">:</span> <span class="LIDENT">int</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_running_20"><span class="LIDENT">running</span></span><span class="COLON">:</span> <span class="LPAREN">(</span><a href="opamProcess.ml.html#type-t"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="STAR">*</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="STAR">*</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_texts_21"><span class="LIDENT">texts</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="opamStd.ml.html#module-OpamList.val-filter_map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter_map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span><span id="local_t_22"><span class="LIDENT">t</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">values</span> <a href="#local_running_20"><span class="LIDENT">running</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_limit_width_23"><span class="LIDENT">limit_width</span></span> <span id="local_acc_24"><span class="LIDENT">acc</span></span> <span id="local_rem_cols_25"><span class="LIDENT">rem_cols</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_acc_24"><span class="LIDENT">acc</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span id="local_t_26"><span class="LIDENT">t</span></span><span class="COLONCOLON">::</span><span id="local_ts_27"><span class="LIDENT">ts</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_len_28"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html#module-OpamFormat.val-visual_length"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">visual_length</span></a> <a href="#local_t_26"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="#local_ts_27"><span class="LIDENT">ts</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_len_28"><span class="LIDENT">len</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_rem_cols_25"><span class="LIDENT">rem_cols</span></a> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <span class="LPAREN">(</span><a href="#local_t_26"><span class="LIDENT">t</span></a><span class="COLONCOLON">::</span><a href="#local_acc_24"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_len_28"><span class="LIDENT">len</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <a href="#local_rem_cols_25"><span class="LIDENT">rem_cols</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">5</span> <span class="THEN">then</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;%s+%2d&quot;</span><span class="EOL">
</span>                 <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-make"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">make</span></a> <span class="LPAREN">(</span><a href="#local_rem_cols_25"><span class="LIDENT">rem_cols</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">4</span><span class="RPAREN">)</span> <span class="CHAR">' '</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-length"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_ts_27"><span class="LIDENT">ts</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>               <span class="COLONCOLON">::</span> <a href="#local_acc_24"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="ELSE">else</span><span class="EOL">
</span>            <a href="#local_limit_width_23"><span class="LIDENT">limit_width</span></a> <span class="LPAREN">(</span><a href="#local_t_26"><span class="LIDENT">t</span></a><span class="COLONCOLON">::</span><a href="#local_acc_24"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_rem_cols_25"><span class="LIDENT">rem_cols</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_28"><span class="LIDENT">len</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_ts_27"><span class="LIDENT">ts</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_title_29"><span class="LIDENT">title</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Processing %2d/%d:&quot;</span><span class="EOL">
</span>          <span class="LPAREN">(</span><a href="#local_finished_19"><span class="LIDENT">finished</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">cardinal</span> <a href="#local_running_20"><span class="LIDENT">running</span></a><span class="RPAREN">)</span> <a href="#local_njobs_7"><span class="LIDENT">njobs</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_texts_30"><span class="LIDENT">texts</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="opamConsole.ml.html#val-disp_status_line"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">disp_status_line</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>          <a href="#local_limit_width_23"><span class="LIDENT">limit_width</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamSys.val-terminal_columns"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">Sys</span><span class="DOT">.</span><span class="LIDENT">terminal_columns</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_title_29"><span class="LIDENT">title</span></a><span class="COLONCOLON">::</span><a href="#local_texts_21"><span class="LIDENT">texts</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="IF">if</span> <a href="opamConsole.ml.html#val-verbose"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">verbose</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="THEN">then</span> <a href="#local_title_29"><span class="LIDENT">title</span></a><span class="COLONCOLON">::</span><a href="#local_texts_21"><span class="LIDENT">texts</span></a><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_texts_30"><span class="LIDENT">texts</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span> <a href="opamConsole.ml.html#val-status_line"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">status_line</span></a> <span class="STRING">&quot;%s&quot;</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-concat"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">concat</span></a> <span class="STRING">&quot; &quot;</span> <a href="#local_texts_30"><span class="LIDENT">texts</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* nslots is the number of free slots *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_31"><span class="LIDENT">loop</span></span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_nslots_32"><span class="LIDENT">nslots</span></span><span class="COLON">:</span> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="LIDENT">int</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="RPAREN">)</span> <span class="COMMENT">(* number of free slots *)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_results_33"><span class="LIDENT">results</span></span><span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">b</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_running_34"><span class="LIDENT">running</span></span><span class="COLON">:</span> <span class="LPAREN">(</span><a href="opamProcess.ml.html#type-t"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="STAR">*</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="STAR">*</span> <span class="LIDENT">string</span> <span class="LIDENT">option</span><span class="RPAREN">)</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span id="local_ready_35"><span class="LIDENT">ready</span></span><span class="COLON">:</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_get_slots_36"><span class="LIDENT">get_slots</span></span> <span id="local_nslots_37"><span class="LIDENT">nslots</span></span> <span id="local_n_38"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_pool_39"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_38"><span class="LIDENT">n</span></a> <a href="#local_pool_39"><span class="LIDENT">pool</span></a><span class="RPAREN">)</span> <a href="#local_nslots_37"><span class="LIDENT">nslots</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_take_slot_40"><span class="LIDENT">take_slot</span></span> <span id="local_nslots_41"><span class="LIDENT">nslots</span></span> <span id="local_n_42"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_pool_43"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span id="local_slots_44"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="IF">if</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_42"><span class="LIDENT">n</span></a> <a href="#local_pool_43"><span class="LIDENT">pool</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><span class="ASSERT">assert</span> <span class="LPAREN">(</span><a href="#local_slots_44"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="#local_pool_43"><span class="LIDENT">pool</span></a><span class="COMMA">,</span> <a href="#local_slots_44"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="ELSE">else</span> <a href="#local_pool_43"><span class="LIDENT">pool</span></a><span class="COMMA">,</span> <a href="#local_slots_44"><span class="LIDENT">slots</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_nslots_41"><span class="LIDENT">nslots</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_release_slot_45"><span class="LIDENT">release_slot</span></span> <span id="local_nslots_46"><span class="LIDENT">nslots</span></span> <span id="local_n_47"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_pool_48"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span id="local_slots_49"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="IF">if</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_47"><span class="LIDENT">n</span></a> <a href="#local_pool_48"><span class="LIDENT">pool</span></a> <span class="THEN">then</span> <span class="LPAREN">(</span><a href="#local_pool_48"><span class="LIDENT">pool</span></a><span class="COMMA">,</span> <a href="#local_slots_49"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="ELSE">else</span> <a href="#local_pool_48"><span class="LIDENT">pool</span></a><span class="COMMA">,</span> <a href="#local_slots_49"><span class="LIDENT">slots</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_nslots_46"><span class="LIDENT">nslots</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_run_seq_command_50"><span class="LIDENT">run_seq_command</span></span> <span id="local_nslots_51"><span class="LIDENT">nslots</span></span> <span id="local_ready_52"><span class="LIDENT">ready</span></span> <span id="local_n_53"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Done</span> <span id="local_r_54"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LIDENT">log</span> <span class="STRING">&quot;Job %a finished&quot;</span> <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="opamStd.ml.html#module-Op.val-(@*)"><span class="INFIXOP1">@*</span></a> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">hash</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_n_53"><span class="LIDENT">n</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_results_55"><span class="LIDENT">results</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_n_53"><span class="LIDENT">n</span></a> <a href="#local_r_54"><span class="LIDENT">r</span></a> <a href="#local_results_33"><span class="LIDENT">results</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_running_56"><span class="LIDENT">running</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_n_53"><span class="LIDENT">n</span></a> <a href="#local_running_34"><span class="LIDENT">running</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_running_56"><span class="LIDENT">running</span></a><span class="RPAREN">)</span> <span class="THEN">then</span><span class="EOL">
</span>            <a href="#local_print_status_18"><span class="LIDENT">print_status</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">cardinal</span> <a href="#local_results_55"><span class="LIDENT">results</span></a><span class="RPAREN">)</span> <a href="#local_running_56"><span class="LIDENT">running</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_nslots_57"><span class="LIDENT">nslots</span></span> <span class="EQUAL">=</span> <a href="#local_release_slot_45"><span class="LIDENT">release_slot</span></a> <a href="#local_nslots_51"><span class="LIDENT">nslots</span></a> <a href="#local_n_53"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_new_ready_58"><span class="LIDENT">new_ready</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">filter</span><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_59"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_59"><span class="LIDENT">n</span></a> <a href="#local_running_56"><span class="LIDENT">running</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a><span class="EOL">
</span>                 <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_59"><span class="LIDENT">n</span></a> <a href="#local_results_55"><span class="LIDENT">results</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a><span class="EOL">
</span>                 <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-for_all"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_60"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_60"><span class="LIDENT">n</span></a> <a href="#local_results_55"><span class="LIDENT">results</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <a href="#local_n_59"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a><span class="EOL">
</span>                 <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-for_all"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">for_all</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_slots_61"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_slots_61"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span><span class="RPAREN">)</span><span class="EOL">
</span>                   <span class="LPAREN">(</span><a href="#local_get_slots_36"><span class="LIDENT">get_slots</span></a> <a href="#local_nslots_57"><span class="LIDENT">nslots</span></a> <a href="#local_n_59"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_acc_62"><span class="LIDENT">acc</span></span> <span class="LPAREN">(</span><span id="local_pool_63"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span id="local_slots_64"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                   <span class="IF">if</span> <a href="#local_slots_64"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">1</span> <span class="THEN">then</span> <a href="#local_acc_62"><span class="LIDENT">acc</span></a> <span class="INFIXOP2">++</span> <a href="#local_pool_63"><span class="LIDENT">pool</span></a> <span class="ELSE">else</span> <a href="#local_acc_62"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>                  <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">of_list</span> <span class="LPAREN">(</span><span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">succ</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <a href="#local_n_53"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>                  <span class="LPAREN">(</span><a href="#local_get_slots_36"><span class="LIDENT">get_slots</span></a> <a href="#local_nslots_57"><span class="LIDENT">nslots</span></a> <a href="#local_n_53"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_loop_31"><span class="LIDENT">loop</span></a> <a href="#local_nslots_57"><span class="LIDENT">nslots</span></a> <a href="#local_results_55"><span class="LIDENT">results</span></a> <a href="#local_running_56"><span class="LIDENT">running</span></a> <span class="LPAREN">(</span><a href="#local_ready_52"><span class="LIDENT">ready</span></a> <span class="INFIXOP2">++</span> <a href="#local_new_ready_58"><span class="LIDENT">new_ready</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="LPAREN">(</span><span id="local_cmd_65"><span class="LIDENT">cmd</span></span><span class="COMMA">,</span> <span id="local_cont_66"><span class="LIDENT">cont</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="LIDENT">log</span> <span class="STRING">&quot;Next task in job %a: %a&quot;</span> <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="opamStd.ml.html#module-Op.val-(@*)"><span class="INFIXOP1">@*</span></a> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">hash</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_n_53"><span class="LIDENT">n</span></a><span class="EOL">
</span>            <span class="LPAREN">(</span><span class="LIDENT">slog</span> <a href="opamProcess.ml.html#val-string_of_command"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">string_of_command</span></a><span class="RPAREN">)</span> <a href="#local_cmd_65"><span class="LIDENT">cmd</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_p_67"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="IF">if</span> <a href="#local_dry_run_4"><span class="LIDENT">dry_run</span></a> <span class="THEN">then</span> <a href="opamProcess.ml.html#val-dry_run_background"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">dry_run_background</span></a> <a href="#local_cmd_65"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>            <span class="ELSE">else</span> <a href="opamProcess.ml.html#val-run_background"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">run_background</span></a> <a href="#local_cmd_65"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_running_68"><span class="LIDENT">running</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_n_53"><span class="LIDENT">n</span></a> <span class="LPAREN">(</span><a href="#local_p_67"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="#local_cont_66"><span class="LIDENT">cont</span></a><span class="COMMA">,</span> <a href="opamProcess.ml.html#val-text_of_command"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">text_of_command</span></a> <a href="#local_cmd_65"><span class="LIDENT">cmd</span></a><span class="RPAREN">)</span> <a href="#local_running_34"><span class="LIDENT">running</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_print_status_18"><span class="LIDENT">print_status</span></a> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">cardinal</span> <a href="#local_results_33"><span class="LIDENT">results</span></a><span class="RPAREN">)</span> <a href="#local_running_68"><span class="LIDENT">running</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_loop_31"><span class="LIDENT">loop</span></a> <a href="#local_nslots_51"><span class="LIDENT">nslots</span></a> <a href="#local_results_33"><span class="LIDENT">results</span></a> <a href="#local_running_68"><span class="LIDENT">running</span></a> <a href="#local_ready_52"><span class="LIDENT">ready</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_fail_69"><span class="LIDENT">fail</span></span> <span id="local_node_70"><span class="LIDENT">node</span></span> <span id="local_error_71"><span class="LIDENT">error</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LIDENT">log</span> <span class="STRING">&quot;Exception while computing job %a: %a&quot;</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="opamStd.ml.html#module-Op.val-(@*)"><span class="INFIXOP1">@*</span></a> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">hash</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_node_70"><span class="LIDENT">node</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">to_string</span><span class="RPAREN">)</span> <a href="#local_node_70"><span class="LIDENT">node</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_error_71"><span class="LIDENT">error</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="UIDENT">Sys</span><span class="DOT">.</span><span class="UIDENT">Break</span> <span class="THEN">then</span> <a href="opamConsole.ml.html#val-error"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">error</span></a> <span class="STRING">&quot;User interruption&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_running_72"><span class="LIDENT">running</span></span> <span class="EQUAL">=</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_node_70"><span class="LIDENT">node</span></a> <a href="#local_running_34"><span class="LIDENT">running</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="COMMENT">(* Cleanup *)</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="def_254"><span id="local_errors_73"><span class="LIDENT">errors</span></span><span class="COMMA">,</span><span id="local_pend_74"><span class="LIDENT">pend</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="#local_dry_run_4"><span class="LIDENT">dry_run</span></a> <span class="THEN">then</span> <span class="LBRACKET">[</span><a href="#local_node_70"><span class="LIDENT">node</span></a><span class="COMMA">,</span><a href="#local_error_71"><span class="LIDENT">error</span></a><span class="RBRACKET">]</span><span class="COMMA">,</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="ELSE">else</span><span class="EOL">
</span>          <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_75"><span class="LIDENT">n</span></span> <span class="LPAREN">(</span><span id="local_p_76"><span class="LIDENT">p</span></span><span class="COMMA">,</span><span id="local_cont_77"><span class="LIDENT">cont</span></span><span class="COMMA">,</span><span id="local__text_78"><span class="LIDENT">_text</span></span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span id="local_errors_79"><span class="LIDENT">errors</span></span><span class="COMMA">,</span><span id="local_pend_80"><span class="LIDENT">pend</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="TRY">try</span><span class="EOL">
</span>                <span class="MATCH">match</span> <a href="opamProcess.ml.html#val-dontwait"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">dontwait</span></a> <a href="#local_p_76"><span class="LIDENT">p</span></a> <span class="WITH">with</span><span class="EOL">
</span>                <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="COMMENT">(* process still running *)</span><span class="EOL">
</span>                  <a href="opamProcess.ml.html#val-interrupt"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">interrupt</span></a> <a href="#local_p_76"><span class="LIDENT">p</span></a><span class="SEMI">;</span><span class="EOL">
</span>                  <span class="LPAREN">(</span><a href="#local_n_75"><span class="LIDENT">n</span></a><span class="COMMA">,</span><span class="UIDENT">Aborted</span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_errors_79"><span class="LIDENT">errors</span></a><span class="COMMA">,</span><span class="EOL">
</span>                  <a href="#local_p_76"><span class="LIDENT">p</span></a><span class="COLONCOLON">::</span><a href="#local_pend_80"><span class="LIDENT">pend</span></a><span class="EOL">
</span>                <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_result_81"><span class="LIDENT">result</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                  <span class="MATCH">match</span> <a href="#local_cont_77"><span class="LIDENT">cont</span></a> <a href="#local_result_81"><span class="LIDENT">result</span></a> <span class="WITH">with</span><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UIDENT">Done</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_errors_79"><span class="LIDENT">errors</span></a><span class="COMMA">,</span> <a href="#local_pend_80"><span class="LIDENT">pend</span></a><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UIDENT">Run</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                    <span class="LPAREN">(</span><a href="#local_n_75"><span class="LIDENT">n</span></a><span class="COMMA">,</span><span class="UIDENT">Aborted</span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_errors_79"><span class="LIDENT">errors</span></a><span class="COMMA">,</span><span class="EOL">
</span>                    <a href="#local_pend_80"><span class="LIDENT">pend</span></a><span class="EOL">
</span>              <span class="WITH">with</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_errors_79"><span class="LIDENT">errors</span></a><span class="COMMA">,</span> <a href="#local_pend_80"><span class="LIDENT">pend</span></a><span class="EOL">
</span>              <span class="BAR">|</span> <span id="local_e_82"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_n_75"><span class="LIDENT">n</span></a><span class="COMMA">,</span><a href="#local_e_82"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="COLONCOLON">::</span><a href="#local_errors_79"><span class="LIDENT">errors</span></a><span class="COMMA">,</span> <a href="#local_pend_80"><span class="LIDENT">pend</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <a href="#local_running_72"><span class="LIDENT">running</span></a> <span class="LPAREN">(</span><span class="LBRACKET">[</span><a href="#local_node_70"><span class="LIDENT">node</span></a><span class="COMMA">,</span><a href="#local_error_71"><span class="LIDENT">error</span></a><span class="RBRACKET">]</span><span class="COMMA">,</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><a href="opamProcess.ml.html#val-wait_one"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">wait_one</span></a> <a href="#local_pend_74"><span class="LIDENT">pend</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_pend_74"><span class="LIDENT">pend</span></a><span class="EOL">
</span>         <span class="WITH">with</span> <span id="local_e_83"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">log</span> <span class="STRING">&quot;%a in sub-process cleanup&quot;</span> <span class="LPAREN">(</span><span class="LIDENT">slog</span> <a href="../../../ocaml-base-compiler/src/stdlib/printexc.ml.html#val-to_string"><span class="UIDENT">Printexc</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a><span class="RPAREN">)</span> <a href="#local_e_83"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="COMMENT">(* Generate the remaining nodes in topological order *)</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_remaining_84"><span class="LIDENT">remaining</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">Topological</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_85"><span class="LIDENT">n</span></span> <span id="local_remaining_86"><span class="LIDENT">remaining</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="IF">if</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">mem</span> <a href="#local_n_85"><span class="LIDENT">n</span></a> <a href="#local_results_33"><span class="LIDENT">results</span></a><span class="EOL">
</span>              <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="opamStd.ml.html#module-OpamList.val-mem_assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">mem_assoc</span></a> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_n_85"><span class="LIDENT">n</span></a> <a href="#local_errors_73"><span class="LIDENT">errors</span></a> <span class="THEN">then</span><span class="EOL">
</span>                <a href="#local_remaining_86"><span class="LIDENT">remaining</span></a><span class="EOL">
</span>              <span class="ELSE">else</span> <a href="#local_n_85"><span class="LIDENT">n</span></a><span class="COLONCOLON">::</span><a href="#local_remaining_86"><span class="LIDENT">remaining</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Errors</span> <span class="LPAREN">(</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">keys</span> <a href="#local_results_33"><span class="LIDENT">results</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_errors_73"><span class="LIDENT">errors</span></a><span class="COMMA">,</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="#local_remaining_84"><span class="LIDENT">remaining</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="IF">if</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_running_34"><span class="LIDENT">running</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_ready_35"><span class="LIDENT">ready</span></a> <span class="THEN">then</span><span class="EOL">
</span>        <a href="#local_results_33"><span class="LIDENT">results</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="IF">if</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_ready_35"><span class="LIDENT">ready</span></a><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-exists"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">exists</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_slots_87"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_slots_87"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span><span class="RPAREN">)</span> <a href="#local_nslots_32"><span class="LIDENT">nslots</span></a><span class="EOL">
</span>      <span class="THEN">then</span><span class="EOL">
</span>        <span class="COMMENT">(* Start a new process *)</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_n_88"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">choose</span> <a href="#local_ready_35"><span class="LIDENT">ready</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">log</span> <span class="STRING">&quot;Starting job %a (worker %a): %a&quot;</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="opamStd.ml.html#module-Op.val-(@*)"><span class="INFIXOP1">@*</span></a> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">hash</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_n_88"><span class="LIDENT">n</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">slog</span><span class="EOL">
</span>             <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_pools_89"><span class="LIDENT">pools</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_slots_90"><span class="LIDENT">slots</span></span> <span class="EQUAL">=</span> <a href="#local_get_slots_36"><span class="LIDENT">get_slots</span></a> <a href="#local_nslots_32"><span class="LIDENT">nslots</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>                <a href="opamStd.ml.html#module-OpamList.val-concat_map"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">concat_map</span></a> <span class="STRING">&quot; &quot;</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_pool_91"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span id="local_jobs_92"><span class="LIDENT">jobs</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                    <span class="LET">let</span> <span id="local_nslots_93"><span class="LIDENT">nslots</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>                      <a href="opamStd.ml.html#module-OpamList.val-assoc_opt"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc_opt</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_pool_91"><span class="LIDENT">pool</span></a> <a href="#local_slots_90"><span class="LIDENT">slots</span></a><span class="EOL">
</span>                    <span class="IN">in</span><span class="EOL">
</span>                  <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;%s/%d&quot;</span><span class="EOL">
</span>                    <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_nslots_93"><span class="LIDENT">nslots</span></a> <span class="WITH">with</span><span class="EOL">
</span>                     <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;-&quot;</span><span class="EOL">
</span>                     <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_n_94"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <span class="LPAREN">(</span><a href="#local_jobs_92"><span class="LIDENT">jobs</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_n_94"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>                    <a href="#local_jobs_92"><span class="LIDENT">jobs</span></a><span class="RPAREN">)</span><span class="EOL">
</span>                  <a href="#local_pools_89"><span class="LIDENT">pools</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>          <a href="#local_pools_9"><span class="LIDENT">pools</span></a><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">to_string</span><span class="RPAREN">)</span> <a href="#local_n_88"><span class="LIDENT">n</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_pred_95"><span class="LIDENT">pred</span></span> <span class="EQUAL">=</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">pred</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_pred_96"><span class="LIDENT">pred</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_97"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_n_97"><span class="LIDENT">n</span></a><span class="COMMA">,</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_n_97"><span class="LIDENT">n</span></a> <a href="#local_results_33"><span class="LIDENT">results</span></a><span class="RPAREN">)</span> <a href="#local_pred_95"><span class="LIDENT">pred</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_cmd_98"><span class="LIDENT">cmd</span></span> <span class="EQUAL">=</span> <span class="TRY">try</span> <a href="#local_command_3"><span class="LIDENT">command</span></a> <span class="TILDE">~</span><a href="#local_pred_96"><span class="LIDENT">pred</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <span class="WITH">with</span> <span id="local_e_99"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_69"><span class="LIDENT">fail</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <a href="#local_e_99"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_nslots_100"><span class="LIDENT">nslots</span></span> <span class="EQUAL">=</span> <a href="#local_take_slot_40"><span class="LIDENT">take_slot</span></a> <a href="#local_nslots_32"><span class="LIDENT">nslots</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_ready_101"><span class="LIDENT">ready</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a><span class="EOL">
</span>            <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_acc_102"><span class="LIDENT">acc</span></span> <span class="LPAREN">(</span><span id="local_pool_103"><span class="LIDENT">pool</span></span><span class="COMMA">,</span> <span id="local_slots_104"><span class="LIDENT">slots</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>               <span class="IF">if</span> <a href="#local_slots_104"><span class="LIDENT">slots</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <span class="THEN">then</span> <a href="#local_acc_102"><span class="LIDENT">acc</span></a> <span class="INFIXOP2">--</span> <a href="#local_pool_103"><span class="LIDENT">pool</span></a> <span class="ELSE">else</span> <a href="#local_acc_102"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="LPAREN">(</span><span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_n_88"><span class="LIDENT">n</span></a> <a href="#local_ready_35"><span class="LIDENT">ready</span></a><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="LPAREN">(</span><a href="#local_get_slots_36"><span class="LIDENT">get_slots</span></a> <a href="#local_nslots_100"><span class="LIDENT">nslots</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <a href="#local_run_seq_command_50"><span class="LIDENT">run_seq_command</span></a> <a href="#local_nslots_100"><span class="LIDENT">nslots</span></a> <a href="#local_ready_101"><span class="LIDENT">ready</span></a> <a href="#local_n_88"><span class="LIDENT">n</span></a> <a href="#local_cmd_98"><span class="LIDENT">cmd</span></a><span class="EOL">
</span>      <span class="ELSE">else</span><span class="EOL">
</span>      <span class="COMMENT">(* Wait for a process to end *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_processes_105"><span class="LIDENT">processes</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_106"><span class="LIDENT">n</span></span> <span class="LPAREN">(</span><span id="local_p_107"><span class="LIDENT">p</span></span><span class="COMMA">,</span><span id="local_x_108"><span class="LIDENT">x</span></span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span id="local_acc_109"><span class="LIDENT">acc</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_p_107"><span class="LIDENT">p</span></a><span class="COMMA">,</span><span class="LPAREN">(</span><a href="#local_n_106"><span class="LIDENT">n</span></a><span class="COMMA">,</span><a href="#local_x_108"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_acc_109"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_running_34"><span class="LIDENT">running</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_249"><span id="local_process_110"><span class="LIDENT">process</span></span><span class="COMMA">,</span> <span id="local_result_111"><span class="LIDENT">result</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_dry_run_4"><span class="LIDENT">dry_run</span></a> <span class="THEN">then</span><span class="EOL">
</span>          <a href="opamProcess.ml.html#val-dry_wait_one"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">dry_wait_one</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-fst"><span class="LIDENT">fst</span></a> <a href="#local_processes_105"><span class="LIDENT">processes</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="TRY">try</span> <span class="MATCH">match</span> <a href="#local_processes_105"><span class="LIDENT">processes</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="LBRACKET">[</span><span id="local_p_112"><span class="LIDENT">p</span></span><span class="COMMA">,</span><span class="UNDERSCORE">_</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_p_112"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="opamProcess.ml.html#val-wait"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">wait</span></a> <a href="#local_p_112"><span class="LIDENT">p</span></a><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="opamProcess.ml.html#val-wait_one"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">wait_one</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-fst"><span class="LIDENT">fst</span></a> <a href="#local_processes_105"><span class="LIDENT">processes</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="WITH">with</span> <span id="local_e_113"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_69"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-fst"><span class="LIDENT">fst</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-snd"><span class="LIDENT">snd</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-hd"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">hd</span></a> <a href="#local_processes_105"><span class="LIDENT">processes</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_e_113"><span class="LIDENT">e</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_246"><span id="local_n_114"><span class="LIDENT">n</span></span><span class="COMMA">,</span><span id="local_cont_115"><span class="LIDENT">cont</span></span></span> <span class="EQUAL">=</span> <a href="opamStd.ml.html"><span class="UIDENT">OpamStd</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="opamStd.ml.html#module-OpamCompare.val-equal"><span class="UIDENT">Compare</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_process_110"><span class="LIDENT">process</span></a> <a href="#local_processes_105"><span class="LIDENT">processes</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">log</span> <span class="STRING">&quot;Collected task for job %a (ret:%d)&quot;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="LIDENT">slog</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="opamStd.ml.html#module-Op.val-(@*)"><span class="INFIXOP1">@*</span></a> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">hash</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_n_114"><span class="LIDENT">n</span></a> <a href="#local_result_111"><span class="LIDENT">result</span></a><span class="DOT">.</span><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">r_code</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_next_116"><span class="LIDENT">next</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="TRY">try</span> <a href="#local_cont_115"><span class="LIDENT">cont</span></a> <a href="#local_result_111"><span class="LIDENT">result</span></a> <span class="WITH">with</span> <span id="local_e_117"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="opamProcess.ml.html#val-cleanup"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">cleanup</span></a> <a href="#local_result_111"><span class="LIDENT">result</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_fail_69"><span class="LIDENT">fail</span></a> <a href="#local_n_114"><span class="LIDENT">n</span></a> <a href="#local_e_117"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="opamProcess.ml.html#val-cleanup"><span class="UIDENT">OpamProcess</span><span class="DOT">.</span><span class="LIDENT">cleanup</span></a> <a href="#local_result_111"><span class="LIDENT">result</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <a href="#local_run_seq_command_50"><span class="LIDENT">run_seq_command</span></a> <a href="#local_nslots_32"><span class="LIDENT">nslots</span></a> <a href="#local_ready_35"><span class="LIDENT">ready</span></a> <a href="#local_n_114"><span class="LIDENT">n</span></a> <a href="#local_next_116"><span class="LIDENT">next</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_roots_118"><span class="LIDENT">roots</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">fold_vertex</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_n_119"><span class="LIDENT">n</span></span> <span id="local_roots_120"><span class="LIDENT">roots</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">in_degree</span> <a href="#local_g_6"><span class="LIDENT">g</span></a> <a href="#local_n_119"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_n_119"><span class="LIDENT">n</span></a> <a href="#local_roots_120"><span class="LIDENT">roots</span></a> <span class="ELSE">else</span> <a href="#local_roots_120"><span class="LIDENT">roots</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="#local_g_6"><span class="LIDENT">g</span></a> <span class="UIDENT">S</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_r_121"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <a href="#local_loop_31"><span class="LIDENT">loop</span></a> <a href="#local_pools_9"><span class="LIDENT">pools</span></a> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">empty</span> <a href="#local_roots_118"><span class="LIDENT">roots</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="opamConsole.ml.html#val-clear_status"><span class="UIDENT">OpamConsole</span><span class="DOT">.</span><span class="LIDENT">clear_status</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_r_121"><span class="LIDENT">r</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-iter"><span class="LIDENT">iter</span></span> <span class="TILDE">~</span><span id="local_jobs_122"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_123"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span id="local_dry_run_124"><span class="LIDENT">dry_run</span></span> <span class="QUESTION">?</span><span id="local_pools_125"><span class="LIDENT">pools</span></span> <span id="local_g_126"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><span class="LIDENT">aux_map</span> <span class="TILDE">~</span><a href="#local_jobs_122"><span class="LIDENT">jobs</span></a> <span class="TILDE">~</span><a href="#local_command_123"><span class="LIDENT">command</span></a> <span class="QUESTION">?</span><a href="#local_dry_run_124"><span class="LIDENT">dry_run</span></a> <span class="QUESTION">?</span><a href="#local_pools_125"><span class="LIDENT">pools</span></a> <a href="#local_g_126"><span class="LIDENT">g</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-map"><span class="LIDENT">map</span></span> <span class="TILDE">~</span><span id="local_jobs_127"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_128"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span id="local_dry_run_129"><span class="LIDENT">dry_run</span></span> <span class="QUESTION">?</span><span id="local_pools_130"><span class="LIDENT">pools</span></span> <span id="local_g_131"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">bindings</span> <span class="LPAREN">(</span><span class="LIDENT">aux_map</span> <span class="TILDE">~</span><a href="#local_jobs_127"><span class="LIDENT">jobs</span></a> <span class="TILDE">~</span><a href="#local_command_128"><span class="LIDENT">command</span></a> <span class="QUESTION">?</span><a href="#local_dry_run_129"><span class="LIDENT">dry_run</span></a> <span class="QUESTION">?</span><a href="#local_pools_130"><span class="LIDENT">pools</span></a> <a href="#local_g_131"><span class="LIDENT">g</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Only print the originally raised exception, which should come first. Ignore
     Aborted exceptions due to other commands termination, and simultaneous
     exceptions in other command's continuations (unlikely as that would require
     both commands to have terminated simultaneously) *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Make.val-error_printer"><span class="LIDENT">error_printer</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Errors</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span><span id="local_exc_132"><span class="LIDENT">exc</span></span><span class="RPAREN">)</span><span class="COLONCOLON">::</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printexc.ml.html#val-to_string"><span class="UIDENT">Printexc</span><span class="DOT">.</span><span class="LIDENT">to_string</span></a> <a href="#local_exc_132"><span class="LIDENT">exc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/printexc.ml.html#val-register_printer"><span class="UIDENT">Printexc</span><span class="DOT">.</span><span class="LIDENT">register_printer</span></a> <span class="LIDENT">error_printer</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-GRAPH"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">GRAPH</span> <span class="EQUAL">=</span> <span class="SIG">sig</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Sig</span><span class="DOT">.</span><span class="UIDENT">I</span> <span class="WITH">with</span> <span id="def_250"><span class="TYPE">type</span> <span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">label</span> <span class="EQUAL">=</span> <span class="LIDENT">dependency_label</span></span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <a href="../../../ocamlgraph/src/ocamlgraph/oper.ml.html#module-type-S"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Oper</span><span class="DOT">.</span><span class="UIDENT">S</span></a> <span class="WITH">with</span> <span id="def_252"><span class="TYPE">type</span> <span class="LIDENT">g</span> <span class="EQUAL">=</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.module-Topological"><span class="MODULE">module</span> <span class="UIDENT">Topological</span> <span class="COLON">:</span> <span class="SIG">sig</span><span class="EOL">
</span>    <span id="module-type-GRAPH.module-Topological.val-fold"><span class="VAL">val</span> <span class="LIDENT">fold</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span></span><span class="EOL">
</span>    <span id="module-type-GRAPH.module-Topological.val-iter"><span class="VAL">val</span> <span class="LIDENT">iter</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.module-Parallel"><span class="MODULE">module</span> <span class="UIDENT">Parallel</span> <span class="COLON">:</span> <span class="UIDENT">SIG</span> <span class="WITH">with</span> <span id="def_256"><span class="TYPE">type</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>                         <span class="AND">and</span> <span id="def_255"><span class="TYPE">type</span> <span class="UIDENT">G</span><span class="DOT">.</span><span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">vertex</span></span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.module-Dot"><span class="MODULE">module</span> <span class="UIDENT">Dot</span> <span class="COLON">:</span> <span class="SIG">sig</span> <span id="module-type-GRAPH.module-Dot.val-output_graph"><span class="VAL">val</span> <span class="LIDENT">output_graph</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#type-out_channel"><span class="LIDENT">out_channel</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span> <span class="END">end</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.val-transitive_closure"><span class="VAL">val</span> <span class="LIDENT">transitive_closure</span><span class="COLON">:</span>  <span class="OPTLABEL">?reflexive:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.val-build"><span class="VAL">val</span> <span class="LIDENT">build</span><span class="COLON">:</span> <span class="UIDENT">V</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.val-compare"><span class="VAL">val</span> <span class="LIDENT">compare</span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span></span><span class="EOL">
</span>  <span id="module-type-GRAPH.val-to_json"><span class="VAL">val</span> <span class="LIDENT">to_json</span> <span class="COLON">:</span> <a href="opamJson.ml.html#type-encoder"><span class="LIDENT">t</span> <span class="UIDENT">OpamJson</span><span class="DOT">.</span><span class="LIDENT">encoder</span></a></span><span class="EOL">
</span>  <span id="module-type-GRAPH.val-of_json"><span class="VAL">val</span> <span class="LIDENT">of_json</span> <span class="COLON">:</span> <a href="opamJson.ml.html#type-decoder"><span class="LIDENT">t</span> <span class="UIDENT">OpamJson</span><span class="DOT">.</span><span class="LIDENT">decoder</span></a></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-MakeGraph"><span class="MODULE">module</span> <span class="UIDENT">MakeGraph</span> <span class="LPAREN">(</span><span class="UIDENT">X</span><span class="COLON">:</span> <span class="UIDENT">VERTEX</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Vertex"><span class="MODULE">module</span> <span class="UIDENT">Vertex</span> <span class="EQUAL">=</span> <span class="UIDENT">X</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-PG"><span class="MODULE">module</span> <span class="UIDENT">PG</span> <span class="EQUAL">=</span> <a href="../../../ocamlgraph/src/ocamlgraph/imperative.ml.html#module-Digraph.module-ConcreteBidirectional"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Imperative</span><span class="DOT">.</span><span class="UIDENT">Digraph</span><span class="DOT">.</span><span class="UIDENT">ConcreteBidirectional</span></a> <span class="LPAREN">(</span><span class="UIDENT">Vertex</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Topological"><span class="MODULE">module</span> <span class="UIDENT">Topological</span> <span class="EQUAL">=</span> <a href="../../../ocamlgraph/src/ocamlgraph/topological.ml.html#module-Make"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Topological</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">PG</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Traverse"><span class="MODULE">module</span> <span class="UIDENT">Traverse</span> <span class="EQUAL">=</span> <a href="../../../ocamlgraph/src/ocamlgraph/traverse.ml.html#module-Dfs"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Traverse</span><span class="DOT">.</span><span class="UIDENT">Dfs</span></a><span class="LPAREN">(</span><span class="UIDENT">PG</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Components"><span class="MODULE">module</span> <span class="UIDENT">Components</span> <span class="EQUAL">=</span> <a href="../../../ocamlgraph/src/ocamlgraph/components.ml.html#module-Make"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Components</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">PG</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Parallel"><span class="MODULE">module</span> <span class="UIDENT">Parallel</span> <span class="EQUAL">=</span> <span class="UIDENT">Make</span> <span class="LPAREN">(</span><span class="STRUCT">struct</span><span class="EOL">
</span>      <span class="INCLUDE">include</span> <span class="UIDENT">PG</span><span class="EOL">
</span>      <span id="local_Vertex_133"><span class="MODULE">module</span> <span class="UIDENT">Vertex</span> <span class="EQUAL">=</span> <span class="UIDENT">Vertex</span></span><span class="EOL">
</span>      <span id="local_Topological_134"><span class="MODULE">module</span> <span class="UIDENT">Topological</span> <span class="EQUAL">=</span> <span class="UIDENT">Topological</span></span><span class="EOL">
</span>      <span class="INCLUDE">include</span> <span class="UIDENT">Traverse</span><span class="EOL">
</span>      <span class="INCLUDE">include</span> <span class="UIDENT">Components</span><span class="EOL">
</span>    <span class="END">end</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span id="module-MakeGraph.module-Dot"><span class="MODULE">module</span> <span class="UIDENT">Dot</span> <span class="EQUAL">=</span> <a href="../../../ocamlgraph/src/ocamlgraph/graphviz.ml.html#module-Dot"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Graphviz</span><span class="DOT">.</span><span class="UIDENT">Dot</span></a> <span class="LPAREN">(</span><span class="STRUCT">struct</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_edge_attributes_135"><span class="LIDENT">edge_attributes</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_default_edge_attributes_136"><span class="LIDENT">default_edge_attributes</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_get_subgraph_137"><span class="LIDENT">get_subgraph</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_vertex_attributes_138"><span class="LIDENT">vertex_attributes</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_vertex_name_139"><span class="LIDENT">vertex_name</span></span> <span id="local_v_140"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;\&quot;%s\&quot;&quot;</span> <span class="LPAREN">(</span><span class="UIDENT">Vertex</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_v_140"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_default_vertex_attributes_141"><span class="LIDENT">default_vertex_attributes</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_graph_attributes_142"><span class="LIDENT">graph_attributes</span></span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="INCLUDE">include</span> <span class="UIDENT">PG</span><span class="EOL">
</span>    <span class="END">end</span><span class="RPAREN">)</span></span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">PG</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <a href="../../../ocamlgraph/src/ocamlgraph/oper.ml.html#module-I"><span class="UIDENT">Graph</span><span class="DOT">.</span><span class="UIDENT">Oper</span><span class="DOT">.</span><span class="UIDENT">I</span></a> <span class="LPAREN">(</span><span class="UIDENT">PG</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-MakeGraph.val-transitive_closure"><span class="LIDENT">transitive_closure</span></span> <span class="QUESTION">?</span><span id="local_reflexive_143"><span class="LIDENT">reflexive</span></span> <span id="local_g_144"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><span class="LIDENT">add_transitive_closure</span> <span class="QUESTION">?</span><a href="#local_reflexive_143"><span class="LIDENT">reflexive</span></a> <a href="#local_g_144"><span class="LIDENT">g</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-MakeGraph.val-build"><span class="LIDENT">build</span></span> <span id="local_vertices_145"><span class="LIDENT">vertices</span></span> <span id="local_edges_146"><span class="LIDENT">edges</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_graph_147"><span class="LIDENT">graph</span></span> <span class="EQUAL">=</span> <span class="LIDENT">create</span> <span class="LABEL">~size:</span><span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-length"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_vertices_145"><span class="LIDENT">vertices</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">add_vertex</span> <a href="#local_graph_147"><span class="LIDENT">graph</span></a><span class="RPAREN">)</span> <a href="#local_vertices_145"><span class="LIDENT">vertices</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">add_edge_e</span> <a href="#local_graph_147"><span class="LIDENT">graph</span></a><span class="RPAREN">)</span> <a href="#local_edges_146"><span class="LIDENT">edges</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_graph_147"><span class="LIDENT">graph</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-MakeGraph.val-compare"><span class="LIDENT">compare</span></span> <span id="local_g1_148"><span class="LIDENT">g1</span></span> <span id="local_g2_149"><span class="LIDENT">g2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">Vertices</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/set.ml.html#module-Make"><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">Vertex</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">Edges</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/set.ml.html#module-Make"><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">E</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_vertices_150"><span class="LIDENT">vertices</span></span> <span id="local_g_151"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LIDENT">fold_vertex</span> <span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_g_151"><span class="LIDENT">g</span></a> <span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_edges_152"><span class="LIDENT">edges</span></span> <span id="local_g_153"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LIDENT">fold_edges_e</span> <span class="UIDENT">Edges</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_g_153"><span class="LIDENT">g</span></a> <span class="UIDENT">Edges</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">compare</span> <span class="LPAREN">(</span><a href="#local_vertices_150"><span class="LIDENT">vertices</span></a> <a href="#local_g1_148"><span class="LIDENT">g1</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_vertices_150"><span class="LIDENT">vertices</span></a> <a href="#local_g2_149"><span class="LIDENT">g2</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Edges</span><span class="DOT">.</span><span class="LIDENT">compare</span> <span class="LPAREN">(</span><a href="#local_edges_152"><span class="LIDENT">edges</span></a> <a href="#local_g1_148"><span class="LIDENT">g1</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_edges_152"><span class="LIDENT">edges</span></a> <a href="#local_g2_149"><span class="LIDENT">g2</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_n_154"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_n_154"><span class="LIDENT">n</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-MakeGraph.val-to_json"><span class="LIDENT">to_json</span></span> <span class="LPAREN">(</span><span id="local_graph_155"><span class="LIDENT">graph</span></span> <span class="COLON">:</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="COLON">:</span> <a href="opamJson.ml.html#type-t"><span class="UIDENT">OpamJson</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_vertex_map_156"><span class="LIDENT">vertex_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="COMMENT">(* we ensure that the map indexing respects the vertex ordering *)</span><span class="EOL">
</span>       <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">Vertices</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/set.ml.html#module-Make"><span class="UIDENT">Set</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">Vertex</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>       <span class="LET">let</span> <span id="local_vertices_157"><span class="LIDENT">vertices</span></span> <span class="EQUAL">=</span> <span class="LIDENT">fold_vertex</span> <span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_graph_155"><span class="LIDENT">graph</span></a> <span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">empty</span> <span class="IN">in</span><span class="EOL">
</span>       <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-mapi"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">mapi</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_158"><span class="LIDENT">i</span></span> <span id="local_v_159"><span class="LIDENT">v</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_i_158"><span class="LIDENT">i</span></a><span class="COMMA">,</span> <a href="#local_v_159"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">Vertices</span><span class="DOT">.</span><span class="LIDENT">elements</span> <a href="#local_vertices_157"><span class="LIDENT">vertices</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_vertices_160"><span class="LIDENT">vertices</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_vertex_to_json_161"><span class="LIDENT">vertex_to_json</span></span> <span class="LPAREN">(</span><span id="local_i_162"><span class="LIDENT">i</span></span><span class="COMMA">,</span> <span id="local_v_163"><span class="LIDENT">v</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <a href="#local_i_162"><span class="LIDENT">i</span></a><span class="COMMA">,</span> <span class="UIDENT">X</span><span class="DOT">.</span><span class="LIDENT">to_json</span> <a href="#local_v_163"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_vertex_to_json_161"><span class="LIDENT">vertex_to_json</span></a> <a href="#local_vertex_map_156"><span class="LIDENT">vertex_map</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_edges_164"><span class="LIDENT">edges</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">VertexMap</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/map.ml.html#module-Make"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="UIDENT">Vertex</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_vertex_inv_map_165"><span class="LIDENT">vertex_inv_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_m_166"><span class="LIDENT">m</span></span> <span class="LPAREN">(</span><span id="local_i_167"><span class="LIDENT">i</span></span><span class="COMMA">,</span> <span id="local_v_168"><span class="LIDENT">v</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">VertexMap</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_v_168"><span class="LIDENT">v</span></a> <a href="#local_i_167"><span class="LIDENT">i</span></a> <a href="#local_m_166"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="UIDENT">VertexMap</span><span class="DOT">.</span><span class="LIDENT">empty</span> <a href="#local_vertex_map_156"><span class="LIDENT">vertex_map</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_index_169"><span class="LIDENT">index</span></span> <span id="local_v_170"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <span class="UIDENT">VertexMap</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_v_170"><span class="LIDENT">v</span></a> <a href="#local_vertex_inv_map_165"><span class="LIDENT">vertex_inv_map</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_index_to_json_171"><span class="LIDENT">index_to_json</span></span> <span id="local_v_172"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <span class="BACKQUOTE">`</span><span class="UIDENT">String</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a> <span class="LPAREN">(</span><a href="#local_index_169"><span class="LIDENT">index</span></a> <a href="#local_v_172"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_edge_to_json_173"><span class="LIDENT">edge_to_json</span></span> <span id="local_edge_174"><span class="LIDENT">edge</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">label</span> <a href="#local_edge_174"><span class="LIDENT">edge</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="COMMENT">(* labels carry no information; if this changes,
           we should add a &quot;label&quot; field in the JSON output *)</span><span class="EOL">
</span>        <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span class="LBRACKET">[</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="STRING">&quot;src&quot;</span><span class="COMMA">,</span> <a href="#local_index_to_json_171"><span class="LIDENT">index_to_json</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">src</span> <a href="#local_edge_174"><span class="LIDENT">edge</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="STRING">&quot;dst&quot;</span><span class="COMMA">,</span> <a href="#local_index_to_json_171"><span class="LIDENT">index_to_json</span></a> <span class="LPAREN">(</span><span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">dst</span> <a href="#local_edge_174"><span class="LIDENT">edge</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="BACKQUOTE">`</span><span class="UIDENT">A</span> <span class="LPAREN">(</span><span class="LIDENT">fold_edges_e</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_edge_175"><span class="LIDENT">edge</span></span> <span id="local_li_176"><span class="LIDENT">li</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_edge_to_json_173"><span class="LIDENT">edge_to_json</span></a> <a href="#local_edge_175"><span class="LIDENT">edge</span></a> <span class="COLONCOLON">::</span> <a href="#local_li_176"><span class="LIDENT">li</span></a><span class="RPAREN">)</span> <a href="#local_graph_155"><span class="LIDENT">graph</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span class="LBRACKET">[</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="STRING">&quot;vertices&quot;</span><span class="COMMA">,</span> <a href="#local_vertices_160"><span class="LIDENT">vertices</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="STRING">&quot;edges&quot;</span><span class="COMMA">,</span> <a href="#local_edges_164"><span class="LIDENT">edges</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-MakeGraph.val-of_json"><span class="LIDENT">of_json</span></span> <span class="COLON">:</span> <a href="opamJson.ml.html#type-decoder"><span class="LIDENT">t</span> <span class="UIDENT">OpamJson</span><span class="DOT">.</span><span class="LIDENT">decoder</span></a> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span id="local_dict_177"><span class="LIDENT">dict</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="BEGIN">begin</span> <span class="TRY">try</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_vertices_json_178"><span class="LIDENT">vertices_json</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="STRING">&quot;vertices&quot;</span> <a href="#local_dict_177"><span class="LIDENT">dict</span></a> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span id="local_vertices_179"><span class="LIDENT">vertices</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_vertices_179"><span class="LIDENT">vertices</span></a><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_edges_json_180"><span class="LIDENT">edges_json</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="STRING">&quot;edges&quot;</span> <a href="#local_dict_177"><span class="LIDENT">dict</span></a> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">A</span> <span id="local_edges_181"><span class="LIDENT">edges</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_edges_181"><span class="LIDENT">edges</span></a><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_vertex_map_182"><span class="LIDENT">vertex_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_vertex_of_json_183"><span class="LIDENT">vertex_of_json</span></span> <span class="LPAREN">(</span><span id="local_ij_184"><span class="LIDENT">ij</span></span><span class="COMMA">,</span> <span id="local_vj_185"><span class="LIDENT">vj</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_i_186"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-int_of_string"><span class="LIDENT">int_of_string</span></a> <a href="#local_ij_184"><span class="LIDENT">ij</span></a> <span class="WITH">with</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span> <span class="IN">in</span><span class="EOL">
</span>              <span class="LET">let</span> <span id="local_v_187"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <span class="UIDENT">X</span><span class="DOT">.</span><span class="LIDENT">of_json</span> <a href="#local_vj_185"><span class="LIDENT">vj</span></a> <span class="WITH">with</span><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span><span class="EOL">
</span>                  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_v_188"><span class="LIDENT">v</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_v_188"><span class="LIDENT">v</span></a> <span class="IN">in</span><span class="EOL">
</span>              <span class="LPAREN">(</span><a href="#local_i_186"><span class="LIDENT">i</span></a><span class="COMMA">,</span> <a href="#local_v_187"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>            <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_vertex_of_json_183"><span class="LIDENT">vertex_of_json</span></a> <a href="#local_vertices_json_178"><span class="LIDENT">vertices_json</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_edges_189"><span class="LIDENT">edges</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_int_of_jsonstring_190"><span class="LIDENT">int_of_jsonstring</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">String</span> <span id="local_s_191"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="TRY">try</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-int_of_string"><span class="LIDENT">int_of_string</span></a> <a href="#local_s_191"><span class="LIDENT">s</span></a> <span class="WITH">with</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span> <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_find_192"><span class="LIDENT">find</span></span> <span id="local_kj_193"><span class="LIDENT">kj</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>              <a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/int.ml.html#val-equal"><span class="UIDENT">Int</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="LPAREN">(</span><a href="#local_int_of_jsonstring_190"><span class="LIDENT">int_of_jsonstring</span></a> <a href="#local_kj_193"><span class="LIDENT">kj</span></a><span class="RPAREN">)</span> <a href="#local_vertex_map_182"><span class="LIDENT">vertex_map</span></a><span class="EOL">
</span>            <span class="IN">in</span><span class="EOL">
</span>            <span class="LET">let</span> <span id="local_edge_of_json_194"><span class="LIDENT">edge_of_json</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>              <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">O</span> <span id="local_dict_195"><span class="LIDENT">dict</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_src_196"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span> <a href="#local_find_192"><span class="LIDENT">find</span></a> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="STRING">&quot;src&quot;</span> <a href="#local_dict_195"><span class="LIDENT">dict</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_label_197"><span class="LIDENT">label</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_dst_198"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <a href="#local_find_192"><span class="LIDENT">find</span></a> <span class="LPAREN">(</span><a href="opamStd.ml.html#module-OpamList.val-assoc"><span class="UIDENT">OpamStd</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">assoc</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/string.ml.html#val-equal"><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="STRING">&quot;dst&quot;</span> <a href="#local_dict_195"><span class="LIDENT">dict</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="UIDENT">E</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_src_196"><span class="LIDENT">src</span></a> <a href="#local_label_197"><span class="LIDENT">label</span></a> <a href="#local_dst_198"><span class="LIDENT">dst</span></a><span class="EOL">
</span>              <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="UIDENT">Not_found</span><span class="EOL">
</span>            <span class="IN">in</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="#local_edge_of_json_194"><span class="LIDENT">edge_of_json</span></a> <a href="#local_edges_json_180"><span class="LIDENT">edges_json</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">build</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-snd"><span class="LIDENT">snd</span></a> <a href="#local_vertex_map_182"><span class="LIDENT">vertex_map</span></a><span class="RPAREN">)</span> <a href="#local_edges_189"><span class="LIDENT">edges</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>      <span class="END">end</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Simple polymorphic implem on lists when we don't need full graphs.
   We piggy-back on the advanced implem using an array and an int-graph *)</span><span class="EOL">
</span><span id="module-IntGraph"><span class="MODULE">module</span> <span class="UIDENT">IntGraph</span> <span class="EQUAL">=</span> <span class="UIDENT">MakeGraph</span><span class="LPAREN">(</span><span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="def_253"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">int</span></span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_compare_199"><span class="LIDENT">compare</span></span> <span id="local_x_200"><span class="LIDENT">x</span></span> <span id="local_y_201"><span class="LIDENT">y</span></span> <span class="EQUAL">=</span> <a href="#local_x_200"><span class="LIDENT">x</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_y_201"><span class="LIDENT">y</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_hash_202"><span class="LIDENT">hash</span></span> <span id="local_x_203"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span> <a href="#local_x_203"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_equal_204"><span class="LIDENT">equal</span></span> <span id="local_x_205"><span class="LIDENT">x</span></span> <span id="local_y_206"><span class="LIDENT">y</span></span> <span class="EQUAL">=</span> <a href="#local_x_205"><span class="LIDENT">x</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_y_206"><span class="LIDENT">y</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_to_string_207"><span class="LIDENT">to_string</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-string_of_int"><span class="LIDENT">string_of_int</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_to_json_208"><span class="LIDENT">to_json</span></span> <span id="local_x_209"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Float</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-float_of_int"><span class="LIDENT">float_of_int</span></a> <a href="#local_x_209"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_of_json_210"><span class="LIDENT">of_json</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Float</span> <span id="local_x_211"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-int_of_float"><span class="LIDENT">int_of_float</span></a> <a href="#local_x_211"><span class="LIDENT">x</span></a><span class="RPAREN">)</span> <span class="WITH">with</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="END">end</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-flat_graph_of_array"><span class="LIDENT">flat_graph_of_array</span></span> <span id="local_a_212"><span class="LIDENT">a</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_g_213"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-iteri"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">iteri</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_214"><span class="LIDENT">i</span></span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="LIDENT">add_vertex</span> <a href="#local_g_213"><span class="LIDENT">g</span></a> <a href="#local_i_214"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <a href="#local_a_212"><span class="LIDENT">a</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_g_213"><span class="LIDENT">g</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="exception-Errors"><span class="EXCEPTION">exception</span> <span class="UIDENT">Errors</span> <span class="EQUAL">=</span> <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="UIDENT">Errors</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-iter"><span class="LIDENT">iter</span></span> <span class="TILDE">~</span><span id="local_jobs_215"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_216"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span id="local_dry_run_217"><span class="LIDENT">dry_run</span></span> <span id="local_l_218"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_a_219"><span class="LIDENT">a</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-of_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">of_list</span></a> <a href="#local_l_218"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_g_220"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LIDENT">flat_graph_of_array</span> <a href="#local_a_219"><span class="LIDENT">a</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_command_221"><span class="LIDENT">command</span></span> <span class="LABEL">~pred:</span><span class="UNDERSCORE">_</span> <span id="local_i_222"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="#local_command_216"><span class="LIDENT">command</span></a> <a href="#local_a_219"><span class="LIDENT">a</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_i_222"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ignore"><span class="LIDENT">ignore</span></a> <span class="LPAREN">(</span><span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="LIDENT">iter</span> <span class="TILDE">~</span><a href="#local_jobs_215"><span class="LIDENT">jobs</span></a> <span class="TILDE">~</span><a href="#local_command_221"><span class="LIDENT">command</span></a> <span class="QUESTION">?</span><a href="#local_dry_run_217"><span class="LIDENT">dry_run</span></a> <a href="#local_g_220"><span class="LIDENT">g</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-map"><span class="LIDENT">map</span></span> <span class="TILDE">~</span><span id="local_jobs_223"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_224"><span class="LIDENT">command</span></span> <span class="QUESTION">?</span><span id="local_dry_run_225"><span class="LIDENT">dry_run</span></span> <span id="local_l_226"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_a_227"><span class="LIDENT">a</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-of_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">of_list</span></a> <a href="#local_l_226"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_g_228"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LIDENT">flat_graph_of_array</span> <a href="#local_a_227"><span class="LIDENT">a</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_command_229"><span class="LIDENT">command</span></span> <span class="LABEL">~pred:</span><span class="UNDERSCORE">_</span> <span id="local_i_230"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="#local_command_224"><span class="LIDENT">command</span></a> <a href="#local_a_227"><span class="LIDENT">a</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_i_230"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_r_231"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="LIDENT">aux_map</span> <span class="TILDE">~</span><a href="#local_jobs_223"><span class="LIDENT">jobs</span></a> <span class="TILDE">~</span><a href="#local_command_229"><span class="LIDENT">command</span></a> <span class="QUESTION">?</span><a href="#local_dry_run_225"><span class="LIDENT">dry_run</span></a> <a href="#local_g_228"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_mklist_232"><span class="LIDENT">mklist</span></span> <span id="local_acc_233"><span class="LIDENT">acc</span></span> <span id="local_n_234"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_n_234"><span class="LIDENT">n</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <a href="#local_acc_233"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="#local_mklist_232"><span class="LIDENT">mklist</span></a> <span class="LPAREN">(</span><span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_n_234"><span class="LIDENT">n</span></a> <a href="#local_r_231"><span class="LIDENT">r</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_233"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_n_234"><span class="LIDENT">n</span></a><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a><span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_mklist_232"><span class="LIDENT">mklist</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-length"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_a_227"><span class="LIDENT">a</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-reduce"><span class="LIDENT">reduce</span></span> <span class="TILDE">~</span><span id="local_jobs_235"><span class="LIDENT">jobs</span></span> <span class="TILDE">~</span><span id="local_command_236"><span class="LIDENT">command</span></span> <span class="TILDE">~</span><span id="local_merge_237"><span class="LIDENT">merge</span></span> <span class="TILDE">~</span><span id="local_nil_238"><span class="LIDENT">nil</span></span> <span class="QUESTION">?</span><span id="local_dry_run_239"><span class="LIDENT">dry_run</span></span> <span id="local_l_240"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_a_241"><span class="LIDENT">a</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/array.ml.html#val-of_list"><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">of_list</span></a> <a href="#local_l_240"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_g_242"><span class="LIDENT">g</span></span> <span class="EQUAL">=</span> <span class="LIDENT">flat_graph_of_array</span> <a href="#local_a_241"><span class="LIDENT">a</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_command_243"><span class="LIDENT">command</span></span> <span class="LABEL">~pred:</span><span class="UNDERSCORE">_</span> <span id="local_i_244"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="#local_command_236"><span class="LIDENT">command</span></a> <a href="#local_a_241"><span class="LIDENT">a</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_i_244"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_r_245"><span class="LIDENT">r</span></span> <span class="EQUAL">=</span> <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="LIDENT">aux_map</span> <span class="TILDE">~</span><a href="#local_jobs_235"><span class="LIDENT">jobs</span></a> <span class="TILDE">~</span><a href="#local_command_243"><span class="LIDENT">command</span></a> <span class="QUESTION">?</span><a href="#local_dry_run_239"><span class="LIDENT">dry_run</span></a> <a href="#local_g_242"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">IntGraph</span><span class="DOT">.</span><span class="UIDENT">Parallel</span><span class="DOT">.</span><span class="UIDENT">M</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_merge_237"><span class="LIDENT">merge</span></a><span class="RPAREN">)</span> <a href="#local_r_245"><span class="LIDENT">r</span></a> <a href="#local_nil_238"><span class="LIDENT">nil</span></a><span class="EOL">
</span></span></code></pre></body></html>
