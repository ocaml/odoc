<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: cstubs_structs.ml (ctypes.src.ctypes.stubs)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">ctypes</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; ctypes.stubs &#x00BB; cstubs_structs.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>cstubs_structs.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">ctypes</a><ul><li>Library <code>ctypes</code><ul><li><a href="../../ctypes/ComplexL/index.html">ComplexL</a></li><li><a href="../../ctypes/Cstubs_internals/index.html">Cstubs_internals</a></li><li><a href="../../ctypes/Ctypes/index.html">Ctypes</a></li><li><a href="../../ctypes/Ctypes_bigarray/index.html">Ctypes_bigarray</a></li><li><a href="../../ctypes/Ctypes_bigarray_stubs/index.html">Ctypes_bigarray_stubs</a></li><li><a href="../../ctypes/Ctypes_coerce/index.html">Ctypes_coerce</a></li><li><a href="../../ctypes/Ctypes_memory/index.html">Ctypes_memory</a></li><li><a href="../../ctypes/Ctypes_memory_stubs/index.html">Ctypes_memory_stubs</a></li><li><a href="../../ctypes/Ctypes_primitive_types/index.html">Ctypes_primitive_types</a></li><li><a href="../../ctypes/Ctypes_primitives/index.html">Ctypes_primitives</a></li><li><a href="../../ctypes/Ctypes_ptr/index.html">Ctypes_ptr</a></li><li><a href="../../ctypes/Ctypes_roots_stubs/index.html">Ctypes_roots_stubs</a></li><li><a href="../../ctypes/Ctypes_static/index.html">Ctypes_static</a></li><li><a href="../../ctypes/Ctypes_std_view_stubs/index.html">Ctypes_std_view_stubs</a></li><li><a href="../../ctypes/Ctypes_std_views/index.html">Ctypes_std_views</a></li><li><a href="../../ctypes/Ctypes_structs/index.html">Ctypes_structs</a></li><li><a href="../../ctypes/Ctypes_structs_computed/index.html">Ctypes_structs_computed</a></li><li><a href="../../ctypes/Ctypes_type_printing/index.html">Ctypes_type_printing</a></li><li><a href="../../ctypes/Ctypes_types/index.html">Ctypes_types</a></li><li><a href="../../ctypes/Ctypes_value_printing/index.html">Ctypes_value_printing</a></li><li><a href="../../ctypes/Ctypes_value_printing_stubs/index.html">Ctypes_value_printing_stubs</a></li><li><a href="../../ctypes/LDouble/index.html">LDouble</a></li><li><a href="../../ctypes/PosixTypes/index.html">PosixTypes</a></li></ul></li><li>Library <code>ctypes.stubs</code><ul><li><a href="../../ctypes.stubs/Cstubs/index.html">Cstubs</a></li><li><a href="../../ctypes.stubs/Cstubs_analysis/index.html">Cstubs_analysis</a></li><li><a href="../../ctypes.stubs/Cstubs_c_language/index.html">Cstubs_c_language</a></li><li><a href="../../ctypes.stubs/Cstubs_emit_c/index.html">Cstubs_emit_c</a></li><li><a href="../../ctypes.stubs/Cstubs_errors/index.html">Cstubs_errors</a></li><li><a href="../../ctypes.stubs/Cstubs_generate_c/index.html">Cstubs_generate_c</a></li><li><a href="../../ctypes.stubs/Cstubs_generate_ml/index.html">Cstubs_generate_ml</a></li><li><a href="../../ctypes.stubs/Cstubs_inverted/index.html">Cstubs_inverted</a></li><li><a href="../../ctypes.stubs/Cstubs_public_name/index.html">Cstubs_public_name</a></li><li><a href="../../ctypes.stubs/Cstubs_structs/index.html">Cstubs_structs</a></li><li><a href="../../ctypes.stubs/Ctypes_path/index.html">Ctypes_path</a></li></ul></li><li>Library <code>ctypes.top</code><ul><li><a href="../../ctypes.top/Ctypes_top/index.html">Ctypes_top</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>ctypes<ul><li><a href="../ctypes/complexL.ml.html">complexL.ml</a></li><li><a href="../ctypes/cstubs_internals.ml.html">cstubs_internals.ml</a></li><li><a href="../ctypes/ctypes.ml.html">ctypes.ml</a></li><li><a href="../ctypes/ctypes_bigarray.ml.html">ctypes_bigarray.ml</a></li><li><a href="../ctypes/ctypes_bigarray_stubs.ml.html">ctypes_bigarray_stubs.ml</a></li><li><a href="../ctypes/ctypes_coerce.ml.html">ctypes_coerce.ml</a></li><li><a href="../ctypes/ctypes_memory.ml.html">ctypes_memory.ml</a></li><li><a href="../ctypes/ctypes_memory_stubs.ml.html">ctypes_memory_stubs.ml</a></li><li><a href="../ctypes/ctypes_primitive_types.ml.html">ctypes_primitive_types.ml</a></li><li><a href="../ctypes/ctypes_primitives.ml.html">ctypes_primitives.ml</a></li><li><a href="../ctypes/ctypes_ptr.ml.html">ctypes_ptr.ml</a></li><li><a href="../ctypes/ctypes_roots_stubs.ml.html">ctypes_roots_stubs.ml</a></li><li><a href="../ctypes/ctypes_static.ml.html">ctypes_static.ml</a></li><li><a href="../ctypes/ctypes_std_view_stubs.ml.html">ctypes_std_view_stubs.ml</a></li><li><a href="../ctypes/ctypes_std_views.ml.html">ctypes_std_views.ml</a></li><li><a href="../ctypes/ctypes_structs.ml.html">ctypes_structs.ml</a></li><li><a href="../ctypes/ctypes_structs_computed.ml.html">ctypes_structs_computed.ml</a></li><li><a href="../ctypes/ctypes_type_printing.ml.html">ctypes_type_printing.ml</a></li><li><a href="../ctypes/ctypes_value_printing.ml.html">ctypes_value_printing.ml</a></li><li><a href="../ctypes/ctypes_value_printing_stubs.ml.html">ctypes_value_printing_stubs.ml</a></li><li><a href="../ctypes/lDouble.ml.html">lDouble.ml</a></li><li><a href="../ctypes/posixTypes.ml.html">posixTypes.ml</a></li></ul></li><li>ctypes.stubs<ul><li><a href="cstubs.ml.html">cstubs.ml</a></li><li><a href="cstubs_analysis.ml.html">cstubs_analysis.ml</a></li><li><a href="cstubs_c_language.ml.html">cstubs_c_language.ml</a></li><li><a href="cstubs_emit_c.ml.html">cstubs_emit_c.ml</a></li><li><a href="cstubs_errors.ml.html">cstubs_errors.ml</a></li><li><a href="cstubs_generate_c.ml.html">cstubs_generate_c.ml</a></li><li><a href="cstubs_generate_ml.ml.html">cstubs_generate_ml.ml</a></li><li><a href="cstubs_inverted.ml.html">cstubs_inverted.ml</a></li><li><a href="cstubs_public_name.ml.html">cstubs_public_name.ml</a></li><li><a href="#" class="current_unit">cstubs_structs.ml</a></li><li><a href="ctypes_path.ml.html">ctypes_path.ml</a></li></ul></li><li>ctypes.top<ul><li><a href="../ctypes.top/ctypes_top.ml.html">ctypes_top.ml</a></li><li><a href="../ctypes.top/install_ctypes_printers.ml.html">install_ctypes_printers.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
</code><code class="source_code"><span><span class="COMMENT">(*
 * Copyright (c) 2014 Jeremy Yallop.
 *
 * This file is distributed under the terms of the MIT License.
 * See the file LICENSE for details.
 *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LBRACKETATATAT">[@@@</span><span class="LIDENT">warning</span> <span class="STRING">&quot;-9-27&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="OPEN">open</span> <a href="../ctypes/ctypes.ml.html"><span class="UIDENT">Ctypes</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-TYPE"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">TYPE</span> <span class="EQUAL">=</span><span class="EOL">
</span><span class="SIG">sig</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">Ctypes_types</span><span class="DOT">.</span><span class="UIDENT">TYPE</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-TYPE.type-const"><span class="TYPE">type</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">const</span></span><span class="EOL">
</span>  <span id="module-type-TYPE.val-constant"><span class="VAL">val</span> <span class="LIDENT">constant</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">typ</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">const</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-type-TYPE.val-enum"><span class="VAL">val</span> <span class="LIDENT">enum</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <span class="OPTLABEL">?typedef:</span><span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="OPTLABEL">?unexpected:</span><span class="LPAREN">(</span><span class="LIDENT">int64</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="STAR">*</span> <span class="LIDENT">int64</span> <span class="LIDENT">const</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="LIDENT">typ</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-type-BINDINGS"><span class="MODULE">module</span> <span class="TYPE">type</span> <span class="UIDENT">BINDINGS</span> <span class="EQUAL">=</span> <span class="FUNCTOR">functor</span> <span class="LPAREN">(</span><span class="UIDENT">F</span> <span class="COLON">:</span> <span class="UIDENT">TYPE</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="SIG">sig</span> <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cstring"><span class="LIDENT">cstring</span></span> <span id="local_s_1"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="COMMENT">(* Format a string for output as a C string literal. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_mappings_2"><span class="LIDENT">mappings</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="UIDENT">Str</span><span class="DOT">.</span><span class="LIDENT">regexp</span> <span class="STRING">&quot;\&quot;&quot;</span><span class="COMMA">,</span> <span class="STRING">&quot;\\\&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>                  <span class="UIDENT">Str</span><span class="DOT">.</span><span class="LIDENT">regexp</span> <span class="STRING">&quot;\n&quot;</span><span class="COMMA">,</span> <span class="STRING">&quot;\\n&quot;</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_escaped_3"><span class="LIDENT">escaped</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_4"><span class="LIDENT">s</span></span> <span class="LPAREN">(</span><span id="local_r_5"><span class="LIDENT">r</span></span><span class="COMMA">,</span> <span id="local_r'_6"><span class="LIDENT">r'</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Str</span><span class="DOT">.</span><span class="LPAREN">(</span><span class="LIDENT">global_replace</span> <a href="#local_r_5"><span class="LIDENT">r</span></a> <a href="#local_r'_6"><span class="LIDENT">r'</span></a><span class="RPAREN">)</span> <a href="#local_s_4"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <a href="#local_s_1"><span class="LIDENT">s</span></a> <a href="#local_mappings_2"><span class="LIDENT">mappings</span></a><span class="EOL">
</span>  <span class="IN">in</span> <span class="STRING">&quot;\&quot;&quot;</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a> <a href="#local_escaped_3"><span class="LIDENT">escaped</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="STRING">&quot;\&quot;&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cprologue"><span class="LIDENT">cprologue</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="EOL">
</span>  <span class="STRING">&quot;#include &lt;stdio.h&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;#include &lt;stddef.h&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;#include \&quot;ctypes_cstubs_internals.h\&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;int main(void)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;{&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RBRACKET">]</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cepilogue"><span class="LIDENT">cepilogue</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="EOL">
</span>  <span class="STRING">&quot;  return 0;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;}&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="RBRACKET">]</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-mlprologue"><span class="LIDENT">mlprologue</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="EOL">
</span>  <span class="STRING">&quot;[@@@warning \&quot;-9-27\&quot;]&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;include Ctypes&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;let lift x = x&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="STRING">&quot;open Ctypes_static&quot;</span><span class="SEMI">;</span><span class="EOL">
</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [puts fmt s] writes the call [puts(s);] on [fmt]. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-puts"><span class="LIDENT">puts</span></span> <span id="local_fmt_7"><span class="LIDENT">fmt</span></span> <span id="local_s_8"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_7"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[puts@[(%s);@]@]@\n&quot;</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="LIDENT">cstring</span> <a href="#local_s_8"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [printf1 fmt s v] writes the call [printf(s, v);] on [fmt]. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-printf1"><span class="LIDENT">printf1</span></span> <span id="local_fmt_9"><span class="LIDENT">fmt</span></span> <span id="local_s_10"><span class="LIDENT">s</span></span> <span id="local_v_11"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_9"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[ctypes_printf@[(%s,@ %t);@]@]@\n&quot;</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="LIDENT">cstring</span> <a href="#local_s_10"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <a href="#local_v_11"><span class="LIDENT">v</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [printf2 fmt s u v] writes the call [printf(s, u, v);] on [fmt]. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-printf2"><span class="LIDENT">printf2</span></span> <span id="local_fmt_12"><span class="LIDENT">fmt</span></span> <span id="local_s_13"><span class="LIDENT">s</span></span> <span id="local_u_14"><span class="LIDENT">u</span></span> <span id="local_v_15"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_12"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[ctypes_printf@[(%s,@ %t,@ %t);@]@]@\n&quot;</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="LIDENT">cstring</span> <a href="#local_s_13"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <a href="#local_u_14"><span class="LIDENT">u</span></a> <a href="#local_v_15"><span class="LIDENT">v</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [offsetof fmt t f] writes the call [offsetof(t, f)] on [fmt]. *)</span> <span class="EOL">
</span><span class="LET">let</span> <span id="val-offsetof"><span class="LIDENT">offsetof</span></span> <span id="local_fmt_16"><span class="LIDENT">fmt</span></span> <span class="LPAREN">(</span><span id="local_t_17"><span class="LIDENT">t</span></span><span class="COMMA">,</span> <span id="local_f_18"><span class="LIDENT">f</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_16"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[offsetof@[(%s,@ %s)@]@]&quot;</span> <a href="#local_t_17"><span class="LIDENT">t</span></a> <a href="#local_f_18"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [sizeof fmt t] writes the call [sizeof(t)] on [fmt]. *)</span> <span class="EOL">
</span><span class="LET">let</span> <span id="val-sizeof"><span class="LIDENT">sizeof</span></span> <span id="local_fmt_19"><span class="LIDENT">fmt</span></span> <span id="local_t_20"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_19"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[sizeof@[(%s)@]@]&quot;</span> <a href="#local_t_20"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-alignmentof"><span class="LIDENT">alignmentof</span></span> <span id="local_fmt_21"><span class="LIDENT">fmt</span></span> <span id="local_t_22"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">offsetof</span> <a href="#local_fmt_21"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-sprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;struct { char c; %s x; }&quot;</span> <a href="#local_t_22"><span class="LIDENT">t</span></a><span class="COMMA">,</span> <span class="STRING">&quot;x&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-{write_c}1/shadowed/(ctypes-src-ctypes.stubs-cstubs_structs.ml)"><span class="LIDENT">write_c</span></span> <span id="local_fmt_23"><span class="LIDENT">fmt</span></span> <span id="local_body_24"><span class="LIDENT">body</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_23"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[%s@]@\n&quot;</span><span class="RPAREN">)</span> <span class="LIDENT">cprologue</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_23"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@[&lt;v 2&gt;@\n@[%t@]@]@\n&quot;</span> <a href="#local_body_24"><span class="LIDENT">body</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_23"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;%s@\n&quot;</span><span class="RPAREN">)</span> <span class="LIDENT">cepilogue</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-cases"><span class="LIDENT">cases</span></span> <span id="local_fmt_25"><span class="LIDENT">fmt</span></span> <span id="local_list_26"><span class="LIDENT">list</span></span> <span id="local_prologue_27"><span class="LIDENT">prologue</span></span> <span id="local_epilogue_28"><span class="LIDENT">epilogue</span></span> <span class="TILDE">~</span><span id="local_case_29"><span class="LIDENT">case</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">puts</span> <a href="#local_fmt_25"><span class="LIDENT">fmt</span></a><span class="RPAREN">)</span> <a href="#local_prologue_27"><span class="LIDENT">prologue</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <a href="#local_case_29"><span class="LIDENT">case</span></a> <a href="#local_list_26"><span class="LIDENT">list</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">puts</span> <a href="#local_fmt_25"><span class="LIDENT">fmt</span></a><span class="RPAREN">)</span> <a href="#local_epilogue_28"><span class="LIDENT">epilogue</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_field"><span class="LIDENT">write_field</span></span> <span id="local_fmt_30"><span class="LIDENT">fmt</span></span> <span id="local_specs_31"><span class="LIDENT">specs</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_case_32"><span class="LIDENT">case</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Struct</span> <span class="LPAREN">(</span><span id="local_tag_33"><span class="LIDENT">tag</span></span><span class="COMMA">,</span> <span id="local_typedef_34"><span class="LIDENT">typedef</span></span><span class="RPAREN">)</span><span class="COMMA">,</span> <span id="local_fname_35"><span class="LIDENT">fname</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_foffset_36"><span class="LIDENT">foffset</span></span> <span id="local_fmt_37"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">offsetof</span> <a href="#local_fmt_37"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="#local_typedef_34"><span class="LIDENT">typedef</span></a><span class="COMMA">,</span> <a href="#local_fname_35"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">puts</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;  | Struct ({ tag = %S; _} as s'), %S -&gt;&quot;</span> <a href="#local_tag_33"><span class="LIDENT">tag</span></a> <a href="#local_fname_35"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">printf1</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a>             <span class="STRING">&quot;    let f = {ftype; fname; foffset = %zu} in \n&quot;</span> <a href="#local_foffset_36"><span class="LIDENT">foffset</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">puts</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a>                <span class="STRING">&quot;    (s'.fields &lt;- BoxedField f :: s'.fields; f)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Union</span> <span class="LPAREN">(</span><span id="local_tag_38"><span class="LIDENT">tag</span></span><span class="COMMA">,</span> <span id="local_typedef_39"><span class="LIDENT">typedef</span></span><span class="RPAREN">)</span><span class="COMMA">,</span> <span id="local_fname_40"><span class="LIDENT">fname</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_foffset_41"><span class="LIDENT">foffset</span></span> <span id="local_fmt_42"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">offsetof</span> <a href="#local_fmt_42"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="#local_typedef_39"><span class="LIDENT">typedef</span></a><span class="COMMA">,</span> <a href="#local_fname_40"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">puts</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;  | Union ({ utag = %S; _} as s'), %S -&gt;&quot;</span> <a href="#local_tag_38"><span class="LIDENT">tag</span></a> <a href="#local_fname_40"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">printf1</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a>             <span class="STRING">&quot;    let f = {ftype; fname; foffset = %zu} in \n&quot;</span> <a href="#local_foffset_41"><span class="LIDENT">foffset</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">puts</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a>                <span class="STRING">&quot;    (s'.ufields &lt;- BoxedField f :: s'.ufields; f)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unsupported</span> <span class="STRING">&quot;Adding a field to non-structured type&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">cases</span> <a href="#local_fmt_30"><span class="LIDENT">fmt</span></a> <a href="#local_specs_31"><span class="LIDENT">specs</span></a><span class="EOL">
</span>  <span class="LBRACKET">[</span><span class="STRING">&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>   <span class="STRING">&quot;let rec field : type t a. t typ -&gt; string -&gt; a typ -&gt; (a, t) field =&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>   <span class="STRING">&quot;  fun s fname ftype -&gt; match s, fname with&quot;</span><span class="SEMI">;</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="TILDE">~</span><a href="#local_case_32"><span class="LIDENT">case</span></a><span class="EOL">
</span>  <span class="LBRACKET">[</span><span class="STRING">&quot;  | View { ty; _ }, _ -&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>   <span class="STRING">&quot;    let { ftype; foffset; fname } = field ty fname ftype in&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>   <span class="STRING">&quot;    { ftype; foffset; fname }&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>   <span class="STRING">&quot;  | _ -&gt; failwith (\&quot;Unexpected field \&quot;^ fname)&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_seal"><span class="LIDENT">write_seal</span></span> <span id="local_fmt_43"><span class="LIDENT">fmt</span></span> <span id="local_specs_44"><span class="LIDENT">specs</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_case_45"><span class="LIDENT">case</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Struct</span> <span class="LPAREN">(</span><span id="local_tag_46"><span class="LIDENT">tag</span></span><span class="COMMA">,</span> <span id="local_typedef_47"><span class="LIDENT">typedef</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_ssize_48"><span class="LIDENT">ssize</span></span> <span id="local_fmt_49"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">sizeof</span> <a href="#local_fmt_49"><span class="LIDENT">fmt</span></a> <a href="#local_typedef_47"><span class="LIDENT">typedef</span></a><span class="EOL">
</span>        <span class="AND">and</span> <span id="local_salign_50"><span class="LIDENT">salign</span></span> <span id="local_fmt_51"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">alignmentof</span> <a href="#local_fmt_51"><span class="LIDENT">fmt</span></a> <a href="#local_typedef_47"><span class="LIDENT">typedef</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">puts</span> <a href="#local_fmt_43"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;  | Struct ({ tag = %S; spec = Incomplete _; _ } as s') -&gt;&quot;</span> <a href="#local_tag_46"><span class="LIDENT">tag</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">printf2</span> <a href="#local_fmt_43"><span class="LIDENT">fmt</span></a>              <span class="STRING">&quot;    s'.spec &lt;- Complete { size = %zu; align = %zu }\n&quot;</span> <a href="#local_ssize_48"><span class="LIDENT">ssize</span></a> <a href="#local_salign_50"><span class="LIDENT">salign</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Union</span> <span class="LPAREN">(</span><span id="local_tag_52"><span class="LIDENT">tag</span></span><span class="COMMA">,</span> <span id="local_typedef_53"><span class="LIDENT">typedef</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_usize_54"><span class="LIDENT">usize</span></span> <span id="local_fmt_55"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">sizeof</span> <a href="#local_fmt_55"><span class="LIDENT">fmt</span></a> <a href="#local_typedef_53"><span class="LIDENT">typedef</span></a><span class="EOL">
</span>        <span class="AND">and</span> <span id="local_ualign_56"><span class="LIDENT">ualign</span></span> <span id="local_fmt_57"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">alignmentof</span> <a href="#local_fmt_57"><span class="LIDENT">fmt</span></a> <a href="#local_typedef_53"><span class="LIDENT">typedef</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">puts</span> <a href="#local_fmt_43"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;  | Union ({ utag = %S; uspec = None; _ } as s') -&gt;&quot;</span> <a href="#local_tag_52"><span class="LIDENT">tag</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">printf2</span> <a href="#local_fmt_43"><span class="LIDENT">fmt</span></a>              <span class="STRING">&quot;    s'.uspec &lt;- Some { size = %zu; align = %zu }\n&quot;</span> <a href="#local_usize_54"><span class="LIDENT">usize</span></a> <a href="#local_ualign_56"><span class="LIDENT">ualign</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Other</span> <span class="MINUSGREATER">-&gt;</span> <span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unsupported</span> <span class="STRING">&quot;Sealing a non-structured type&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">cases</span> <a href="#local_fmt_43"><span class="LIDENT">fmt</span></a> <a href="#local_specs_44"><span class="LIDENT">specs</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;let rec seal : type a. a typ -&gt; unit = function&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_case_45"><span class="LIDENT">case</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;  | Struct { tag; spec = Complete _; _ } -&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;    raise (ModifyingSealedType tag)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;  | Union { utag; uspec = Some _; _ } -&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;    raise (ModifyingSealedType utag)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;  | View { ty; _ } -&gt; seal ty&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;  | _ -&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;    raise (Unsupported \&quot;Sealing a non-structured type\&quot;)&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-primitive_format_string"><span class="LIDENT">primitive_format_string</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span><span class="DOT">.</span> <a href="../ctypes/ctypes_primitive_types.ml.html#type-prim"><span class="LIDENT">a</span> <span class="UIDENT">Ctypes_primitive_types</span><span class="DOT">.</span><span class="LIDENT">prim</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">string</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_p_58"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="OPEN">open</span> <a href="../ctypes/ctypes_primitive_types.ml.html"><span class="UIDENT">Ctypes_primitive_types</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_sprintf_59"><span class="LIDENT">sprintf</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fail_60"><span class="LIDENT">fail</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-ksprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">ksprintf</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;Cannot retrieve constants of type %s&quot;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../ctypes/ctypes_primitives.ml.html#val-name"><span class="UIDENT">Ctypes_primitives</span><span class="DOT">.</span><span class="LIDENT">name</span></a> <a href="#local_p_58"><span class="LIDENT">p</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_p_58"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="../ctypes/ctypes_primitives.ml.html#val-format_string"><span class="UIDENT">Ctypes_primitives</span><span class="DOT">.</span><span class="LIDENT">format_string</span></a> <a href="#local_p_58"><span class="LIDENT">p</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Char</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_61"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Char.chr (((%s) + 256) mod 256)&quot;</span> <a href="#local_fmt_61"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Schar</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_62"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_62"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uchar</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_63"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UChar.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_63"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Bool</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_64"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;((%s) &lt;&gt; 0)&quot;</span> <a href="#local_fmt_64"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Short</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_65"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_65"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Int</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_66"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_66"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Long</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_67"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Signed.Long.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_67"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Llong</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_68"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Signed.LLong.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_68"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ushort</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_69"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UShort.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_69"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Sint</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_70"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Signed.SInt.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_70"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uint</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_71"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UInt.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_71"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ulong</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_72"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.ULong.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_72"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ullong</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_73"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.ULLong.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_73"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Size_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_74"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.Size_t.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_74"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Int8_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_75"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_75"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Int16_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_76"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_76"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Int32_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_77"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_77"><span class="LIDENT">fmt</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="STRING">&quot;l&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Int64_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_78"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_78"><span class="LIDENT">fmt</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="STRING">&quot;L&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uint8_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_79"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UInt8.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_79"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uint16_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_80"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UInt16.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_80"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uint32_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_81"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UInt32.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_81"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Uint64_t</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_82"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sprintf_59"><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Unsigned.UInt64.of_string \&quot;%s\&quot;&quot;</span> <a href="#local_fmt_82"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Camlint</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_83"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_83"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Nativeint</span><span class="COMMA">,</span> <span class="UIDENT">Some</span> <span id="local_fmt_84"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fmt_84"><span class="LIDENT">fmt</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(^)"><span class="INFIXOP1">^</span></a><span class="STRING">&quot;n&quot;</span><span class="EOL">
</span>    <span class="COMMENT">(* Integer constant expressions cannot have non-integer type *)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Complex32</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Complex64</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Complexld</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Float</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Double</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">LDouble</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fail_60"><span class="LIDENT">fail</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-ml_pat_and_exp_of_typ"><span class="LIDENT">ml_pat_and_exp_of_typ</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span><span class="DOT">.</span> <a href="../ctypes/ctypes_static.ml.html#type-typ"><span class="LIDENT">a</span> <span class="LIDENT">typ</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">string</span> <span class="STAR">*</span> <span class="LIDENT">string</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_ty_85"><span class="LIDENT">ty</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_ty_85"><span class="LIDENT">ty</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ctypes_static</span><span class="DOT">.</span><span class="UIDENT">View</span> <span class="LBRACE">{</span> <span id="local_ty_86"><span class="UIDENT">Ctypes_static</span><span class="DOT">.</span><span class="LIDENT">ty</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_157"><span id="local_p_87"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span id="local_e_88"><span class="LIDENT">e</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">ml_pat_and_exp_of_typ</span> <a href="#local_ty_86"><span class="LIDENT">ty</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_x_89"><span class="LIDENT">x</span></span> <span class="EQUAL">=</span> <a href="cstubs_c_language.ml.html#val-fresh_var"><span class="UIDENT">Cstubs_c_language</span><span class="DOT">.</span><span class="LIDENT">fresh_var</span></a> <span class="LABEL">~prefix:</span><span class="STRING">&quot;read&quot;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_p'_90"><span class="LIDENT">p'</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;Ctypes_static.View { Ctypes_static.read = %s; ty = %s }&quot;</span> <a href="#local_x_89"><span class="LIDENT">x</span></a> <a href="#local_p_87"><span class="LIDENT">p</span></a><span class="EOL">
</span>      <span class="AND">and</span> <span id="local_e'_91"><span class="LIDENT">e'</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/printf.ml.html#val-sprintf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a> <span class="STRING">&quot;(%s (%s))&quot;</span> <a href="#local_x_89"><span class="LIDENT">x</span></a> <a href="#local_e_88"><span class="LIDENT">e</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_p'_90"><span class="LIDENT">p'</span></a><span class="COMMA">,</span> <a href="#local_e'_91"><span class="LIDENT">e'</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ctypes_static</span><span class="DOT">.</span><span class="UIDENT">Primitive</span> <span id="local_p_92"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pat_93"><span class="LIDENT">pat</span></span> <span class="EQUAL">=</span> <span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-asprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">asprintf</span></a> <span class="STRING">&quot;Ctypes_static.Primitive %a&quot;</span><span class="EOL">
</span>           <a href="ctypes_path.ml.html#val-format_path"><span class="UIDENT">Ctypes_path</span><span class="DOT">.</span><span class="LIDENT">format_path</span></a><span class="EOL">
</span>           <span class="LPAREN">(</span><a href="cstubs_public_name.ml.html#val-constructor_cident_of_prim"><span class="UIDENT">Cstubs_public_name</span><span class="DOT">.</span><span class="LIDENT">constructor_cident_of_prim</span></a> <a href="#local_p_92"><span class="LIDENT">p</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="AND">and</span> <span id="local_exp_94"><span class="LIDENT">exp</span></span> <span class="EQUAL">=</span> <span class="LIDENT">primitive_format_string</span> <a href="#local_p_92"><span class="LIDENT">p</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_pat_93"><span class="LIDENT">pat</span></a><span class="COMMA">,</span> <a href="#local_exp_94"><span class="LIDENT">exp</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-failwith"><span class="failwith">failwith</span></a> <span class="STRING">&quot;constant of non-primitive&quot;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_consts"><span class="LIDENT">write_consts</span></span> <span id="local_fmt_95"><span class="LIDENT">fmt</span></span> <span id="local_consts_96"><span class="LIDENT">consts</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_case_97"><span class="LIDENT">case</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="FUNCTION">function</span> <span class="LPAREN">(</span><span id="local_name_98"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span class="UIDENT">Ctypes_static</span><span class="DOT">.</span><span class="UIDENT">BoxedType</span> <span id="local_ty_99"><span class="LIDENT">ty</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_156"><span id="local_p_100"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span id="local_e_101"><span class="LIDENT">e</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">ml_pat_and_exp_of_typ</span> <a href="#local_ty_99"><span class="LIDENT">ty</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;{@[&lt;v 2&gt;@\n&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;enum { check_%s_const = (int)%s };@\n&quot;</span> <a href="#local_name_98"><span class="LIDENT">name</span></a> <a href="#local_name_98"><span class="LIDENT">name</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="COMMENT">(* Since printf is variadic we can't rely on implicit conversions.
         We'll use assignment rather than casts to coerce to the correct type
         because casts typically result in silent truncation whereas narrowing
         assignments typically trigger warnings even on default compiler
         settings. *)</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;%a = (%s);@\n&quot;</span> <span class="LPAREN">(</span><a href="../ctypes/ctypes_type_printing.ml.html#val-format_typ"><span class="UIDENT">Ctypes</span><span class="DOT">.</span><span class="LIDENT">format_typ</span></a> <span class="LABEL">~name:</span><span class="STRING">&quot;v&quot;</span><span class="RPAREN">)</span> <a href="#local_ty_99"><span class="LIDENT">ty</span></a> <a href="#local_name_98"><span class="LIDENT">name</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">printf1</span> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-asprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">asprintf</span></a> <span class="STRING">&quot;  | %s, %S -&gt;@\n    %s\n&quot;</span> <a href="#local_p_100"><span class="LIDENT">p</span></a> <a href="#local_name_98"><span class="LIDENT">name</span></a> <a href="#local_e_101"><span class="LIDENT">e</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fmt_102"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_102"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;v&quot;</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;@]@\n}@\n&quot;</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">cases</span> <a href="#local_fmt_95"><span class="LIDENT">fmt</span></a> <a href="#local_consts_96"><span class="LIDENT">consts</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;type 'a const = 'a&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;let constant (type t) name (t : t typ) : t = match t, name with&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_case_97"><span class="LIDENT">case</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;  | _, s -&gt; failwith (\&quot;unmatched constant: \&quot;^ s)&quot;</span><span class="RBRACKET">]</span> <span class="EOL">
</span>    <span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_enums"><span class="LIDENT">write_enums</span></span> <span id="local_fmt_103"><span class="LIDENT">fmt</span></span> <span id="local_enums_104"><span class="LIDENT">enums</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_case_105"><span class="LIDENT">case</span></span> <span class="LPAREN">(</span><span id="local_name_106"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span id="local_typedef_107"><span class="LIDENT">typedef</span></span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">printf1</span> <a href="#local_fmt_103"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-sprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">sprintf</span></a><span class="EOL">
</span>         <span class="STRING">&quot;  | %S -&gt; \n    Cstubs_internals.build_enum_type %S Ctypes_static.%%s ?typedef ?unexpected alist\n&quot;</span><span class="EOL">
</span>         <a href="#local_name_106"><span class="LIDENT">name</span></a><span class="EOL">
</span>         <a href="#local_name_106"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fmt_108"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_108"><span class="LIDENT">fmt</span></a><span class="EOL">
</span>           <span class="STRING">&quot;ctypes_arithmetic_type_name(CTYPES_CLASSIFY_ARITHMETIC_TYPE(%s%s))&quot;</span><span class="EOL">
</span>           <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_typedef_107"><span class="LIDENT">typedef</span></a> <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span> <span class="ELSE">else</span> <span class="STRING">&quot;enum &quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>           <a href="#local_name_106"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">cases</span> <a href="#local_fmt_103"><span class="LIDENT">fmt</span></a> <a href="#local_enums_104"><span class="LIDENT">enums</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;let enum (type a) name ?typedef ?unexpected (alist : (a * int64) list) =&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;  match name with&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_case_105"><span class="LIDENT">case</span></a><span class="EOL">
</span>    <span class="LBRACKET">[</span><span class="STRING">&quot;  | s -&gt;&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>     <span class="STRING">&quot;    failwith (\&quot;unmatched enum: \&quot;^ s)&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_ml"><span class="LIDENT">write_ml</span></span> <span id="local_fmt_109"><span class="LIDENT">fmt</span></span> <span id="local_fields_110"><span class="LIDENT">fields</span></span> <span id="local_structures_111"><span class="LIDENT">structures</span></span> <span id="local_consts_112"><span class="LIDENT">consts</span></span> <span id="local_enums_113"><span class="LIDENT">enums</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="LIDENT">puts</span> <a href="#local_fmt_109"><span class="LIDENT">fmt</span></a><span class="RPAREN">)</span> <span class="LIDENT">mlprologue</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">write_field</span> <a href="#local_fmt_109"><span class="LIDENT">fmt</span></a> <a href="#local_fields_110"><span class="LIDENT">fields</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">write_seal</span> <a href="#local_fmt_109"><span class="LIDENT">fmt</span></a> <a href="#local_structures_111"><span class="LIDENT">structures</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">write_consts</span> <a href="#local_fmt_109"><span class="LIDENT">fmt</span></a> <a href="#local_consts_112"><span class="LIDENT">consts</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">write_enums</span> <a href="#local_fmt_109"><span class="LIDENT">fmt</span></a> <a href="#local_enums_113"><span class="LIDENT">enums</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-gen_c"><span class="LIDENT">gen_c</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_fields_114"><span class="LIDENT">fields</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_structures_115"><span class="LIDENT">structures</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_consts_116"><span class="LIDENT">consts</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="AND">and</span> <span id="local_enums_117"><span class="LIDENT">enums</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_finally_118"><span class="LIDENT">finally</span></span> <span id="local_fmt_119"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <span class="LIDENT">write_c</span> <a href="#local_fmt_119"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fmt_120"><span class="LIDENT">fmt</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                    <span class="LIDENT">write_ml</span> <a href="#local_fmt_120"><span class="LIDENT">fmt</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_fields_114"><span class="LIDENT">fields</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_structures_115"><span class="LIDENT">structures</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_consts_116"><span class="LIDENT">consts</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_enums_117"><span class="LIDENT">enums</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_m_121"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="MODULE">module</span> <span class="STRUCT">struct</span><span class="EOL">
</span>      <span class="INCLUDE">include</span> <a href="../ctypes/ctypes.ml.html"><span class="UIDENT">Ctypes</span></a><span class="EOL">
</span>      <span class="OPEN">open</span> <a href="../ctypes/ctypes_static.ml.html"><span class="UIDENT">Ctypes_static</span></a><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_field'_122"><span class="LIDENT">field'</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">a</span> <span class="LIDENT">s</span> <span class="LIDENT">r</span><span class="DOT">.</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <a href="../ctypes/ctypes_static.ml.html#type-typ"><span class="LIDENT">s</span> <span class="LIDENT">typ</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <a href="../ctypes/ctypes_static.ml.html#type-typ"><span class="LIDENT">a</span> <span class="LIDENT">typ</span></a> <span class="MINUSGREATER">-&gt;</span> <a href="../ctypes/ctypes_static.ml.html#type-field"><span class="LPAREN">(</span><span class="LIDENT">a</span><span class="COMMA">,</span> <span class="LIDENT">r</span><span class="RPAREN">)</span> <span class="LIDENT">field</span></a> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="FUN">fun</span> <span id="local_structname_123"><span class="LIDENT">structname</span></span> <span id="local_s_124"><span class="LIDENT">s</span></span> <span id="local_fname_125"><span class="LIDENT">fname</span></span> <span id="local_ftype_126"><span class="LIDENT">ftype</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="MATCH">match</span> <a href="#local_s_124"><span class="LIDENT">s</span></a> <span class="WITH">with</span> <span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Struct</span> <span class="LBRACE">{</span> <span id="local_tag_127"><span class="LIDENT">tag</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_fields_114"><span class="LIDENT">fields</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Struct</span> <span class="LPAREN">(</span><a href="#local_tag_127"><span class="LIDENT">tag</span></a><span class="COMMA">,</span> <a href="#local_structname_123"><span class="LIDENT">structname</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <a href="#local_fname_125"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_fields_114"><span class="LIDENT">fields</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LBRACE">{</span> <a href="#local_ftype_126"><span class="LIDENT">ftype</span></a><span class="SEMI">;</span> <span class="LIDENT">foffset</span> <span class="EQUAL">=</span> <span class="MINUS">-</span><span class="INT">1</span><span class="SEMI">;</span> <a href="#local_fname_125"><span class="LIDENT">fname</span></a><span class="RBRACE">}</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Union</span> <span class="LBRACE">{</span> <span id="local_utag_128"><span class="LIDENT">utag</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_fields_114"><span class="LIDENT">fields</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Union</span> <span class="LPAREN">(</span><a href="#local_utag_128"><span class="LIDENT">utag</span></a><span class="COMMA">,</span> <a href="#local_structname_123"><span class="LIDENT">structname</span></a><span class="RPAREN">)</span><span class="COMMA">,</span> <a href="#local_fname_125"><span class="LIDENT">fname</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_fields_114"><span class="LIDENT">fields</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="LBRACE">{</span> <a href="#local_ftype_126"><span class="LIDENT">ftype</span></a><span class="SEMI">;</span> <span class="LIDENT">foffset</span> <span class="EQUAL">=</span> <span class="MINUS">-</span><span class="INT">1</span><span class="SEMI">;</span> <a href="#local_fname_125"><span class="LIDENT">fname</span></a><span class="RBRACE">}</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">View</span> <span class="LBRACE">{</span> <span id="local_ty_129"><span class="LIDENT">ty</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <span class="EOL">
</span>          <a href="#local_field'_122"><span class="LIDENT">field'</span></a> <a href="#local_structname_123"><span class="LIDENT">structname</span></a> <a href="#local_ty_129"><span class="LIDENT">ty</span></a> <a href="#local_fname_125"><span class="LIDENT">fname</span></a> <a href="#local_ftype_126"><span class="LIDENT">ftype</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unsupported</span> <span class="STRING">&quot;Adding a field to non-structured type&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_field_130"><span class="LIDENT">field</span></span> <span id="local_s_131"><span class="LIDENT">s</span></span> <span id="local_fname_132"><span class="LIDENT">fname</span></span> <span id="local_ftype_133"><span class="LIDENT">ftype</span></span> <span class="EQUAL">=</span> <a href="#local_field'_122"><span class="LIDENT">field'</span></a> <span class="LPAREN">(</span><a href="../ctypes/ctypes_type_printing.ml.html#val-string_of_typ"><span class="UIDENT">Ctypes</span><span class="DOT">.</span><span class="LIDENT">string_of_typ</span></a> <a href="#local_s_131"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <a href="#local_s_131"><span class="LIDENT">s</span></a> <a href="#local_fname_132"><span class="LIDENT">fname</span></a> <a href="#local_ftype_133"><span class="LIDENT">ftype</span></a><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_seal'_134"><span class="LIDENT">seal'</span></span> <span class="COLON">:</span> <span class="TYPE">type</span> <span class="LIDENT">s</span><span class="DOT">.</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <a href="../ctypes/ctypes_static.ml.html#type-typ"><span class="LIDENT">s</span> <span class="LIDENT">typ</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="FUN">fun</span> <span id="local_structname_135"><span class="LIDENT">structname</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUNCTION">function</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Struct</span> <span class="LBRACE">{</span> <span id="local_tag_136"><span class="LIDENT">tag</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_structures_115"><span class="LIDENT">structures</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="BACKQUOTE">`</span><span class="UIDENT">Struct</span> <span class="LPAREN">(</span><a href="#local_tag_136"><span class="LIDENT">tag</span></a><span class="COMMA">,</span> <a href="#local_structname_135"><span class="LIDENT">structname</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_structures_115"><span class="LIDENT">structures</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Union</span> <span class="LBRACE">{</span> <span id="local_utag_137"><span class="LIDENT">utag</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_structures_115"><span class="LIDENT">structures</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="BACKQUOTE">`</span><span class="UIDENT">Union</span> <span class="LPAREN">(</span><a href="#local_utag_137"><span class="LIDENT">utag</span></a><span class="COMMA">,</span> <a href="#local_structname_135"><span class="LIDENT">structname</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_structures_115"><span class="LIDENT">structures</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">View</span> <span class="LBRACE">{</span> <span id="local_ty_138"><span class="LIDENT">ty</span></span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>           <a href="#local_seal'_134"><span class="LIDENT">seal'</span></a> <a href="#local_structname_135"><span class="LIDENT">structname</span></a> <a href="#local_ty_138"><span class="LIDENT">ty</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <span class="LPAREN">(</span><span class="UIDENT">Unsupported</span> <span class="STRING">&quot;Sealing a field to non-structured type&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_seal_139"><span class="LIDENT">seal</span></span> <span id="local_ty_140"><span class="LIDENT">ty</span></span> <span class="EQUAL">=</span> <a href="#local_seal'_134"><span class="LIDENT">seal'</span></a> <span class="LPAREN">(</span><a href="../ctypes/ctypes_type_printing.ml.html#val-string_of_typ"><span class="UIDENT">Ctypes</span><span class="DOT">.</span><span class="LIDENT">string_of_typ</span></a> <a href="#local_ty_140"><span class="LIDENT">ty</span></a><span class="RPAREN">)</span> <a href="#local_ty_140"><span class="LIDENT">ty</span></a><span class="EOL">
</span><span class="EOL">
</span>      <span id="def_159"><span class="TYPE">type</span> <span class="UNDERSCORE">_</span> <span class="LIDENT">const</span> <span class="EQUAL">=</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_constant_141"><span class="LIDENT">constant</span></span> <span id="local_name_142"><span class="LIDENT">name</span></span> <span id="local_ty_143"><span class="LIDENT">ty</span></span>  <span class="EQUAL">=</span> <a href="#local_consts_116"><span class="LIDENT">consts</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><a href="#local_name_142"><span class="LIDENT">name</span></a><span class="COMMA">,</span> <span class="UIDENT">Ctypes_static</span><span class="DOT">.</span><span class="UIDENT">BoxedType</span> <a href="#local_ty_143"><span class="LIDENT">ty</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_consts_116"><span class="LIDENT">consts</span></a><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_enum_144"><span class="LIDENT">enum</span></span> <span id="local_name_145"><span class="LIDENT">name</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_typedef_146"><span class="LIDENT">typedef</span></span><span class="EQUAL">=</span><span class="FALSE">false</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_unexpected_147"><span class="LIDENT">unexpected</span></span> <span id="local_alist_148"><span class="LIDENT">alist</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_enums_117"><span class="LIDENT">enums</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><a href="#local_name_145"><span class="LIDENT">name</span></a><span class="COMMA">,</span> <a href="#local_typedef_146"><span class="LIDENT">typedef</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_enums_117"><span class="LIDENT">enums</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_format_typ_149"><span class="LIDENT">format_typ</span></span> <span id="local_k_150"><span class="LIDENT">k</span></span> <span id="local_fmt_151"><span class="LIDENT">fmt</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_fmt_151"><span class="LIDENT">fmt</span></a> <span class="STRING">&quot;%s%s%t&quot;</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_typedef_146"><span class="LIDENT">typedef</span></a> <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span> <span class="ELSE">else</span> <span class="STRING">&quot;enum &quot;</span><span class="RPAREN">)</span> <a href="#local_name_145"><span class="LIDENT">name</span></a> <a href="#local_k_150"><span class="LIDENT">k</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="COMMENT">(* a dummy value of type 'a typ, mostly unusable *)</span><span class="EOL">
</span>        <a href="../ctypes/ctypes_static.ml.html#val-view"><span class="LIDENT">view</span></a> <a href="../ctypes/ctypes_static.ml.html#val-void"><span class="LIDENT">void</span></a><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_format_typ_149"><span class="LIDENT">format_typ</span></a><span class="EOL">
</span>          <span class="LABEL">~read:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="LABEL">~write:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="END">end</span> <span class="COLON">:</span> <span class="UIDENT">TYPE</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span> <span class="LPAREN">(</span><a href="#local_m_121"><span class="LIDENT">m</span></a><span class="COMMA">,</span> <a href="#local_finally_118"><span class="LIDENT">finally</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-write_c"><span class="LIDENT">write_c</span></span> <span id="local_fmt_152"><span class="LIDENT">fmt</span></span> <span class="LPAREN">(</span><span class="MODULE">module</span> <span id="local_B_153"><span class="UIDENT">B</span></span> <span class="COLON">:</span> <span class="UIDENT">BINDINGS</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="def_158"><span id="local_m_154"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span id="local_finally_155"><span class="LIDENT">finally</span></span></span> <span class="EQUAL">=</span> <span class="LIDENT">gen_c</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">M</span> <span class="EQUAL">=</span> <a href="#local_B_153"><span class="UIDENT">B</span></a><span class="LPAREN">(</span><span class="LPAREN">(</span><span class="VAL">val</span> <a href="#local_m_154"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_finally_155"><span class="LIDENT">finally</span></a> <a href="#local_fmt_152"><span class="LIDENT">fmt</span></a><span class="EOL">
</span></span></code></pre></body></html>
