<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Exn (base.base.Base.Backtrace.Exn)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../../';
let search_urls = ['../../../../sherlodoc_db.js','../../../../../sherlodoc.js'];
</script><script src="../../../../../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../../../index.html">üè†</a> &#x00BB; <a href="../../../../index.html">Base</a> &#x00BB; Library <code>base</code> &#x00BB; <a href="../../index.html">Base</a> &#x00BB; <a href="../index.html">Backtrace</a> &#x00BB; Exn</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Backtrace.Exn</span></code><a href="../../../../src/base/backtrace.ml.html#module-Exn" class="source_link">Source</a></h1><p><code>Backtrace.Exn</code> has functions for controlling and printing the backtrace of the most recently raised exception.</p><p>When an exception is raised, the runtime &quot;unwinds&quot; the stack, i.e., removes stack frames, until it reaches a frame with an exception handler. It then matches the exception against the patterns in the handler. If the exception matches, then the program continues. If not, then the runtime continues unwinding the stack to the next handler.</p><p>If <code>am_recording () = true</code>, then while the runtime is unwinding the stack, it keeps track of the part of the stack that is unwound. This is available as a backtrace via <code>most_recent ()</code>. Calling <code>most_recent</code> if <code>am_recording () = false</code> will yield the empty backtrace.</p><p>With <code>am_recording () = true</code>, OCaml keeps only a backtrace for the most recently raised exception. When one raises an exception, OCaml checks if it is physically equal to the most recently raised exception. If it is, then OCaml appends the string representation of the stack unwound by the current raise to the stored backtrace. If the exception being raised is not physically equally to the most recently raised exception, then OCaml starts recording a new backtrace. Thus one must call <code>most_recent</code> before a subsequent <code>raise</code> of a (physically) distinct exception, or the backtrace is lost.</p><p>The initial value of <code>am_recording ()</code> is determined by the environment variable OCAMLRUNPARAM. If OCAMLRUNPARAM is set and contains a &quot;b&quot; parameter, then <code>am_recording ()</code> is set according to OCAMLRUNPARAM: true if &quot;b&quot; or &quot;b=1&quot; appears; false if &quot;b=0&quot; appears. If OCAMLRUNPARAM is not set (as is always the case when running in a web browser) or does not contain a &quot;b&quot; parameter, then <code>am_recording ()</code> is initially true.</p><p>This is the same functionality as provided by the OCaml stdlib <code>Printexc</code> functions <code>backtrace_status</code>, <code>record_backtraces</code>, <code>get_backtrace</code>.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../../../index.html">Base</a><ul><li>Library <code>base</code><ul><li><a href="../../index.html">Base</a><ul><li><a href="../../Applicative/index.html">Applicative</a></li><li><a href="../../Array/index.html">Array</a></li><li><a href="../../Avltree/index.html">Avltree</a></li><li><a href="../index.html">Backtrace</a><ul><li><a href="#" class="current_unit">Exn</a></li></ul></li><li><a href="../../Binary_search/index.html">Binary_search</a></li><li><a href="../../Binary_searchable/index.html">Binary_searchable</a></li><li><a href="../../Blit/index.html">Blit</a></li><li><a href="../../Bool/index.html">Bool</a></li><li><a href="../../Buffer/index.html">Buffer</a></li><li><a href="../../Bytes/index.html">Bytes</a></li><li><a href="../../Char/index.html">Char</a></li><li><a href="../../Comparable/index.html">Comparable</a></li><li><a href="../../Comparator/index.html">Comparator</a></li><li><a href="../../Comparisons/index.html">Comparisons</a></li><li><a href="../../Container/index.html">Container</a></li><li><a href="../../Either/index.html">Either</a></li><li><a href="../../Equal/index.html">Equal</a></li><li><a href="../../Error/index.html">Error</a></li><li><a href="../../Exn/index.html">Exn</a></li><li><a href="../../Field/index.html">Field</a></li><li><a href="../../Float/index.html">Float</a></li><li><a href="../../Floatable/index.html">Floatable</a></li><li><a href="../../Fn/index.html">Fn</a></li><li><a href="../../Formatter/index.html">Formatter</a></li><li><a href="../../Hash/index.html">Hash</a></li><li><a href="../../Hash_set/index.html">Hash_set</a></li><li><a href="../../Hashable/index.html">Hashable</a></li><li><a href="../../Hasher/index.html">Hasher</a></li><li><a href="../../Hashtbl/index.html">Hashtbl</a></li><li><a href="../../Identifiable/index.html">Identifiable</a></li><li><a href="../../Indexed_container/index.html">Indexed_container</a></li><li><a href="../../Info/index.html">Info</a></li><li><a href="../../Int/index.html">Int</a></li><li><a href="../../Int_conversions/index.html">Int_conversions</a></li><li><a href="../../Int32/index.html">Int32</a></li><li><a href="../../Int63/index.html">Int63</a></li><li><a href="../../Int64/index.html">Int64</a></li><li><a href="../../Intable/index.html">Intable</a></li><li><a href="../../Int_math/index.html">Int_math</a></li><li><a href="../../Invariant/index.html">Invariant</a></li><li><a href="../../Lazy/index.html">Lazy</a></li><li><a href="../../List/index.html">List</a></li><li><a href="../../Map/index.html">Map</a></li><li><a href="../../Maybe_bound/index.html">Maybe_bound</a></li><li><a href="../../Monad/index.html">Monad</a></li><li><a href="../../Nativeint/index.html">Nativeint</a></li><li><a href="../../Nothing/index.html">Nothing</a></li><li><a href="../../Option/index.html">Option</a></li><li><a href="../../Option_array/index.html">Option_array</a></li><li><a href="../../Or_error/index.html">Or_error</a></li><li><a href="../../Ordered_collection_common/index.html">Ordered_collection_common</a></li><li><a href="../../Ordering/index.html">Ordering</a></li><li><a href="../../Poly/index.html">Poly</a></li><li><a href="../../Popcount/index.html">Popcount</a></li><li><a href="../../Pretty_printer/index.html">Pretty_printer</a></li><li><a href="../../Printf/index.html">Printf</a></li><li><a href="../../Linked_queue/index.html">Linked_queue</a></li><li><a href="../../Queue/index.html">Queue</a></li><li><a href="../../Random/index.html">Random</a></li><li><a href="../../Ref/index.html">Ref</a></li><li><a href="../../Result/index.html">Result</a></li><li><a href="../../Sequence/index.html">Sequence</a></li><li><a href="../../Set/index.html">Set</a></li><li><a href="../../Sexpable/index.html">Sexpable</a></li><li><a href="../../Sign/index.html">Sign</a></li><li><a href="../../Sign_or_nan/index.html">Sign_or_nan</a></li><li><a href="../../Source_code_position/index.html">Source_code_position</a></li><li><a href="../../Stack/index.html">Stack</a></li><li><a href="../../Staged/index.html">Staged</a></li><li><a href="../../String/index.html">String</a></li><li><a href="../../Stringable/index.html">Stringable</a></li><li><a href="../../Sys/index.html">Sys</a></li><li><a href="../../T/index.html">T</a></li><li><a href="../../Type_equal/index.html">Type_equal</a></li><li><a href="../../Uniform_array/index.html">Uniform_array</a></li><li><a href="../../Unit/index.html">Unit</a></li><li><a href="../../Uchar/index.html">Uchar</a></li><li><a href="../../Variant/index.html">Variant</a></li><li><a href="../../With_return/index.html">With_return</a></li><li><a href="../../Word_size/index.html">Word_size</a></li><li><a href="../../index.html#module-type-T">T</a></li><li><a href="../../index.html#module-type-T1">T1</a></li><li><a href="../../index.html#module-type-T2">T2</a></li><li><a href="../../index.html#module-type-T3">T3</a></li><li><a href="../../Sexp/index.html">Sexp</a></li><li><a href="../../Export/index.html">Export</a></li><li><a href="../../index.html#module-Continue_or_stop">Continue_or_stop</a></li></ul></li></ul></li><li>Library <code>base.base_internalhash_types</code><ul><li><a href="../../../../base.base_internalhash_types/Base_internalhash_types/index.html">Base_internalhash_types</a></li></ul></li><li>Library <code>base.caml</code><ul><li><a href="../../../../base.caml/Caml/index.html">Caml</a></li></ul></li><li>Library <code>base.md5</code><ul><li><a href="../../../../base.md5/Md5_lib/index.html">Md5_lib</a></li></ul></li><li>Library <code>base.shadow_stdlib</code><ul><li><a href="../../../../base.shadow_stdlib/Shadow_stdlib/index.html">Shadow_stdlib</a></li></ul></li><li><a href="../../../../src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-am_recording"><a href="#val-am_recording" class="anchor"></a><a href="../../../../src/base/backtrace.ml.html#module-Exn.val-am_recording" class="source_link">Source</a><code><span><span class="keyword">val</span> am_recording : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_recording"><a href="#val-set_recording" class="anchor"></a><a href="../../../../src/base/backtrace.ml.html#module-Exn.val-set_recording" class="source_link">Source</a><code><span><span class="keyword">val</span> set_recording : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_recording"><a href="#val-with_recording" class="anchor"></a><a href="../../../../src/base/backtrace.ml.html#module-Exn.val-with_recording" class="source_link">Source</a><code><span><span class="keyword">val</span> with_recording : <span>bool <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-most_recent"><a href="#val-most_recent" class="anchor"></a><a href="../../../../src/base/backtrace.ml.html#module-Exn.val-most_recent" class="source_link">Source</a><code><span><span class="keyword">val</span> most_recent : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-t">t</a></span></code></div><div class="spec-doc"><p><code>most_recent ()</code> returns a backtrace containing the stack that was unwound by the most recently raised exception.</p><p>Normally this includes just the function calls that lead from the exception handler being set up to the exception being raised. However, due to inlining, the stack frame that has the exception handler may correspond to a chain of multiple function calls. All of those function calls are then reported in this backtrace, even though they are not themselves on the path from the exception handler to the &quot;raise&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-most_recent_for_exn"><a href="#val-most_recent_for_exn" class="anchor"></a><a href="../../../../src/base/backtrace.ml.html#module-Exn.val-most_recent_for_exn" class="source_link">Source</a><code><span><span class="keyword">val</span> most_recent_for_exn : <span><a href="../../Exn/index.html#type-t">Exn.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p><code>most_recent_for_exn exn</code> returns a backtrace containing the stack that was unwound when raising <code>exn</code> if <code>exn</code> is the most recently raised exception. Otherwise it returns <code>None</code>.</p><p>Note that this may return a misleading backtrace instead of <code>None</code> if different raise events happen to raise physically equal exceptions. Consider the example below. Here if <code>e = Not_found</code> and <code>g</code> usees <code>Not_found</code> internally then the backtrace will correspond to the internal backtrace in <code>g</code> instead of the one used in <code>f</code>, which is not desirable.</p><pre class="language-ocaml"><code>try f () with
| e -&gt;
  g ();
  let bt = Backtrace.Exn.most_recent_for_exn e in
  ...</code></pre></div></div></div></body></html>
