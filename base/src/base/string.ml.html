<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: string.ml (base.src.base)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Base</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; base &#x00BB; string.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>string.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">Base</a><ul><li>Library <code>base</code><ul><li><a href="../../base/Base/index.html">Base</a></li></ul></li><li>Library <code>base.base_internalhash_types</code><ul><li><a href="../../base.base_internalhash_types/Base_internalhash_types/index.html">Base_internalhash_types</a></li></ul></li><li>Library <code>base.caml</code><ul><li><a href="../../base.caml/Caml/index.html">Caml</a></li></ul></li><li>Library <code>base.md5</code><ul><li><a href="../../base.md5/Md5_lib/index.html">Md5_lib</a></li></ul></li><li>Library <code>base.shadow_stdlib</code><ul><li><a href="../../base.shadow_stdlib/Shadow_stdlib/index.html">Shadow_stdlib</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>base<ul><li><a href="applicative.ml.html">applicative.ml</a></li><li><a href="applicative_intf.ml.html">applicative_intf.ml</a></li><li><a href="array.ml.html">array.ml</a></li><li><a href="array0.ml.html">array0.ml</a></li><li><a href="array_permute.ml.html">array_permute.ml</a></li><li><a href="avltree.ml.html">avltree.ml</a></li><li><a href="backtrace.ml.html">backtrace.ml</a></li><li><a href="base.ml.html">base.ml</a></li><li><a href="base__.ml.html">base__.ml</a></li><li><a href="binary_search.ml.html">binary_search.ml</a></li><li><a href="binary_searchable.ml.html">binary_searchable.ml</a></li><li><a href="binary_searchable_intf.ml.html">binary_searchable_intf.ml</a></li><li><a href="blit.ml.html">blit.ml</a></li><li><a href="blit_intf.ml.html">blit_intf.ml</a></li><li><a href="bool.ml.html">bool.ml</a></li><li><a href="bool0.ml.html">bool0.ml</a></li><li><a href="buffer.ml.html">buffer.ml</a></li><li><a href="buffer_intf.ml.html">buffer_intf.ml</a></li><li><a href="bytes.ml.html">bytes.ml</a></li><li><a href="bytes0.ml.html">bytes0.ml</a></li><li><a href="bytes_tr.ml.html">bytes_tr.ml</a></li><li><a href="char.ml.html">char.ml</a></li><li><a href="char0.ml.html">char0.ml</a></li><li><a href="comparable.ml.html">comparable.ml</a></li><li><a href="comparable_intf.ml.html">comparable_intf.ml</a></li><li><a href="comparator.ml.html">comparator.ml</a></li><li><a href="comparisons.ml.html">comparisons.ml</a></li><li><a href="container.ml.html">container.ml</a></li><li><a href="container_intf.ml.html">container_intf.ml</a></li><li><a href="either.ml.html">either.ml</a></li><li><a href="either0.ml.html">either0.ml</a></li><li><a href="either_intf.ml.html">either_intf.ml</a></li><li><a href="equal.ml.html">equal.ml</a></li><li><a href="error.ml.html">error.ml</a></li><li><a href="exn.ml.html">exn.ml</a></li><li><a href="field.ml.html">field.ml</a></li><li><a href="fieldslib.ml.html">fieldslib.ml</a></li><li><a href="float.ml.html">float.ml</a></li><li><a href="float0.ml.html">float0.ml</a></li><li><a href="floatable.ml.html">floatable.ml</a></li><li><a href="fn.ml.html">fn.ml</a></li><li><a href="formatter.ml.html">formatter.ml</a></li><li><a href="globalize.ml.html">globalize.ml</a></li><li><a href="hash.ml.html">hash.ml</a></li><li><a href="hash_intf.ml.html">hash_intf.ml</a></li><li><a href="hash_set.ml.html">hash_set.ml</a></li><li><a href="hash_set_intf.ml.html">hash_set_intf.ml</a></li><li><a href="hashable.ml.html">hashable.ml</a></li><li><a href="hashable_intf.ml.html">hashable_intf.ml</a></li><li><a href="hasher.ml.html">hasher.ml</a></li><li><a href="hashtbl.ml.html">hashtbl.ml</a></li><li><a href="hashtbl_intf.ml.html">hashtbl_intf.ml</a></li><li><a href="hex_lexer.ml.html">hex_lexer.ml</a></li><li><a href="identifiable.ml.html">identifiable.ml</a></li><li><a href="identifiable_intf.ml.html">identifiable_intf.ml</a></li><li><a href="import.ml.html">import.ml</a></li><li><a href="import0.ml.html">import0.ml</a></li><li><a href="indexed_container.ml.html">indexed_container.ml</a></li><li><a href="indexed_container_intf.ml.html">indexed_container_intf.ml</a></li><li><a href="info.ml.html">info.ml</a></li><li><a href="info_intf.ml.html">info_intf.ml</a></li><li><a href="int.ml.html">int.ml</a></li><li><a href="int0.ml.html">int0.ml</a></li><li><a href="int32.ml.html">int32.ml</a></li><li><a href="int63.ml.html">int63.ml</a></li><li><a href="int63_emul.ml.html">int63_emul.ml</a></li><li><a href="int64.ml.html">int64.ml</a></li><li><a href="int_conversions.ml.html">int_conversions.ml</a></li><li><a href="int_intf.ml.html">int_intf.ml</a></li><li><a href="int_math.ml.html">int_math.ml</a></li><li><a href="intable.ml.html">intable.ml</a></li><li><a href="invariant.ml.html">invariant.ml</a></li><li><a href="invariant_intf.ml.html">invariant_intf.ml</a></li><li><a href="lazy.ml.html">lazy.ml</a></li><li><a href="linked_queue.ml.html">linked_queue.ml</a></li><li><a href="linked_queue0.ml.html">linked_queue0.ml</a></li><li><a href="list.ml.html">list.ml</a></li><li><a href="list0.ml.html">list0.ml</a></li><li><a href="list1.ml.html">list1.ml</a></li><li><a href="map.ml.html">map.ml</a></li><li><a href="map_intf.ml.html">map_intf.ml</a></li><li><a href="maybe_bound.ml.html">maybe_bound.ml</a></li><li><a href="monad.ml.html">monad.ml</a></li><li><a href="monad_intf.ml.html">monad_intf.ml</a></li><li><a href="nativeint.ml.html">nativeint.ml</a></li><li><a href="nothing.ml.html">nothing.ml</a></li><li><a href="obj_array.ml.html">obj_array.ml</a></li><li><a href="obj_local.ml.html">obj_local.ml</a></li><li><a href="option.ml.html">option.ml</a></li><li><a href="option_array.ml.html">option_array.ml</a></li><li><a href="or_error.ml.html">or_error.ml</a></li><li><a href="ordered_collection_common.ml.html">ordered_collection_common.ml</a></li><li><a href="ordered_collection_common0.ml.html">ordered_collection_common0.ml</a></li><li><a href="ordering.ml.html">ordering.ml</a></li><li><a href="poly0.ml.html">poly0.ml</a></li><li><a href="popcount.ml.html">popcount.ml</a></li><li><a href="pow_overflow_bounds.ml.html">pow_overflow_bounds.ml</a></li><li><a href="ppx_compare_lib.ml.html">ppx_compare_lib.ml</a></li><li><a href="ppx_enumerate_lib.ml.html">ppx_enumerate_lib.ml</a></li><li><a href="ppx_hash_lib.ml.html">ppx_hash_lib.ml</a></li><li><a href="pretty_printer.ml.html">pretty_printer.ml</a></li><li><a href="printf.ml.html">printf.ml</a></li><li><a href="queue.ml.html">queue.ml</a></li><li><a href="queue_intf.ml.html">queue_intf.ml</a></li><li><a href="random.ml.html">random.ml</a></li><li><a href="random_repr.ml.html">random_repr.ml</a></li><li><a href="ref.ml.html">ref.ml</a></li><li><a href="result.ml.html">result.ml</a></li><li><a href="sequence.ml.html">sequence.ml</a></li><li><a href="set.ml.html">set.ml</a></li><li><a href="set_intf.ml.html">set_intf.ml</a></li><li><a href="sexp.ml.html">sexp.ml</a></li><li><a href="sexp_with_comparable.ml.html">sexp_with_comparable.ml</a></li><li><a href="sexpable.ml.html">sexpable.ml</a></li><li><a href="sign.ml.html">sign.ml</a></li><li><a href="sign0.ml.html">sign0.ml</a></li><li><a href="sign_or_nan.ml.html">sign_or_nan.ml</a></li><li><a href="source_code_position.ml.html">source_code_position.ml</a></li><li><a href="source_code_position0.ml.html">source_code_position0.ml</a></li><li><a href="stack.ml.html">stack.ml</a></li><li><a href="stack_intf.ml.html">stack_intf.ml</a></li><li><a href="staged.ml.html">staged.ml</a></li><li><a href="#" class="current_unit">string.ml</a></li><li><a href="string0.ml.html">string0.ml</a></li><li><a href="stringable.ml.html">stringable.ml</a></li><li><a href="sys.ml.html">sys.ml</a></li><li><a href="sys0.ml.html">sys0.ml</a></li><li><a href="t.ml.html">t.ml</a></li><li><a href="type_equal.ml.html">type_equal.ml</a></li><li><a href="uchar.ml.html">uchar.ml</a></li><li><a href="uchar0.ml.html">uchar0.ml</a></li><li><a href="uniform_array.ml.html">uniform_array.ml</a></li><li><a href="unit.ml.html">unit.ml</a></li><li><a href="variant.ml.html">variant.ml</a></li><li><a href="variantslib.ml.html">variantslib.ml</a></li><li><a href="with_return.ml.html">with_return.ml</a></li><li><a href="word_size.ml.html">word_size.ml</a></li></ul></li><li>base.base_internalhash_types<ul><li><a href="../base.base_internalhash_types/base_internalhash_types.ml.html">base_internalhash_types.ml</a></li></ul></li><li>base.caml<ul><li><a href="../base.caml/caml.ml.html">caml.ml</a></li></ul></li><li>base.md5<ul><li><a href="../base.md5/md5_lib.ml.html">md5_lib.ml</a></li></ul></li><li>base.shadow_stdlib<ul><li><a href="../base.shadow_stdlib/shadow_stdlib.ml.html">shadow_stdlib.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
<a id="L445" class="source_line" href="#L445">445</a>
<a id="L446" class="source_line" href="#L446">446</a>
<a id="L447" class="source_line" href="#L447">447</a>
<a id="L448" class="source_line" href="#L448">448</a>
<a id="L449" class="source_line" href="#L449">449</a>
<a id="L450" class="source_line" href="#L450">450</a>
<a id="L451" class="source_line" href="#L451">451</a>
<a id="L452" class="source_line" href="#L452">452</a>
<a id="L453" class="source_line" href="#L453">453</a>
<a id="L454" class="source_line" href="#L454">454</a>
<a id="L455" class="source_line" href="#L455">455</a>
<a id="L456" class="source_line" href="#L456">456</a>
<a id="L457" class="source_line" href="#L457">457</a>
<a id="L458" class="source_line" href="#L458">458</a>
<a id="L459" class="source_line" href="#L459">459</a>
<a id="L460" class="source_line" href="#L460">460</a>
<a id="L461" class="source_line" href="#L461">461</a>
<a id="L462" class="source_line" href="#L462">462</a>
<a id="L463" class="source_line" href="#L463">463</a>
<a id="L464" class="source_line" href="#L464">464</a>
<a id="L465" class="source_line" href="#L465">465</a>
<a id="L466" class="source_line" href="#L466">466</a>
<a id="L467" class="source_line" href="#L467">467</a>
<a id="L468" class="source_line" href="#L468">468</a>
<a id="L469" class="source_line" href="#L469">469</a>
<a id="L470" class="source_line" href="#L470">470</a>
<a id="L471" class="source_line" href="#L471">471</a>
<a id="L472" class="source_line" href="#L472">472</a>
<a id="L473" class="source_line" href="#L473">473</a>
<a id="L474" class="source_line" href="#L474">474</a>
<a id="L475" class="source_line" href="#L475">475</a>
<a id="L476" class="source_line" href="#L476">476</a>
<a id="L477" class="source_line" href="#L477">477</a>
<a id="L478" class="source_line" href="#L478">478</a>
<a id="L479" class="source_line" href="#L479">479</a>
<a id="L480" class="source_line" href="#L480">480</a>
<a id="L481" class="source_line" href="#L481">481</a>
<a id="L482" class="source_line" href="#L482">482</a>
<a id="L483" class="source_line" href="#L483">483</a>
<a id="L484" class="source_line" href="#L484">484</a>
<a id="L485" class="source_line" href="#L485">485</a>
<a id="L486" class="source_line" href="#L486">486</a>
<a id="L487" class="source_line" href="#L487">487</a>
<a id="L488" class="source_line" href="#L488">488</a>
<a id="L489" class="source_line" href="#L489">489</a>
<a id="L490" class="source_line" href="#L490">490</a>
<a id="L491" class="source_line" href="#L491">491</a>
<a id="L492" class="source_line" href="#L492">492</a>
<a id="L493" class="source_line" href="#L493">493</a>
<a id="L494" class="source_line" href="#L494">494</a>
<a id="L495" class="source_line" href="#L495">495</a>
<a id="L496" class="source_line" href="#L496">496</a>
<a id="L497" class="source_line" href="#L497">497</a>
<a id="L498" class="source_line" href="#L498">498</a>
<a id="L499" class="source_line" href="#L499">499</a>
<a id="L500" class="source_line" href="#L500">500</a>
<a id="L501" class="source_line" href="#L501">501</a>
<a id="L502" class="source_line" href="#L502">502</a>
<a id="L503" class="source_line" href="#L503">503</a>
<a id="L504" class="source_line" href="#L504">504</a>
<a id="L505" class="source_line" href="#L505">505</a>
<a id="L506" class="source_line" href="#L506">506</a>
<a id="L507" class="source_line" href="#L507">507</a>
<a id="L508" class="source_line" href="#L508">508</a>
<a id="L509" class="source_line" href="#L509">509</a>
<a id="L510" class="source_line" href="#L510">510</a>
<a id="L511" class="source_line" href="#L511">511</a>
<a id="L512" class="source_line" href="#L512">512</a>
<a id="L513" class="source_line" href="#L513">513</a>
<a id="L514" class="source_line" href="#L514">514</a>
<a id="L515" class="source_line" href="#L515">515</a>
<a id="L516" class="source_line" href="#L516">516</a>
<a id="L517" class="source_line" href="#L517">517</a>
<a id="L518" class="source_line" href="#L518">518</a>
<a id="L519" class="source_line" href="#L519">519</a>
<a id="L520" class="source_line" href="#L520">520</a>
<a id="L521" class="source_line" href="#L521">521</a>
<a id="L522" class="source_line" href="#L522">522</a>
<a id="L523" class="source_line" href="#L523">523</a>
<a id="L524" class="source_line" href="#L524">524</a>
<a id="L525" class="source_line" href="#L525">525</a>
<a id="L526" class="source_line" href="#L526">526</a>
<a id="L527" class="source_line" href="#L527">527</a>
<a id="L528" class="source_line" href="#L528">528</a>
<a id="L529" class="source_line" href="#L529">529</a>
<a id="L530" class="source_line" href="#L530">530</a>
<a id="L531" class="source_line" href="#L531">531</a>
<a id="L532" class="source_line" href="#L532">532</a>
<a id="L533" class="source_line" href="#L533">533</a>
<a id="L534" class="source_line" href="#L534">534</a>
<a id="L535" class="source_line" href="#L535">535</a>
<a id="L536" class="source_line" href="#L536">536</a>
<a id="L537" class="source_line" href="#L537">537</a>
<a id="L538" class="source_line" href="#L538">538</a>
<a id="L539" class="source_line" href="#L539">539</a>
<a id="L540" class="source_line" href="#L540">540</a>
<a id="L541" class="source_line" href="#L541">541</a>
<a id="L542" class="source_line" href="#L542">542</a>
<a id="L543" class="source_line" href="#L543">543</a>
<a id="L544" class="source_line" href="#L544">544</a>
<a id="L545" class="source_line" href="#L545">545</a>
<a id="L546" class="source_line" href="#L546">546</a>
<a id="L547" class="source_line" href="#L547">547</a>
<a id="L548" class="source_line" href="#L548">548</a>
<a id="L549" class="source_line" href="#L549">549</a>
<a id="L550" class="source_line" href="#L550">550</a>
<a id="L551" class="source_line" href="#L551">551</a>
<a id="L552" class="source_line" href="#L552">552</a>
<a id="L553" class="source_line" href="#L553">553</a>
<a id="L554" class="source_line" href="#L554">554</a>
<a id="L555" class="source_line" href="#L555">555</a>
<a id="L556" class="source_line" href="#L556">556</a>
<a id="L557" class="source_line" href="#L557">557</a>
<a id="L558" class="source_line" href="#L558">558</a>
<a id="L559" class="source_line" href="#L559">559</a>
<a id="L560" class="source_line" href="#L560">560</a>
<a id="L561" class="source_line" href="#L561">561</a>
<a id="L562" class="source_line" href="#L562">562</a>
<a id="L563" class="source_line" href="#L563">563</a>
<a id="L564" class="source_line" href="#L564">564</a>
<a id="L565" class="source_line" href="#L565">565</a>
<a id="L566" class="source_line" href="#L566">566</a>
<a id="L567" class="source_line" href="#L567">567</a>
<a id="L568" class="source_line" href="#L568">568</a>
<a id="L569" class="source_line" href="#L569">569</a>
<a id="L570" class="source_line" href="#L570">570</a>
<a id="L571" class="source_line" href="#L571">571</a>
<a id="L572" class="source_line" href="#L572">572</a>
<a id="L573" class="source_line" href="#L573">573</a>
<a id="L574" class="source_line" href="#L574">574</a>
<a id="L575" class="source_line" href="#L575">575</a>
<a id="L576" class="source_line" href="#L576">576</a>
<a id="L577" class="source_line" href="#L577">577</a>
<a id="L578" class="source_line" href="#L578">578</a>
<a id="L579" class="source_line" href="#L579">579</a>
<a id="L580" class="source_line" href="#L580">580</a>
<a id="L581" class="source_line" href="#L581">581</a>
<a id="L582" class="source_line" href="#L582">582</a>
<a id="L583" class="source_line" href="#L583">583</a>
<a id="L584" class="source_line" href="#L584">584</a>
<a id="L585" class="source_line" href="#L585">585</a>
<a id="L586" class="source_line" href="#L586">586</a>
<a id="L587" class="source_line" href="#L587">587</a>
<a id="L588" class="source_line" href="#L588">588</a>
<a id="L589" class="source_line" href="#L589">589</a>
<a id="L590" class="source_line" href="#L590">590</a>
<a id="L591" class="source_line" href="#L591">591</a>
<a id="L592" class="source_line" href="#L592">592</a>
<a id="L593" class="source_line" href="#L593">593</a>
<a id="L594" class="source_line" href="#L594">594</a>
<a id="L595" class="source_line" href="#L595">595</a>
<a id="L596" class="source_line" href="#L596">596</a>
<a id="L597" class="source_line" href="#L597">597</a>
<a id="L598" class="source_line" href="#L598">598</a>
<a id="L599" class="source_line" href="#L599">599</a>
<a id="L600" class="source_line" href="#L600">600</a>
<a id="L601" class="source_line" href="#L601">601</a>
<a id="L602" class="source_line" href="#L602">602</a>
<a id="L603" class="source_line" href="#L603">603</a>
<a id="L604" class="source_line" href="#L604">604</a>
<a id="L605" class="source_line" href="#L605">605</a>
<a id="L606" class="source_line" href="#L606">606</a>
<a id="L607" class="source_line" href="#L607">607</a>
<a id="L608" class="source_line" href="#L608">608</a>
<a id="L609" class="source_line" href="#L609">609</a>
<a id="L610" class="source_line" href="#L610">610</a>
<a id="L611" class="source_line" href="#L611">611</a>
<a id="L612" class="source_line" href="#L612">612</a>
<a id="L613" class="source_line" href="#L613">613</a>
<a id="L614" class="source_line" href="#L614">614</a>
<a id="L615" class="source_line" href="#L615">615</a>
<a id="L616" class="source_line" href="#L616">616</a>
<a id="L617" class="source_line" href="#L617">617</a>
<a id="L618" class="source_line" href="#L618">618</a>
<a id="L619" class="source_line" href="#L619">619</a>
<a id="L620" class="source_line" href="#L620">620</a>
<a id="L621" class="source_line" href="#L621">621</a>
<a id="L622" class="source_line" href="#L622">622</a>
<a id="L623" class="source_line" href="#L623">623</a>
<a id="L624" class="source_line" href="#L624">624</a>
<a id="L625" class="source_line" href="#L625">625</a>
<a id="L626" class="source_line" href="#L626">626</a>
<a id="L627" class="source_line" href="#L627">627</a>
<a id="L628" class="source_line" href="#L628">628</a>
<a id="L629" class="source_line" href="#L629">629</a>
<a id="L630" class="source_line" href="#L630">630</a>
<a id="L631" class="source_line" href="#L631">631</a>
<a id="L632" class="source_line" href="#L632">632</a>
<a id="L633" class="source_line" href="#L633">633</a>
<a id="L634" class="source_line" href="#L634">634</a>
<a id="L635" class="source_line" href="#L635">635</a>
<a id="L636" class="source_line" href="#L636">636</a>
<a id="L637" class="source_line" href="#L637">637</a>
<a id="L638" class="source_line" href="#L638">638</a>
<a id="L639" class="source_line" href="#L639">639</a>
<a id="L640" class="source_line" href="#L640">640</a>
<a id="L641" class="source_line" href="#L641">641</a>
<a id="L642" class="source_line" href="#L642">642</a>
<a id="L643" class="source_line" href="#L643">643</a>
<a id="L644" class="source_line" href="#L644">644</a>
<a id="L645" class="source_line" href="#L645">645</a>
<a id="L646" class="source_line" href="#L646">646</a>
<a id="L647" class="source_line" href="#L647">647</a>
<a id="L648" class="source_line" href="#L648">648</a>
<a id="L649" class="source_line" href="#L649">649</a>
<a id="L650" class="source_line" href="#L650">650</a>
<a id="L651" class="source_line" href="#L651">651</a>
<a id="L652" class="source_line" href="#L652">652</a>
<a id="L653" class="source_line" href="#L653">653</a>
<a id="L654" class="source_line" href="#L654">654</a>
<a id="L655" class="source_line" href="#L655">655</a>
<a id="L656" class="source_line" href="#L656">656</a>
<a id="L657" class="source_line" href="#L657">657</a>
<a id="L658" class="source_line" href="#L658">658</a>
<a id="L659" class="source_line" href="#L659">659</a>
<a id="L660" class="source_line" href="#L660">660</a>
<a id="L661" class="source_line" href="#L661">661</a>
<a id="L662" class="source_line" href="#L662">662</a>
<a id="L663" class="source_line" href="#L663">663</a>
<a id="L664" class="source_line" href="#L664">664</a>
<a id="L665" class="source_line" href="#L665">665</a>
<a id="L666" class="source_line" href="#L666">666</a>
<a id="L667" class="source_line" href="#L667">667</a>
<a id="L668" class="source_line" href="#L668">668</a>
<a id="L669" class="source_line" href="#L669">669</a>
<a id="L670" class="source_line" href="#L670">670</a>
<a id="L671" class="source_line" href="#L671">671</a>
<a id="L672" class="source_line" href="#L672">672</a>
<a id="L673" class="source_line" href="#L673">673</a>
<a id="L674" class="source_line" href="#L674">674</a>
<a id="L675" class="source_line" href="#L675">675</a>
<a id="L676" class="source_line" href="#L676">676</a>
<a id="L677" class="source_line" href="#L677">677</a>
<a id="L678" class="source_line" href="#L678">678</a>
<a id="L679" class="source_line" href="#L679">679</a>
<a id="L680" class="source_line" href="#L680">680</a>
<a id="L681" class="source_line" href="#L681">681</a>
<a id="L682" class="source_line" href="#L682">682</a>
<a id="L683" class="source_line" href="#L683">683</a>
<a id="L684" class="source_line" href="#L684">684</a>
<a id="L685" class="source_line" href="#L685">685</a>
<a id="L686" class="source_line" href="#L686">686</a>
<a id="L687" class="source_line" href="#L687">687</a>
<a id="L688" class="source_line" href="#L688">688</a>
<a id="L689" class="source_line" href="#L689">689</a>
<a id="L690" class="source_line" href="#L690">690</a>
<a id="L691" class="source_line" href="#L691">691</a>
<a id="L692" class="source_line" href="#L692">692</a>
<a id="L693" class="source_line" href="#L693">693</a>
<a id="L694" class="source_line" href="#L694">694</a>
<a id="L695" class="source_line" href="#L695">695</a>
<a id="L696" class="source_line" href="#L696">696</a>
<a id="L697" class="source_line" href="#L697">697</a>
<a id="L698" class="source_line" href="#L698">698</a>
<a id="L699" class="source_line" href="#L699">699</a>
<a id="L700" class="source_line" href="#L700">700</a>
<a id="L701" class="source_line" href="#L701">701</a>
<a id="L702" class="source_line" href="#L702">702</a>
<a id="L703" class="source_line" href="#L703">703</a>
<a id="L704" class="source_line" href="#L704">704</a>
<a id="L705" class="source_line" href="#L705">705</a>
<a id="L706" class="source_line" href="#L706">706</a>
<a id="L707" class="source_line" href="#L707">707</a>
<a id="L708" class="source_line" href="#L708">708</a>
<a id="L709" class="source_line" href="#L709">709</a>
<a id="L710" class="source_line" href="#L710">710</a>
<a id="L711" class="source_line" href="#L711">711</a>
<a id="L712" class="source_line" href="#L712">712</a>
<a id="L713" class="source_line" href="#L713">713</a>
<a id="L714" class="source_line" href="#L714">714</a>
<a id="L715" class="source_line" href="#L715">715</a>
<a id="L716" class="source_line" href="#L716">716</a>
<a id="L717" class="source_line" href="#L717">717</a>
<a id="L718" class="source_line" href="#L718">718</a>
<a id="L719" class="source_line" href="#L719">719</a>
<a id="L720" class="source_line" href="#L720">720</a>
<a id="L721" class="source_line" href="#L721">721</a>
<a id="L722" class="source_line" href="#L722">722</a>
<a id="L723" class="source_line" href="#L723">723</a>
<a id="L724" class="source_line" href="#L724">724</a>
<a id="L725" class="source_line" href="#L725">725</a>
<a id="L726" class="source_line" href="#L726">726</a>
<a id="L727" class="source_line" href="#L727">727</a>
<a id="L728" class="source_line" href="#L728">728</a>
<a id="L729" class="source_line" href="#L729">729</a>
<a id="L730" class="source_line" href="#L730">730</a>
<a id="L731" class="source_line" href="#L731">731</a>
<a id="L732" class="source_line" href="#L732">732</a>
<a id="L733" class="source_line" href="#L733">733</a>
<a id="L734" class="source_line" href="#L734">734</a>
<a id="L735" class="source_line" href="#L735">735</a>
<a id="L736" class="source_line" href="#L736">736</a>
<a id="L737" class="source_line" href="#L737">737</a>
<a id="L738" class="source_line" href="#L738">738</a>
<a id="L739" class="source_line" href="#L739">739</a>
<a id="L740" class="source_line" href="#L740">740</a>
<a id="L741" class="source_line" href="#L741">741</a>
<a id="L742" class="source_line" href="#L742">742</a>
<a id="L743" class="source_line" href="#L743">743</a>
<a id="L744" class="source_line" href="#L744">744</a>
<a id="L745" class="source_line" href="#L745">745</a>
<a id="L746" class="source_line" href="#L746">746</a>
<a id="L747" class="source_line" href="#L747">747</a>
<a id="L748" class="source_line" href="#L748">748</a>
<a id="L749" class="source_line" href="#L749">749</a>
<a id="L750" class="source_line" href="#L750">750</a>
<a id="L751" class="source_line" href="#L751">751</a>
<a id="L752" class="source_line" href="#L752">752</a>
<a id="L753" class="source_line" href="#L753">753</a>
<a id="L754" class="source_line" href="#L754">754</a>
<a id="L755" class="source_line" href="#L755">755</a>
<a id="L756" class="source_line" href="#L756">756</a>
<a id="L757" class="source_line" href="#L757">757</a>
<a id="L758" class="source_line" href="#L758">758</a>
<a id="L759" class="source_line" href="#L759">759</a>
<a id="L760" class="source_line" href="#L760">760</a>
<a id="L761" class="source_line" href="#L761">761</a>
<a id="L762" class="source_line" href="#L762">762</a>
<a id="L763" class="source_line" href="#L763">763</a>
<a id="L764" class="source_line" href="#L764">764</a>
<a id="L765" class="source_line" href="#L765">765</a>
<a id="L766" class="source_line" href="#L766">766</a>
<a id="L767" class="source_line" href="#L767">767</a>
<a id="L768" class="source_line" href="#L768">768</a>
<a id="L769" class="source_line" href="#L769">769</a>
<a id="L770" class="source_line" href="#L770">770</a>
<a id="L771" class="source_line" href="#L771">771</a>
<a id="L772" class="source_line" href="#L772">772</a>
<a id="L773" class="source_line" href="#L773">773</a>
<a id="L774" class="source_line" href="#L774">774</a>
<a id="L775" class="source_line" href="#L775">775</a>
<a id="L776" class="source_line" href="#L776">776</a>
<a id="L777" class="source_line" href="#L777">777</a>
<a id="L778" class="source_line" href="#L778">778</a>
<a id="L779" class="source_line" href="#L779">779</a>
<a id="L780" class="source_line" href="#L780">780</a>
<a id="L781" class="source_line" href="#L781">781</a>
<a id="L782" class="source_line" href="#L782">782</a>
<a id="L783" class="source_line" href="#L783">783</a>
<a id="L784" class="source_line" href="#L784">784</a>
<a id="L785" class="source_line" href="#L785">785</a>
<a id="L786" class="source_line" href="#L786">786</a>
<a id="L787" class="source_line" href="#L787">787</a>
<a id="L788" class="source_line" href="#L788">788</a>
<a id="L789" class="source_line" href="#L789">789</a>
<a id="L790" class="source_line" href="#L790">790</a>
<a id="L791" class="source_line" href="#L791">791</a>
<a id="L792" class="source_line" href="#L792">792</a>
<a id="L793" class="source_line" href="#L793">793</a>
<a id="L794" class="source_line" href="#L794">794</a>
<a id="L795" class="source_line" href="#L795">795</a>
<a id="L796" class="source_line" href="#L796">796</a>
<a id="L797" class="source_line" href="#L797">797</a>
<a id="L798" class="source_line" href="#L798">798</a>
<a id="L799" class="source_line" href="#L799">799</a>
<a id="L800" class="source_line" href="#L800">800</a>
<a id="L801" class="source_line" href="#L801">801</a>
<a id="L802" class="source_line" href="#L802">802</a>
<a id="L803" class="source_line" href="#L803">803</a>
<a id="L804" class="source_line" href="#L804">804</a>
<a id="L805" class="source_line" href="#L805">805</a>
<a id="L806" class="source_line" href="#L806">806</a>
<a id="L807" class="source_line" href="#L807">807</a>
<a id="L808" class="source_line" href="#L808">808</a>
<a id="L809" class="source_line" href="#L809">809</a>
<a id="L810" class="source_line" href="#L810">810</a>
<a id="L811" class="source_line" href="#L811">811</a>
<a id="L812" class="source_line" href="#L812">812</a>
<a id="L813" class="source_line" href="#L813">813</a>
<a id="L814" class="source_line" href="#L814">814</a>
<a id="L815" class="source_line" href="#L815">815</a>
<a id="L816" class="source_line" href="#L816">816</a>
<a id="L817" class="source_line" href="#L817">817</a>
<a id="L818" class="source_line" href="#L818">818</a>
<a id="L819" class="source_line" href="#L819">819</a>
<a id="L820" class="source_line" href="#L820">820</a>
<a id="L821" class="source_line" href="#L821">821</a>
<a id="L822" class="source_line" href="#L822">822</a>
<a id="L823" class="source_line" href="#L823">823</a>
<a id="L824" class="source_line" href="#L824">824</a>
<a id="L825" class="source_line" href="#L825">825</a>
<a id="L826" class="source_line" href="#L826">826</a>
<a id="L827" class="source_line" href="#L827">827</a>
<a id="L828" class="source_line" href="#L828">828</a>
<a id="L829" class="source_line" href="#L829">829</a>
<a id="L830" class="source_line" href="#L830">830</a>
<a id="L831" class="source_line" href="#L831">831</a>
<a id="L832" class="source_line" href="#L832">832</a>
<a id="L833" class="source_line" href="#L833">833</a>
<a id="L834" class="source_line" href="#L834">834</a>
<a id="L835" class="source_line" href="#L835">835</a>
<a id="L836" class="source_line" href="#L836">836</a>
<a id="L837" class="source_line" href="#L837">837</a>
<a id="L838" class="source_line" href="#L838">838</a>
<a id="L839" class="source_line" href="#L839">839</a>
<a id="L840" class="source_line" href="#L840">840</a>
<a id="L841" class="source_line" href="#L841">841</a>
<a id="L842" class="source_line" href="#L842">842</a>
<a id="L843" class="source_line" href="#L843">843</a>
<a id="L844" class="source_line" href="#L844">844</a>
<a id="L845" class="source_line" href="#L845">845</a>
<a id="L846" class="source_line" href="#L846">846</a>
<a id="L847" class="source_line" href="#L847">847</a>
<a id="L848" class="source_line" href="#L848">848</a>
<a id="L849" class="source_line" href="#L849">849</a>
<a id="L850" class="source_line" href="#L850">850</a>
<a id="L851" class="source_line" href="#L851">851</a>
<a id="L852" class="source_line" href="#L852">852</a>
<a id="L853" class="source_line" href="#L853">853</a>
<a id="L854" class="source_line" href="#L854">854</a>
<a id="L855" class="source_line" href="#L855">855</a>
<a id="L856" class="source_line" href="#L856">856</a>
<a id="L857" class="source_line" href="#L857">857</a>
<a id="L858" class="source_line" href="#L858">858</a>
<a id="L859" class="source_line" href="#L859">859</a>
<a id="L860" class="source_line" href="#L860">860</a>
<a id="L861" class="source_line" href="#L861">861</a>
<a id="L862" class="source_line" href="#L862">862</a>
<a id="L863" class="source_line" href="#L863">863</a>
<a id="L864" class="source_line" href="#L864">864</a>
<a id="L865" class="source_line" href="#L865">865</a>
<a id="L866" class="source_line" href="#L866">866</a>
<a id="L867" class="source_line" href="#L867">867</a>
<a id="L868" class="source_line" href="#L868">868</a>
<a id="L869" class="source_line" href="#L869">869</a>
<a id="L870" class="source_line" href="#L870">870</a>
<a id="L871" class="source_line" href="#L871">871</a>
<a id="L872" class="source_line" href="#L872">872</a>
<a id="L873" class="source_line" href="#L873">873</a>
<a id="L874" class="source_line" href="#L874">874</a>
<a id="L875" class="source_line" href="#L875">875</a>
<a id="L876" class="source_line" href="#L876">876</a>
<a id="L877" class="source_line" href="#L877">877</a>
<a id="L878" class="source_line" href="#L878">878</a>
<a id="L879" class="source_line" href="#L879">879</a>
<a id="L880" class="source_line" href="#L880">880</a>
<a id="L881" class="source_line" href="#L881">881</a>
<a id="L882" class="source_line" href="#L882">882</a>
<a id="L883" class="source_line" href="#L883">883</a>
<a id="L884" class="source_line" href="#L884">884</a>
<a id="L885" class="source_line" href="#L885">885</a>
<a id="L886" class="source_line" href="#L886">886</a>
<a id="L887" class="source_line" href="#L887">887</a>
<a id="L888" class="source_line" href="#L888">888</a>
<a id="L889" class="source_line" href="#L889">889</a>
<a id="L890" class="source_line" href="#L890">890</a>
<a id="L891" class="source_line" href="#L891">891</a>
<a id="L892" class="source_line" href="#L892">892</a>
<a id="L893" class="source_line" href="#L893">893</a>
<a id="L894" class="source_line" href="#L894">894</a>
<a id="L895" class="source_line" href="#L895">895</a>
<a id="L896" class="source_line" href="#L896">896</a>
<a id="L897" class="source_line" href="#L897">897</a>
<a id="L898" class="source_line" href="#L898">898</a>
<a id="L899" class="source_line" href="#L899">899</a>
<a id="L900" class="source_line" href="#L900">900</a>
<a id="L901" class="source_line" href="#L901">901</a>
<a id="L902" class="source_line" href="#L902">902</a>
<a id="L903" class="source_line" href="#L903">903</a>
<a id="L904" class="source_line" href="#L904">904</a>
<a id="L905" class="source_line" href="#L905">905</a>
<a id="L906" class="source_line" href="#L906">906</a>
<a id="L907" class="source_line" href="#L907">907</a>
<a id="L908" class="source_line" href="#L908">908</a>
<a id="L909" class="source_line" href="#L909">909</a>
<a id="L910" class="source_line" href="#L910">910</a>
<a id="L911" class="source_line" href="#L911">911</a>
<a id="L912" class="source_line" href="#L912">912</a>
<a id="L913" class="source_line" href="#L913">913</a>
<a id="L914" class="source_line" href="#L914">914</a>
<a id="L915" class="source_line" href="#L915">915</a>
<a id="L916" class="source_line" href="#L916">916</a>
<a id="L917" class="source_line" href="#L917">917</a>
<a id="L918" class="source_line" href="#L918">918</a>
<a id="L919" class="source_line" href="#L919">919</a>
<a id="L920" class="source_line" href="#L920">920</a>
<a id="L921" class="source_line" href="#L921">921</a>
<a id="L922" class="source_line" href="#L922">922</a>
<a id="L923" class="source_line" href="#L923">923</a>
<a id="L924" class="source_line" href="#L924">924</a>
<a id="L925" class="source_line" href="#L925">925</a>
<a id="L926" class="source_line" href="#L926">926</a>
<a id="L927" class="source_line" href="#L927">927</a>
<a id="L928" class="source_line" href="#L928">928</a>
<a id="L929" class="source_line" href="#L929">929</a>
<a id="L930" class="source_line" href="#L930">930</a>
<a id="L931" class="source_line" href="#L931">931</a>
<a id="L932" class="source_line" href="#L932">932</a>
<a id="L933" class="source_line" href="#L933">933</a>
<a id="L934" class="source_line" href="#L934">934</a>
<a id="L935" class="source_line" href="#L935">935</a>
<a id="L936" class="source_line" href="#L936">936</a>
<a id="L937" class="source_line" href="#L937">937</a>
<a id="L938" class="source_line" href="#L938">938</a>
<a id="L939" class="source_line" href="#L939">939</a>
<a id="L940" class="source_line" href="#L940">940</a>
<a id="L941" class="source_line" href="#L941">941</a>
<a id="L942" class="source_line" href="#L942">942</a>
<a id="L943" class="source_line" href="#L943">943</a>
<a id="L944" class="source_line" href="#L944">944</a>
<a id="L945" class="source_line" href="#L945">945</a>
<a id="L946" class="source_line" href="#L946">946</a>
<a id="L947" class="source_line" href="#L947">947</a>
<a id="L948" class="source_line" href="#L948">948</a>
<a id="L949" class="source_line" href="#L949">949</a>
<a id="L950" class="source_line" href="#L950">950</a>
<a id="L951" class="source_line" href="#L951">951</a>
<a id="L952" class="source_line" href="#L952">952</a>
<a id="L953" class="source_line" href="#L953">953</a>
<a id="L954" class="source_line" href="#L954">954</a>
<a id="L955" class="source_line" href="#L955">955</a>
<a id="L956" class="source_line" href="#L956">956</a>
<a id="L957" class="source_line" href="#L957">957</a>
<a id="L958" class="source_line" href="#L958">958</a>
<a id="L959" class="source_line" href="#L959">959</a>
<a id="L960" class="source_line" href="#L960">960</a>
<a id="L961" class="source_line" href="#L961">961</a>
<a id="L962" class="source_line" href="#L962">962</a>
<a id="L963" class="source_line" href="#L963">963</a>
<a id="L964" class="source_line" href="#L964">964</a>
<a id="L965" class="source_line" href="#L965">965</a>
<a id="L966" class="source_line" href="#L966">966</a>
<a id="L967" class="source_line" href="#L967">967</a>
<a id="L968" class="source_line" href="#L968">968</a>
<a id="L969" class="source_line" href="#L969">969</a>
<a id="L970" class="source_line" href="#L970">970</a>
<a id="L971" class="source_line" href="#L971">971</a>
<a id="L972" class="source_line" href="#L972">972</a>
<a id="L973" class="source_line" href="#L973">973</a>
<a id="L974" class="source_line" href="#L974">974</a>
<a id="L975" class="source_line" href="#L975">975</a>
<a id="L976" class="source_line" href="#L976">976</a>
<a id="L977" class="source_line" href="#L977">977</a>
<a id="L978" class="source_line" href="#L978">978</a>
<a id="L979" class="source_line" href="#L979">979</a>
<a id="L980" class="source_line" href="#L980">980</a>
<a id="L981" class="source_line" href="#L981">981</a>
<a id="L982" class="source_line" href="#L982">982</a>
<a id="L983" class="source_line" href="#L983">983</a>
<a id="L984" class="source_line" href="#L984">984</a>
<a id="L985" class="source_line" href="#L985">985</a>
<a id="L986" class="source_line" href="#L986">986</a>
<a id="L987" class="source_line" href="#L987">987</a>
<a id="L988" class="source_line" href="#L988">988</a>
<a id="L989" class="source_line" href="#L989">989</a>
<a id="L990" class="source_line" href="#L990">990</a>
<a id="L991" class="source_line" href="#L991">991</a>
<a id="L992" class="source_line" href="#L992">992</a>
<a id="L993" class="source_line" href="#L993">993</a>
<a id="L994" class="source_line" href="#L994">994</a>
<a id="L995" class="source_line" href="#L995">995</a>
<a id="L996" class="source_line" href="#L996">996</a>
<a id="L997" class="source_line" href="#L997">997</a>
<a id="L998" class="source_line" href="#L998">998</a>
<a id="L999" class="source_line" href="#L999">999</a>
<a id="L1000" class="source_line" href="#L1000">1000</a>
<a id="L1001" class="source_line" href="#L1001">1001</a>
<a id="L1002" class="source_line" href="#L1002">1002</a>
<a id="L1003" class="source_line" href="#L1003">1003</a>
<a id="L1004" class="source_line" href="#L1004">1004</a>
<a id="L1005" class="source_line" href="#L1005">1005</a>
<a id="L1006" class="source_line" href="#L1006">1006</a>
<a id="L1007" class="source_line" href="#L1007">1007</a>
<a id="L1008" class="source_line" href="#L1008">1008</a>
<a id="L1009" class="source_line" href="#L1009">1009</a>
<a id="L1010" class="source_line" href="#L1010">1010</a>
<a id="L1011" class="source_line" href="#L1011">1011</a>
<a id="L1012" class="source_line" href="#L1012">1012</a>
<a id="L1013" class="source_line" href="#L1013">1013</a>
<a id="L1014" class="source_line" href="#L1014">1014</a>
<a id="L1015" class="source_line" href="#L1015">1015</a>
<a id="L1016" class="source_line" href="#L1016">1016</a>
<a id="L1017" class="source_line" href="#L1017">1017</a>
<a id="L1018" class="source_line" href="#L1018">1018</a>
<a id="L1019" class="source_line" href="#L1019">1019</a>
<a id="L1020" class="source_line" href="#L1020">1020</a>
<a id="L1021" class="source_line" href="#L1021">1021</a>
<a id="L1022" class="source_line" href="#L1022">1022</a>
<a id="L1023" class="source_line" href="#L1023">1023</a>
<a id="L1024" class="source_line" href="#L1024">1024</a>
<a id="L1025" class="source_line" href="#L1025">1025</a>
<a id="L1026" class="source_line" href="#L1026">1026</a>
<a id="L1027" class="source_line" href="#L1027">1027</a>
<a id="L1028" class="source_line" href="#L1028">1028</a>
<a id="L1029" class="source_line" href="#L1029">1029</a>
<a id="L1030" class="source_line" href="#L1030">1030</a>
<a id="L1031" class="source_line" href="#L1031">1031</a>
<a id="L1032" class="source_line" href="#L1032">1032</a>
<a id="L1033" class="source_line" href="#L1033">1033</a>
<a id="L1034" class="source_line" href="#L1034">1034</a>
<a id="L1035" class="source_line" href="#L1035">1035</a>
<a id="L1036" class="source_line" href="#L1036">1036</a>
<a id="L1037" class="source_line" href="#L1037">1037</a>
<a id="L1038" class="source_line" href="#L1038">1038</a>
<a id="L1039" class="source_line" href="#L1039">1039</a>
<a id="L1040" class="source_line" href="#L1040">1040</a>
<a id="L1041" class="source_line" href="#L1041">1041</a>
<a id="L1042" class="source_line" href="#L1042">1042</a>
<a id="L1043" class="source_line" href="#L1043">1043</a>
<a id="L1044" class="source_line" href="#L1044">1044</a>
<a id="L1045" class="source_line" href="#L1045">1045</a>
<a id="L1046" class="source_line" href="#L1046">1046</a>
<a id="L1047" class="source_line" href="#L1047">1047</a>
<a id="L1048" class="source_line" href="#L1048">1048</a>
<a id="L1049" class="source_line" href="#L1049">1049</a>
<a id="L1050" class="source_line" href="#L1050">1050</a>
<a id="L1051" class="source_line" href="#L1051">1051</a>
<a id="L1052" class="source_line" href="#L1052">1052</a>
<a id="L1053" class="source_line" href="#L1053">1053</a>
<a id="L1054" class="source_line" href="#L1054">1054</a>
<a id="L1055" class="source_line" href="#L1055">1055</a>
<a id="L1056" class="source_line" href="#L1056">1056</a>
<a id="L1057" class="source_line" href="#L1057">1057</a>
<a id="L1058" class="source_line" href="#L1058">1058</a>
<a id="L1059" class="source_line" href="#L1059">1059</a>
<a id="L1060" class="source_line" href="#L1060">1060</a>
<a id="L1061" class="source_line" href="#L1061">1061</a>
<a id="L1062" class="source_line" href="#L1062">1062</a>
<a id="L1063" class="source_line" href="#L1063">1063</a>
<a id="L1064" class="source_line" href="#L1064">1064</a>
<a id="L1065" class="source_line" href="#L1065">1065</a>
<a id="L1066" class="source_line" href="#L1066">1066</a>
<a id="L1067" class="source_line" href="#L1067">1067</a>
<a id="L1068" class="source_line" href="#L1068">1068</a>
<a id="L1069" class="source_line" href="#L1069">1069</a>
<a id="L1070" class="source_line" href="#L1070">1070</a>
<a id="L1071" class="source_line" href="#L1071">1071</a>
<a id="L1072" class="source_line" href="#L1072">1072</a>
<a id="L1073" class="source_line" href="#L1073">1073</a>
<a id="L1074" class="source_line" href="#L1074">1074</a>
<a id="L1075" class="source_line" href="#L1075">1075</a>
<a id="L1076" class="source_line" href="#L1076">1076</a>
<a id="L1077" class="source_line" href="#L1077">1077</a>
<a id="L1078" class="source_line" href="#L1078">1078</a>
<a id="L1079" class="source_line" href="#L1079">1079</a>
<a id="L1080" class="source_line" href="#L1080">1080</a>
<a id="L1081" class="source_line" href="#L1081">1081</a>
<a id="L1082" class="source_line" href="#L1082">1082</a>
<a id="L1083" class="source_line" href="#L1083">1083</a>
<a id="L1084" class="source_line" href="#L1084">1084</a>
<a id="L1085" class="source_line" href="#L1085">1085</a>
<a id="L1086" class="source_line" href="#L1086">1086</a>
<a id="L1087" class="source_line" href="#L1087">1087</a>
<a id="L1088" class="source_line" href="#L1088">1088</a>
<a id="L1089" class="source_line" href="#L1089">1089</a>
<a id="L1090" class="source_line" href="#L1090">1090</a>
<a id="L1091" class="source_line" href="#L1091">1091</a>
<a id="L1092" class="source_line" href="#L1092">1092</a>
<a id="L1093" class="source_line" href="#L1093">1093</a>
<a id="L1094" class="source_line" href="#L1094">1094</a>
<a id="L1095" class="source_line" href="#L1095">1095</a>
<a id="L1096" class="source_line" href="#L1096">1096</a>
<a id="L1097" class="source_line" href="#L1097">1097</a>
<a id="L1098" class="source_line" href="#L1098">1098</a>
<a id="L1099" class="source_line" href="#L1099">1099</a>
<a id="L1100" class="source_line" href="#L1100">1100</a>
<a id="L1101" class="source_line" href="#L1101">1101</a>
<a id="L1102" class="source_line" href="#L1102">1102</a>
<a id="L1103" class="source_line" href="#L1103">1103</a>
<a id="L1104" class="source_line" href="#L1104">1104</a>
<a id="L1105" class="source_line" href="#L1105">1105</a>
<a id="L1106" class="source_line" href="#L1106">1106</a>
<a id="L1107" class="source_line" href="#L1107">1107</a>
<a id="L1108" class="source_line" href="#L1108">1108</a>
<a id="L1109" class="source_line" href="#L1109">1109</a>
<a id="L1110" class="source_line" href="#L1110">1110</a>
<a id="L1111" class="source_line" href="#L1111">1111</a>
<a id="L1112" class="source_line" href="#L1112">1112</a>
<a id="L1113" class="source_line" href="#L1113">1113</a>
<a id="L1114" class="source_line" href="#L1114">1114</a>
<a id="L1115" class="source_line" href="#L1115">1115</a>
<a id="L1116" class="source_line" href="#L1116">1116</a>
<a id="L1117" class="source_line" href="#L1117">1117</a>
<a id="L1118" class="source_line" href="#L1118">1118</a>
<a id="L1119" class="source_line" href="#L1119">1119</a>
<a id="L1120" class="source_line" href="#L1120">1120</a>
<a id="L1121" class="source_line" href="#L1121">1121</a>
<a id="L1122" class="source_line" href="#L1122">1122</a>
<a id="L1123" class="source_line" href="#L1123">1123</a>
<a id="L1124" class="source_line" href="#L1124">1124</a>
<a id="L1125" class="source_line" href="#L1125">1125</a>
<a id="L1126" class="source_line" href="#L1126">1126</a>
<a id="L1127" class="source_line" href="#L1127">1127</a>
<a id="L1128" class="source_line" href="#L1128">1128</a>
<a id="L1129" class="source_line" href="#L1129">1129</a>
<a id="L1130" class="source_line" href="#L1130">1130</a>
<a id="L1131" class="source_line" href="#L1131">1131</a>
<a id="L1132" class="source_line" href="#L1132">1132</a>
<a id="L1133" class="source_line" href="#L1133">1133</a>
<a id="L1134" class="source_line" href="#L1134">1134</a>
<a id="L1135" class="source_line" href="#L1135">1135</a>
<a id="L1136" class="source_line" href="#L1136">1136</a>
<a id="L1137" class="source_line" href="#L1137">1137</a>
<a id="L1138" class="source_line" href="#L1138">1138</a>
<a id="L1139" class="source_line" href="#L1139">1139</a>
<a id="L1140" class="source_line" href="#L1140">1140</a>
<a id="L1141" class="source_line" href="#L1141">1141</a>
<a id="L1142" class="source_line" href="#L1142">1142</a>
<a id="L1143" class="source_line" href="#L1143">1143</a>
<a id="L1144" class="source_line" href="#L1144">1144</a>
<a id="L1145" class="source_line" href="#L1145">1145</a>
<a id="L1146" class="source_line" href="#L1146">1146</a>
<a id="L1147" class="source_line" href="#L1147">1147</a>
<a id="L1148" class="source_line" href="#L1148">1148</a>
<a id="L1149" class="source_line" href="#L1149">1149</a>
<a id="L1150" class="source_line" href="#L1150">1150</a>
<a id="L1151" class="source_line" href="#L1151">1151</a>
<a id="L1152" class="source_line" href="#L1152">1152</a>
<a id="L1153" class="source_line" href="#L1153">1153</a>
<a id="L1154" class="source_line" href="#L1154">1154</a>
<a id="L1155" class="source_line" href="#L1155">1155</a>
<a id="L1156" class="source_line" href="#L1156">1156</a>
<a id="L1157" class="source_line" href="#L1157">1157</a>
<a id="L1158" class="source_line" href="#L1158">1158</a>
<a id="L1159" class="source_line" href="#L1159">1159</a>
<a id="L1160" class="source_line" href="#L1160">1160</a>
<a id="L1161" class="source_line" href="#L1161">1161</a>
<a id="L1162" class="source_line" href="#L1162">1162</a>
<a id="L1163" class="source_line" href="#L1163">1163</a>
<a id="L1164" class="source_line" href="#L1164">1164</a>
<a id="L1165" class="source_line" href="#L1165">1165</a>
<a id="L1166" class="source_line" href="#L1166">1166</a>
<a id="L1167" class="source_line" href="#L1167">1167</a>
<a id="L1168" class="source_line" href="#L1168">1168</a>
<a id="L1169" class="source_line" href="#L1169">1169</a>
<a id="L1170" class="source_line" href="#L1170">1170</a>
<a id="L1171" class="source_line" href="#L1171">1171</a>
<a id="L1172" class="source_line" href="#L1172">1172</a>
<a id="L1173" class="source_line" href="#L1173">1173</a>
<a id="L1174" class="source_line" href="#L1174">1174</a>
<a id="L1175" class="source_line" href="#L1175">1175</a>
<a id="L1176" class="source_line" href="#L1176">1176</a>
<a id="L1177" class="source_line" href="#L1177">1177</a>
<a id="L1178" class="source_line" href="#L1178">1178</a>
<a id="L1179" class="source_line" href="#L1179">1179</a>
<a id="L1180" class="source_line" href="#L1180">1180</a>
<a id="L1181" class="source_line" href="#L1181">1181</a>
<a id="L1182" class="source_line" href="#L1182">1182</a>
<a id="L1183" class="source_line" href="#L1183">1183</a>
<a id="L1184" class="source_line" href="#L1184">1184</a>
<a id="L1185" class="source_line" href="#L1185">1185</a>
<a id="L1186" class="source_line" href="#L1186">1186</a>
<a id="L1187" class="source_line" href="#L1187">1187</a>
<a id="L1188" class="source_line" href="#L1188">1188</a>
<a id="L1189" class="source_line" href="#L1189">1189</a>
<a id="L1190" class="source_line" href="#L1190">1190</a>
<a id="L1191" class="source_line" href="#L1191">1191</a>
<a id="L1192" class="source_line" href="#L1192">1192</a>
<a id="L1193" class="source_line" href="#L1193">1193</a>
<a id="L1194" class="source_line" href="#L1194">1194</a>
<a id="L1195" class="source_line" href="#L1195">1195</a>
<a id="L1196" class="source_line" href="#L1196">1196</a>
<a id="L1197" class="source_line" href="#L1197">1197</a>
<a id="L1198" class="source_line" href="#L1198">1198</a>
<a id="L1199" class="source_line" href="#L1199">1199</a>
<a id="L1200" class="source_line" href="#L1200">1200</a>
<a id="L1201" class="source_line" href="#L1201">1201</a>
<a id="L1202" class="source_line" href="#L1202">1202</a>
<a id="L1203" class="source_line" href="#L1203">1203</a>
<a id="L1204" class="source_line" href="#L1204">1204</a>
<a id="L1205" class="source_line" href="#L1205">1205</a>
<a id="L1206" class="source_line" href="#L1206">1206</a>
<a id="L1207" class="source_line" href="#L1207">1207</a>
<a id="L1208" class="source_line" href="#L1208">1208</a>
<a id="L1209" class="source_line" href="#L1209">1209</a>
<a id="L1210" class="source_line" href="#L1210">1210</a>
<a id="L1211" class="source_line" href="#L1211">1211</a>
<a id="L1212" class="source_line" href="#L1212">1212</a>
<a id="L1213" class="source_line" href="#L1213">1213</a>
<a id="L1214" class="source_line" href="#L1214">1214</a>
<a id="L1215" class="source_line" href="#L1215">1215</a>
<a id="L1216" class="source_line" href="#L1216">1216</a>
<a id="L1217" class="source_line" href="#L1217">1217</a>
<a id="L1218" class="source_line" href="#L1218">1218</a>
<a id="L1219" class="source_line" href="#L1219">1219</a>
<a id="L1220" class="source_line" href="#L1220">1220</a>
<a id="L1221" class="source_line" href="#L1221">1221</a>
<a id="L1222" class="source_line" href="#L1222">1222</a>
<a id="L1223" class="source_line" href="#L1223">1223</a>
<a id="L1224" class="source_line" href="#L1224">1224</a>
<a id="L1225" class="source_line" href="#L1225">1225</a>
<a id="L1226" class="source_line" href="#L1226">1226</a>
<a id="L1227" class="source_line" href="#L1227">1227</a>
<a id="L1228" class="source_line" href="#L1228">1228</a>
<a id="L1229" class="source_line" href="#L1229">1229</a>
<a id="L1230" class="source_line" href="#L1230">1230</a>
<a id="L1231" class="source_line" href="#L1231">1231</a>
<a id="L1232" class="source_line" href="#L1232">1232</a>
<a id="L1233" class="source_line" href="#L1233">1233</a>
<a id="L1234" class="source_line" href="#L1234">1234</a>
<a id="L1235" class="source_line" href="#L1235">1235</a>
<a id="L1236" class="source_line" href="#L1236">1236</a>
<a id="L1237" class="source_line" href="#L1237">1237</a>
<a id="L1238" class="source_line" href="#L1238">1238</a>
<a id="L1239" class="source_line" href="#L1239">1239</a>
<a id="L1240" class="source_line" href="#L1240">1240</a>
<a id="L1241" class="source_line" href="#L1241">1241</a>
<a id="L1242" class="source_line" href="#L1242">1242</a>
<a id="L1243" class="source_line" href="#L1243">1243</a>
<a id="L1244" class="source_line" href="#L1244">1244</a>
<a id="L1245" class="source_line" href="#L1245">1245</a>
<a id="L1246" class="source_line" href="#L1246">1246</a>
<a id="L1247" class="source_line" href="#L1247">1247</a>
<a id="L1248" class="source_line" href="#L1248">1248</a>
<a id="L1249" class="source_line" href="#L1249">1249</a>
<a id="L1250" class="source_line" href="#L1250">1250</a>
<a id="L1251" class="source_line" href="#L1251">1251</a>
<a id="L1252" class="source_line" href="#L1252">1252</a>
<a id="L1253" class="source_line" href="#L1253">1253</a>
<a id="L1254" class="source_line" href="#L1254">1254</a>
<a id="L1255" class="source_line" href="#L1255">1255</a>
<a id="L1256" class="source_line" href="#L1256">1256</a>
<a id="L1257" class="source_line" href="#L1257">1257</a>
<a id="L1258" class="source_line" href="#L1258">1258</a>
<a id="L1259" class="source_line" href="#L1259">1259</a>
<a id="L1260" class="source_line" href="#L1260">1260</a>
<a id="L1261" class="source_line" href="#L1261">1261</a>
<a id="L1262" class="source_line" href="#L1262">1262</a>
<a id="L1263" class="source_line" href="#L1263">1263</a>
<a id="L1264" class="source_line" href="#L1264">1264</a>
<a id="L1265" class="source_line" href="#L1265">1265</a>
<a id="L1266" class="source_line" href="#L1266">1266</a>
<a id="L1267" class="source_line" href="#L1267">1267</a>
<a id="L1268" class="source_line" href="#L1268">1268</a>
<a id="L1269" class="source_line" href="#L1269">1269</a>
<a id="L1270" class="source_line" href="#L1270">1270</a>
<a id="L1271" class="source_line" href="#L1271">1271</a>
<a id="L1272" class="source_line" href="#L1272">1272</a>
<a id="L1273" class="source_line" href="#L1273">1273</a>
<a id="L1274" class="source_line" href="#L1274">1274</a>
<a id="L1275" class="source_line" href="#L1275">1275</a>
<a id="L1276" class="source_line" href="#L1276">1276</a>
<a id="L1277" class="source_line" href="#L1277">1277</a>
<a id="L1278" class="source_line" href="#L1278">1278</a>
<a id="L1279" class="source_line" href="#L1279">1279</a>
<a id="L1280" class="source_line" href="#L1280">1280</a>
<a id="L1281" class="source_line" href="#L1281">1281</a>
<a id="L1282" class="source_line" href="#L1282">1282</a>
<a id="L1283" class="source_line" href="#L1283">1283</a>
<a id="L1284" class="source_line" href="#L1284">1284</a>
<a id="L1285" class="source_line" href="#L1285">1285</a>
<a id="L1286" class="source_line" href="#L1286">1286</a>
<a id="L1287" class="source_line" href="#L1287">1287</a>
<a id="L1288" class="source_line" href="#L1288">1288</a>
<a id="L1289" class="source_line" href="#L1289">1289</a>
<a id="L1290" class="source_line" href="#L1290">1290</a>
<a id="L1291" class="source_line" href="#L1291">1291</a>
<a id="L1292" class="source_line" href="#L1292">1292</a>
<a id="L1293" class="source_line" href="#L1293">1293</a>
<a id="L1294" class="source_line" href="#L1294">1294</a>
<a id="L1295" class="source_line" href="#L1295">1295</a>
<a id="L1296" class="source_line" href="#L1296">1296</a>
<a id="L1297" class="source_line" href="#L1297">1297</a>
<a id="L1298" class="source_line" href="#L1298">1298</a>
<a id="L1299" class="source_line" href="#L1299">1299</a>
<a id="L1300" class="source_line" href="#L1300">1300</a>
<a id="L1301" class="source_line" href="#L1301">1301</a>
<a id="L1302" class="source_line" href="#L1302">1302</a>
<a id="L1303" class="source_line" href="#L1303">1303</a>
<a id="L1304" class="source_line" href="#L1304">1304</a>
<a id="L1305" class="source_line" href="#L1305">1305</a>
<a id="L1306" class="source_line" href="#L1306">1306</a>
<a id="L1307" class="source_line" href="#L1307">1307</a>
<a id="L1308" class="source_line" href="#L1308">1308</a>
<a id="L1309" class="source_line" href="#L1309">1309</a>
<a id="L1310" class="source_line" href="#L1310">1310</a>
<a id="L1311" class="source_line" href="#L1311">1311</a>
<a id="L1312" class="source_line" href="#L1312">1312</a>
<a id="L1313" class="source_line" href="#L1313">1313</a>
<a id="L1314" class="source_line" href="#L1314">1314</a>
<a id="L1315" class="source_line" href="#L1315">1315</a>
<a id="L1316" class="source_line" href="#L1316">1316</a>
<a id="L1317" class="source_line" href="#L1317">1317</a>
<a id="L1318" class="source_line" href="#L1318">1318</a>
<a id="L1319" class="source_line" href="#L1319">1319</a>
<a id="L1320" class="source_line" href="#L1320">1320</a>
<a id="L1321" class="source_line" href="#L1321">1321</a>
<a id="L1322" class="source_line" href="#L1322">1322</a>
<a id="L1323" class="source_line" href="#L1323">1323</a>
<a id="L1324" class="source_line" href="#L1324">1324</a>
<a id="L1325" class="source_line" href="#L1325">1325</a>
<a id="L1326" class="source_line" href="#L1326">1326</a>
<a id="L1327" class="source_line" href="#L1327">1327</a>
<a id="L1328" class="source_line" href="#L1328">1328</a>
<a id="L1329" class="source_line" href="#L1329">1329</a>
<a id="L1330" class="source_line" href="#L1330">1330</a>
<a id="L1331" class="source_line" href="#L1331">1331</a>
<a id="L1332" class="source_line" href="#L1332">1332</a>
<a id="L1333" class="source_line" href="#L1333">1333</a>
<a id="L1334" class="source_line" href="#L1334">1334</a>
<a id="L1335" class="source_line" href="#L1335">1335</a>
<a id="L1336" class="source_line" href="#L1336">1336</a>
<a id="L1337" class="source_line" href="#L1337">1337</a>
<a id="L1338" class="source_line" href="#L1338">1338</a>
<a id="L1339" class="source_line" href="#L1339">1339</a>
<a id="L1340" class="source_line" href="#L1340">1340</a>
<a id="L1341" class="source_line" href="#L1341">1341</a>
<a id="L1342" class="source_line" href="#L1342">1342</a>
<a id="L1343" class="source_line" href="#L1343">1343</a>
<a id="L1344" class="source_line" href="#L1344">1344</a>
<a id="L1345" class="source_line" href="#L1345">1345</a>
<a id="L1346" class="source_line" href="#L1346">1346</a>
<a id="L1347" class="source_line" href="#L1347">1347</a>
<a id="L1348" class="source_line" href="#L1348">1348</a>
<a id="L1349" class="source_line" href="#L1349">1349</a>
<a id="L1350" class="source_line" href="#L1350">1350</a>
<a id="L1351" class="source_line" href="#L1351">1351</a>
<a id="L1352" class="source_line" href="#L1352">1352</a>
<a id="L1353" class="source_line" href="#L1353">1353</a>
<a id="L1354" class="source_line" href="#L1354">1354</a>
<a id="L1355" class="source_line" href="#L1355">1355</a>
<a id="L1356" class="source_line" href="#L1356">1356</a>
<a id="L1357" class="source_line" href="#L1357">1357</a>
<a id="L1358" class="source_line" href="#L1358">1358</a>
<a id="L1359" class="source_line" href="#L1359">1359</a>
<a id="L1360" class="source_line" href="#L1360">1360</a>
<a id="L1361" class="source_line" href="#L1361">1361</a>
<a id="L1362" class="source_line" href="#L1362">1362</a>
<a id="L1363" class="source_line" href="#L1363">1363</a>
<a id="L1364" class="source_line" href="#L1364">1364</a>
<a id="L1365" class="source_line" href="#L1365">1365</a>
<a id="L1366" class="source_line" href="#L1366">1366</a>
<a id="L1367" class="source_line" href="#L1367">1367</a>
<a id="L1368" class="source_line" href="#L1368">1368</a>
<a id="L1369" class="source_line" href="#L1369">1369</a>
<a id="L1370" class="source_line" href="#L1370">1370</a>
<a id="L1371" class="source_line" href="#L1371">1371</a>
<a id="L1372" class="source_line" href="#L1372">1372</a>
<a id="L1373" class="source_line" href="#L1373">1373</a>
<a id="L1374" class="source_line" href="#L1374">1374</a>
<a id="L1375" class="source_line" href="#L1375">1375</a>
<a id="L1376" class="source_line" href="#L1376">1376</a>
<a id="L1377" class="source_line" href="#L1377">1377</a>
<a id="L1378" class="source_line" href="#L1378">1378</a>
<a id="L1379" class="source_line" href="#L1379">1379</a>
<a id="L1380" class="source_line" href="#L1380">1380</a>
<a id="L1381" class="source_line" href="#L1381">1381</a>
<a id="L1382" class="source_line" href="#L1382">1382</a>
<a id="L1383" class="source_line" href="#L1383">1383</a>
<a id="L1384" class="source_line" href="#L1384">1384</a>
<a id="L1385" class="source_line" href="#L1385">1385</a>
<a id="L1386" class="source_line" href="#L1386">1386</a>
<a id="L1387" class="source_line" href="#L1387">1387</a>
<a id="L1388" class="source_line" href="#L1388">1388</a>
<a id="L1389" class="source_line" href="#L1389">1389</a>
<a id="L1390" class="source_line" href="#L1390">1390</a>
<a id="L1391" class="source_line" href="#L1391">1391</a>
<a id="L1392" class="source_line" href="#L1392">1392</a>
<a id="L1393" class="source_line" href="#L1393">1393</a>
<a id="L1394" class="source_line" href="#L1394">1394</a>
<a id="L1395" class="source_line" href="#L1395">1395</a>
<a id="L1396" class="source_line" href="#L1396">1396</a>
<a id="L1397" class="source_line" href="#L1397">1397</a>
<a id="L1398" class="source_line" href="#L1398">1398</a>
<a id="L1399" class="source_line" href="#L1399">1399</a>
<a id="L1400" class="source_line" href="#L1400">1400</a>
<a id="L1401" class="source_line" href="#L1401">1401</a>
<a id="L1402" class="source_line" href="#L1402">1402</a>
<a id="L1403" class="source_line" href="#L1403">1403</a>
<a id="L1404" class="source_line" href="#L1404">1404</a>
<a id="L1405" class="source_line" href="#L1405">1405</a>
<a id="L1406" class="source_line" href="#L1406">1406</a>
<a id="L1407" class="source_line" href="#L1407">1407</a>
<a id="L1408" class="source_line" href="#L1408">1408</a>
<a id="L1409" class="source_line" href="#L1409">1409</a>
<a id="L1410" class="source_line" href="#L1410">1410</a>
<a id="L1411" class="source_line" href="#L1411">1411</a>
<a id="L1412" class="source_line" href="#L1412">1412</a>
<a id="L1413" class="source_line" href="#L1413">1413</a>
<a id="L1414" class="source_line" href="#L1414">1414</a>
<a id="L1415" class="source_line" href="#L1415">1415</a>
<a id="L1416" class="source_line" href="#L1416">1416</a>
<a id="L1417" class="source_line" href="#L1417">1417</a>
<a id="L1418" class="source_line" href="#L1418">1418</a>
<a id="L1419" class="source_line" href="#L1419">1419</a>
<a id="L1420" class="source_line" href="#L1420">1420</a>
<a id="L1421" class="source_line" href="#L1421">1421</a>
<a id="L1422" class="source_line" href="#L1422">1422</a>
<a id="L1423" class="source_line" href="#L1423">1423</a>
<a id="L1424" class="source_line" href="#L1424">1424</a>
<a id="L1425" class="source_line" href="#L1425">1425</a>
<a id="L1426" class="source_line" href="#L1426">1426</a>
<a id="L1427" class="source_line" href="#L1427">1427</a>
<a id="L1428" class="source_line" href="#L1428">1428</a>
<a id="L1429" class="source_line" href="#L1429">1429</a>
<a id="L1430" class="source_line" href="#L1430">1430</a>
<a id="L1431" class="source_line" href="#L1431">1431</a>
<a id="L1432" class="source_line" href="#L1432">1432</a>
<a id="L1433" class="source_line" href="#L1433">1433</a>
<a id="L1434" class="source_line" href="#L1434">1434</a>
<a id="L1435" class="source_line" href="#L1435">1435</a>
<a id="L1436" class="source_line" href="#L1436">1436</a>
<a id="L1437" class="source_line" href="#L1437">1437</a>
<a id="L1438" class="source_line" href="#L1438">1438</a>
<a id="L1439" class="source_line" href="#L1439">1439</a>
<a id="L1440" class="source_line" href="#L1440">1440</a>
<a id="L1441" class="source_line" href="#L1441">1441</a>
<a id="L1442" class="source_line" href="#L1442">1442</a>
<a id="L1443" class="source_line" href="#L1443">1443</a>
<a id="L1444" class="source_line" href="#L1444">1444</a>
<a id="L1445" class="source_line" href="#L1445">1445</a>
<a id="L1446" class="source_line" href="#L1446">1446</a>
<a id="L1447" class="source_line" href="#L1447">1447</a>
<a id="L1448" class="source_line" href="#L1448">1448</a>
<a id="L1449" class="source_line" href="#L1449">1449</a>
<a id="L1450" class="source_line" href="#L1450">1450</a>
<a id="L1451" class="source_line" href="#L1451">1451</a>
<a id="L1452" class="source_line" href="#L1452">1452</a>
<a id="L1453" class="source_line" href="#L1453">1453</a>
<a id="L1454" class="source_line" href="#L1454">1454</a>
<a id="L1455" class="source_line" href="#L1455">1455</a>
<a id="L1456" class="source_line" href="#L1456">1456</a>
<a id="L1457" class="source_line" href="#L1457">1457</a>
<a id="L1458" class="source_line" href="#L1458">1458</a>
<a id="L1459" class="source_line" href="#L1459">1459</a>
<a id="L1460" class="source_line" href="#L1460">1460</a>
<a id="L1461" class="source_line" href="#L1461">1461</a>
<a id="L1462" class="source_line" href="#L1462">1462</a>
<a id="L1463" class="source_line" href="#L1463">1463</a>
<a id="L1464" class="source_line" href="#L1464">1464</a>
<a id="L1465" class="source_line" href="#L1465">1465</a>
<a id="L1466" class="source_line" href="#L1466">1466</a>
<a id="L1467" class="source_line" href="#L1467">1467</a>
<a id="L1468" class="source_line" href="#L1468">1468</a>
<a id="L1469" class="source_line" href="#L1469">1469</a>
<a id="L1470" class="source_line" href="#L1470">1470</a>
<a id="L1471" class="source_line" href="#L1471">1471</a>
<a id="L1472" class="source_line" href="#L1472">1472</a>
<a id="L1473" class="source_line" href="#L1473">1473</a>
<a id="L1474" class="source_line" href="#L1474">1474</a>
<a id="L1475" class="source_line" href="#L1475">1475</a>
<a id="L1476" class="source_line" href="#L1476">1476</a>
<a id="L1477" class="source_line" href="#L1477">1477</a>
<a id="L1478" class="source_line" href="#L1478">1478</a>
<a id="L1479" class="source_line" href="#L1479">1479</a>
<a id="L1480" class="source_line" href="#L1480">1480</a>
<a id="L1481" class="source_line" href="#L1481">1481</a>
<a id="L1482" class="source_line" href="#L1482">1482</a>
<a id="L1483" class="source_line" href="#L1483">1483</a>
<a id="L1484" class="source_line" href="#L1484">1484</a>
<a id="L1485" class="source_line" href="#L1485">1485</a>
<a id="L1486" class="source_line" href="#L1486">1486</a>
<a id="L1487" class="source_line" href="#L1487">1487</a>
<a id="L1488" class="source_line" href="#L1488">1488</a>
<a id="L1489" class="source_line" href="#L1489">1489</a>
<a id="L1490" class="source_line" href="#L1490">1490</a>
<a id="L1491" class="source_line" href="#L1491">1491</a>
<a id="L1492" class="source_line" href="#L1492">1492</a>
<a id="L1493" class="source_line" href="#L1493">1493</a>
<a id="L1494" class="source_line" href="#L1494">1494</a>
<a id="L1495" class="source_line" href="#L1495">1495</a>
<a id="L1496" class="source_line" href="#L1496">1496</a>
<a id="L1497" class="source_line" href="#L1497">1497</a>
<a id="L1498" class="source_line" href="#L1498">1498</a>
<a id="L1499" class="source_line" href="#L1499">1499</a>
<a id="L1500" class="source_line" href="#L1500">1500</a>
<a id="L1501" class="source_line" href="#L1501">1501</a>
<a id="L1502" class="source_line" href="#L1502">1502</a>
<a id="L1503" class="source_line" href="#L1503">1503</a>
<a id="L1504" class="source_line" href="#L1504">1504</a>
<a id="L1505" class="source_line" href="#L1505">1505</a>
<a id="L1506" class="source_line" href="#L1506">1506</a>
<a id="L1507" class="source_line" href="#L1507">1507</a>
<a id="L1508" class="source_line" href="#L1508">1508</a>
<a id="L1509" class="source_line" href="#L1509">1509</a>
<a id="L1510" class="source_line" href="#L1510">1510</a>
<a id="L1511" class="source_line" href="#L1511">1511</a>
<a id="L1512" class="source_line" href="#L1512">1512</a>
<a id="L1513" class="source_line" href="#L1513">1513</a>
<a id="L1514" class="source_line" href="#L1514">1514</a>
<a id="L1515" class="source_line" href="#L1515">1515</a>
<a id="L1516" class="source_line" href="#L1516">1516</a>
<a id="L1517" class="source_line" href="#L1517">1517</a>
<a id="L1518" class="source_line" href="#L1518">1518</a>
<a id="L1519" class="source_line" href="#L1519">1519</a>
<a id="L1520" class="source_line" href="#L1520">1520</a>
<a id="L1521" class="source_line" href="#L1521">1521</a>
<a id="L1522" class="source_line" href="#L1522">1522</a>
<a id="L1523" class="source_line" href="#L1523">1523</a>
<a id="L1524" class="source_line" href="#L1524">1524</a>
<a id="L1525" class="source_line" href="#L1525">1525</a>
<a id="L1526" class="source_line" href="#L1526">1526</a>
<a id="L1527" class="source_line" href="#L1527">1527</a>
<a id="L1528" class="source_line" href="#L1528">1528</a>
<a id="L1529" class="source_line" href="#L1529">1529</a>
<a id="L1530" class="source_line" href="#L1530">1530</a>
<a id="L1531" class="source_line" href="#L1531">1531</a>
<a id="L1532" class="source_line" href="#L1532">1532</a>
<a id="L1533" class="source_line" href="#L1533">1533</a>
<a id="L1534" class="source_line" href="#L1534">1534</a>
<a id="L1535" class="source_line" href="#L1535">1535</a>
<a id="L1536" class="source_line" href="#L1536">1536</a>
<a id="L1537" class="source_line" href="#L1537">1537</a>
<a id="L1538" class="source_line" href="#L1538">1538</a>
<a id="L1539" class="source_line" href="#L1539">1539</a>
<a id="L1540" class="source_line" href="#L1540">1540</a>
<a id="L1541" class="source_line" href="#L1541">1541</a>
<a id="L1542" class="source_line" href="#L1542">1542</a>
<a id="L1543" class="source_line" href="#L1543">1543</a>
<a id="L1544" class="source_line" href="#L1544">1544</a>
<a id="L1545" class="source_line" href="#L1545">1545</a>
<a id="L1546" class="source_line" href="#L1546">1546</a>
<a id="L1547" class="source_line" href="#L1547">1547</a>
<a id="L1548" class="source_line" href="#L1548">1548</a>
<a id="L1549" class="source_line" href="#L1549">1549</a>
<a id="L1550" class="source_line" href="#L1550">1550</a>
<a id="L1551" class="source_line" href="#L1551">1551</a>
<a id="L1552" class="source_line" href="#L1552">1552</a>
<a id="L1553" class="source_line" href="#L1553">1553</a>
<a id="L1554" class="source_line" href="#L1554">1554</a>
<a id="L1555" class="source_line" href="#L1555">1555</a>
<a id="L1556" class="source_line" href="#L1556">1556</a>
<a id="L1557" class="source_line" href="#L1557">1557</a>
<a id="L1558" class="source_line" href="#L1558">1558</a>
<a id="L1559" class="source_line" href="#L1559">1559</a>
<a id="L1560" class="source_line" href="#L1560">1560</a>
<a id="L1561" class="source_line" href="#L1561">1561</a>
<a id="L1562" class="source_line" href="#L1562">1562</a>
<a id="L1563" class="source_line" href="#L1563">1563</a>
<a id="L1564" class="source_line" href="#L1564">1564</a>
<a id="L1565" class="source_line" href="#L1565">1565</a>
<a id="L1566" class="source_line" href="#L1566">1566</a>
<a id="L1567" class="source_line" href="#L1567">1567</a>
<a id="L1568" class="source_line" href="#L1568">1568</a>
<a id="L1569" class="source_line" href="#L1569">1569</a>
<a id="L1570" class="source_line" href="#L1570">1570</a>
<a id="L1571" class="source_line" href="#L1571">1571</a>
<a id="L1572" class="source_line" href="#L1572">1572</a>
<a id="L1573" class="source_line" href="#L1573">1573</a>
<a id="L1574" class="source_line" href="#L1574">1574</a>
<a id="L1575" class="source_line" href="#L1575">1575</a>
<a id="L1576" class="source_line" href="#L1576">1576</a>
<a id="L1577" class="source_line" href="#L1577">1577</a>
<a id="L1578" class="source_line" href="#L1578">1578</a>
<a id="L1579" class="source_line" href="#L1579">1579</a>
<a id="L1580" class="source_line" href="#L1580">1580</a>
<a id="L1581" class="source_line" href="#L1581">1581</a>
<a id="L1582" class="source_line" href="#L1582">1582</a>
<a id="L1583" class="source_line" href="#L1583">1583</a>
<a id="L1584" class="source_line" href="#L1584">1584</a>
<a id="L1585" class="source_line" href="#L1585">1585</a>
<a id="L1586" class="source_line" href="#L1586">1586</a>
<a id="L1587" class="source_line" href="#L1587">1587</a>
<a id="L1588" class="source_line" href="#L1588">1588</a>
<a id="L1589" class="source_line" href="#L1589">1589</a>
<a id="L1590" class="source_line" href="#L1590">1590</a>
<a id="L1591" class="source_line" href="#L1591">1591</a>
<a id="L1592" class="source_line" href="#L1592">1592</a>
<a id="L1593" class="source_line" href="#L1593">1593</a>
<a id="L1594" class="source_line" href="#L1594">1594</a>
<a id="L1595" class="source_line" href="#L1595">1595</a>
<a id="L1596" class="source_line" href="#L1596">1596</a>
<a id="L1597" class="source_line" href="#L1597">1597</a>
<a id="L1598" class="source_line" href="#L1598">1598</a>
<a id="L1599" class="source_line" href="#L1599">1599</a>
<a id="L1600" class="source_line" href="#L1600">1600</a>
<a id="L1601" class="source_line" href="#L1601">1601</a>
<a id="L1602" class="source_line" href="#L1602">1602</a>
<a id="L1603" class="source_line" href="#L1603">1603</a>
<a id="L1604" class="source_line" href="#L1604">1604</a>
<a id="L1605" class="source_line" href="#L1605">1605</a>
<a id="L1606" class="source_line" href="#L1606">1606</a>
<a id="L1607" class="source_line" href="#L1607">1607</a>
<a id="L1608" class="source_line" href="#L1608">1608</a>
<a id="L1609" class="source_line" href="#L1609">1609</a>
<a id="L1610" class="source_line" href="#L1610">1610</a>
<a id="L1611" class="source_line" href="#L1611">1611</a>
<a id="L1612" class="source_line" href="#L1612">1612</a>
<a id="L1613" class="source_line" href="#L1613">1613</a>
<a id="L1614" class="source_line" href="#L1614">1614</a>
<a id="L1615" class="source_line" href="#L1615">1615</a>
<a id="L1616" class="source_line" href="#L1616">1616</a>
<a id="L1617" class="source_line" href="#L1617">1617</a>
<a id="L1618" class="source_line" href="#L1618">1618</a>
<a id="L1619" class="source_line" href="#L1619">1619</a>
<a id="L1620" class="source_line" href="#L1620">1620</a>
<a id="L1621" class="source_line" href="#L1621">1621</a>
<a id="L1622" class="source_line" href="#L1622">1622</a>
<a id="L1623" class="source_line" href="#L1623">1623</a>
<a id="L1624" class="source_line" href="#L1624">1624</a>
<a id="L1625" class="source_line" href="#L1625">1625</a>
<a id="L1626" class="source_line" href="#L1626">1626</a>
<a id="L1627" class="source_line" href="#L1627">1627</a>
<a id="L1628" class="source_line" href="#L1628">1628</a>
<a id="L1629" class="source_line" href="#L1629">1629</a>
<a id="L1630" class="source_line" href="#L1630">1630</a>
<a id="L1631" class="source_line" href="#L1631">1631</a>
<a id="L1632" class="source_line" href="#L1632">1632</a>
<a id="L1633" class="source_line" href="#L1633">1633</a>
<a id="L1634" class="source_line" href="#L1634">1634</a>
<a id="L1635" class="source_line" href="#L1635">1635</a>
<a id="L1636" class="source_line" href="#L1636">1636</a>
<a id="L1637" class="source_line" href="#L1637">1637</a>
<a id="L1638" class="source_line" href="#L1638">1638</a>
<a id="L1639" class="source_line" href="#L1639">1639</a>
<a id="L1640" class="source_line" href="#L1640">1640</a>
<a id="L1641" class="source_line" href="#L1641">1641</a>
<a id="L1642" class="source_line" href="#L1642">1642</a>
<a id="L1643" class="source_line" href="#L1643">1643</a>
<a id="L1644" class="source_line" href="#L1644">1644</a>
<a id="L1645" class="source_line" href="#L1645">1645</a>
<a id="L1646" class="source_line" href="#L1646">1646</a>
<a id="L1647" class="source_line" href="#L1647">1647</a>
<a id="L1648" class="source_line" href="#L1648">1648</a>
<a id="L1649" class="source_line" href="#L1649">1649</a>
<a id="L1650" class="source_line" href="#L1650">1650</a>
<a id="L1651" class="source_line" href="#L1651">1651</a>
<a id="L1652" class="source_line" href="#L1652">1652</a>
<a id="L1653" class="source_line" href="#L1653">1653</a>
<a id="L1654" class="source_line" href="#L1654">1654</a>
<a id="L1655" class="source_line" href="#L1655">1655</a>
<a id="L1656" class="source_line" href="#L1656">1656</a>
<a id="L1657" class="source_line" href="#L1657">1657</a>
<a id="L1658" class="source_line" href="#L1658">1658</a>
<a id="L1659" class="source_line" href="#L1659">1659</a>
<a id="L1660" class="source_line" href="#L1660">1660</a>
<a id="L1661" class="source_line" href="#L1661">1661</a>
<a id="L1662" class="source_line" href="#L1662">1662</a>
<a id="L1663" class="source_line" href="#L1663">1663</a>
<a id="L1664" class="source_line" href="#L1664">1664</a>
<a id="L1665" class="source_line" href="#L1665">1665</a>
<a id="L1666" class="source_line" href="#L1666">1666</a>
<a id="L1667" class="source_line" href="#L1667">1667</a>
<a id="L1668" class="source_line" href="#L1668">1668</a>
<a id="L1669" class="source_line" href="#L1669">1669</a>
<a id="L1670" class="source_line" href="#L1670">1670</a>
<a id="L1671" class="source_line" href="#L1671">1671</a>
<a id="L1672" class="source_line" href="#L1672">1672</a>
<a id="L1673" class="source_line" href="#L1673">1673</a>
<a id="L1674" class="source_line" href="#L1674">1674</a>
<a id="L1675" class="source_line" href="#L1675">1675</a>
<a id="L1676" class="source_line" href="#L1676">1676</a>
<a id="L1677" class="source_line" href="#L1677">1677</a>
<a id="L1678" class="source_line" href="#L1678">1678</a>
<a id="L1679" class="source_line" href="#L1679">1679</a>
<a id="L1680" class="source_line" href="#L1680">1680</a>
<a id="L1681" class="source_line" href="#L1681">1681</a>
<a id="L1682" class="source_line" href="#L1682">1682</a>
<a id="L1683" class="source_line" href="#L1683">1683</a>
<a id="L1684" class="source_line" href="#L1684">1684</a>
<a id="L1685" class="source_line" href="#L1685">1685</a>
<a id="L1686" class="source_line" href="#L1686">1686</a>
<a id="L1687" class="source_line" href="#L1687">1687</a>
<a id="L1688" class="source_line" href="#L1688">1688</a>
<a id="L1689" class="source_line" href="#L1689">1689</a>
<a id="L1690" class="source_line" href="#L1690">1690</a>
<a id="L1691" class="source_line" href="#L1691">1691</a>
<a id="L1692" class="source_line" href="#L1692">1692</a>
<a id="L1693" class="source_line" href="#L1693">1693</a>
<a id="L1694" class="source_line" href="#L1694">1694</a>
<a id="L1695" class="source_line" href="#L1695">1695</a>
<a id="L1696" class="source_line" href="#L1696">1696</a>
<a id="L1697" class="source_line" href="#L1697">1697</a>
<a id="L1698" class="source_line" href="#L1698">1698</a>
<a id="L1699" class="source_line" href="#L1699">1699</a>
<a id="L1700" class="source_line" href="#L1700">1700</a>
<a id="L1701" class="source_line" href="#L1701">1701</a>
<a id="L1702" class="source_line" href="#L1702">1702</a>
<a id="L1703" class="source_line" href="#L1703">1703</a>
<a id="L1704" class="source_line" href="#L1704">1704</a>
<a id="L1705" class="source_line" href="#L1705">1705</a>
<a id="L1706" class="source_line" href="#L1706">1706</a>
<a id="L1707" class="source_line" href="#L1707">1707</a>
<a id="L1708" class="source_line" href="#L1708">1708</a>
<a id="L1709" class="source_line" href="#L1709">1709</a>
<a id="L1710" class="source_line" href="#L1710">1710</a>
<a id="L1711" class="source_line" href="#L1711">1711</a>
<a id="L1712" class="source_line" href="#L1712">1712</a>
<a id="L1713" class="source_line" href="#L1713">1713</a>
<a id="L1714" class="source_line" href="#L1714">1714</a>
<a id="L1715" class="source_line" href="#L1715">1715</a>
<a id="L1716" class="source_line" href="#L1716">1716</a>
<a id="L1717" class="source_line" href="#L1717">1717</a>
<a id="L1718" class="source_line" href="#L1718">1718</a>
<a id="L1719" class="source_line" href="#L1719">1719</a>
<a id="L1720" class="source_line" href="#L1720">1720</a>
<a id="L1721" class="source_line" href="#L1721">1721</a>
<a id="L1722" class="source_line" href="#L1722">1722</a>
<a id="L1723" class="source_line" href="#L1723">1723</a>
<a id="L1724" class="source_line" href="#L1724">1724</a>
<a id="L1725" class="source_line" href="#L1725">1725</a>
<a id="L1726" class="source_line" href="#L1726">1726</a>
<a id="L1727" class="source_line" href="#L1727">1727</a>
<a id="L1728" class="source_line" href="#L1728">1728</a>
<a id="L1729" class="source_line" href="#L1729">1729</a>
<a id="L1730" class="source_line" href="#L1730">1730</a>
<a id="L1731" class="source_line" href="#L1731">1731</a>
<a id="L1732" class="source_line" href="#L1732">1732</a>
<a id="L1733" class="source_line" href="#L1733">1733</a>
<a id="L1734" class="source_line" href="#L1734">1734</a>
<a id="L1735" class="source_line" href="#L1735">1735</a>
<a id="L1736" class="source_line" href="#L1736">1736</a>
<a id="L1737" class="source_line" href="#L1737">1737</a>
<a id="L1738" class="source_line" href="#L1738">1738</a>
<a id="L1739" class="source_line" href="#L1739">1739</a>
<a id="L1740" class="source_line" href="#L1740">1740</a>
<a id="L1741" class="source_line" href="#L1741">1741</a>
<a id="L1742" class="source_line" href="#L1742">1742</a>
<a id="L1743" class="source_line" href="#L1743">1743</a>
<a id="L1744" class="source_line" href="#L1744">1744</a>
<a id="L1745" class="source_line" href="#L1745">1745</a>
<a id="L1746" class="source_line" href="#L1746">1746</a>
<a id="L1747" class="source_line" href="#L1747">1747</a>
<a id="L1748" class="source_line" href="#L1748">1748</a>
<a id="L1749" class="source_line" href="#L1749">1749</a>
<a id="L1750" class="source_line" href="#L1750">1750</a>
<a id="L1751" class="source_line" href="#L1751">1751</a>
<a id="L1752" class="source_line" href="#L1752">1752</a>
<a id="L1753" class="source_line" href="#L1753">1753</a>
<a id="L1754" class="source_line" href="#L1754">1754</a>
<a id="L1755" class="source_line" href="#L1755">1755</a>
<a id="L1756" class="source_line" href="#L1756">1756</a>
<a id="L1757" class="source_line" href="#L1757">1757</a>
<a id="L1758" class="source_line" href="#L1758">1758</a>
<a id="L1759" class="source_line" href="#L1759">1759</a>
<a id="L1760" class="source_line" href="#L1760">1760</a>
<a id="L1761" class="source_line" href="#L1761">1761</a>
<a id="L1762" class="source_line" href="#L1762">1762</a>
<a id="L1763" class="source_line" href="#L1763">1763</a>
<a id="L1764" class="source_line" href="#L1764">1764</a>
<a id="L1765" class="source_line" href="#L1765">1765</a>
<a id="L1766" class="source_line" href="#L1766">1766</a>
<a id="L1767" class="source_line" href="#L1767">1767</a>
<a id="L1768" class="source_line" href="#L1768">1768</a>
<a id="L1769" class="source_line" href="#L1769">1769</a>
<a id="L1770" class="source_line" href="#L1770">1770</a>
<a id="L1771" class="source_line" href="#L1771">1771</a>
<a id="L1772" class="source_line" href="#L1772">1772</a>
<a id="L1773" class="source_line" href="#L1773">1773</a>
<a id="L1774" class="source_line" href="#L1774">1774</a>
<a id="L1775" class="source_line" href="#L1775">1775</a>
<a id="L1776" class="source_line" href="#L1776">1776</a>
<a id="L1777" class="source_line" href="#L1777">1777</a>
<a id="L1778" class="source_line" href="#L1778">1778</a>
<a id="L1779" class="source_line" href="#L1779">1779</a>
<a id="L1780" class="source_line" href="#L1780">1780</a>
<a id="L1781" class="source_line" href="#L1781">1781</a>
<a id="L1782" class="source_line" href="#L1782">1782</a>
<a id="L1783" class="source_line" href="#L1783">1783</a>
<a id="L1784" class="source_line" href="#L1784">1784</a>
<a id="L1785" class="source_line" href="#L1785">1785</a>
<a id="L1786" class="source_line" href="#L1786">1786</a>
<a id="L1787" class="source_line" href="#L1787">1787</a>
<a id="L1788" class="source_line" href="#L1788">1788</a>
<a id="L1789" class="source_line" href="#L1789">1789</a>
<a id="L1790" class="source_line" href="#L1790">1790</a>
<a id="L1791" class="source_line" href="#L1791">1791</a>
<a id="L1792" class="source_line" href="#L1792">1792</a>
<a id="L1793" class="source_line" href="#L1793">1793</a>
<a id="L1794" class="source_line" href="#L1794">1794</a>
<a id="L1795" class="source_line" href="#L1795">1795</a>
<a id="L1796" class="source_line" href="#L1796">1796</a>
<a id="L1797" class="source_line" href="#L1797">1797</a>
<a id="L1798" class="source_line" href="#L1798">1798</a>
<a id="L1799" class="source_line" href="#L1799">1799</a>
<a id="L1800" class="source_line" href="#L1800">1800</a>
<a id="L1801" class="source_line" href="#L1801">1801</a>
<a id="L1802" class="source_line" href="#L1802">1802</a>
<a id="L1803" class="source_line" href="#L1803">1803</a>
<a id="L1804" class="source_line" href="#L1804">1804</a>
<a id="L1805" class="source_line" href="#L1805">1805</a>
<a id="L1806" class="source_line" href="#L1806">1806</a>
<a id="L1807" class="source_line" href="#L1807">1807</a>
<a id="L1808" class="source_line" href="#L1808">1808</a>
<a id="L1809" class="source_line" href="#L1809">1809</a>
<a id="L1810" class="source_line" href="#L1810">1810</a>
<a id="L1811" class="source_line" href="#L1811">1811</a>
<a id="L1812" class="source_line" href="#L1812">1812</a>
<a id="L1813" class="source_line" href="#L1813">1813</a>
<a id="L1814" class="source_line" href="#L1814">1814</a>
<a id="L1815" class="source_line" href="#L1815">1815</a>
<a id="L1816" class="source_line" href="#L1816">1816</a>
<a id="L1817" class="source_line" href="#L1817">1817</a>
<a id="L1818" class="source_line" href="#L1818">1818</a>
<a id="L1819" class="source_line" href="#L1819">1819</a>
<a id="L1820" class="source_line" href="#L1820">1820</a>
<a id="L1821" class="source_line" href="#L1821">1821</a>
<a id="L1822" class="source_line" href="#L1822">1822</a>
<a id="L1823" class="source_line" href="#L1823">1823</a>
<a id="L1824" class="source_line" href="#L1824">1824</a>
<a id="L1825" class="source_line" href="#L1825">1825</a>
<a id="L1826" class="source_line" href="#L1826">1826</a>
<a id="L1827" class="source_line" href="#L1827">1827</a>
<a id="L1828" class="source_line" href="#L1828">1828</a>
<a id="L1829" class="source_line" href="#L1829">1829</a>
<a id="L1830" class="source_line" href="#L1830">1830</a>
<a id="L1831" class="source_line" href="#L1831">1831</a>
<a id="L1832" class="source_line" href="#L1832">1832</a>
<a id="L1833" class="source_line" href="#L1833">1833</a>
<a id="L1834" class="source_line" href="#L1834">1834</a>
<a id="L1835" class="source_line" href="#L1835">1835</a>
<a id="L1836" class="source_line" href="#L1836">1836</a>
<a id="L1837" class="source_line" href="#L1837">1837</a>
<a id="L1838" class="source_line" href="#L1838">1838</a>
<a id="L1839" class="source_line" href="#L1839">1839</a>
<a id="L1840" class="source_line" href="#L1840">1840</a>
<a id="L1841" class="source_line" href="#L1841">1841</a>
<a id="L1842" class="source_line" href="#L1842">1842</a>
<a id="L1843" class="source_line" href="#L1843">1843</a>
<a id="L1844" class="source_line" href="#L1844">1844</a>
<a id="L1845" class="source_line" href="#L1845">1845</a>
<a id="L1846" class="source_line" href="#L1846">1846</a>
<a id="L1847" class="source_line" href="#L1847">1847</a>
<a id="L1848" class="source_line" href="#L1848">1848</a>
<a id="L1849" class="source_line" href="#L1849">1849</a>
<a id="L1850" class="source_line" href="#L1850">1850</a>
<a id="L1851" class="source_line" href="#L1851">1851</a>
<a id="L1852" class="source_line" href="#L1852">1852</a>
<a id="L1853" class="source_line" href="#L1853">1853</a>
<a id="L1854" class="source_line" href="#L1854">1854</a>
<a id="L1855" class="source_line" href="#L1855">1855</a>
<a id="L1856" class="source_line" href="#L1856">1856</a>
<a id="L1857" class="source_line" href="#L1857">1857</a>
<a id="L1858" class="source_line" href="#L1858">1858</a>
<a id="L1859" class="source_line" href="#L1859">1859</a>
<a id="L1860" class="source_line" href="#L1860">1860</a>
<a id="L1861" class="source_line" href="#L1861">1861</a>
<a id="L1862" class="source_line" href="#L1862">1862</a>
<a id="L1863" class="source_line" href="#L1863">1863</a>
<a id="L1864" class="source_line" href="#L1864">1864</a>
<a id="L1865" class="source_line" href="#L1865">1865</a>
<a id="L1866" class="source_line" href="#L1866">1866</a>
<a id="L1867" class="source_line" href="#L1867">1867</a>
<a id="L1868" class="source_line" href="#L1868">1868</a>
<a id="L1869" class="source_line" href="#L1869">1869</a>
<a id="L1870" class="source_line" href="#L1870">1870</a>
<a id="L1871" class="source_line" href="#L1871">1871</a>
<a id="L1872" class="source_line" href="#L1872">1872</a>
<a id="L1873" class="source_line" href="#L1873">1873</a>
</code><code class="source_code"><span><span class="OPEN">open</span><span class="BANG">!</span> <a href="import.ml.html"><span class="UIDENT">Import</span></a><span class="EOL">
</span><span id="module-Array"><span class="MODULE">module</span> <span class="UIDENT">Array</span> <span class="EQUAL">=</span> <a href="array0.ml.html"><span class="UIDENT">Array0</span></a></span><span class="EOL">
</span><span id="module-Bytes"><span class="MODULE">module</span> <span class="UIDENT">Bytes</span> <span class="EQUAL">=</span> <a href="bytes0.ml.html"><span class="UIDENT">Bytes0</span></a></span><span class="EOL">
</span><span id="module-Int"><span class="MODULE">module</span> <span class="UIDENT">Int</span> <span class="EQUAL">=</span> <a href="int0.ml.html"><span class="UIDENT">Int0</span></a></span><span class="EOL">
</span><span class="INCLUDE">include</span> <a href="string0.ml.html"><span class="UIDENT">String0</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-invalid_argf"><span class="LIDENT">invalid_argf</span></span> <span class="EQUAL">=</span> <a href="printf.ml.html#val-invalid_argf"><span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">invalid_argf</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-raise_s"><span class="LIDENT">raise_s</span></span> <span class="EQUAL">=</span> <a href="error.ml.html#val-raise_s"><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">raise_s</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-stage"><span class="LIDENT">stage</span></span> <span class="EQUAL">=</span> <a href="staged.ml.html#val-stage"><span class="UIDENT">Staged</span><span class="DOT">.</span><span class="LIDENT">stage</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="module-T"><span class="MODULE">module</span> <span class="UIDENT">T</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-T.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">string</span> <span class="LBRACKETATAT">[@@</span><span class="LIDENT">deriving_inline</span> <span class="LIDENT">globalize</span><span class="COMMA">,</span> <span class="LIDENT">hash</span><span class="COMMA">,</span> <span class="LIDENT">sexp</span><span class="COMMA">,</span> <span class="LIDENT">sexp_grammar</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span id="module-T.val-globalize"><span class="LIDENT">globalize</span></span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="LIDENT">t</span><span class="LBRACKETAT">[@</span><span class="LIDENT">ocaml</span><span class="DOT">.</span><span class="LIDENT">local</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="globalize.ml.html#val-globalize_string"><span class="LIDENT">globalize_string</span></a> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="LIDENT">t</span><span class="LBRACKETAT">[@</span><span class="LIDENT">ocaml</span><span class="DOT">.</span><span class="LIDENT">local</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span id="module-T.val-hash_fold_t"><span class="LIDENT">hash_fold_t</span></span> <span class="COLON">:</span> <a href="../base.base_internalhash_types/base_internalhash_types.ml.html#type-state"><span class="UIDENT">Ppx_hash_lib</span><span class="DOT">.</span><span class="UIDENT">Std</span><span class="DOT">.</span><span class="UIDENT">Hash</span><span class="DOT">.</span><span class="LIDENT">state</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../base.base_internalhash_types/base_internalhash_types.ml.html#type-state"><span class="UIDENT">Ppx_hash_lib</span><span class="DOT">.</span><span class="UIDENT">Std</span><span class="DOT">.</span><span class="UIDENT">Hash</span><span class="DOT">.</span><span class="LIDENT">state</span></a><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="hash.ml.html#module-Folding.val-hash_fold_string"><span class="LIDENT">hash_fold_string</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="AND">and</span> <span class="LPAREN">(</span><span id="module-T.val-hash"><span class="LIDENT">hash</span></span> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../base.base_internalhash_types/base_internalhash_types.ml.html#type-hash_value"><span class="UIDENT">Ppx_hash_lib</span><span class="DOT">.</span><span class="UIDENT">Std</span><span class="DOT">.</span><span class="UIDENT">Hash</span><span class="DOT">.</span><span class="LIDENT">hash_value</span></a><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_func_1"><span class="LIDENT">func</span></span> <span class="EQUAL">=</span> <a href="hash.ml.html#module-Folding.val-hash_string"><span class="LIDENT">hash_string</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="FUN">fun</span> <span id="local_x_2"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_func_1"><span class="LIDENT">func</span></a> <a href="#local_x_2"><span class="LIDENT">x</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-T.val-t_of_sexp"><span class="LIDENT">t_of_sexp</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-string_of_sexp"><span class="LIDENT">string_of_sexp</span></a> <span class="COLON">:</span> <a href="../../../sexplib0/src/sexplib0/sexp.ml.html#type-t"><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-T.val-sexp_of_t"><span class="LIDENT">sexp_of_t</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_string"><span class="LIDENT">sexp_of_string</span></a> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../sexplib0/src/sexplib0/sexp.ml.html#type-t"><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="LPAREN">(</span><span id="module-T.val-t_sexp_grammar"><span class="LIDENT">t_sexp_grammar</span></span> <span class="COLON">:</span> <a href="../../../sexplib0/src/sexplib0/sexp_grammar.ml.html#type-t"><span class="LIDENT">t</span> <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp_grammar</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv_grammar.ml.html#val-string_sexp_grammar"><span class="LIDENT">string_sexp_grammar</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LBRACKETATATAT">[@@@</span><span class="END">end</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-T.val-hashable"><span class="LIDENT">hashable</span></span> <span class="COLON">:</span> <a href="hashable_intf.ml.html#module-Hashable.type-t"><span class="LIDENT">t</span> <span class="UIDENT">Hashable</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span class="LIDENT">hash</span><span class="SEMI">;</span> <span class="LIDENT">compare</span><span class="SEMI">;</span> <span class="LIDENT">sexp_of_t</span> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-T.val-compare"><span class="LIDENT">compare</span></span> <span class="EQUAL">=</span> <span class="LIDENT">compare</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <span class="UIDENT">T</span><span class="EOL">
</span><span class="INCLUDE">include</span> <a href="comparator.ml.html#module-Make"><span class="UIDENT">Comparator</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">T</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-elt"><span class="TYPE">type</span> <span class="LIDENT">elt</span> <span class="EQUAL">=</span> <span class="LIDENT">char</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-invariant"><span class="LIDENT">invariant</span></span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* This is copied/adapted from 'blit.ml'.
   [sub], [subo] could be implemented using [Blit.Make(Bytes)] plus unsafe casts to/from
   string but were inlined here to avoid using [Bytes.unsafe_of_string] as much as possible.
*)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-unsafe_sub"><span class="LIDENT">unsafe_sub</span></span> <span id="local_src_3"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_pos_4"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_5"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_len_5"><span class="LIDENT">len</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>  <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_dst_6"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_len_5"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_blit_string</span> <span class="TILDE">~</span><a href="#local_src_3"><span class="LIDENT">src</span></a> <span class="LABEL">~src_pos:</span><a href="#local_pos_4"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_dst_6"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_len_5"><span class="LIDENT">len</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_dst_6"><span class="LIDENT">dst</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-sub"><span class="LIDENT">sub</span></span> <span id="local_src_7"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_pos_8"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_9"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_pos_8"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_len_9"><span class="LIDENT">len</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_src_7"><span class="LIDENT">src</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_src_7"><span class="LIDENT">src</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <a href="ordered_collection_common0.ml.html#val-check_pos_len_exn"><span class="UIDENT">Ordered_collection_common</span><span class="DOT">.</span><span class="LIDENT">check_pos_len_exn</span></a> <span class="TILDE">~</span><a href="#local_pos_8"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_9"><span class="LIDENT">len</span></a> <span class="LABEL">~total_length:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_src_7"><span class="LIDENT">src</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">unsafe_sub</span> <a href="#local_src_7"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_pos_8"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_9"><span class="LIDENT">len</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-subo"><span class="LIDENT">subo</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_pos_10"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_len_11"><span class="LIDENT">len</span></span> <span id="local_src_12"><span class="LIDENT">src</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">sub</span><span class="EOL">
</span>    <a href="#local_src_12"><span class="LIDENT">src</span></a><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_pos_10"><span class="LIDENT">pos</span></a><span class="EOL">
</span>    <span class="LABEL">~len:</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_len_11"><span class="LIDENT">len</span></a> <span class="WITH">with</span><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_i_13"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_i_13"><span class="LIDENT">i</span></a><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">length</span> <a href="#local_src_12"><span class="LIDENT">src</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos_10"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-contains_unsafe"><span class="LIDENT">contains_unsafe</span></span> <span id="local_t_14"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pos_15"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_end__16"><span class="LIDENT">end_</span></span> <span id="local_char_17"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="#local_pos_15"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_end__16"><span class="LIDENT">end_</span></a><span class="EOL">
</span>  <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LPAREN">(</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_t_14"><span class="LIDENT">t</span></a> <a href="#local_pos_15"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <a href="#local_char_17"><span class="LIDENT">char</span></a> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">contains_unsafe</span> <a href="#local_t_14"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_15"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_end__16"><span class="LIDENT">end_</span></a> <a href="#local_char_17"><span class="LIDENT">char</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-contains"><span class="LIDENT">contains</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_pos_18"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span id="local_len_19"><span class="LIDENT">len</span></span> <span id="local_t_20"><span class="LIDENT">t</span></span> <span id="local_char_21"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_total_length_22"><span class="LIDENT">total_length</span></span> <span class="EQUAL">=</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_t_20"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_23"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="option.ml.html#val-value"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">value</span></a> <a href="#local_len_19"><span class="LIDENT">len</span></a> <span class="LABEL">~default:</span><span class="LPAREN">(</span><a href="#local_total_length_22"><span class="LIDENT">total_length</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos_18"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="ordered_collection_common0.ml.html#val-check_pos_len_exn"><span class="UIDENT">Ordered_collection_common</span><span class="DOT">.</span><span class="LIDENT">check_pos_len_exn</span></a> <span class="TILDE">~</span><a href="#local_pos_18"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_23"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_total_length_22"><span class="LIDENT">total_length</span></a><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">contains_unsafe</span> <a href="#local_t_20"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_18"><span class="LIDENT">pos</span></a> <span class="LABEL">~end_:</span><span class="LPAREN">(</span><a href="#local_pos_18"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_23"><span class="LIDENT">len</span></a><span class="RPAREN">)</span> <a href="#local_char_21"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_empty"><span class="LIDENT">is_empty</span></span> <span id="local_t_24"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_24"><span class="LIDENT">t</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-index_from_exn_internal"><span class="LIDENT">index_from_exn_internal</span></span> <span id="local_string_25"><span class="LIDENT">string</span></span> <span class="TILDE">~</span><span id="local_pos_26"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_27"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_not_found_28"><span class="LIDENT">not_found</span></span> <span id="local_char_29"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_pos_26"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_len_27"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="import0.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_not_found_28"><span class="LIDENT">not_found</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_string_25"><span class="LIDENT">string</span></a> <a href="#local_pos_26"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <a href="#local_char_29"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_pos_26"><span class="LIDENT">pos</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LIDENT">index_from_exn_internal</span> <a href="#local_string_25"><span class="LIDENT">string</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_26"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_27"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_not_found_28"><span class="LIDENT">not_found</span></a> <a href="#local_char_29"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-index_exn_internal"><span class="LIDENT">index_exn_internal</span></span> <span id="local_t_30"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_not_found_31"><span class="LIDENT">not_found</span></span> <span id="local_char_32"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">index_from_exn_internal</span> <a href="#local_t_30"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_30"><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_not_found_31"><span class="LIDENT">not_found</span></a> <a href="#local_char_32"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-index_exn"><span class="LIDENT">index_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_33"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.index_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_index_exn_34"><span class="LIDENT">index_exn</span></span> <span id="local_t_35"><span class="LIDENT">t</span></span> <span id="local_char_36"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_exn_internal</span> <a href="#local_t_35"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_not_found_33"><span class="LIDENT">not_found</span></a> <a href="#local_char_36"><span class="LIDENT">char</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_index_exn_34"><span class="LIDENT">index_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-index_from_exn"><span class="LIDENT">index_from_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_37"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.index_from_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_index_from_exn_38"><span class="LIDENT">index_from_exn</span></span> <span id="local_t_39"><span class="LIDENT">t</span></span> <span id="local_pos_40"><span class="LIDENT">pos</span></span> <span id="local_char_41"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_42"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_39"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_pos_40"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_pos_40"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <a href="#local_len_42"><span class="LIDENT">len</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <a href="import0.ml.html#val-invalid_arg"><span class="LIDENT">invalid_arg</span></a> <span class="STRING">&quot;String.index_from_exn&quot;</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LIDENT">index_from_exn_internal</span> <a href="#local_t_39"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_40"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_42"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_not_found_37"><span class="LIDENT">not_found</span></a> <a href="#local_char_41"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_index_from_exn_38"><span class="LIDENT">index_from_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-rindex_from_exn_internal"><span class="LIDENT">rindex_from_exn_internal</span></span> <span id="local_string_43"><span class="LIDENT">string</span></span> <span class="TILDE">~</span><span id="local_pos_44"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_45"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_not_found_46"><span class="LIDENT">not_found</span></span> <span id="local_char_47"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_pos_44"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span><span class="EOL">
</span>  <span class="THEN">then</span> <a href="import0.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_not_found_46"><span class="LIDENT">not_found</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_string_43"><span class="LIDENT">string</span></a> <a href="#local_pos_44"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <a href="#local_char_47"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_pos_44"><span class="LIDENT">pos</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LIDENT">rindex_from_exn_internal</span> <a href="#local_string_43"><span class="LIDENT">string</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_44"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_45"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_not_found_46"><span class="LIDENT">not_found</span></a> <a href="#local_char_47"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rindex_exn_internal"><span class="LIDENT">rindex_exn_internal</span></span> <span id="local_t_48"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_not_found_49"><span class="LIDENT">not_found</span></span> <span id="local_char_50"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_51"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_48"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">rindex_from_exn_internal</span> <a href="#local_t_48"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_len_51"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_51"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_not_found_49"><span class="LIDENT">not_found</span></a> <a href="#local_char_50"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rindex_exn"><span class="LIDENT">rindex_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_52"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.rindex_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_rindex_exn_53"><span class="LIDENT">rindex_exn</span></span> <span id="local_t_54"><span class="LIDENT">t</span></span> <span id="local_char_55"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">rindex_exn_internal</span> <a href="#local_t_54"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_not_found_52"><span class="LIDENT">not_found</span></a> <a href="#local_char_55"><span class="LIDENT">char</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_rindex_exn_53"><span class="LIDENT">rindex_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rindex_from_exn"><span class="LIDENT">rindex_from_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_56"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.rindex_from_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_rindex_from_exn_57"><span class="LIDENT">rindex_from_exn</span></span> <span id="local_t_58"><span class="LIDENT">t</span></span> <span id="local_pos_59"><span class="LIDENT">pos</span></span> <span id="local_char_60"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_61"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_58"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_pos_59"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="MINUS">-</span><span class="INT">1</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_pos_59"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_len_61"><span class="LIDENT">len</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <a href="import0.ml.html#val-invalid_arg"><span class="LIDENT">invalid_arg</span></a> <span class="STRING">&quot;String.rindex_from_exn&quot;</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LIDENT">rindex_from_exn_internal</span> <a href="#local_t_58"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_59"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_61"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_not_found_56"><span class="LIDENT">not_found</span></a> <a href="#local_char_60"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_rindex_from_exn_57"><span class="LIDENT">rindex_from_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-index"><span class="LIDENT">index</span></span> <span id="local_t_62"><span class="LIDENT">t</span></span> <span id="local_char_63"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">index_exn</span> <a href="#local_t_62"><span class="LIDENT">t</span></a> <a href="#local_char_63"><span class="LIDENT">char</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rindex"><span class="LIDENT">rindex</span></span> <span id="local_t_64"><span class="LIDENT">t</span></span> <span id="local_char_65"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">rindex_exn</span> <a href="#local_t_64"><span class="LIDENT">t</span></a> <a href="#local_char_65"><span class="LIDENT">char</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-index_from"><span class="LIDENT">index_from</span></span> <span id="local_t_66"><span class="LIDENT">t</span></span> <span id="local_pos_67"><span class="LIDENT">pos</span></span> <span id="local_char_68"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">index_from_exn</span> <a href="#local_t_66"><span class="LIDENT">t</span></a> <a href="#local_pos_67"><span class="LIDENT">pos</span></a> <a href="#local_char_68"><span class="LIDENT">char</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rindex_from"><span class="LIDENT">rindex_from</span></span> <span id="local_t_69"><span class="LIDENT">t</span></span> <span id="local_pos_70"><span class="LIDENT">pos</span></span> <span id="local_char_71"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">rindex_from_exn</span> <a href="#local_t_69"><span class="LIDENT">t</span></a> <a href="#local_pos_70"><span class="LIDENT">pos</span></a> <a href="#local_char_71"><span class="LIDENT">char</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Search_pattern0"><span class="MODULE">module</span> <span class="UIDENT">Search_pattern0</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Search_pattern0.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span id="def_875"><span class="LIDENT">pattern</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_872"><span class="LIDENT">case_sensitive</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="EOL">
</span>    <span class="SEMI">;</span></span> <span id="def_869"><span class="LIDENT">kmp_array</span> <span class="COLON">:</span> <span class="LIDENT">int</span> <span class="LIDENT">array</span></span><span class="EOL">
</span>    <span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-sexp_of_t"><span class="LIDENT">sexp_of_t</span></span> <span class="LBRACE">{</span> <span id="local_pattern_72"><span class="LIDENT">pattern</span></span><span class="SEMI">;</span> <span id="local_case_sensitive_73"><span class="LIDENT">case_sensitive</span></span><span class="SEMI">;</span> <span class="LIDENT">kmp_array</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="COLON">:</span> <a href="sexp.ml.html#type-t"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">List</span><span class="EOL">
</span>      <span class="LBRACKET">[</span> <span class="UIDENT">List</span> <span class="LBRACKET">[</span> <span class="UIDENT">Atom</span> <span class="STRING">&quot;pattern&quot;</span><span class="SEMI">;</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_string"><span class="LIDENT">sexp_of_string</span></a> <a href="#local_pattern_72"><span class="LIDENT">pattern</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="SEMI">;</span> <span class="UIDENT">List</span> <span class="LBRACKET">[</span> <span class="UIDENT">Atom</span> <span class="STRING">&quot;case_sensitive&quot;</span><span class="SEMI">;</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_bool"><span class="LIDENT">sexp_of_bool</span></a> <a href="#local_case_sensitive_73"><span class="LIDENT">case_sensitive</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-pattern"><span class="LIDENT">pattern</span></span> <span id="local_t_74"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_74"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-case_sensitive"><span class="LIDENT">case_sensitive</span></span> <span id="local_t_75"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="#local_t_75"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">case_sensitive</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Find max number of matched characters at [next_text_char], given the current
     [matched_chars]. Try to extend the current match, if chars don't match, try to match
     fewer chars. If chars match then extend the match. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-kmp_internal_loop"><span class="LIDENT">kmp_internal_loop</span></span> <span class="TILDE">~</span><span id="local_matched_chars_76"><span class="LIDENT">matched_chars</span></span> <span class="TILDE">~</span><span id="local_next_text_char_77"><span class="LIDENT">next_text_char</span></span> <span class="TILDE">~</span><span id="local_pattern_78"><span class="LIDENT">pattern</span></span> <span class="TILDE">~</span><span id="local_kmp_array_79"><span class="LIDENT">kmp_array</span></span> <span class="TILDE">~</span><span id="local_char_equal_80"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_matched_chars_81"><span class="LIDENT">matched_chars</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_matched_chars_76"><span class="LIDENT">matched_chars</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="WHILE">while</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_char_equal_80"><span class="LIDENT">char_equal</span></a> <a href="#local_next_text_char_77"><span class="LIDENT">next_text_char</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_pattern_78"><span class="LIDENT">pattern</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="DO">do</span><span class="EOL">
</span>      <a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">unsafe_get</span> <a href="#local_kmp_array_79"><span class="LIDENT">kmp_array</span></a> <span class="LPAREN">(</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_char_equal_80"><span class="LIDENT">char_equal</span></a> <a href="#local_next_text_char_77"><span class="LIDENT">next_text_char</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_pattern_78"><span class="LIDENT">pattern</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_81"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-get_char_equal"><span class="LIDENT">get_char_equal</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_82"><span class="LIDENT">case_sensitive</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_case_sensitive_82"><span class="LIDENT">case_sensitive</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="TRUE">true</span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="FALSE">false</span> <span class="MINUSGREATER">-&gt;</span> <a href="comparable.ml.html#module-Comparisons.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="UIDENT">Caseless</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Classic KMP pre-processing of the pattern: build the int array, which, for each i,
     contains the length of the longest non-trivial prefix of s which is equal to a suffix
     ending at s.[i] *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-create"><span class="LIDENT">create</span></span> <span id="local_pattern_83"><span class="LIDENT">pattern</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_84"><span class="LIDENT">case_sensitive</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_n_85"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_pattern_83"><span class="LIDENT">pattern</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_kmp_array_86"><span class="LIDENT">kmp_array</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~len:</span><a href="#local_n_85"><span class="LIDENT">n</span></a> <span class="LPAREN">(</span><span class="MINUS">-</span><span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_n_85"><span class="LIDENT">n</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_char_equal_87"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span> <span class="LIDENT">get_char_equal</span> <span class="TILDE">~</span><a href="#local_case_sensitive_84"><span class="LIDENT">case_sensitive</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_kmp_array_86"><span class="LIDENT">kmp_array</span></a> <span class="INT">0</span> <span class="INT">0</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_matched_chars_88"><span class="LIDENT">matched_chars</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">1</span> <span class="TO">to</span> <a href="#local_n_85"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>        <a href="#local_matched_chars_88"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>        <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LIDENT">kmp_internal_loop</span><span class="EOL">
</span>             <span class="LABEL">~matched_chars:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_88"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>             <span class="LABEL">~next_text_char:</span><span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_pattern_83"><span class="LIDENT">pattern</span></a> <span class="LIDENT">i</span><span class="RPAREN">)</span><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_pattern_83"><span class="LIDENT">pattern</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_kmp_array_86"><span class="LIDENT">kmp_array</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_char_equal_87"><span class="LIDENT">char_equal</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_kmp_array_86"><span class="LIDENT">kmp_array</span></a> <span class="LIDENT">i</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_88"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>      <span class="DONE">done</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <a href="#local_pattern_83"><span class="LIDENT">pattern</span></a><span class="SEMI">;</span> <a href="#local_case_sensitive_84"><span class="LIDENT">case_sensitive</span></a><span class="SEMI">;</span> <a href="#local_kmp_array_86"><span class="LIDENT">kmp_array</span></a> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Classic KMP: use the pre-processed pattern to optimize look-behinds on non-matches.
     We return int to avoid allocation in [index_exn]. -1 means no match. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-index_internal"><span class="LIDENT">index_internal</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_pos_89"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="RPAREN">)</span> <span class="LBRACE">{</span> <span id="local_pattern_90"><span class="LIDENT">pattern</span></span><span class="SEMI">;</span> <span id="local_case_sensitive_91"><span class="LIDENT">case_sensitive</span></span><span class="SEMI">;</span> <span id="local_kmp_array_92"><span class="LIDENT">kmp_array</span></span> <span class="RBRACE">}</span> <span class="LABEL">~in_:</span><span id="local_text_93"><span class="LIDENT">text</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_pos_89"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_pos_89"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="LIDENT">length</span> <a href="#local_text_93"><span class="LIDENT">text</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="LIDENT">length</span> <a href="#local_pattern_90"><span class="LIDENT">pattern</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <span class="MINUS">-</span><span class="INT">1</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_char_equal_94"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span> <span class="LIDENT">get_char_equal</span> <span class="TILDE">~</span><a href="#local_case_sensitive_91"><span class="LIDENT">case_sensitive</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_j_95"><span class="LIDENT">j</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_pos_89"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_matched_chars_96"><span class="LIDENT">matched_chars</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_k_97"><span class="LIDENT">k</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_pattern_90"><span class="LIDENT">pattern</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_n_98"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_text_93"><span class="LIDENT">text</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_j_95"><span class="LIDENT">j</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_98"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_96"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_k_97"><span class="LIDENT">k</span></a> <span class="DO">do</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_next_text_char_99"><span class="LIDENT">next_text_char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_text_93"><span class="LIDENT">text</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_j_95"><span class="LIDENT">j</span></a> <span class="IN">in</span><span class="EOL">
</span>        <a href="#local_matched_chars_96"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>        <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LIDENT">kmp_internal_loop</span><span class="EOL">
</span>             <span class="LABEL">~matched_chars:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_96"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_next_text_char_99"><span class="LIDENT">next_text_char</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_pattern_90"><span class="LIDENT">pattern</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_kmp_array_92"><span class="LIDENT">kmp_array</span></a><span class="EOL">
</span>             <span class="TILDE">~</span><a href="#local_char_equal_94"><span class="LIDENT">char_equal</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_j_95"><span class="LIDENT">j</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_j_95"><span class="LIDENT">j</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_96"><span class="LIDENT">matched_chars</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_k_97"><span class="LIDENT">k</span></a> <span class="THEN">then</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_j_95"><span class="LIDENT">j</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_k_97"><span class="LIDENT">k</span></a> <span class="ELSE">else</span> <span class="MINUS">-</span><span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-matches"><span class="LIDENT">matches</span></span> <span id="local_t_100"><span class="LIDENT">t</span></span> <span id="local_str_101"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_internal</span> <a href="#local_t_100"><span class="LIDENT">t</span></a> <span class="LABEL">~in_:</span><a href="#local_str_101"><span class="LIDENT">str</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">0</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-index"><span class="LIDENT">index</span></span> <span class="QUESTION">?</span><span id="local_pos_102"><span class="LIDENT">pos</span></span> <span id="local_t_103"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_in__104"><span class="LIDENT">in_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_p_105"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_internal</span> <span class="QUESTION">?</span><a href="#local_pos_102"><span class="LIDENT">pos</span></a> <a href="#local_t_103"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_in__104"><span class="LIDENT">in_</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_p_105"><span class="LIDENT">p</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="UIDENT">None</span> <span class="ELSE">else</span> <span class="UIDENT">Some</span> <a href="#local_p_105"><span class="LIDENT">p</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-index_exn"><span class="LIDENT">index_exn</span></span> <span class="QUESTION">?</span><span id="local_pos_106"><span class="LIDENT">pos</span></span> <span id="local_t_107"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_in__108"><span class="LIDENT">in_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_p_109"><span class="LIDENT">p</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_internal</span> <span class="QUESTION">?</span><a href="#local_pos_106"><span class="LIDENT">pos</span></a> <a href="#local_t_107"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_in__108"><span class="LIDENT">in_</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_p_109"><span class="LIDENT">p</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">0</span><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_p_109"><span class="LIDENT">p</span></a><span class="EOL">
</span>    <span class="ELSE">else</span><span class="EOL">
</span>      <span class="LIDENT">raise_s</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp.ml.html#val-message"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">message</span></a> <span class="STRING">&quot;Substring not found&quot;</span> <span class="LBRACKET">[</span> <span class="STRING">&quot;substring&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_string"><span class="LIDENT">sexp_of_string</span></a> <a href="#local_t_107"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span> <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-index_all"><span class="LIDENT">index_all</span></span> <span class="LBRACE">{</span> <span id="local_pattern_110"><span class="LIDENT">pattern</span></span><span class="SEMI">;</span> <span id="local_case_sensitive_111"><span class="LIDENT">case_sensitive</span></span><span class="SEMI">;</span> <span id="local_kmp_array_112"><span class="LIDENT">kmp_array</span></span> <span class="RBRACE">}</span> <span class="TILDE">~</span><span id="local_may_overlap_113"><span class="LIDENT">may_overlap</span></span> <span class="LABEL">~in_:</span><span id="local_text_114"><span class="LIDENT">text</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="LIDENT">length</span> <a href="#local_pattern_110"><span class="LIDENT">pattern</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>    <span class="THEN">then</span> <a href="list.ml.html#val-init"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">init</span></a> <span class="LPAREN">(</span><span class="INT">1</span> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="LIDENT">length</span> <a href="#local_text_114"><span class="LIDENT">text</span></a><span class="RPAREN">)</span> <span class="LABEL">~f:</span><a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_char_equal_115"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span> <span class="LIDENT">get_char_equal</span> <span class="TILDE">~</span><a href="#local_case_sensitive_111"><span class="LIDENT">case_sensitive</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_matched_chars_116"><span class="LIDENT">matched_chars</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_k_117"><span class="LIDENT">k</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_pattern_110"><span class="LIDENT">pattern</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_n_118"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_text_114"><span class="LIDENT">text</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_found_119"><span class="LIDENT">found</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FOR">for</span> <span class="LIDENT">j</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_n_118"><span class="LIDENT">n</span></a> <span class="DO">do</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_116"><span class="LIDENT">matched_chars</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_k_117"><span class="LIDENT">k</span></a><span class="EOL">
</span>        <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <a href="#local_found_119"><span class="LIDENT">found</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><span class="LIDENT">j</span> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_k_117"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_found_119"><span class="LIDENT">found</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <span class="COMMENT">(* we just found a match in the previous iteration *)</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_may_overlap_113"><span class="LIDENT">may_overlap</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="TRUE">true</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_matched_chars_116"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">unsafe_get</span> <a href="#local_kmp_array_112"><span class="LIDENT">kmp_array</span></a> <span class="LPAREN">(</span><a href="#local_k_117"><span class="LIDENT">k</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="FALSE">false</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_matched_chars_116"><span class="LIDENT">matched_chars</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="INT">0</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="IF">if</span> <span class="LIDENT">j</span> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_118"><span class="LIDENT">n</span></a><span class="EOL">
</span>        <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_next_text_char_120"><span class="LIDENT">next_text_char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_text_114"><span class="LIDENT">text</span></a> <span class="LIDENT">j</span> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_matched_chars_116"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>          <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LIDENT">kmp_internal_loop</span><span class="EOL">
</span>               <span class="LABEL">~matched_chars:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_matched_chars_116"><span class="LIDENT">matched_chars</span></a><span class="EOL">
</span>               <span class="TILDE">~</span><a href="#local_next_text_char_120"><span class="LIDENT">next_text_char</span></a><span class="EOL">
</span>               <span class="TILDE">~</span><a href="#local_pattern_110"><span class="LIDENT">pattern</span></a><span class="EOL">
</span>               <span class="TILDE">~</span><a href="#local_kmp_array_112"><span class="LIDENT">kmp_array</span></a><span class="EOL">
</span>               <span class="TILDE">~</span><a href="#local_char_equal_115"><span class="LIDENT">char_equal</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="list0.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_found_119"><span class="LIDENT">found</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-replace_first"><span class="LIDENT">replace_first</span></span> <span class="QUESTION">?</span><span id="local_pos_121"><span class="LIDENT">pos</span></span> <span id="local_t_122"><span class="LIDENT">t</span></span> <span class="LABEL">~in_:</span><span id="local_s_123"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_with__124"><span class="LIDENT">with_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">index</span> <span class="QUESTION">?</span><a href="#local_pos_121"><span class="LIDENT">pos</span></a> <a href="#local_t_122"><span class="LIDENT">t</span></a> <span class="LABEL">~in_:</span><a href="#local_s_123"><span class="LIDENT">s</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_s_123"><span class="LIDENT">s</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_i_125"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_s_126"><span class="LIDENT">len_s</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_123"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_t_127"><span class="LIDENT">len_t</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_122"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_with_128"><span class="LIDENT">len_with</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_with__124"><span class="LIDENT">with_</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dst_129"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_len_s_126"><span class="LIDENT">len_s</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_with_128"><span class="LIDENT">len_with</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_t_127"><span class="LIDENT">len_t</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_s_123"><span class="LIDENT">s</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_dst_129"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_i_125"><span class="LIDENT">i</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_with__124"><span class="LIDENT">with_</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_dst_129"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><a href="#local_i_125"><span class="LIDENT">i</span></a> <span class="LABEL">~len:</span><a href="#local_len_with_128"><span class="LIDENT">len_with</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span><span class="EOL">
</span>        <span class="LABEL">~src:</span><a href="#local_s_123"><span class="LIDENT">s</span></a><span class="EOL">
</span>        <span class="LABEL">~src_pos:</span><span class="LPAREN">(</span><a href="#local_i_125"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_t_127"><span class="LIDENT">len_t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_dst_129"><span class="LIDENT">dst</span></a><span class="EOL">
</span>        <span class="LABEL">~dst_pos:</span><span class="LPAREN">(</span><a href="#local_i_125"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_with_128"><span class="LIDENT">len_with</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_s_126"><span class="LIDENT">len_s</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_125"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_t_127"><span class="LIDENT">len_t</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_dst_129"><span class="LIDENT">dst</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-replace_all"><span class="LIDENT">replace_all</span></span> <span id="local_t_130"><span class="LIDENT">t</span></span> <span class="LABEL">~in_:</span><span id="local_s_131"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_with__132"><span class="LIDENT">with_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_matches_133"><span class="LIDENT">matches</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_all</span> <a href="#local_t_130"><span class="LIDENT">t</span></a> <span class="LABEL">~may_overlap:</span><span class="FALSE">false</span> <span class="LABEL">~in_:</span><a href="#local_s_131"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_matches_133"><span class="LIDENT">matches</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_s_131"><span class="LIDENT">s</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="COLONCOLON">::</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_s_134"><span class="LIDENT">len_s</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_131"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_t_135"><span class="LIDENT">len_t</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_130"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_with_136"><span class="LIDENT">len_with</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_with__132"><span class="LIDENT">with_</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_num_matches_137"><span class="LIDENT">num_matches</span></span> <span class="EQUAL">=</span> <a href="list0.ml.html#val-length"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_matches_133"><span class="LIDENT">matches</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dst_138"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_len_s_134"><span class="LIDENT">len_s</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="LPAREN">(</span><span class="LPAREN">(</span><a href="#local_len_with_136"><span class="LIDENT">len_with</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_t_135"><span class="LIDENT">len_t</span></a><span class="RPAREN">)</span> <a href="import0.ml.html#val-(*)"><span class="STAR">*</span></a> <a href="#local_num_matches_137"><span class="LIDENT">num_matches</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="list0.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <a href="#local_matches_133"><span class="LIDENT">matches</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_141"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_len_142"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="#local_i_141"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_s_131"><span class="LIDENT">s</span></a> <span class="LABEL">~src_pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a> <span class="TILDE">~</span><a href="#local_dst_138"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></a> <span class="TILDE">~</span><a href="#local_len_142"><span class="LIDENT">len</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span><span class="EOL">
</span>          <span class="LABEL">~src:</span><a href="#local_with__132"><span class="LIDENT">with_</span></a><span class="EOL">
</span>          <span class="LABEL">~src_pos:</span><span class="INT">0</span><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_dst_138"><span class="LIDENT">dst</span></a><span class="EOL">
</span>          <span class="LABEL">~dst_pos:</span><span class="LPAREN">(</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_142"><span class="LIDENT">len</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="LABEL">~len:</span><a href="#local_len_with_136"><span class="LIDENT">len_with</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_142"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_with_136"><span class="LIDENT">len_with</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_142"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_len_t_135"><span class="LIDENT">len_t</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span><span class="EOL">
</span>        <span class="LABEL">~src:</span><a href="#local_s_131"><span class="LIDENT">s</span></a><span class="EOL">
</span>        <span class="LABEL">~src_pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_dst_138"><span class="LIDENT">dst</span></a><span class="EOL">
</span>        <span class="LABEL">~dst_pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_dst_pos_139"><span class="LIDENT">next_dst_pos</span></a><span class="EOL">
</span>        <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_s_134"><span class="LIDENT">len_s</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_next_src_pos_140"><span class="LIDENT">next_src_pos</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_dst_138"><span class="LIDENT">dst</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern0.val-split_on"><span class="LIDENT">split_on</span></span> <span id="local_t_143"><span class="LIDENT">t</span></span> <span id="local_s_144"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_pattern_len_145"><span class="LIDENT">pattern_len</span></span> <span class="EQUAL">=</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_t_143"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_matches_146"><span class="LIDENT">matches</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_all</span> <a href="#local_t_143"><span class="LIDENT">t</span></a> <span class="LABEL">~may_overlap:</span><span class="FALSE">false</span> <span class="LABEL">~in_:</span><a href="#local_s_144"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="list.ml.html#val-map2_exn"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map2_exn</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="import0.ml.html#val-(~-)"><span class="MINUS">-</span></a><a href="#local_pattern_len_145"><span class="LIDENT">pattern_len</span></a> <span class="COLONCOLON">::</span> <a href="#local_matches_146"><span class="LIDENT">matches</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="#local_matches_146"><span class="LIDENT">matches</span></a> <a href="import0.ml.html#val-(@)"><span class="INFIXOP1">@</span></a> <span class="LBRACKET">[</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_s_144"><span class="LIDENT">s</span></a> <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_147"><span class="LIDENT">i</span></span> <span id="local_j_148"><span class="LIDENT">j</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">sub</span> <a href="#local_s_144"><span class="LIDENT">s</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_i_147"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_pattern_len_145"><span class="LIDENT">pattern_len</span></a><span class="RPAREN">)</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_j_148"><span class="LIDENT">j</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_147"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pattern_len_145"><span class="LIDENT">pattern_len</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="module-Search_pattern0.module-Private"><span class="MODULE">module</span> <span class="UIDENT">Private</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Search_pattern0.module-Private.type-public"><span class="TYPE">type</span> <span class="LIDENT">public</span> <span class="EQUAL">=</span> <span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span id="module-Search_pattern0.module-Private.type-t"><span class="TYPE">type</span> <span class="NONREC">nonrec</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LBRACE">{</span> <span id="def_876"><span class="LIDENT">pattern</span> <span class="COLON">:</span> <span class="LIDENT">string</span><span class="EOL">
</span>      <span class="SEMI">;</span></span> <span id="def_870"><span class="LIDENT">case_sensitive</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="EOL">
</span>      <span class="SEMI">;</span></span> <span id="def_873"><span class="LIDENT">kmp_array</span> <span class="COLON">:</span> <span class="LIDENT">int</span> <span class="LIDENT">array</span></span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="LBRACKETATAT">[@@</span><span class="LIDENT">deriving_inline</span> <span class="LIDENT">equal</span><span class="COMMA">,</span> <span class="LIDENT">sexp_of</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Search_pattern0.module-Private.val-equal"><span class="LIDENT">equal</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_a__003__149"><span class="LIDENT">a__003_</span></span> <span id="local_b__004__150"><span class="LIDENT">b__004_</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="IF">if</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(==)"><span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="INFIXOP0">==</span> <span class="RPAREN">)</span></a> <a href="#local_a__003__149"><span class="LIDENT">a__003_</span></a> <a href="#local_b__004__150"><span class="LIDENT">b__004_</span></a><span class="EOL">
</span>         <span class="THEN">then</span> <span class="TRUE">true</span><span class="EOL">
</span>         <span class="ELSE">else</span><span class="EOL">
</span>           <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="AMPERAMPER">&amp;&amp;</span> <span class="RPAREN">)</span></a><span class="EOL">
</span>             <span class="LPAREN">(</span><a href="ppx_compare_lib.ml.html#module-Builtin.val-equal_string"><span class="LIDENT">equal_string</span></a> <a href="#local_a__003__149"><span class="LIDENT">a__003_</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span> <a href="#local_b__004__150"><span class="LIDENT">b__004_</span></a><span class="DOT">.</span><span class="LIDENT">pattern</span><span class="RPAREN">)</span><span class="EOL">
</span>             <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="AMPERAMPER">&amp;&amp;</span> <span class="RPAREN">)</span></a><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="ppx_compare_lib.ml.html#module-Builtin.val-equal_bool"><span class="LIDENT">equal_bool</span></a> <a href="#local_a__003__149"><span class="LIDENT">a__003_</span></a><span class="DOT">.</span><span class="LIDENT">case_sensitive</span> <a href="#local_b__004__150"><span class="LIDENT">b__004_</span></a><span class="DOT">.</span><span class="LIDENT">case_sensitive</span><span class="RPAREN">)</span><span class="EOL">
</span>                <span class="LPAREN">(</span><a href="ppx_compare_lib.ml.html#module-Builtin.val-equal_array"><span class="LIDENT">equal_array</span></a> <a href="ppx_compare_lib.ml.html#module-Builtin.val-equal_int"><span class="LIDENT">equal_int</span></a> <a href="#local_a__003__149"><span class="LIDENT">a__003_</span></a><span class="DOT">.</span><span class="LIDENT">kmp_array</span> <a href="#local_b__004__150"><span class="LIDENT">b__004_</span></a><span class="DOT">.</span><span class="LIDENT">kmp_array</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>           <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Search_pattern0.module-Private.val-sexp_of_t"><span class="LIDENT">sexp_of_t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LBRACE">{</span> <span class="LIDENT">pattern</span> <span class="EQUAL">=</span> <span id="local_pattern__008__151"><span class="LIDENT">pattern__008_</span></span><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="LIDENT">case_sensitive</span> <span class="EQUAL">=</span> <span id="local_case_sensitive__010__152"><span class="LIDENT">case_sensitive__010_</span></span><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="LIDENT">kmp_array</span> <span class="EQUAL">=</span> <span id="local_kmp_array__012__153"><span class="LIDENT">kmp_array__012_</span></span><span class="EOL">
</span>           <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_bnds__007__154"><span class="LIDENT">bnds__007_</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#type-t"><span class="UNDERSCORE">_</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_bnds__007__155"><span class="LIDENT">bnds__007_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_arg__013__156"><span class="LIDENT">arg__013_</span></span> <span class="EQUAL">=</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_array"><span class="LIDENT">sexp_of_array</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_int"><span class="LIDENT">sexp_of_int</span></a> <a href="#local_kmp_array__012__153"><span class="LIDENT">kmp_array__012_</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">List</span> <span class="LBRACKET">[</span> <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;kmp_array&quot;</span><span class="SEMI">;</span> <a href="#local_arg__013__156"><span class="LIDENT">arg__013_</span></a> <span class="RBRACKET">]</span> <span class="COLONCOLON">::</span> <a href="#local_bnds__007__154"><span class="LIDENT">bnds__007_</span></a><span class="EOL">
</span>           <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#type-t"><span class="UNDERSCORE">_</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_bnds__007__157"><span class="LIDENT">bnds__007_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_arg__011__158"><span class="LIDENT">arg__011_</span></span> <span class="EQUAL">=</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_bool"><span class="LIDENT">sexp_of_bool</span></a> <a href="#local_case_sensitive__010__152"><span class="LIDENT">case_sensitive__010_</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">List</span> <span class="LBRACKET">[</span> <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;case_sensitive&quot;</span><span class="SEMI">;</span> <a href="#local_arg__011__158"><span class="LIDENT">arg__011_</span></a> <span class="RBRACKET">]</span><span class="EOL">
</span>           <span class="COLONCOLON">::</span> <a href="#local_bnds__007__155"><span class="LIDENT">bnds__007_</span></a><span class="EOL">
</span>           <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#type-t"><span class="UNDERSCORE">_</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_bnds__007__159"><span class="LIDENT">bnds__007_</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_arg__009__160"><span class="LIDENT">arg__009_</span></span> <span class="EQUAL">=</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_string"><span class="LIDENT">sexp_of_string</span></a> <a href="#local_pattern__008__151"><span class="LIDENT">pattern__008_</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LPAREN">(</span><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">List</span> <span class="LBRACKET">[</span> <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;pattern&quot;</span><span class="SEMI">;</span> <a href="#local_arg__009__160"><span class="LIDENT">arg__009_</span></a> <span class="RBRACKET">]</span> <span class="COLONCOLON">::</span> <a href="#local_bnds__007__157"><span class="LIDENT">bnds__007_</span></a><span class="EOL">
</span>           <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#type-t"><span class="UNDERSCORE">_</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="UIDENT">List</span> <a href="#local_bnds__007__159"><span class="LIDENT">bnds__007_</span></a><span class="EOL">
</span>        <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../sexplib0/src/sexplib0/sexp.ml.html#type-t"><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LBRACKETATATAT">[@@@</span><span class="END">end</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Search_pattern0.module-Private.val-representation"><span class="LIDENT">representation</span></span> <span class="EQUAL">=</span> <a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Search_pattern_helper"><span class="MODULE">module</span> <span class="UIDENT">Search_pattern_helper</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Search_pattern_helper.module-Search_pattern"><span class="MODULE">module</span> <span class="UIDENT">Search_pattern</span> <span class="EQUAL">=</span> <span class="UIDENT">Search_pattern0</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Search_pattern_helper</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index_gen"><span class="LIDENT">substr_index_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_161"><span class="LIDENT">case_sensitive</span></span> <span class="QUESTION">?</span><span id="local_pos_162"><span class="LIDENT">pos</span></span> <span id="local_t_163"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pattern_164"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">index</span> <span class="QUESTION">?</span><a href="#local_pos_162"><span class="LIDENT">pos</span></a> <span class="LPAREN">(</span><span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_case_sensitive_161"><span class="LIDENT">case_sensitive</span></a> <a href="#local_pattern_164"><span class="LIDENT">pattern</span></a><span class="RPAREN">)</span> <span class="LABEL">~in_:</span><a href="#local_t_163"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index_exn_gen"><span class="LIDENT">substr_index_exn_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_165"><span class="LIDENT">case_sensitive</span></span> <span class="QUESTION">?</span><span id="local_pos_166"><span class="LIDENT">pos</span></span> <span id="local_t_167"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pattern_168"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">index_exn</span> <span class="QUESTION">?</span><a href="#local_pos_166"><span class="LIDENT">pos</span></a> <span class="LPAREN">(</span><span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_case_sensitive_165"><span class="LIDENT">case_sensitive</span></a> <a href="#local_pattern_168"><span class="LIDENT">pattern</span></a><span class="RPAREN">)</span> <span class="LABEL">~in_:</span><a href="#local_t_167"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index_all_gen"><span class="LIDENT">substr_index_all_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_169"><span class="LIDENT">case_sensitive</span></span> <span id="local_t_170"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_may_overlap_171"><span class="LIDENT">may_overlap</span></span> <span class="TILDE">~</span><span id="local_pattern_172"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">index_all</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_case_sensitive_169"><span class="LIDENT">case_sensitive</span></a> <a href="#local_pattern_172"><span class="LIDENT">pattern</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="TILDE">~</span><a href="#local_may_overlap_171"><span class="LIDENT">may_overlap</span></a><span class="EOL">
</span>    <span class="LABEL">~in_:</span><a href="#local_t_170"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_replace_first_gen"><span class="LIDENT">substr_replace_first_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_173"><span class="LIDENT">case_sensitive</span></span> <span class="QUESTION">?</span><span id="local_pos_174"><span class="LIDENT">pos</span></span> <span id="local_t_175"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pattern_176"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">replace_first</span> <span class="QUESTION">?</span><a href="#local_pos_174"><span class="LIDENT">pos</span></a> <span class="LPAREN">(</span><span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_case_sensitive_173"><span class="LIDENT">case_sensitive</span></a> <a href="#local_pattern_176"><span class="LIDENT">pattern</span></a><span class="RPAREN">)</span> <span class="LABEL">~in_:</span><a href="#local_t_175"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_replace_all_gen"><span class="LIDENT">substr_replace_all_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_177"><span class="LIDENT">case_sensitive</span></span> <span id="local_t_178"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pattern_179"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">replace_all</span> <span class="LPAREN">(</span><span class="UIDENT">Search_pattern</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="TILDE">~</span><a href="#local_case_sensitive_177"><span class="LIDENT">case_sensitive</span></a> <a href="#local_pattern_179"><span class="LIDENT">pattern</span></a><span class="RPAREN">)</span> <span class="LABEL">~in_:</span><a href="#local_t_178"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_substring_gen"><span class="LIDENT">is_substring_gen</span></span> <span class="TILDE">~</span><span id="local_case_sensitive_180"><span class="LIDENT">case_sensitive</span></span> <span id="local_t_181"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_substring_182"><span class="LIDENT">substring</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="option.ml.html#val-is_some"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">is_some</span></a> <span class="LPAREN">(</span><span class="LIDENT">substr_index_gen</span> <a href="#local_t_181"><span class="LIDENT">t</span></a> <span class="LABEL">~pattern:</span><a href="#local_substring_182"><span class="LIDENT">substring</span></a> <span class="TILDE">~</span><a href="#local_case_sensitive_180"><span class="LIDENT">case_sensitive</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index"><span class="LIDENT">substr_index</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index_exn"><span class="LIDENT">substr_index_exn</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_exn_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_index_all"><span class="LIDENT">substr_index_all</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_all_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_replace_first"><span class="LIDENT">substr_replace_first</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_replace_first_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-substr_replace_all"><span class="LIDENT">substr_replace_all</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_replace_all_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_substring"><span class="LIDENT">is_substring</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_substring_gen</span> <span class="LABEL">~case_sensitive:</span><span class="TRUE">true</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_substring_at_gen"><span class="LIDENT">is_substring_at_gen</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_183"><span class="LIDENT">loop</span></span> <span class="TILDE">~</span><span id="local_str_184"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_str_pos_185"><span class="LIDENT">str_pos</span></span> <span class="TILDE">~</span><span id="local_sub_186"><span class="LIDENT">sub</span></span> <span class="TILDE">~</span><span id="local_sub_pos_187"><span class="LIDENT">sub_pos</span></span> <span class="TILDE">~</span><span id="local_sub_len_188"><span class="LIDENT">sub_len</span></span> <span class="TILDE">~</span><span id="local_char_equal_189"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_sub_pos_187"><span class="LIDENT">sub_pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_sub_len_188"><span class="LIDENT">sub_len</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <span class="TRUE">true</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_char_equal_189"><span class="LIDENT">char_equal</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_str_184"><span class="LIDENT">str</span></a> <a href="#local_str_pos_185"><span class="LIDENT">str_pos</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_sub_186"><span class="LIDENT">sub</span></a> <a href="#local_sub_pos_187"><span class="LIDENT">sub_pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_loop_183"><span class="LIDENT">loop</span></a> <span class="TILDE">~</span><a href="#local_str_184"><span class="LIDENT">str</span></a> <span class="LABEL">~str_pos:</span><span class="LPAREN">(</span><a href="#local_str_pos_185"><span class="LIDENT">str_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_sub_186"><span class="LIDENT">sub</span></a> <span class="LABEL">~sub_pos:</span><span class="LPAREN">(</span><a href="#local_sub_pos_187"><span class="LIDENT">sub_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_sub_len_188"><span class="LIDENT">sub_len</span></a> <span class="TILDE">~</span><a href="#local_char_equal_189"><span class="LIDENT">char_equal</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_str_190"><span class="LIDENT">str</span></span> <span class="LABEL">~pos:</span><span id="local_str_pos_191"><span class="LIDENT">str_pos</span></span> <span class="LABEL">~substring:</span><span id="local_sub_192"><span class="LIDENT">sub</span></span> <span class="TILDE">~</span><span id="local_char_equal_193"><span class="LIDENT">char_equal</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_str_len_194"><span class="LIDENT">str_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_str_190"><span class="LIDENT">str</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_sub_len_195"><span class="LIDENT">sub_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_sub_192"><span class="LIDENT">sub</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_str_pos_191"><span class="LIDENT">str_pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_str_pos_191"><span class="LIDENT">str_pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <a href="#local_str_len_194"><span class="LIDENT">str_len</span></a><span class="EOL">
</span>    <span class="THEN">then</span><span class="EOL">
</span>      <span class="LIDENT">invalid_argf</span><span class="EOL">
</span>        <span class="STRING">&quot;String.is_substring_at: invalid index %d for string of length %d&quot;</span><span class="EOL">
</span>        <a href="#local_str_pos_191"><span class="LIDENT">str_pos</span></a><span class="EOL">
</span>        <a href="#local_str_len_194"><span class="LIDENT">str_len</span></a><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_str_pos_191"><span class="LIDENT">str_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_sub_len_195"><span class="LIDENT">sub_len</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_str_len_194"><span class="LIDENT">str_len</span></a><span class="EOL">
</span>    <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_loop_183"><span class="LIDENT">loop</span></a> <span class="TILDE">~</span><a href="#local_str_190"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_str_pos_191"><span class="LIDENT">str_pos</span></a> <span class="TILDE">~</span><a href="#local_sub_192"><span class="LIDENT">sub</span></a> <span class="LABEL">~sub_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_sub_len_195"><span class="LIDENT">sub_len</span></a> <span class="TILDE">~</span><a href="#local_char_equal_193"><span class="LIDENT">char_equal</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_suffix_gen"><span class="LIDENT">is_suffix_gen</span></span> <span id="local_string_196"><span class="LIDENT">string</span></span> <span class="TILDE">~</span><span id="local_suffix_197"><span class="LIDENT">suffix</span></span> <span class="TILDE">~</span><span id="local_char_equal_198"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_string_len_199"><span class="LIDENT">string_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_string_196"><span class="LIDENT">string</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_suffix_len_200"><span class="LIDENT">suffix_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_suffix_197"><span class="LIDENT">suffix</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_string_len_199"><span class="LIDENT">string_len</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_suffix_len_200"><span class="LIDENT">suffix_len</span></a><span class="EOL">
</span>  <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LIDENT">is_substring_at_gen</span><span class="EOL">
</span>       <a href="#local_string_196"><span class="LIDENT">string</span></a><span class="EOL">
</span>       <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_string_len_199"><span class="LIDENT">string_len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_suffix_len_200"><span class="LIDENT">suffix_len</span></a><span class="RPAREN">)</span><span class="EOL">
</span>       <span class="LABEL">~substring:</span><a href="#local_suffix_197"><span class="LIDENT">suffix</span></a><span class="EOL">
</span>       <span class="TILDE">~</span><a href="#local_char_equal_198"><span class="LIDENT">char_equal</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_prefix_gen"><span class="LIDENT">is_prefix_gen</span></span> <span id="local_string_201"><span class="LIDENT">string</span></span> <span class="TILDE">~</span><span id="local_prefix_202"><span class="LIDENT">prefix</span></span> <span class="TILDE">~</span><span id="local_char_equal_203"><span class="LIDENT">char_equal</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_string_len_204"><span class="LIDENT">string_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_string_201"><span class="LIDENT">string</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_prefix_len_205"><span class="LIDENT">prefix_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_prefix_202"><span class="LIDENT">prefix</span></a> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_string_len_204"><span class="LIDENT">string_len</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_prefix_len_205"><span class="LIDENT">prefix_len</span></a><span class="EOL">
</span>  <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LIDENT">is_substring_at_gen</span> <a href="#local_string_201"><span class="LIDENT">string</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~substring:</span><a href="#local_prefix_202"><span class="LIDENT">prefix</span></a> <span class="TILDE">~</span><a href="#local_char_equal_203"><span class="LIDENT">char_equal</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Caseless"><span class="MODULE">module</span> <span class="UIDENT">Caseless</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Caseless.module-T"><span class="MODULE">module</span> <span class="UIDENT">T</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="module-Caseless.module-T.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">string</span> <span class="LBRACKETATAT">[@@</span><span class="LIDENT">deriving_inline</span> <span class="LIDENT">sexp</span><span class="COMMA">,</span> <span class="LIDENT">sexp_grammar</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-t_of_sexp"><span class="LIDENT">t_of_sexp</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-string_of_sexp"><span class="LIDENT">string_of_sexp</span></a> <span class="COLON">:</span> <a href="../../../sexplib0/src/sexplib0/sexp.ml.html#type-t"><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-sexp_of_t"><span class="LIDENT">sexp_of_t</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_string"><span class="LIDENT">sexp_of_string</span></a> <span class="COLON">:</span> <span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../sexplib0/src/sexplib0/sexp.ml.html#type-t"><span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="LPAREN">(</span><span id="module-Caseless.module-T.val-t_sexp_grammar"><span class="LIDENT">t_sexp_grammar</span></span> <span class="COLON">:</span> <a href="../../../sexplib0/src/sexplib0/sexp_grammar.ml.html#type-t"><span class="LIDENT">t</span> <span class="UIDENT">Sexplib0</span><span class="DOT">.</span><span class="UIDENT">Sexp_grammar</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv_grammar.ml.html#val-string_sexp_grammar"><span class="LIDENT">string_sexp_grammar</span></a><span class="EOL">
</span><span class="EOL">
</span>    <span class="LBRACKETATATAT">[@@@</span><span class="END">end</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-char_compare_caseless"><span class="LIDENT">char_compare_caseless</span></span> <span id="local_c1_206"><span class="LIDENT">c1</span></span> <span id="local_c2_207"><span class="LIDENT">c2</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-compare"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">compare</span></a> <span class="LPAREN">(</span><a href="char0.ml.html#val-lowercase"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">lowercase</span></a> <a href="#local_c1_206"><span class="LIDENT">c1</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="char0.ml.html#val-lowercase"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">lowercase</span></a> <a href="#local_c2_207"><span class="LIDENT">c2</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="module-Caseless.module-T.val-compare_loop"><span class="LIDENT">compare_loop</span></span> <span class="TILDE">~</span><span id="local_pos_208"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_string1_209"><span class="LIDENT">string1</span></span> <span class="TILDE">~</span><span id="local_len1_210"><span class="LIDENT">len1</span></span> <span class="TILDE">~</span><span id="local_string2_211"><span class="LIDENT">string2</span></span> <span class="TILDE">~</span><span id="local_len2_212"><span class="LIDENT">len2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_pos_208"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len1_210"><span class="LIDENT">len1</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="IF">if</span> <a href="#local_pos_208"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len2_212"><span class="LIDENT">len2</span></a> <span class="THEN">then</span> <span class="INT">0</span> <span class="ELSE">else</span> <span class="MINUS">-</span><span class="INT">1</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_pos_208"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len2_212"><span class="LIDENT">len2</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="INT">1</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_c_213"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <span class="LIDENT">char_compare_caseless</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_string1_209"><span class="LIDENT">string1</span></a> <a href="#local_pos_208"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_string2_211"><span class="LIDENT">string2</span></a> <a href="#local_pos_208"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_c_213"><span class="LIDENT">c</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">compare_loop</span> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_208"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_string1_209"><span class="LIDENT">string1</span></a> <span class="TILDE">~</span><a href="#local_len1_210"><span class="LIDENT">len1</span></a> <span class="TILDE">~</span><a href="#local_string2_211"><span class="LIDENT">string2</span></a> <span class="TILDE">~</span><a href="#local_len2_212"><span class="LIDENT">len2</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_c_213"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-compare"><span class="LIDENT">compare</span></span> <span id="local_string1_214"><span class="LIDENT">string1</span></span> <span id="local_string2_215"><span class="LIDENT">string2</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="import0.ml.html#val-phys_equal"><span class="LIDENT">phys_equal</span></a> <a href="#local_string1_214"><span class="LIDENT">string1</span></a> <a href="#local_string2_215"><span class="LIDENT">string2</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="INT">0</span><span class="EOL">
</span>      <span class="ELSE">else</span><span class="EOL">
</span>        <span class="LIDENT">compare_loop</span><span class="EOL">
</span>          <span class="LABEL">~pos:</span><span class="INT">0</span><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_string1_214"><span class="LIDENT">string1</span></a><span class="EOL">
</span>          <span class="LABEL">~len1:</span><span class="LPAREN">(</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_string1_214"><span class="LIDENT">string1</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_string2_215"><span class="LIDENT">string2</span></a><span class="EOL">
</span>          <span class="LABEL">~len2:</span><span class="LPAREN">(</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_string2_215"><span class="LIDENT">string2</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-hash_fold_t"><span class="LIDENT">hash_fold_t</span></span> <span id="local_state_216"><span class="LIDENT">state</span></span> <span id="local_t_217"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_len_218"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_217"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_state_219"><span class="LIDENT">state</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><a href="hash.ml.html#module-Folding.val-hash_fold_int"><span class="LIDENT">hash_fold_int</span></a> <a href="#local_state_216"><span class="LIDENT">state</span></a> <a href="#local_len_218"><span class="LIDENT">len</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FOR">for</span> <span class="LIDENT">pos</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_len_218"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>        <a href="#local_state_219"><span class="LIDENT">state</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="hash.ml.html#module-Folding.val-hash_fold_char"><span class="LIDENT">hash_fold_char</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_state_219"><span class="LIDENT">state</span></a> <span class="LPAREN">(</span><a href="char0.ml.html#val-lowercase"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">lowercase</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_t_217"><span class="LIDENT">t</span></a> <span class="LIDENT">pos</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_state_219"><span class="LIDENT">state</span></a><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-hash"><span class="LIDENT">hash</span></span> <span id="local_t_220"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="hash.ml.html#module-T.val-run"><span class="UIDENT">Hash</span><span class="DOT">.</span><span class="LIDENT">run</span></a> <span class="LIDENT">hash_fold_t</span> <a href="#local_t_220"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-is_suffix"><span class="LIDENT">is_suffix</span></span> <span id="local_s_221"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_suffix_222"><span class="LIDENT">suffix</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_suffix_gen</span> <a href="#local_s_221"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_suffix_222"><span class="LIDENT">suffix</span></a> <span class="LABEL">~char_equal:</span><a href="comparable.ml.html#module-Comparisons.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="UIDENT">Caseless</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-is_prefix"><span class="LIDENT">is_prefix</span></span> <span id="local_s_223"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_prefix_224"><span class="LIDENT">prefix</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_prefix_gen</span> <a href="#local_s_223"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_prefix_224"><span class="LIDENT">prefix</span></a> <span class="LABEL">~char_equal:</span><a href="comparable.ml.html#module-Comparisons.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="UIDENT">Caseless</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-substr_index"><span class="LIDENT">substr_index</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-substr_index_exn"><span class="LIDENT">substr_index_exn</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_exn_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-substr_index_all"><span class="LIDENT">substr_index_all</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_index_all_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-substr_replace_first"><span class="LIDENT">substr_replace_first</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_replace_first_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-substr_replace_all"><span class="LIDENT">substr_replace_all</span></span> <span class="EQUAL">=</span> <span class="LIDENT">substr_replace_all_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-is_substring"><span class="LIDENT">is_substring</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_substring_gen</span> <span class="LABEL">~case_sensitive:</span><span class="FALSE">false</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="module-Caseless.module-T.val-is_substring_at"><span class="LIDENT">is_substring_at</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_substring_at_gen</span> <span class="LABEL">~char_equal:</span><a href="comparable.ml.html#module-Comparisons.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="UIDENT">Caseless</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>  <span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">T</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <a href="comparable.ml.html#module-Make"><span class="UIDENT">Comparable</span><span class="DOT">.</span><span class="UIDENT">Make</span></a> <span class="LPAREN">(</span><span class="UIDENT">T</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-of_string"><span class="LIDENT">of_string</span></span> <span class="EQUAL">=</span> <a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-to_string"><span class="LIDENT">to_string</span></span> <span class="EQUAL">=</span> <a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-init"><span class="LIDENT">init</span></span> <span id="local_n_225"><span class="LIDENT">n</span></span> <span class="TILDE">~</span><span id="local_f_226"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_n_225"><span class="LIDENT">n</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="LIDENT">invalid_argf</span> <span class="STRING">&quot;String.init %d&quot;</span> <a href="#local_n_225"><span class="LIDENT">n</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_t_227"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_n_225"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_n_225"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_t_227"><span class="LIDENT">t</span></a> <span class="LIDENT">i</span> <span class="LPAREN">(</span><a href="#local_f_226"><span class="LIDENT">f</span></a> <span class="LIDENT">i</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_t_227"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-to_list"><span class="LIDENT">to_list</span></span> <span id="local_s_228"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_229"><span class="LIDENT">loop</span></span> <span id="local_acc_230"><span class="LIDENT">acc</span></span> <span id="local_i_231"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_i_231"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <a href="#local_acc_230"><span class="LIDENT">acc</span></a> <span class="ELSE">else</span> <a href="#local_loop_229"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_s_228"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_231"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="COLONCOLON">::</span> <a href="#local_acc_230"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_i_231"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_229"><span class="LIDENT">loop</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_s_228"><span class="LIDENT">s</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-to_list_rev"><span class="LIDENT">to_list_rev</span></span> <span id="local_s_232"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_233"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_232"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_234"><span class="LIDENT">loop</span></span> <span id="local_acc_235"><span class="LIDENT">acc</span></span> <span id="local_i_236"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_i_236"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_233"><span class="LIDENT">len</span></a> <span class="THEN">then</span> <a href="#local_acc_235"><span class="LIDENT">acc</span></a> <span class="ELSE">else</span> <a href="#local_loop_234"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_s_232"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_236"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="COLONCOLON">::</span> <a href="#local_acc_235"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_i_236"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_234"><span class="LIDENT">loop</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="INT">0</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rev"><span class="LIDENT">rev</span></span> <span id="local_t_237"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_238"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_237"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_res_239"><span class="LIDENT">res</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_len_238"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_len_238"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_res_239"><span class="LIDENT">res</span></a> <span class="LIDENT">i</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_t_237"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><a href="#local_len_238"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="LIDENT">i</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_res_239"><span class="LIDENT">res</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Efficient string splitting *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lsplit2_exn"><span class="LIDENT">lsplit2_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_240"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.lsplit2_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_lsplit2_exn_241"><span class="LIDENT">lsplit2_exn</span></span> <span id="local_line_242"><span class="LIDENT">line</span></span> <span class="LABEL">~on:</span><span id="local_delim_243"><span class="LIDENT">delim</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_pos_244"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_exn_internal</span> <a href="#local_line_242"><span class="LIDENT">line</span></a> <span class="TILDE">~</span><a href="#local_not_found_240"><span class="LIDENT">not_found</span></a> <a href="#local_delim_243"><span class="LIDENT">delim</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">sub</span> <a href="#local_line_242"><span class="LIDENT">line</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_pos_244"><span class="LIDENT">pos</span></a><span class="COMMA">,</span> <span class="LIDENT">sub</span> <a href="#local_line_242"><span class="LIDENT">line</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_244"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_line_242"><span class="LIDENT">line</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos_244"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_lsplit2_exn_241"><span class="LIDENT">lsplit2_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rsplit2_exn"><span class="LIDENT">rsplit2_exn</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_not_found_245"><span class="LIDENT">not_found</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Not_found_s</span> <span class="LPAREN">(</span><span class="UIDENT">Atom</span> <span class="STRING">&quot;String.rsplit2_exn: not found&quot;</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_rsplit2_exn_246"><span class="LIDENT">rsplit2_exn</span></span> <span id="local_line_247"><span class="LIDENT">line</span></span> <span class="LABEL">~on:</span><span id="local_delim_248"><span class="LIDENT">delim</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_pos_249"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="LIDENT">rindex_exn_internal</span> <a href="#local_line_247"><span class="LIDENT">line</span></a> <span class="TILDE">~</span><a href="#local_not_found_245"><span class="LIDENT">not_found</span></a> <a href="#local_delim_248"><span class="LIDENT">delim</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">sub</span> <a href="#local_line_247"><span class="LIDENT">line</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_pos_249"><span class="LIDENT">pos</span></a><span class="COMMA">,</span> <span class="LIDENT">sub</span> <a href="#local_line_247"><span class="LIDENT">line</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_249"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_line_247"><span class="LIDENT">line</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos_249"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* named to preserve symbol in compiled binary *)</span><span class="EOL">
</span>  <a href="#local_rsplit2_exn_246"><span class="LIDENT">rsplit2_exn</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lsplit2"><span class="LIDENT">lsplit2</span></span> <span id="local_line_250"><span class="LIDENT">line</span></span> <span class="TILDE">~</span><span id="local_on_251"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">lsplit2_exn</span> <a href="#local_line_250"><span class="LIDENT">line</span></a> <span class="TILDE">~</span><a href="#local_on_251"><span class="LIDENT">on</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rsplit2"><span class="LIDENT">rsplit2</span></span> <span id="local_line_252"><span class="LIDENT">line</span></span> <span class="TILDE">~</span><span id="local_on_253"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">rsplit2_exn</span> <a href="#local_line_252"><span class="LIDENT">line</span></a> <span class="TILDE">~</span><a href="#local_on_253"><span class="LIDENT">on</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Not_found_s</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-char_list_mem"><span class="LIDENT">char_list_mem</span></span> <span id="local_l_254"><span class="LIDENT">l</span></span> <span class="LPAREN">(</span><span id="local_c_255"><span class="LIDENT">c</span></span> <span class="COLON">:</span> <span class="LIDENT">char</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_l_254"><span class="LIDENT">l</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="BAR">|</span> <span id="local_hd_256"><span class="LIDENT">hd</span></span> <span class="COLONCOLON">::</span> <span id="local_tl_257"><span class="LIDENT">tl</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_hd_256"><span class="LIDENT">hd</span></a> <a href="#local_c_255"><span class="LIDENT">c</span></a> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">char_list_mem</span> <a href="#local_tl_257"><span class="LIDENT">tl</span></a> <a href="#local_c_255"><span class="LIDENT">c</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-split_gen"><span class="LIDENT">split_gen</span></span> <span id="local_str_258"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_259"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_is_delim_260"><span class="LIDENT">is_delim</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_on_259"><span class="LIDENT">on</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">char</span> <span id="local_c'_261"><span class="LIDENT">c'</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUN">fun</span> <span id="local_c_262"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c_262"><span class="LIDENT">c</span></a> <a href="#local_c'_261"><span class="LIDENT">c'</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">char_list</span> <span id="local_l_263"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUN">fun</span> <span id="local_c_264"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">char_list_mem</span> <a href="#local_l_263"><span class="LIDENT">l</span></a> <a href="#local_c_264"><span class="LIDENT">c</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_len_265"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_str_258"><span class="LIDENT">str</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_266"><span class="LIDENT">loop</span></span> <span id="local_acc_267"><span class="LIDENT">acc</span></span> <span id="local_last_pos_268"><span class="LIDENT">last_pos</span></span> <span id="local_pos_269"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_pos_269"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="MINUS">-</span><span class="INT">1</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LIDENT">sub</span> <a href="#local_str_258"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_last_pos_268"><span class="LIDENT">last_pos</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_267"><span class="LIDENT">acc</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_is_delim_260"><span class="LIDENT">is_delim</span></a> <a href="#local_str_258"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_pos_269"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pos1_270"><span class="LIDENT">pos1</span></span> <span class="EQUAL">=</span> <a href="#local_pos_269"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_sub_str_271"><span class="LIDENT">sub_str</span></span> <span class="EQUAL">=</span> <span class="LIDENT">sub</span> <a href="#local_str_258"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><a href="#local_pos1_270"><span class="LIDENT">pos1</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_last_pos_268"><span class="LIDENT">last_pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos1_270"><span class="LIDENT">pos1</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_loop_266"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_sub_str_271"><span class="LIDENT">sub_str</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_267"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_pos_269"><span class="LIDENT">pos</span></a> <span class="LPAREN">(</span><a href="#local_pos_269"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="#local_loop_266"><span class="LIDENT">loop</span></a> <a href="#local_acc_267"><span class="LIDENT">acc</span></a> <a href="#local_last_pos_268"><span class="LIDENT">last_pos</span></a> <span class="LPAREN">(</span><a href="#local_pos_269"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_266"><span class="LIDENT">loop</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="#local_len_265"><span class="LIDENT">len</span></a> <span class="LPAREN">(</span><a href="#local_len_265"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-split"><span class="LIDENT">split</span></span> <span id="local_str_272"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_273"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_gen</span> <a href="#local_str_272"><span class="LIDENT">str</span></a> <span class="LABEL">~on:</span><span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="LIDENT">char</span> <a href="#local_on_273"><span class="LIDENT">on</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-split_on_chars"><span class="LIDENT">split_on_chars</span></span> <span id="local_str_274"><span class="LIDENT">str</span></span> <span class="LABEL">~on:</span><span id="local_chars_275"><span class="LIDENT">chars</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_gen</span> <a href="#local_str_274"><span class="LIDENT">str</span></a> <span class="LABEL">~on:</span><span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="LIDENT">char_list</span> <a href="#local_chars_275"><span class="LIDENT">chars</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-split_lines"><span class="LIDENT">split_lines</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_back_up_at_newline_276"><span class="LIDENT">back_up_at_newline</span></span> <span class="TILDE">~</span><span id="local_t_277"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_pos_278"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_eol_279"><span class="LIDENT">eol</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_pos_278"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_278"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_278"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_t_277"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_278"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RBRACKET">]</span> <span class="CHAR">'\r'</span> <span class="THEN">then</span> <span class="INT">2</span> <span class="ELSE">else</span> <span class="INT">1</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_eol_279"><span class="LIDENT">eol</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_278"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_t_280"><span class="LIDENT">t</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_n_281"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_280"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_n_281"><span class="LIDENT">n</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="COMMENT">(* Invariant: [-1 &lt;= pos &lt; eol]. *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pos_282"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><a href="#local_n_281"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_eol_283"><span class="LIDENT">eol</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_n_281"><span class="LIDENT">n</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_ac_284"><span class="LIDENT">ac</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="COMMENT">(* We treat the end of the string specially, because if the string ends with a
         newline, we don't want an extra empty string at the end of the output. *)</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_t_280"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_282"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span> <span class="CHAR">'\n'</span> <span class="THEN">then</span> <a href="#local_back_up_at_newline_276"><span class="LIDENT">back_up_at_newline</span></a> <span class="TILDE">~</span><a href="#local_t_280"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_282"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_eol_283"><span class="LIDENT">eol</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_282"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="INT">0</span> <span class="DO">do</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-(&lt;&gt;)"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="INFIXOP0">&lt;&gt;</span> <span class="RPAREN">)</span></a> <a href="#local_t_280"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_282"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span> <span class="CHAR">'\n'</span><span class="EOL">
</span>        <span class="THEN">then</span> <a href="import0.ml.html#val-decr"><span class="LIDENT">decr</span></a> <a href="#local_pos_282"><span class="LIDENT">pos</span></a><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="COMMENT">(* Because [pos &lt; eol], we know that [start &lt;= eol]. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_start_285"><span class="LIDENT">start</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_pos_282"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_ac_284"><span class="LIDENT">ac</span></a> <a href="import0.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LIDENT">sub</span> <a href="#local_t_280"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><a href="#local_start_285"><span class="LIDENT">start</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_eol_283"><span class="LIDENT">eol</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_start_285"><span class="LIDENT">start</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_ac_284"><span class="LIDENT">ac</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_back_up_at_newline_276"><span class="LIDENT">back_up_at_newline</span></a> <span class="TILDE">~</span><a href="#local_t_280"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_282"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_eol_283"><span class="LIDENT">eol</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">sub</span> <a href="#local_t_280"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_eol_283"><span class="LIDENT">eol</span></a> <span class="COLONCOLON">::</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_ac_284"><span class="LIDENT">ac</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_suffix"><span class="LIDENT">is_suffix</span></span> <span id="local_s_286"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_suffix_287"><span class="LIDENT">suffix</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_suffix_gen</span> <a href="#local_s_286"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_suffix_287"><span class="LIDENT">suffix</span></a> <span class="LABEL">~char_equal:</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_prefix"><span class="LIDENT">is_prefix</span></span> <span id="local_s_288"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_prefix_289"><span class="LIDENT">prefix</span></span> <span class="EQUAL">=</span> <span class="LIDENT">is_prefix_gen</span> <a href="#local_s_288"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_prefix_289"><span class="LIDENT">prefix</span></a> <span class="LABEL">~char_equal:</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_substring_at"><span class="LIDENT">is_substring_at</span></span> <span id="local_s_290"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_pos_291"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_substring_292"><span class="LIDENT">substring</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">is_substring_at_gen</span> <a href="#local_s_290"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_pos_291"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_substring_292"><span class="LIDENT">substring</span></a> <span class="LABEL">~char_equal:</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-wrap_sub_n"><span class="LIDENT">wrap_sub_n</span></span> <span id="local_t_293"><span class="LIDENT">t</span></span> <span id="local_n_294"><span class="LIDENT">n</span></span> <span class="TILDE">~</span><span id="local_name_295"><span class="LIDENT">name</span></span> <span class="TILDE">~</span><span id="local_pos_296"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_297"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_on_error_298"><span class="LIDENT">on_error</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_n_294"><span class="LIDENT">n</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span><span class="EOL">
</span>  <span class="THEN">then</span> <a href="import0.ml.html#val-invalid_arg"><span class="LIDENT">invalid_arg</span></a> <span class="LPAREN">(</span><a href="#local_name_295"><span class="LIDENT">name</span></a> <span class="INFIXOP1">^</span> <span class="STRING">&quot; expecting nonnegative argument&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="TRY">try</span> <span class="LIDENT">sub</span> <a href="#local_t_293"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_pos_296"><span class="LIDENT">pos</span></a> <span class="TILDE">~</span><a href="#local_len_297"><span class="LIDENT">len</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_on_error_298"><span class="LIDENT">on_error</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-drop_prefix"><span class="LIDENT">drop_prefix</span></span> <span id="local_t_299"><span class="LIDENT">t</span></span> <span id="local_n_300"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">wrap_sub_n</span> <span class="LABEL">~name:</span><span class="STRING">&quot;drop_prefix&quot;</span> <a href="#local_t_299"><span class="LIDENT">t</span></a> <a href="#local_n_300"><span class="LIDENT">n</span></a> <span class="LABEL">~pos:</span><a href="#local_n_300"><span class="LIDENT">n</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_299"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_n_300"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <span class="LABEL">~on_error:</span><span class="STRING">&quot;&quot;</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-drop_suffix"><span class="LIDENT">drop_suffix</span></span> <span id="local_t_301"><span class="LIDENT">t</span></span> <span id="local_n_302"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LIDENT">wrap_sub_n</span> <span class="LABEL">~name:</span><span class="STRING">&quot;drop_suffix&quot;</span> <a href="#local_t_301"><span class="LIDENT">t</span></a> <a href="#local_n_302"><span class="LIDENT">n</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_301"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_n_302"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <span class="LABEL">~on_error:</span><span class="STRING">&quot;&quot;</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-prefix"><span class="LIDENT">prefix</span></span> <span id="local_t_303"><span class="LIDENT">t</span></span> <span id="local_n_304"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">wrap_sub_n</span> <span class="LABEL">~name:</span><span class="STRING">&quot;prefix&quot;</span> <a href="#local_t_303"><span class="LIDENT">t</span></a> <a href="#local_n_304"><span class="LIDENT">n</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_n_304"><span class="LIDENT">n</span></a> <span class="LABEL">~on_error:</span><a href="#local_t_303"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-suffix"><span class="LIDENT">suffix</span></span> <span id="local_t_305"><span class="LIDENT">t</span></span> <span id="local_n_306"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">wrap_sub_n</span> <span class="LABEL">~name:</span><span class="STRING">&quot;suffix&quot;</span> <a href="#local_t_305"><span class="LIDENT">t</span></a> <a href="#local_n_306"><span class="LIDENT">n</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_305"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_n_306"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <span class="LABEL">~len:</span><a href="#local_n_306"><span class="LIDENT">n</span></a> <span class="LABEL">~on_error:</span><a href="#local_t_305"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lfindi"><span class="LIDENT">lfindi</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_pos_307"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <span class="INT">0</span><span class="RPAREN">)</span> <span id="local_t_308"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_309"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_n_310"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_308"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_311"><span class="LIDENT">loop</span></span> <span id="local_i_312"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_i_312"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_310"><span class="LIDENT">n</span></a> <span class="THEN">then</span> <span class="UIDENT">None</span> <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_f_309"><span class="LIDENT">f</span></a> <a href="#local_i_312"><span class="LIDENT">i</span></a> <a href="#local_t_308"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_312"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_i_312"><span class="LIDENT">i</span></a> <span class="ELSE">else</span> <a href="#local_loop_311"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_i_312"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_311"><span class="LIDENT">loop</span></a> <a href="#local_pos_307"><span class="LIDENT">pos</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-find"><span class="LIDENT">find</span></span> <span id="local_t_313"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_314"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">lfindi</span> <a href="#local_t_313"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span id="local_c_315"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_314"><span class="LIDENT">f</span></a> <a href="#local_c_315"><span class="LIDENT">c</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_i_316"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_t_313"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_316"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-find_map"><span class="LIDENT">find_map</span></span> <span id="local_t_317"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_318"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_n_319"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_317"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_320"><span class="LIDENT">loop</span></span> <span id="local_i_321"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_i_321"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_319"><span class="LIDENT">n</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_f_318"><span class="LIDENT">f</span></a> <a href="#local_t_317"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_321"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_320"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_i_321"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_res_322"><span class="LIDENT">res</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_res_322"><span class="LIDENT">res</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_320"><span class="LIDENT">loop</span></a> <span class="INT">0</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rfindi"><span class="LIDENT">rfindi</span></span> <span class="QUESTION">?</span><span id="local_pos_323"><span class="LIDENT">pos</span></span> <span id="local_t_324"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_325"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_326"><span class="LIDENT">loop</span></span> <span id="local_i_327"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_i_327"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="UIDENT">None</span> <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_f_325"><span class="LIDENT">f</span></a> <a href="#local_i_327"><span class="LIDENT">i</span></a> <a href="#local_t_324"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_327"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_i_327"><span class="LIDENT">i</span></a> <span class="ELSE">else</span> <a href="#local_loop_326"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_i_327"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_pos_328"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_pos_323"><span class="LIDENT">pos</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_pos_329"><span class="LIDENT">pos</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pos_329"><span class="LIDENT">pos</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">length</span> <a href="#local_t_324"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_loop_326"><span class="LIDENT">loop</span></a> <a href="#local_pos_328"><span class="LIDENT">pos</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-last_non_drop"><span class="LIDENT">last_non_drop</span></span> <span class="TILDE">~</span><span id="local_drop_330"><span class="LIDENT">drop</span></span> <span id="local_t_331"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="LIDENT">rfindi</span> <a href="#local_t_331"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span id="local_c_332"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_330"><span class="LIDENT">drop</span></a> <a href="#local_c_332"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-rstrip"><span class="LIDENT">rstrip</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_333"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_334"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">last_non_drop</span> <a href="#local_t_334"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_333"><span class="LIDENT">drop</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_i_335"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="#local_i_335"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="LIDENT">length</span> <a href="#local_t_334"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="THEN">then</span> <a href="#local_t_334"><span class="LIDENT">t</span></a> <span class="ELSE">else</span> <span class="LIDENT">prefix</span> <a href="#local_t_334"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><a href="#local_i_335"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-first_non_drop"><span class="LIDENT">first_non_drop</span></span> <span class="TILDE">~</span><span id="local_drop_336"><span class="LIDENT">drop</span></span> <span id="local_t_337"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="LIDENT">lfindi</span> <a href="#local_t_337"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span id="local_c_338"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_336"><span class="LIDENT">drop</span></a> <a href="#local_c_338"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lstrip"><span class="LIDENT">lstrip</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_339"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_340"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">first_non_drop</span> <a href="#local_t_340"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_339"><span class="LIDENT">drop</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_t_340"><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_n_341"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">drop_prefix</span> <a href="#local_t_340"><span class="LIDENT">t</span></a> <a href="#local_n_341"><span class="LIDENT">n</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [strip t] could be implemented as [lstrip (rstrip t)].  The implementation
   below saves (at least) a factor of two allocation, by only allocating the
   final result.  This also saves some amount of time. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-strip"><span class="LIDENT">strip</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_342"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_343"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_length_344"><span class="LIDENT">length</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_343"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_length_344"><span class="LIDENT">length</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_342"><span class="LIDENT">drop</span></a> <a href="#local_t_343"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_drop_342"><span class="LIDENT">drop</span></a> <a href="#local_t_343"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_length_344"><span class="LIDENT">length</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_t_343"><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">first_non_drop</span> <a href="#local_t_343"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_342"><span class="LIDENT">drop</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_first_345"><span class="LIDENT">first</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="MATCH">match</span> <span class="LIDENT">last_non_drop</span> <a href="#local_t_343"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_342"><span class="LIDENT">drop</span></a> <span class="WITH">with</span><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span><span class="EOL">
</span>       <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_last_346"><span class="LIDENT">last</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">sub</span> <a href="#local_t_343"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><a href="#local_first_345"><span class="LIDENT">first</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_last_346"><span class="LIDENT">last</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_first_345"><span class="LIDENT">first</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-mapi"><span class="LIDENT">mapi</span></span> <span id="local_t_347"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_348"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_l_349"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_347"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_t'_350"><span class="LIDENT">t'</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_l_349"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_l_349"><span class="LIDENT">l</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_t'_350"><span class="LIDENT">t'</span></a> <span class="LIDENT">i</span> <span class="LPAREN">(</span><a href="#local_f_348"><span class="LIDENT">f</span></a> <span class="LIDENT">i</span> <a href="#local_t_347"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="LIDENT">i</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_t'_350"><span class="LIDENT">t'</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* repeated code to avoid requiring an extra allocation for a closure on each call. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-map"><span class="LIDENT">map</span></span> <span id="local_t_351"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_352"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_l_353"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_351"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_t'_354"><span class="LIDENT">t'</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_l_353"><span class="LIDENT">l</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <a href="#local_l_353"><span class="LIDENT">l</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_t'_354"><span class="LIDENT">t'</span></a> <span class="LIDENT">i</span> <span class="LPAREN">(</span><a href="#local_f_352"><span class="LIDENT">f</span></a> <a href="#local_t_351"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="LIDENT">i</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_t'_354"><span class="LIDENT">t'</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-to_array"><span class="LIDENT">to_array</span></span> <span id="local_s_355"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">init</span> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_s_355"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_356"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_s_355"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_356"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-exists"><span class="LIDENT">exists</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_357"><span class="LIDENT">loop</span></span> <span id="local_s_358"><span class="LIDENT">s</span></span> <span id="local_i_359"><span class="LIDENT">i</span></span> <span class="TILDE">~</span><span id="local_len_360"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_f_361"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="#local_i_359"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_len_360"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LPAREN">(</span><a href="#local_f_361"><span class="LIDENT">f</span></a> <a href="#local_s_358"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_359"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_loop_357"><span class="LIDENT">loop</span></a> <a href="#local_s_358"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><a href="#local_i_359"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_360"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_f_361"><span class="LIDENT">f</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_s_362"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_f_363"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_357"><span class="LIDENT">loop</span></a> <a href="#local_s_362"><span class="LIDENT">s</span></a> <span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_s_362"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_363"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-for_all"><span class="LIDENT">for_all</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_364"><span class="LIDENT">loop</span></span> <span id="local_s_365"><span class="LIDENT">s</span></span> <span id="local_i_366"><span class="LIDENT">i</span></span> <span class="TILDE">~</span><span id="local_len_367"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_f_368"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="#local_i_366"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_367"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LPAREN">(</span><a href="#local_f_368"><span class="LIDENT">f</span></a> <a href="#local_s_365"><span class="LIDENT">s</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_366"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_loop_364"><span class="LIDENT">loop</span></a> <a href="#local_s_365"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><a href="#local_i_366"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_367"><span class="LIDENT">len</span></a> <span class="TILDE">~</span><a href="#local_f_368"><span class="LIDENT">f</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_s_369"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_f_370"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_364"><span class="LIDENT">loop</span></a> <a href="#local_s_369"><span class="LIDENT">s</span></a> <span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_s_369"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_370"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-fold"><span class="LIDENT">fold</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_371"><span class="LIDENT">loop</span></span> <span id="local_t_372"><span class="LIDENT">t</span></span> <span id="local_i_373"><span class="LIDENT">i</span></span> <span id="local_ac_374"><span class="LIDENT">ac</span></span> <span class="TILDE">~</span><span id="local_f_375"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_len_376"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_i_373"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_376"><span class="LIDENT">len</span></a> <span class="THEN">then</span> <a href="#local_ac_374"><span class="LIDENT">ac</span></a> <span class="ELSE">else</span> <a href="#local_loop_371"><span class="LIDENT">loop</span></a> <a href="#local_t_372"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><a href="#local_i_373"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_f_375"><span class="LIDENT">f</span></a> <a href="#local_ac_374"><span class="LIDENT">ac</span></a> <a href="#local_t_372"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_373"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_375"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_376"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_t_377"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_init_378"><span class="LIDENT">init</span></span> <span class="TILDE">~</span><span id="local_f_379"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_371"><span class="LIDENT">loop</span></a> <a href="#local_t_377"><span class="LIDENT">t</span></a> <span class="INT">0</span> <a href="#local_init_378"><span class="LIDENT">init</span></a> <span class="TILDE">~</span><a href="#local_f_379"><span class="LIDENT">f</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_377"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-foldi"><span class="LIDENT">foldi</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_380"><span class="LIDENT">loop</span></span> <span id="local_t_381"><span class="LIDENT">t</span></span> <span id="local_i_382"><span class="LIDENT">i</span></span> <span id="local_ac_383"><span class="LIDENT">ac</span></span> <span class="TILDE">~</span><span id="local_f_384"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_len_385"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_i_382"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_385"><span class="LIDENT">len</span></a> <span class="THEN">then</span> <a href="#local_ac_383"><span class="LIDENT">ac</span></a> <span class="ELSE">else</span> <a href="#local_loop_380"><span class="LIDENT">loop</span></a> <a href="#local_t_381"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><a href="#local_i_382"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_f_384"><span class="LIDENT">f</span></a> <a href="#local_i_382"><span class="LIDENT">i</span></a> <a href="#local_ac_383"><span class="LIDENT">ac</span></a> <a href="#local_t_381"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_382"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_384"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_385"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_t_386"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_init_387"><span class="LIDENT">init</span></span> <span class="TILDE">~</span><span id="local_f_388"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_380"><span class="LIDENT">loop</span></a> <a href="#local_t_386"><span class="LIDENT">t</span></a> <span class="INT">0</span> <a href="#local_init_387"><span class="LIDENT">init</span></a> <span class="TILDE">~</span><a href="#local_f_388"><span class="LIDENT">f</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_386"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-iteri"><span class="LIDENT">iteri</span></span> <span id="local_t_389"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_390"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="FOR">for</span> <span class="LIDENT">i</span> <span class="EQUAL">=</span> <span class="INT">0</span> <span class="TO">to</span> <span class="LIDENT">length</span> <a href="#local_t_389"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>    <a href="#local_f_390"><span class="LIDENT">f</span></a> <span class="LIDENT">i</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_t_389"><span class="LIDENT">t</span></a> <span class="LIDENT">i</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="DONE">done</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-count"><span class="LIDENT">count</span></span> <span id="local_t_391"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_392"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-count"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">count</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <a href="#local_t_391"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_392"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-sum"><span class="LIDENT">sum</span></span> <span id="local_m_393"><span class="LIDENT">m</span></span> <span id="local_t_394"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_395"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-sum"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">sum</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <a href="#local_m_393"><span class="LIDENT">m</span></a> <a href="#local_t_394"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_395"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-min_elt"><span class="LIDENT">min_elt</span></span> <span id="local_t_396"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-min_elt"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">min_elt</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <a href="#local_t_396"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-max_elt"><span class="LIDENT">max_elt</span></span> <span id="local_t_397"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-max_elt"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">max_elt</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <a href="#local_t_397"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-fold_result"><span class="LIDENT">fold_result</span></span> <span id="local_t_398"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_init_399"><span class="LIDENT">init</span></span> <span class="TILDE">~</span><span id="local_f_400"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-fold_result"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">fold_result</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <span class="TILDE">~</span><a href="#local_init_399"><span class="LIDENT">init</span></a> <span class="TILDE">~</span><a href="#local_f_400"><span class="LIDENT">f</span></a> <a href="#local_t_398"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-fold_until"><span class="LIDENT">fold_until</span></span> <span id="local_t_401"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_init_402"><span class="LIDENT">init</span></span> <span class="TILDE">~</span><span id="local_f_403"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_finish_404"><span class="LIDENT">finish</span></span> <span class="EQUAL">=</span> <a href="container.ml.html#val-fold_until"><span class="UIDENT">Container</span><span class="DOT">.</span><span class="LIDENT">fold_until</span></a> <span class="TILDE">~</span><span class="LIDENT">fold</span> <span class="TILDE">~</span><a href="#local_init_402"><span class="LIDENT">init</span></a> <span class="TILDE">~</span><a href="#local_f_403"><span class="LIDENT">f</span></a> <a href="#local_t_401"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_finish_404"><span class="LIDENT">finish</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-find_mapi"><span class="LIDENT">find_mapi</span></span> <span id="local_t_405"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_406"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="indexed_container.ml.html#val-find_mapi"><span class="UIDENT">Indexed_container</span><span class="DOT">.</span><span class="LIDENT">find_mapi</span></a> <span class="TILDE">~</span><span class="LIDENT">iteri</span> <a href="#local_t_405"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_406"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-findi"><span class="LIDENT">findi</span></span> <span id="local_t_407"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_408"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="indexed_container.ml.html#val-findi"><span class="UIDENT">Indexed_container</span><span class="DOT">.</span><span class="LIDENT">findi</span></a> <span class="TILDE">~</span><span class="LIDENT">iteri</span> <a href="#local_t_407"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_408"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-counti"><span class="LIDENT">counti</span></span> <span id="local_t_409"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_410"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="indexed_container.ml.html#val-counti"><span class="UIDENT">Indexed_container</span><span class="DOT">.</span><span class="LIDENT">counti</span></a> <span class="TILDE">~</span><span class="LIDENT">foldi</span> <a href="#local_t_409"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_410"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-for_alli"><span class="LIDENT">for_alli</span></span> <span id="local_t_411"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_412"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="indexed_container.ml.html#val-for_alli"><span class="UIDENT">Indexed_container</span><span class="DOT">.</span><span class="LIDENT">for_alli</span></a> <span class="TILDE">~</span><span class="LIDENT">iteri</span> <a href="#local_t_411"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_412"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-existsi"><span class="LIDENT">existsi</span></span> <span id="local_t_413"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_414"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="indexed_container.ml.html#val-existsi"><span class="UIDENT">Indexed_container</span><span class="DOT">.</span><span class="LIDENT">existsi</span></a> <span class="TILDE">~</span><span class="LIDENT">iteri</span> <a href="#local_t_413"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_414"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-mem"><span class="LIDENT">mem</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_415"><span class="LIDENT">loop</span></span> <span id="local_t_416"><span class="LIDENT">t</span></span> <span id="local_c_417"><span class="LIDENT">c</span></span> <span class="LABEL">~pos:</span><span id="local_i_418"><span class="LIDENT">i</span></span> <span class="TILDE">~</span><span id="local_len_419"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_i_418"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_len_419"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LPAREN">(</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c_417"><span class="LIDENT">c</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_t_416"><span class="LIDENT">t</span></a> <a href="#local_i_418"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_loop_415"><span class="LIDENT">loop</span></a> <a href="#local_t_416"><span class="LIDENT">t</span></a> <a href="#local_c_417"><span class="LIDENT">c</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_i_418"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_len_419"><span class="LIDENT">len</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_t_420"><span class="LIDENT">t</span></span> <span id="local_c_421"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_loop_415"><span class="LIDENT">loop</span></a> <a href="#local_t_420"><span class="LIDENT">t</span></a> <a href="#local_c_421"><span class="LIDENT">c</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_420"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-tr"><span class="LIDENT">tr</span></span> <span class="TILDE">~</span><span id="local_target_422"><span class="LIDENT">target</span></span> <span class="TILDE">~</span><span id="local_replacement_423"><span class="LIDENT">replacement</span></span> <span id="local_s_424"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_target_422"><span class="LIDENT">target</span></a> <a href="#local_replacement_423"><span class="LIDENT">replacement</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_s_424"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="IF">if</span> <span class="LIDENT">mem</span> <a href="#local_s_424"><span class="LIDENT">s</span></a> <a href="#local_target_422"><span class="LIDENT">target</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <span class="LIDENT">map</span> <a href="#local_s_424"><span class="LIDENT">s</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_425"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c_425"><span class="LIDENT">c</span></a> <a href="#local_target_422"><span class="LIDENT">target</span></a> <span class="THEN">then</span> <a href="#local_replacement_423"><span class="LIDENT">replacement</span></a> <span class="ELSE">else</span> <a href="#local_c_425"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="ELSE">else</span> <a href="#local_s_424"><span class="LIDENT">s</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-tr_multi"><span class="LIDENT">tr_multi</span></span> <span class="TILDE">~</span><span id="local_target_426"><span class="LIDENT">target</span></span> <span class="TILDE">~</span><span id="local_replacement_427"><span class="LIDENT">replacement</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">is_empty</span> <a href="#local_target_426"><span class="LIDENT">target</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <span class="LIDENT">stage</span> <a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="IF">if</span> <span class="LIDENT">is_empty</span> <a href="#local_replacement_427"><span class="LIDENT">replacement</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="import0.ml.html#val-invalid_arg"><span class="LIDENT">invalid_arg</span></a> <span class="STRING">&quot;tr_multi replacement is empty string&quot;</span><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="bytes_tr.ml.html#val-tr_create_map"><span class="UIDENT">Bytes_tr</span><span class="DOT">.</span><span class="LIDENT">tr_create_map</span></a> <span class="TILDE">~</span><a href="#local_target_426"><span class="LIDENT">target</span></a> <span class="TILDE">~</span><a href="#local_replacement_427"><span class="LIDENT">replacement</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">stage</span> <a href="fn.ml.html#val-id"><span class="UIDENT">Fn</span><span class="DOT">.</span><span class="LIDENT">id</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_tr_map_428"><span class="LIDENT">tr_map</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">stage</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_s_429"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="IF">if</span> <span class="LIDENT">exists</span> <a href="#local_s_429"><span class="LIDENT">s</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_430"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-(&lt;&gt;)"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="INFIXOP0">&lt;&gt;</span> <span class="RPAREN">)</span></a> <a href="#local_c_430"><span class="LIDENT">c</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_tr_map_428"><span class="LIDENT">tr_map</span></a> <span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_c_430"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="THEN">then</span> <span class="LIDENT">map</span> <a href="#local_s_429"><span class="LIDENT">s</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_431"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unsafe_get</span> <a href="#local_tr_map_428"><span class="LIDENT">tr_map</span></a> <span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_c_431"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <a href="#local_s_429"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* fast version, if we ever need it:
   {[
     let concat_array ~sep ar =
       let ar_len = Array.length ar in
       if ar_len = 0 then &quot;&quot;
       else
         let sep_len = length sep in
         let res_len_ref = ref (sep_len * (ar_len - 1)) in
         for i = 0 to ar_len - 1 do
           res_len_ref := !res_len_ref + length ar.(i)
         done;
         let res = create !res_len_ref in
         let str_0 = ar.(0) in
         let len_0 = length str_0 in
         blit ~src:str_0 ~src_pos:0 ~dst:res ~dst_pos:0 ~len:len_0;
         let pos_ref = ref len_0 in
         for i = 1 to ar_len - 1 do
           let pos = !pos_ref in
           blit ~src:sep ~src_pos:0 ~dst:res ~dst_pos:pos ~len:sep_len;
           let new_pos = pos + sep_len in
           let str_i = ar.(i) in
           let len_i = length str_i in
           blit ~src:str_i ~src_pos:0 ~dst:res ~dst_pos:new_pos ~len:len_i;
           pos_ref := new_pos + len_i
         done;
         res
   ]} *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-concat_array"><span class="LIDENT">concat_array</span></span> <span class="QUESTION">?</span><span id="local_sep_432"><span class="LIDENT">sep</span></span> <span id="local_ar_433"><span class="LIDENT">ar</span></span> <span class="EQUAL">=</span> <span class="LIDENT">concat</span> <span class="QUESTION">?</span><a href="#local_sep_432"><span class="LIDENT">sep</span></a> <span class="LPAREN">(</span><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">to_list</span> <a href="#local_ar_433"><span class="LIDENT">ar</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-concat_map"><span class="LIDENT">concat_map</span></span> <span class="QUESTION">?</span><span id="local_sep_434"><span class="LIDENT">sep</span></span> <span id="local_s_435"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_f_436"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="LIDENT">concat_array</span> <span class="QUESTION">?</span><a href="#local_sep_434"><span class="LIDENT">sep</span></a> <span class="LPAREN">(</span><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">map</span> <span class="LPAREN">(</span><span class="LIDENT">to_array</span> <a href="#local_s_435"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_436"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-concat_mapi"><span class="LIDENT">concat_mapi</span></span> <span class="QUESTION">?</span><span id="local_sep_437"><span class="LIDENT">sep</span></span> <span id="local_t_438"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_439"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="LIDENT">concat_array</span> <span class="QUESTION">?</span><a href="#local_sep_437"><span class="LIDENT">sep</span></a> <span class="LPAREN">(</span><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">mapi</span> <span class="LPAREN">(</span><span class="LIDENT">to_array</span> <a href="#local_t_438"><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_f_439"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-concat_lines"><span class="LIDENT">concat_lines</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_line_lengths_440"><span class="LIDENT">line_lengths</span></span> <span class="TILDE">~</span><span id="local_lines_441"><span class="LIDENT">lines</span></span> <span class="TILDE">~</span><span id="local_newline_len_442"><span class="LIDENT">newline_len</span></span> <span class="TILDE">~</span><span id="local_sum_443"><span class="LIDENT">sum</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_lines_441"><span class="LIDENT">lines</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_sum_443"><span class="LIDENT">sum</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_line_444"><span class="LIDENT">line</span></span> <span class="COLONCOLON">::</span> <span id="local_lines_445"><span class="LIDENT">lines</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_sum_446"><span class="LIDENT">sum</span></span> <span class="EQUAL">=</span> <a href="#local_sum_443"><span class="LIDENT">sum</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_line_444"><span class="LIDENT">line</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="#local_newline_len_442"><span class="LIDENT">newline_len</span></a> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_line_lengths_440"><span class="LIDENT">line_lengths</span></a> <span class="TILDE">~</span><a href="#local_lines_445"><span class="LIDENT">lines</span></a> <span class="TILDE">~</span><a href="#local_newline_len_442"><span class="LIDENT">newline_len</span></a> <span class="TILDE">~</span><a href="#local_sum_446"><span class="LIDENT">sum</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="local_write_lines_447"><span class="LIDENT">write_lines</span></span> <span class="TILDE">~</span><span id="local_buf_448"><span class="LIDENT">buf</span></span> <span class="TILDE">~</span><span id="local_lines_449"><span class="LIDENT">lines</span></span> <span class="TILDE">~</span><span id="local_crlf_450"><span class="LIDENT">crlf</span></span> <span class="TILDE">~</span><span id="local_pos_451"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_lines_449"><span class="LIDENT">lines</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pos_451"><span class="LIDENT">pos</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_line_452"><span class="LIDENT">line</span></span> <span class="COLONCOLON">::</span> <span id="local_lines_453"><span class="LIDENT">lines</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_blit_string</span><span class="EOL">
</span>        <span class="LABEL">~src:</span><a href="#local_line_452"><span class="LIDENT">line</span></a><span class="EOL">
</span>        <span class="LABEL">~src_pos:</span><span class="INT">0</span><span class="EOL">
</span>        <span class="LABEL">~dst:</span><a href="#local_buf_448"><span class="LIDENT">buf</span></a><span class="EOL">
</span>        <span class="LABEL">~dst_pos:</span><a href="#local_pos_451"><span class="LIDENT">pos</span></a><span class="EOL">
</span>        <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_line_452"><span class="LIDENT">line</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pos_454"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <a href="#local_pos_451"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_line_452"><span class="LIDENT">line</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pos_455"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_crlf_450"><span class="LIDENT">crlf</span></a><span class="EOL">
</span>        <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_buf_448"><span class="LIDENT">buf</span></a> <a href="#local_pos_454"><span class="LIDENT">pos</span></a> <span class="CHAR">'\r'</span><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_pos_454"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <a href="#local_pos_454"><span class="LIDENT">pos</span></a><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_buf_448"><span class="LIDENT">buf</span></a> <a href="#local_pos_455"><span class="LIDENT">pos</span></a> <span class="CHAR">'\n'</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_pos_456"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span> <a href="#local_pos_455"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_write_lines_447"><span class="LIDENT">write_lines</span></a> <span class="TILDE">~</span><a href="#local_buf_448"><span class="LIDENT">buf</span></a> <span class="TILDE">~</span><a href="#local_lines_453"><span class="LIDENT">lines</span></a> <span class="TILDE">~</span><a href="#local_crlf_450"><span class="LIDENT">crlf</span></a> <span class="TILDE">~</span><a href="#local_pos_456"><span class="LIDENT">pos</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_crlf_457"><span class="LIDENT">crlf</span></span> <span class="EQUAL">=</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <span id="local_lines_458"><span class="LIDENT">lines</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_newline_len_459"><span class="LIDENT">newline_len</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_crlf_457"><span class="LIDENT">crlf</span></a> <span class="THEN">then</span> <span class="INT">2</span> <span class="ELSE">else</span> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_460"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="#local_line_lengths_440"><span class="LIDENT">line_lengths</span></a> <span class="TILDE">~</span><a href="#local_newline_len_459"><span class="LIDENT">newline_len</span></a> <span class="TILDE">~</span><a href="#local_lines_458"><span class="LIDENT">lines</span></a> <span class="LABEL">~sum:</span><span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_buf_461"><span class="LIDENT">buf</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_len_460"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_written_462"><span class="LIDENT">written</span></span> <span class="EQUAL">=</span> <a href="#local_write_lines_447"><span class="LIDENT">write_lines</span></a> <span class="TILDE">~</span><a href="#local_buf_461"><span class="LIDENT">buf</span></a> <span class="TILDE">~</span><a href="#local_lines_458"><span class="LIDENT">lines</span></a> <span class="TILDE">~</span><a href="#local_crlf_457"><span class="LIDENT">crlf</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="ASSERT">assert</span> <span class="LPAREN">(</span><a href="#local_written_462"><span class="LIDENT">written</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_460"><span class="LIDENT">len</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_buf_461"><span class="LIDENT">buf</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [filter t f] is implemented by the following algorithm.

   Let [n = length t].

   1. Find the lowest [i] such that [not (f t.[i])].

   2. If there is no such [i], then return [t].

   3. If there is such an [i], allocate a string, [out], to hold the result.  [out] has
   length [n - 1], which is the maximum possible output size given that there is at least
   one character not satisfying [f].

   4. Copy characters at indices 0 ... [i - 1] from [t] to [out].

   5. Walk through characters at indices [i+1] ... [n-1] of [t], copying those that
   satisfy [f] from [t] to [out].

   6. If we completely filled [out], then return it.  If not, return the prefix of [out]
   that we did fill in.

   This algorithm has the property that it doesn't allocate a new string if there's
   nothing to filter, which is a common case. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-filter"><span class="LIDENT">filter</span></span> <span id="local_t_463"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_464"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_n_465"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_463"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_i_466"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_465"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_f_464"><span class="LIDENT">f</span></a> <a href="#local_t_463"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="DO">do</span><span class="EOL">
</span>    <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_466"><span class="LIDENT">i</span></a><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_465"><span class="LIDENT">n</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_t_463"><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_467"><span class="LIDENT">out</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_n_465"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_t_463"><span class="LIDENT">t</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="LABEL">~dst:</span><a href="#local_out_467"><span class="LIDENT">out</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_pos_468"><span class="LIDENT">out_pos</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_466"><span class="LIDENT">i</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_465"><span class="LIDENT">n</span></a> <span class="DO">do</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_c_469"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <a href="#local_t_463"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_466"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_f_464"><span class="LIDENT">f</span></a> <a href="#local_c_469"><span class="LIDENT">c</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_out_467"><span class="LIDENT">out</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_468"><span class="LIDENT">out_pos</span></a> <a href="#local_c_469"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_out_pos_468"><span class="LIDENT">out_pos</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_466"><span class="LIDENT">i</span></a><span class="EOL">
</span>    <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_470"><span class="LIDENT">out</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_out_467"><span class="LIDENT">out</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_468"><span class="LIDENT">out_pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_465"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="THEN">then</span> <a href="#local_out_470"><span class="LIDENT">out</span></a> <span class="ELSE">else</span> <span class="LIDENT">sub</span> <a href="#local_out_470"><span class="LIDENT">out</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_468"><span class="LIDENT">out_pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* repeated code to avoid requiring an extra allocation for a closure on each call. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-filteri"><span class="LIDENT">filteri</span></span> <span id="local_t_471"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_472"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_n_473"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_471"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_i_474"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_473"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_f_472"><span class="LIDENT">f</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <a href="#local_t_471"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="DO">do</span><span class="EOL">
</span>    <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_474"><span class="LIDENT">i</span></a><span class="EOL">
</span>  <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_473"><span class="LIDENT">n</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_t_471"><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_475"><span class="LIDENT">out</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="#local_n_473"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_t_471"><span class="LIDENT">t</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="LABEL">~dst:</span><a href="#local_out_475"><span class="LIDENT">out</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_pos_476"><span class="LIDENT">out_pos</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_474"><span class="LIDENT">i</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="WHILE">while</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_n_473"><span class="LIDENT">n</span></a> <span class="DO">do</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_c_477"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <a href="#local_t_471"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_f_472"><span class="LIDENT">f</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_i_474"><span class="LIDENT">i</span></a> <a href="#local_c_477"><span class="LIDENT">c</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_out_475"><span class="LIDENT">out</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_476"><span class="LIDENT">out_pos</span></a> <a href="#local_c_477"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_out_pos_476"><span class="LIDENT">out_pos</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_i_474"><span class="LIDENT">i</span></a><span class="EOL">
</span>    <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_out_478"><span class="LIDENT">out</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_out_475"><span class="LIDENT">out</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_476"><span class="LIDENT">out_pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_n_473"><span class="LIDENT">n</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="THEN">then</span> <a href="#local_out_478"><span class="LIDENT">out</span></a> <span class="ELSE">else</span> <span class="LIDENT">sub</span> <a href="#local_out_478"><span class="LIDENT">out</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_out_pos_476"><span class="LIDENT">out_pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_prefix"><span class="LIDENT">chop_prefix</span></span> <span id="local_s_479"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_prefix_480"><span class="LIDENT">prefix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">is_prefix</span> <a href="#local_s_479"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_prefix_480"><span class="LIDENT">prefix</span></a> <span class="THEN">then</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">drop_prefix</span> <a href="#local_s_479"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_prefix_480"><span class="LIDENT">prefix</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="ELSE">else</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_prefix_if_exists"><span class="LIDENT">chop_prefix_if_exists</span></span> <span id="local_s_481"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_prefix_482"><span class="LIDENT">prefix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">is_prefix</span> <a href="#local_s_481"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_prefix_482"><span class="LIDENT">prefix</span></a> <span class="THEN">then</span> <span class="LIDENT">drop_prefix</span> <a href="#local_s_481"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_prefix_482"><span class="LIDENT">prefix</span></a><span class="RPAREN">)</span> <span class="ELSE">else</span> <a href="#local_s_481"><span class="LIDENT">s</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_prefix_exn"><span class="LIDENT">chop_prefix_exn</span></span> <span id="local_s_483"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_prefix_484"><span class="LIDENT">prefix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">chop_prefix</span> <a href="#local_s_483"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_prefix_484"><span class="LIDENT">prefix</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_str_485"><span class="LIDENT">str</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_str_485"><span class="LIDENT">str</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">invalid_argf</span> <span class="STRING">&quot;String.chop_prefix_exn %S %S&quot;</span> <a href="#local_s_483"><span class="LIDENT">s</span></a> <a href="#local_prefix_484"><span class="LIDENT">prefix</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_suffix"><span class="LIDENT">chop_suffix</span></span> <span id="local_s_486"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_suffix_487"><span class="LIDENT">suffix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">is_suffix</span> <a href="#local_s_486"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_suffix_487"><span class="LIDENT">suffix</span></a> <span class="THEN">then</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="LIDENT">drop_suffix</span> <a href="#local_s_486"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_suffix_487"><span class="LIDENT">suffix</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="ELSE">else</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_suffix_if_exists"><span class="LIDENT">chop_suffix_if_exists</span></span> <span id="local_s_488"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_suffix_489"><span class="LIDENT">suffix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">is_suffix</span> <a href="#local_s_488"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_suffix_489"><span class="LIDENT">suffix</span></a> <span class="THEN">then</span> <span class="LIDENT">drop_suffix</span> <a href="#local_s_488"><span class="LIDENT">s</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_suffix_489"><span class="LIDENT">suffix</span></a><span class="RPAREN">)</span> <span class="ELSE">else</span> <a href="#local_s_488"><span class="LIDENT">s</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-chop_suffix_exn"><span class="LIDENT">chop_suffix_exn</span></span> <span id="local_s_490"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_suffix_491"><span class="LIDENT">suffix</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="LIDENT">chop_suffix</span> <a href="#local_s_490"><span class="LIDENT">s</span></a> <span class="TILDE">~</span><a href="#local_suffix_491"><span class="LIDENT">suffix</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_str_492"><span class="LIDENT">str</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_str_492"><span class="LIDENT">str</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">invalid_argf</span> <span class="STRING">&quot;String.chop_suffix_exn %S %S&quot;</span> <a href="#local_s_490"><span class="LIDENT">s</span></a> <a href="#local_suffix_491"><span class="LIDENT">suffix</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-For_common_prefix_and_suffix"><span class="MODULE">module</span> <span class="UIDENT">For_common_prefix_and_suffix</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="COMMENT">(* When taking a string prefix or suffix, we extract from the shortest input available
     in case we can just return one of our inputs without allocating a new string. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-shorter"><span class="LIDENT">shorter</span></span> <span id="local_a_493"><span class="LIDENT">a</span></span> <span id="local_b_494"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <span class="LIDENT">length</span> <a href="#local_a_493"><span class="LIDENT">a</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <span class="LIDENT">length</span> <a href="#local_b_494"><span class="LIDENT">b</span></a> <span class="THEN">then</span> <a href="#local_a_493"><span class="LIDENT">a</span></a> <span class="ELSE">else</span> <a href="#local_b_494"><span class="LIDENT">b</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-shortest"><span class="LIDENT">shortest</span></span> <span id="local_list_495"><span class="LIDENT">list</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_list_495"><span class="LIDENT">list</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_first_496"><span class="LIDENT">first</span></span> <span class="COLONCOLON">::</span> <span id="local_rest_497"><span class="LIDENT">rest</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="list0.ml.html#val-fold"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold</span></a> <a href="#local_rest_497"><span class="LIDENT">rest</span></a> <span class="LABEL">~init:</span><a href="#local_first_496"><span class="LIDENT">first</span></a> <span class="LABEL">~f:</span><span class="LIDENT">shorter</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Our generic accessors for common prefix/suffix abstract over [get_pos], which is
     either [pos_from_left] or [pos_from_right]. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-pos_from_left"><span class="LIDENT">pos_from_left</span></span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span> <span class="COLON">:</span> <span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span id="local_i_498"><span class="LIDENT">i</span></span> <span class="COLON">:</span> <span class="LIDENT">int</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_i_498"><span class="LIDENT">i</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-pos_from_right"><span class="LIDENT">pos_from_right</span></span> <span id="local_t_499"><span class="LIDENT">t</span></span> <span id="local_i_500"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_499"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_i_500"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-For_common_prefix_and_suffix.val-common_generic2_length_loop"><span class="LIDENT">common_generic2_length_loop</span></span> <span id="local_a_501"><span class="LIDENT">a</span></span> <span id="local_b_502"><span class="LIDENT">b</span></span> <span class="TILDE">~</span><span id="local_get_pos_503"><span class="LIDENT">get_pos</span></span> <span class="TILDE">~</span><span id="local_max_len_504"><span class="LIDENT">max_len</span></span> <span class="TILDE">~</span><span id="local_len_so_far_505"><span class="LIDENT">len_so_far</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_len_so_far_505"><span class="LIDENT">len_so_far</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_max_len_504"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_max_len_504"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_a_501"><span class="LIDENT">a</span></a> <span class="LPAREN">(</span><a href="#local_get_pos_503"><span class="LIDENT">get_pos</span></a> <a href="#local_a_501"><span class="LIDENT">a</span></a> <a href="#local_len_so_far_505"><span class="LIDENT">len_so_far</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_b_502"><span class="LIDENT">b</span></a> <span class="LPAREN">(</span><a href="#local_get_pos_503"><span class="LIDENT">get_pos</span></a> <a href="#local_b_502"><span class="LIDENT">b</span></a> <a href="#local_len_so_far_505"><span class="LIDENT">len_so_far</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="LIDENT">common_generic2_length_loop</span> <a href="#local_a_501"><span class="LIDENT">a</span></a> <a href="#local_b_502"><span class="LIDENT">b</span></a> <span class="TILDE">~</span><a href="#local_get_pos_503"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_504"><span class="LIDENT">max_len</span></a> <span class="LABEL">~len_so_far:</span><span class="LPAREN">(</span><a href="#local_len_so_far_505"><span class="LIDENT">len_so_far</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="#local_len_so_far_505"><span class="LIDENT">len_so_far</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-common_generic2_length"><span class="LIDENT">common_generic2_length</span></span> <span id="local_a_506"><span class="LIDENT">a</span></span> <span id="local_b_507"><span class="LIDENT">b</span></span> <span class="TILDE">~</span><span id="local_get_pos_508"><span class="LIDENT">get_pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_max_len_509"><span class="LIDENT">max_len</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-min"><span class="LIDENT">min</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_a_506"><span class="LIDENT">a</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_b_507"><span class="LIDENT">b</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">common_generic2_length_loop</span> <a href="#local_a_506"><span class="LIDENT">a</span></a> <a href="#local_b_507"><span class="LIDENT">b</span></a> <span class="TILDE">~</span><a href="#local_get_pos_508"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_509"><span class="LIDENT">max_len</span></a> <span class="LABEL">~len_so_far:</span><span class="INT">0</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="REC">rec</span> <span id="module-For_common_prefix_and_suffix.val-common_generic_length_loop"><span class="LIDENT">common_generic_length_loop</span></span> <span id="local_first_510"><span class="LIDENT">first</span></span> <span id="local_list_511"><span class="LIDENT">list</span></span> <span class="TILDE">~</span><span id="local_get_pos_512"><span class="LIDENT">get_pos</span></span> <span class="TILDE">~</span><span id="local_max_len_513"><span class="LIDENT">max_len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_list_511"><span class="LIDENT">list</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_max_len_513"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_second_514"><span class="LIDENT">second</span></span> <span class="COLONCOLON">::</span> <span id="local_rest_515"><span class="LIDENT">rest</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_max_len_516"><span class="LIDENT">max_len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="COMMENT">(* We call [common_generic2_length_loop] rather than [common_generic2_length] so
           that [max_len] limits our traversal of [first] and [second]. *)</span><span class="EOL">
</span>        <span class="LIDENT">common_generic2_length_loop</span> <a href="#local_first_510"><span class="LIDENT">first</span></a> <a href="#local_second_514"><span class="LIDENT">second</span></a> <span class="TILDE">~</span><a href="#local_get_pos_512"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_513"><span class="LIDENT">max_len</span></a> <span class="LABEL">~len_so_far:</span><span class="INT">0</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">common_generic_length_loop</span> <a href="#local_second_514"><span class="LIDENT">second</span></a> <a href="#local_rest_515"><span class="LIDENT">rest</span></a> <span class="TILDE">~</span><a href="#local_get_pos_512"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_516"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-common_generic_length"><span class="LIDENT">common_generic_length</span></span> <span id="local_list_517"><span class="LIDENT">list</span></span> <span class="TILDE">~</span><span id="local_get_pos_518"><span class="LIDENT">get_pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_list_517"><span class="LIDENT">list</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="INT">0</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_first_519"><span class="LIDENT">first</span></span> <span class="COLONCOLON">::</span> <span id="local_rest_520"><span class="LIDENT">rest</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="COMMENT">(* Precomputing [max_len] based on [shortest list] saves us work in longer strings,
         at the cost of an extra pass over the spine of [list].

         For example, if you're looking for the longest prefix of the strings:

         {v
            let long_a = List.init 1000 ~f:(Fn.const 'a')
            [ long_a; long_a; 'aa' ]
         v}

         the approach below will just check the first two characters of all the strings.
      *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_max_len_521"><span class="LIDENT">max_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <span class="LPAREN">(</span><span class="LIDENT">shortest</span> <a href="#local_list_517"><span class="LIDENT">list</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">common_generic_length_loop</span> <a href="#local_first_519"><span class="LIDENT">first</span></a> <a href="#local_rest_520"><span class="LIDENT">rest</span></a> <span class="TILDE">~</span><a href="#local_get_pos_518"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_521"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* Our generic accessors that produce a string abstract over [take], which is either
     [prefix] or [suffix]. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-common_generic2"><span class="LIDENT">common_generic2</span></span> <span id="local_a_522"><span class="LIDENT">a</span></span> <span id="local_b_523"><span class="LIDENT">b</span></span> <span class="TILDE">~</span><span id="local_get_pos_524"><span class="LIDENT">get_pos</span></span> <span class="TILDE">~</span><span id="local_take_525"><span class="LIDENT">take</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_526"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic2_length</span> <a href="#local_a_522"><span class="LIDENT">a</span></a> <a href="#local_b_523"><span class="LIDENT">b</span></a> <span class="TILDE">~</span><a href="#local_get_pos_524"><span class="LIDENT">get_pos</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Use the shorter of the two strings, so that if the shorter one is the shared
       prefix, [take] won't allocate another string. *)</span><span class="EOL">
</span>    <a href="#local_take_525"><span class="LIDENT">take</span></a> <span class="LPAREN">(</span><span class="LIDENT">shorter</span> <a href="#local_a_522"><span class="LIDENT">a</span></a> <a href="#local_b_523"><span class="LIDENT">b</span></a><span class="RPAREN">)</span> <a href="#local_len_526"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-For_common_prefix_and_suffix.val-common_generic"><span class="LIDENT">common_generic</span></span> <span id="local_list_527"><span class="LIDENT">list</span></span> <span class="TILDE">~</span><span id="local_get_pos_528"><span class="LIDENT">get_pos</span></span> <span class="TILDE">~</span><span id="local_take_529"><span class="LIDENT">take</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_list_527"><span class="LIDENT">list</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span id="local_first_530"><span class="LIDENT">first</span></span> <span class="COLONCOLON">::</span> <span id="local_rest_531"><span class="LIDENT">rest</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="COMMENT">(* As with [common_generic_length], we base [max_len] on [shortest list]. We also
         use this result for [take], below, to potentially avoid allocating a string. *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_s_532"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span> <span class="LIDENT">shortest</span> <a href="#local_list_527"><span class="LIDENT">list</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_max_len_533"><span class="LIDENT">max_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_532"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_max_len_533"><span class="LIDENT">max_len</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>      <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_len_534"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="COMMENT">(* We call directly into [common_generic_length_loop] rather than
             [common_generic_length] to avoid recomputing [shortest list]. *)</span><span class="EOL">
</span>          <span class="LIDENT">common_generic_length_loop</span> <a href="#local_first_530"><span class="LIDENT">first</span></a> <a href="#local_rest_531"><span class="LIDENT">rest</span></a> <span class="TILDE">~</span><a href="#local_get_pos_528"><span class="LIDENT">get_pos</span></a> <span class="TILDE">~</span><a href="#local_max_len_533"><span class="LIDENT">max_len</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <a href="#local_take_529"><span class="LIDENT">take</span></a> <a href="#local_s_532"><span class="LIDENT">s</span></a> <a href="#local_len_534"><span class="LIDENT">len</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="OPEN">open</span> <span class="UIDENT">For_common_prefix_and_suffix</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_prefix_535"><span class="LIDENT">common_prefix</span></span> <span id="local_list_536"><span class="LIDENT">list</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic</span> <a href="#local_list_536"><span class="LIDENT">list</span></a> <span class="LABEL">~take:</span><span class="LIDENT">prefix</span> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_left</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_suffix_537"><span class="LIDENT">common_suffix</span></span> <span id="local_list_538"><span class="LIDENT">list</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic</span> <a href="#local_list_538"><span class="LIDENT">list</span></a> <span class="LABEL">~take:</span><span class="LIDENT">suffix</span> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_right</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_prefix2_539"><span class="LIDENT">common_prefix2</span></span> <span id="local_a_540"><span class="LIDENT">a</span></span> <span id="local_b_541"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic2</span> <a href="#local_a_540"><span class="LIDENT">a</span></a> <a href="#local_b_541"><span class="LIDENT">b</span></a> <span class="LABEL">~take:</span><span class="LIDENT">prefix</span> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_left</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_suffix2_542"><span class="LIDENT">common_suffix2</span></span> <span id="local_a_543"><span class="LIDENT">a</span></span> <span id="local_b_544"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic2</span> <a href="#local_a_543"><span class="LIDENT">a</span></a> <a href="#local_b_544"><span class="LIDENT">b</span></a> <span class="LABEL">~take:</span><span class="LIDENT">suffix</span> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_right</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_prefix_length_545"><span class="LIDENT">common_prefix_length</span></span> <span id="local_list_546"><span class="LIDENT">list</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic_length</span> <a href="#local_list_546"><span class="LIDENT">list</span></a> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_left</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_suffix_length_547"><span class="LIDENT">common_suffix_length</span></span> <span id="local_list_548"><span class="LIDENT">list</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic_length</span> <a href="#local_list_548"><span class="LIDENT">list</span></a> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_right</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_prefix2_length_549"><span class="LIDENT">common_prefix2_length</span></span> <span id="local_a_550"><span class="LIDENT">a</span></span> <span id="local_b_551"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic2_length</span> <a href="#local_a_550"><span class="LIDENT">a</span></a> <a href="#local_b_551"><span class="LIDENT">b</span></a> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_left</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_common_suffix2_length_552"><span class="LIDENT">common_suffix2_length</span></span> <span id="local_a_553"><span class="LIDENT">a</span></span> <span id="local_b_554"><span class="LIDENT">b</span></span> <span class="EQUAL">=</span> <span class="LIDENT">common_generic2_length</span> <a href="#local_a_553"><span class="LIDENT">a</span></a> <a href="#local_b_554"><span class="LIDENT">b</span></a> <span class="LABEL">~get_pos:</span><span class="LIDENT">pos_from_right</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* There used to be a custom implementation that was faster for very short strings
   (peaking at 40% faster for 4-6 char long strings).
   This new function is around 20% faster than the default hash function, but slower
   than the previous custom implementation. However, the new OCaml function is well
   behaved, and this implementation is less likely to diverge from the default OCaml
   implementation does, which is a desirable property. (The only way to avoid the
   divergence is to expose the macro redefined in hash_stubs.c in the hash.h header of
   the OCaml compiler.) *)</span><span class="EOL">
</span><span id="module-Hash"><span class="MODULE">module</span> <span class="UIDENT">Hash</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Hash.val-hash"><span class="EXTERNAL">external</span> <span class="LIDENT">hash</span> <span class="COLON">:</span> <span class="LIDENT">string</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">int</span> <span class="EQUAL">=</span> <span class="STRING">&quot;Base_hash_string&quot;</span> <span class="LBRACKETATAT">[@@</span><span class="LIDENT">noalloc</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [include Hash] to make the [external] version override the [hash] from
   [Hashable.Make_binable], so that we get a little bit of a speedup by exposing it as
   external in the mli. *)</span><span class="EOL">
</span><span class="LET">let</span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LIDENT">hash</span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <span class="UIDENT">Hash</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* for interactive top-levels -- modules deriving from String should have String's pretty
   printer. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-pp"><span class="LIDENT">pp</span></span> <span id="local_ppf_555"><span class="LIDENT">ppf</span></span> <span id="local_string_556"><span class="LIDENT">string</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-fprintf"><span class="UIDENT">Stdlib</span><span class="DOT">.</span><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">fprintf</span></a> <a href="#local_ppf_555"><span class="LIDENT">ppf</span></a> <span class="STRING">&quot;%S&quot;</span> <a href="#local_string_556"><span class="LIDENT">string</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-of_char"><span class="LIDENT">of_char</span></span> <span id="local_c_557"><span class="LIDENT">c</span></span> <span class="EQUAL">=</span> <span class="LIDENT">make</span> <span class="INT">1</span> <a href="#local_c_557"><span class="LIDENT">c</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-of_char_list"><span class="LIDENT">of_char_list</span></span> <span id="local_l_558"><span class="LIDENT">l</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_t_559"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><a href="list0.ml.html#val-length"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_l_558"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="list.ml.html#val-iteri"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iteri</span></a> <a href="#local_l_558"><span class="LIDENT">l</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_560"><span class="LIDENT">i</span></span> <span id="local_c_561"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_t_559"><span class="LIDENT">t</span></a> <a href="#local_i_560"><span class="LIDENT">i</span></a> <a href="#local_c_561"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_t_559"><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-of_list"><span class="LIDENT">of_list</span></span> <span class="EQUAL">=</span> <span class="LIDENT">of_char_list</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-of_array"><span class="LIDENT">of_array</span></span> <span id="local_a_562"><span class="LIDENT">a</span></span> <span class="EQUAL">=</span> <span class="LIDENT">init</span> <span class="LPAREN">(</span><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_a_562"><span class="LIDENT">a</span></a><span class="RPAREN">)</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">get</span> <a href="#local_a_562"><span class="LIDENT">a</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-append"><span class="LIDENT">append</span></span> <span class="EQUAL">=</span> <span class="LPAREN">(</span> <span class="INFIXOP1">^</span> <span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-pad_right"><span class="LIDENT">pad_right</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_char_563"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="CHAR">' '</span><span class="RPAREN">)</span> <span id="local_s_564"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_len_565"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_src_len_566"><span class="LIDENT">src_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_564"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_src_len_566"><span class="LIDENT">src_len</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_len_565"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_s_564"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_res_567"><span class="LIDENT">res</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_len_565"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_s_564"><span class="LIDENT">s</span></a> <span class="LABEL">~dst:</span><a href="#local_res_567"><span class="LIDENT">res</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_src_len_566"><span class="LIDENT">src_len</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">fill</span> <span class="LABEL">~pos:</span><a href="#local_src_len_566"><span class="LIDENT">src_len</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_565"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_src_len_566"><span class="LIDENT">src_len</span></a><span class="RPAREN">)</span> <a href="#local_res_567"><span class="LIDENT">res</span></a> <a href="#local_char_563"><span class="LIDENT">char</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_res_567"><span class="LIDENT">res</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-pad_left"><span class="LIDENT">pad_left</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_char_568"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="CHAR">' '</span><span class="RPAREN">)</span> <span id="local_s_569"><span class="LIDENT">s</span></span> <span class="TILDE">~</span><span id="local_len_570"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_src_len_571"><span class="LIDENT">src_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_s_569"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_src_len_571"><span class="LIDENT">src_len</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_len_570"><span class="LIDENT">len</span></a><span class="EOL">
</span>  <span class="THEN">then</span> <a href="#local_s_569"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_res_572"><span class="LIDENT">res</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_len_570"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="LABEL">~src:</span><a href="#local_s_569"><span class="LIDENT">s</span></a> <span class="LABEL">~dst:</span><a href="#local_res_572"><span class="LIDENT">res</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="LABEL">~dst_pos:</span><span class="LPAREN">(</span><a href="#local_len_570"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_src_len_571"><span class="LIDENT">src_len</span></a><span class="RPAREN">)</span> <span class="LABEL">~len:</span><a href="#local_src_len_571"><span class="LIDENT">src_len</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">fill</span> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_570"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_src_len_571"><span class="LIDENT">src_len</span></a><span class="RPAREN">)</span> <a href="#local_res_572"><span class="LIDENT">res</span></a> <a href="#local_char_568"><span class="LIDENT">char</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_res_572"><span class="LIDENT">res</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Called upon first difference generated by filtering. Allocates [buffer_len] bytes
   for new result, and copies [prefix_len] unchanged characters from [src].
   Always returns a local buffer. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-local_copy_prefix"><span class="LIDENT">local_copy_prefix</span></span> <span class="LPAREN">(</span><span id="local_src_573"><span class="LIDENT">src</span></span> <span class="LBRACKETAT">[@</span><span class="LIDENT">local</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="TILDE">~</span><span id="local_prefix_len_574"><span class="LIDENT">prefix_len</span></span> <span class="TILDE">~</span><span id="local_buffer_len_575"><span class="LIDENT">buffer_len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_dst_576"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create_local</span> <a href="#local_buffer_len_575"><span class="LIDENT">buffer_len</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="UIDENT">Primitives</span><span class="DOT">.</span><span class="LIDENT">unsafe_blit_string</span> <span class="TILDE">~</span><a href="#local_src_573"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_dst_576"><span class="LIDENT">dst</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_prefix_len_574"><span class="LIDENT">prefix_len</span></a><span class="SEMI">;</span><span class="EOL">
</span>   <a href="#local_dst_576"><span class="LIDENT">dst</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Copies a perhaps-local buffer into a definitely-global string. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-local_copy_to_string"><span class="LIDENT">local_copy_to_string</span></span> <span class="LPAREN">(</span><span id="local_buf_577"><span class="LIDENT">buf</span></span> <span class="LBRACKETAT">[@</span><span class="LIDENT">local</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="TILDE">~</span><span id="local_pos_578"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_str_579"><span class="LIDENT">str</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_buf_577"><span class="LIDENT">buf</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LIDENT">unsafe_sub</span> <a href="#local_str_579"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_pos_578"><span class="LIDENT">pos</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="OPEN">open</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span class="COMMENT">(* filter_map helpers *)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* Filters from string [src] into an allocated buffer [dst];
       copies the allocated buffer to a heap-allocated result string.

       Pre-conditions:
       [src_len = length src]
       [src != dst]
       [0 &lt;= src_pos &lt; src_len]
       [0 &lt;= dst_pos &lt; length dst]
    *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_filter_mapi_into_580"><span class="LIDENT">filter_mapi_into</span></span> <span id="local_src_581"><span class="LIDENT">src</span></span> <span class="LPAREN">(</span><span id="local_dst_582"><span class="LIDENT">dst</span></span> <span class="LBRACKETAT">[@</span><span class="LIDENT">local</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="TILDE">~</span><span id="local_f_583"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_src_pos_584"><span class="LIDENT">src_pos</span></span> <span class="TILDE">~</span><span id="local_dst_pos_585"><span class="LIDENT">dst_pos</span></span> <span class="TILDE">~</span><span id="local_src_len_586"><span class="LIDENT">src_len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_dst_pos_587"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span>  <span class="LPAREN">(</span><a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_dst_pos_585"><span class="LIDENT">dst_pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FOR">for</span> <span class="LIDENT">src_pos</span> <span class="EQUAL">=</span> <a href="#local_src_pos_584"><span class="LIDENT">src_pos</span></a> <span class="TO">to</span> <a href="#local_src_len_586"><span class="LIDENT">src_len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_f_583"><span class="LIDENT">f</span></a> <span class="LIDENT">src_pos</span> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_src_581"><span class="LIDENT">src</span></a> <span class="LIDENT">src_pos</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_c_588"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_dst_582"><span class="LIDENT">dst</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dst_pos_587"><span class="LIDENT">dst_pos</span></a> <a href="#local_c_588"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_dst_pos_587"><span class="LIDENT">dst_pos</span></a><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">local_copy_to_string</span> <a href="#local_dst_582"><span class="LIDENT">dst</span></a> <span class="LABEL">~pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_dst_pos_587"><span class="LIDENT">dst_pos</span></a><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="COMMENT">(* Filters [t]. If the result turns out to be identical to the input, returns [t]
       directly without needing to allocate a buffer and traverse the string twice.

       Pre-condition: [len == length t]
       Pre-condition: [0 &lt;= pos &lt;= len] *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_filter_mapi_maybe_id_589"><span class="LIDENT">filter_mapi_maybe_id</span></span> <span id="local_t_590"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_591"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_pos_592"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_593"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_pos_592"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_593"><span class="LIDENT">len</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <a href="#local_t_590"><span class="LIDENT">t</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_c1_594"><span class="LIDENT">c1</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_t_590"><span class="LIDENT">t</span></a> <a href="#local_pos_592"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_next_595"><span class="LIDENT">next</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Int</span><span class="DOT">.</span><span class="LIDENT">succ</span> <a href="#local_pos_592"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_f_591"><span class="LIDENT">f</span></a> <a href="#local_pos_592"><span class="LIDENT">pos</span></a> <a href="#local_c1_594"><span class="LIDENT">c1</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_c2_596"><span class="LIDENT">c2</span></span> <span class="WHEN">when</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c1_594"><span class="LIDENT">c1</span></a> <a href="#local_c2_596"><span class="LIDENT">c2</span></a> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* if nothing has changed, continue *)</span><span class="EOL">
</span>          <a href="#local_filter_mapi_maybe_id_589"><span class="LIDENT">filter_mapi_maybe_id</span></a> <a href="#local_t_590"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_591"><span class="LIDENT">f</span></a> <span class="LABEL">~pos:</span><a href="#local_next_595"><span class="LIDENT">next</span></a> <span class="TILDE">~</span><a href="#local_len_593"><span class="LIDENT">len</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span id="local_option_597"><span class="LIDENT">option</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="COMMENT">(* If a character has been changed or dropped, begin an output buffer up to
             [pos], and write the new character into it. *)</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_copy_598"><span class="LIDENT">copy</span></span> <span class="EQUAL">=</span> <span class="LIDENT">local_copy_prefix</span> <a href="#local_t_590"><span class="LIDENT">t</span></a> <span class="LABEL">~prefix_len:</span><a href="#local_pos_592"><span class="LIDENT">pos</span></a> <span class="LABEL">~buffer_len:</span><a href="#local_len_593"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_dst_pos_599"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="#local_option_597"><span class="LIDENT">option</span></a> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pos_592"><span class="LIDENT">pos</span></a><span class="EOL">
</span>            <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_c_600"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>              <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_copy_598"><span class="LIDENT">copy</span></a> <a href="#local_pos_592"><span class="LIDENT">pos</span></a> <a href="#local_c_600"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>              <a href="#local_next_595"><span class="LIDENT">next</span></a><span class="EOL">
</span>          <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_filter_mapi_into_580"><span class="LIDENT">filter_mapi_into</span></a> <a href="#local_t_590"><span class="LIDENT">t</span></a> <a href="#local_copy_598"><span class="LIDENT">copy</span></a> <span class="TILDE">~</span><a href="#local_f_591"><span class="LIDENT">f</span></a> <span class="LABEL">~src_pos:</span><a href="#local_next_595"><span class="LIDENT">next</span></a> <span class="TILDE">~</span><a href="#local_dst_pos_599"><span class="LIDENT">dst_pos</span></a> <span class="LABEL">~src_len:</span><a href="#local_len_593"><span class="LIDENT">len</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span>  <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* filter_map functions *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_filter_mapi_601"><span class="LIDENT">filter_mapi</span></span> <span id="local_t_602"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_603"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="LIDENT">filter_mapi_maybe_id</span> <a href="#local_t_602"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_f_603"><span class="LIDENT">f</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_t_602"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_filter_map_604"><span class="LIDENT">filter_map</span></span> <span id="local_t_605"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_606"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="#local_filter_mapi_601"><span class="LIDENT">filter_mapi</span></a> <a href="#local_t_605"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span class="UNDERSCORE">_</span> <span id="local_c_607"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_606"><span class="LIDENT">f</span></a> <a href="#local_c_607"><span class="LIDENT">c</span></a><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="INCLUDE">include</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="OPEN">open</span> <span class="STRUCT">struct</span><span class="EOL">
</span>    <span class="COMMENT">(* partition helpers *)</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_partition_map_into_608"><span class="LIDENT">partition_map_into</span></span> <span id="local_src_609"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_fsts_610"><span class="LIDENT">fsts</span></span> <span class="TILDE">~</span><span id="local_snds_611"><span class="LIDENT">snds</span></span> <span class="TILDE">~</span><span id="local_f_612"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_len_613"><span class="LIDENT">len</span></span> <span class="TILDE">~</span><span id="local_src_pos_614"><span class="LIDENT">src_pos</span></span> <span class="TILDE">~</span><span id="local_fst_pos_615"><span class="LIDENT">fst_pos</span></span> <span class="TILDE">~</span><span id="local_snd_pos_616"><span class="LIDENT">snd_pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_fst_pos_617"><span class="LIDENT">fst_pos</span></span> <span class="EQUAL">=</span>  <span class="LPAREN">(</span><a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_fst_pos_615"><span class="LIDENT">fst_pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_snd_pos_618"><span class="LIDENT">snd_pos</span></span> <span class="EQUAL">=</span>  <span class="LPAREN">(</span><a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <a href="#local_snd_pos_616"><span class="LIDENT">snd_pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="FOR">for</span> <span class="LIDENT">src_pos</span> <span class="EQUAL">=</span> <a href="#local_src_pos_614"><span class="LIDENT">src_pos</span></a> <span class="TO">to</span> <a href="#local_len_613"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="DO">do</span><span class="EOL">
</span>        <span class="MATCH">match</span>  <span class="LPAREN">(</span><a href="#local_f_612"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="LIDENT">unsafe_get</span> <a href="#local_src_609"><span class="LIDENT">src</span></a> <span class="LIDENT">src_pos</span><span class="RPAREN">)</span> <span class="COLON">:</span> <a href="either0.ml.html#type-t"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Either</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">First</span> <span id="local_c_619"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_fsts_610"><span class="LIDENT">fsts</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_fst_pos_617"><span class="LIDENT">fst_pos</span></a> <a href="#local_c_619"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_fst_pos_617"><span class="LIDENT">fst_pos</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Second</span> <span id="local_c_620"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_snds_611"><span class="LIDENT">snds</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_snd_pos_618"><span class="LIDENT">snd_pos</span></a> <a href="#local_c_620"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_snd_pos_618"><span class="LIDENT">snd_pos</span></a><span class="EOL">
</span>      <span class="DONE">done</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LIDENT">local_copy_to_string</span> <a href="#local_fsts_610"><span class="LIDENT">fsts</span></a> <span class="LABEL">~pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_fst_pos_617"><span class="LIDENT">fst_pos</span></a><span class="COMMA">,</span> <span class="LIDENT">local_copy_to_string</span> <a href="#local_snds_611"><span class="LIDENT">snds</span></a> <span class="LABEL">~pos:</span><a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_snd_pos_618"><span class="LIDENT">snd_pos</span></a><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_partition_map_difference_621"><span class="LIDENT">partition_map_difference</span></span> <span id="local_src_622"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_f_623"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_len_624"><span class="LIDENT">len</span></span> <span class="LABEL">~pos:</span><span id="local_src_pos_625"><span class="LIDENT">src_pos</span></span> <span class="TILDE">~</span><span id="local_fst_pos_626"><span class="LIDENT">fst_pos</span></span> <span class="TILDE">~</span><span id="local_snd_pos_627"><span class="LIDENT">snd_pos</span></span> <span id="local_either_628"><span class="LIDENT">either</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_fsts_629"><span class="LIDENT">fsts</span></span> <span class="EQUAL">=</span> <span class="LIDENT">local_copy_prefix</span> <a href="#local_src_622"><span class="LIDENT">src</span></a> <span class="LABEL">~prefix_len:</span><a href="#local_fst_pos_626"><span class="LIDENT">fst_pos</span></a> <span class="LABEL">~buffer_len:</span><a href="#local_len_624"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_snds_630"><span class="LIDENT">snds</span></span> <span class="EQUAL">=</span> <span class="LIDENT">local_copy_prefix</span> <a href="#local_src_622"><span class="LIDENT">src</span></a> <span class="LABEL">~prefix_len:</span><a href="#local_snd_pos_627"><span class="LIDENT">snd_pos</span></a> <span class="LABEL">~buffer_len:</span><a href="#local_len_624"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="def_874"><span id="local_fst_pos_631"><span class="LIDENT">fst_pos</span></span><span class="COMMA">,</span> <span id="local_snd_pos_632"><span class="LIDENT">snd_pos</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="MATCH">match</span> <span class="LPAREN">(</span><a href="#local_either_628"><span class="LIDENT">either</span></a> <span class="COLON">:</span> <a href="either0.ml.html#type-t"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Either</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">First</span> <span id="local_c_633"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_fsts_629"><span class="LIDENT">fsts</span></a> <a href="#local_fst_pos_626"><span class="LIDENT">fst_pos</span></a> <a href="#local_c_633"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>           <span class="LPAREN">(</span><a href="#local_fst_pos_626"><span class="LIDENT">fst_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="COMMA">,</span> <a href="#local_snd_pos_627"><span class="LIDENT">snd_pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Second</span> <span id="local_c_634"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_set</span> <a href="#local_snds_630"><span class="LIDENT">snds</span></a> <a href="#local_snd_pos_627"><span class="LIDENT">snd_pos</span></a> <a href="#local_c_634"><span class="LIDENT">c</span></a><span class="SEMI">;</span><span class="EOL">
</span>           <span class="LPAREN">(</span><a href="#local_fst_pos_626"><span class="LIDENT">fst_pos</span></a><span class="COMMA">,</span> <a href="#local_snd_pos_627"><span class="LIDENT">snd_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_partition_map_into_608"><span class="LIDENT">partition_map_into</span></a><span class="EOL">
</span>        <a href="#local_src_622"><span class="LIDENT">src</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_fsts_629"><span class="LIDENT">fsts</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_snds_630"><span class="LIDENT">snds</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_f_623"><span class="LIDENT">f</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_len_624"><span class="LIDENT">len</span></a><span class="EOL">
</span>        <span class="LABEL">~src_pos:</span><span class="LPAREN">(</span><a href="#local_src_pos_625"><span class="LIDENT">src_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_fst_pos_631"><span class="LIDENT">fst_pos</span></a><span class="EOL">
</span>        <span class="TILDE">~</span><a href="#local_snd_pos_632"><span class="LIDENT">snd_pos</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_partition_map_first_maybe_id_635"><span class="LIDENT">partition_map_first_maybe_id</span></span> <span id="local_src_636"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_f_637"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_pos_638"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_639"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_pos_638"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_639"><span class="LIDENT">len</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <a href="#local_src_636"><span class="LIDENT">src</span></a><span class="COMMA">,</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_c1_640"><span class="LIDENT">c1</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_src_636"><span class="LIDENT">src</span></a> <a href="#local_pos_638"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span>  <span class="LPAREN">(</span><a href="#local_f_637"><span class="LIDENT">f</span></a> <a href="#local_c1_640"><span class="LIDENT">c1</span></a> <span class="COLON">:</span> <a href="either0.ml.html#type-t"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Either</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">First</span> <span id="local_c2_641"><span class="LIDENT">c2</span></span> <span class="WHEN">when</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c1_640"><span class="LIDENT">c1</span></a> <a href="#local_c2_641"><span class="LIDENT">c2</span></a> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_partition_map_first_maybe_id_635"><span class="LIDENT">partition_map_first_maybe_id</span></a> <a href="#local_src_636"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_f_637"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_639"><span class="LIDENT">len</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_638"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span id="local_either_642"><span class="LIDENT">either</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_partition_map_difference_621"><span class="LIDENT">partition_map_difference</span></a><span class="EOL">
</span>            <a href="#local_src_636"><span class="LIDENT">src</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_f_637"><span class="LIDENT">f</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_len_639"><span class="LIDENT">len</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_pos_638"><span class="LIDENT">pos</span></a><span class="EOL">
</span>            <span class="LABEL">~fst_pos:</span><a href="#local_pos_638"><span class="LIDENT">pos</span></a><span class="EOL">
</span>            <span class="LABEL">~snd_pos:</span><span class="INT">0</span><span class="EOL">
</span>            <a href="#local_either_642"><span class="LIDENT">either</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_partition_map_second_maybe_id_643"><span class="LIDENT">partition_map_second_maybe_id</span></span> <span id="local_src_644"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_f_645"><span class="LIDENT">f</span></span> <span class="TILDE">~</span><span id="local_pos_646"><span class="LIDENT">pos</span></span> <span class="TILDE">~</span><span id="local_len_647"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_pos_646"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_647"><span class="LIDENT">len</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span><span class="COMMA">,</span> <a href="#local_src_644"><span class="LIDENT">src</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_c1_648"><span class="LIDENT">c1</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_src_644"><span class="LIDENT">src</span></a> <a href="#local_pos_646"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span>  <span class="LPAREN">(</span><a href="#local_f_645"><span class="LIDENT">f</span></a> <a href="#local_c1_648"><span class="LIDENT">c1</span></a> <span class="COLON">:</span> <a href="either0.ml.html#type-t"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Either</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Second</span> <span id="local_c2_649"><span class="LIDENT">c2</span></span> <span class="WHEN">when</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c1_648"><span class="LIDENT">c1</span></a> <a href="#local_c2_649"><span class="LIDENT">c2</span></a> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_partition_map_second_maybe_id_643"><span class="LIDENT">partition_map_second_maybe_id</span></a> <a href="#local_src_644"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_f_645"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_647"><span class="LIDENT">len</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_646"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span id="local_either_650"><span class="LIDENT">either</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#local_partition_map_difference_621"><span class="LIDENT">partition_map_difference</span></a><span class="EOL">
</span>            <a href="#local_src_644"><span class="LIDENT">src</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_f_645"><span class="LIDENT">f</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_len_647"><span class="LIDENT">len</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_pos_646"><span class="LIDENT">pos</span></a><span class="EOL">
</span>            <span class="LABEL">~fst_pos:</span><span class="INT">0</span><span class="EOL">
</span>            <span class="LABEL">~snd_pos:</span><a href="#local_pos_646"><span class="LIDENT">pos</span></a><span class="EOL">
</span>            <a href="#local_either_650"><span class="LIDENT">either</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="SEMISEMI">;;</span><span class="EOL">
</span>  <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* partition functions *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_partition_map_651"><span class="LIDENT">partition_map</span></span> <span id="local_src_652"><span class="LIDENT">src</span></span> <span class="TILDE">~</span><span id="local_f_653"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_654"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_src_652"><span class="LIDENT">src</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_len_654"><span class="LIDENT">len</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span><span class="COMMA">,</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_c1_655"><span class="LIDENT">c1</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unsafe_get</span> <a href="#local_src_652"><span class="LIDENT">src</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="MATCH">match</span>  <span class="LPAREN">(</span><a href="#local_f_653"><span class="LIDENT">f</span></a> <a href="#local_c1_655"><span class="LIDENT">c1</span></a> <span class="COLON">:</span> <a href="either0.ml.html#type-t"><span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="UIDENT">Either</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">First</span> <span id="local_c2_656"><span class="LIDENT">c2</span></span> <span class="WHEN">when</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c1_655"><span class="LIDENT">c1</span></a> <a href="#local_c2_656"><span class="LIDENT">c2</span></a> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">partition_map_first_maybe_id</span> <a href="#local_src_652"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_f_653"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_654"><span class="LIDENT">len</span></a> <span class="LABEL">~pos:</span><span class="INT">1</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Second</span> <span id="local_c2_657"><span class="LIDENT">c2</span></span> <span class="WHEN">when</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c1_655"><span class="LIDENT">c1</span></a> <a href="#local_c2_657"><span class="LIDENT">c2</span></a> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LIDENT">partition_map_second_maybe_id</span> <a href="#local_src_652"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_f_653"><span class="LIDENT">f</span></a> <span class="TILDE">~</span><a href="#local_len_654"><span class="LIDENT">len</span></a> <span class="LABEL">~pos:</span><span class="INT">1</span><span class="EOL">
</span>      <span class="BAR">|</span> <span id="local_either_658"><span class="LIDENT">either</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LIDENT">partition_map_difference</span><span class="EOL">
</span>          <a href="#local_src_652"><span class="LIDENT">src</span></a><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_f_653"><span class="LIDENT">f</span></a><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_len_654"><span class="LIDENT">len</span></a><span class="EOL">
</span>          <span class="LABEL">~pos:</span><span class="INT">0</span><span class="EOL">
</span>          <span class="LABEL">~fst_pos:</span><span class="INT">0</span><span class="EOL">
</span>          <span class="LABEL">~snd_pos:</span><span class="INT">0</span><span class="EOL">
</span>          <a href="#local_either_658"><span class="LIDENT">either</span></a> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_partition_tf_659"><span class="LIDENT">partition_tf</span></span> <span id="local_t_660"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_f_661"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="#local_partition_map_651"><span class="LIDENT">partition_map</span></a> <a href="#local_t_660"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_662"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="#local_f_661"><span class="LIDENT">f</span></a> <a href="#local_c_662"><span class="LIDENT">c</span></a> <span class="THEN">then</span>  <span class="LPAREN">(</span><span class="UIDENT">First</span> <a href="#local_c_662"><span class="LIDENT">c</span></a><span class="RPAREN">)</span> <span class="ELSE">else</span>  <span class="LPAREN">(</span><span class="UIDENT">Second</span> <a href="#local_c_662"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="EOL">
</span>    <span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Escaping"><span class="MODULE">module</span> <span class="UIDENT">Escaping</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="COMMENT">(* If this is changed, make sure to update [escape], which attempts to ensure all the
     invariants checked here.  *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-build_and_validate_escapeworthy_map"><span class="LIDENT">build_and_validate_escapeworthy_map</span></span> <span id="local_escapeworthy_map_663"><span class="LIDENT">escapeworthy_map</span></span> <span id="local_escape_char_664"><span class="LIDENT">escape_char</span></span> <span id="local_func_665"><span class="LIDENT">func</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_escapeworthy_map_666"><span class="LIDENT">escapeworthy_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="list.ml.html#module-Assoc.val-mem"><span class="UIDENT">List</span><span class="DOT">.</span><span class="UIDENT">Assoc</span><span class="DOT">.</span><span class="LIDENT">mem</span></a> <a href="#local_escapeworthy_map_663"><span class="LIDENT">escapeworthy_map</span></a> <span class="LABEL">~equal:</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_escape_char_664"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <a href="#local_escapeworthy_map_663"><span class="LIDENT">escapeworthy_map</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><a href="#local_escape_char_664"><span class="LIDENT">escape_char</span></a><span class="COMMA">,</span> <a href="#local_escape_char_664"><span class="LIDENT">escape_char</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_escapeworthy_map_663"><span class="LIDENT">escapeworthy_map</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_arr_667"><span class="LIDENT">arr</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~len:</span><span class="INT">256</span> <span class="LPAREN">(</span><span class="MINUS">-</span><span class="INT">1</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_vals_668"><span class="LIDENT">vals</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Array</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LABEL">~len:</span><span class="INT">256</span> <span class="FALSE">false</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_669"><span class="LIDENT">loop</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_arr_667"><span class="LIDENT">arr</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="LPAREN">(</span><span id="local_c_from_670"><span class="LIDENT">c_from</span></span><span class="COMMA">,</span> <span id="local_c_to_671"><span class="LIDENT">c_to</span></span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <span id="local_l_672"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="def_871"><span id="local_k_673"><span class="LIDENT">k</span></span><span class="COMMA">,</span> <span id="local_v_674"><span class="LIDENT">v</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_func_665"><span class="LIDENT">func</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape</span> <span class="MINUSGREATER">-&gt;</span> <a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_c_from_670"><span class="LIDENT">c_from</span></a><span class="COMMA">,</span> <a href="#local_c_to_671"><span class="LIDENT">c_to</span></a><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Unescape</span> <span class="MINUSGREATER">-&gt;</span> <a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_c_to_671"><span class="LIDENT">c_to</span></a><span class="COMMA">,</span> <a href="#local_c_from_670"><span class="LIDENT">c_from</span></a><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_arr_667"><span class="LIDENT">arr</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_k_673"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;&gt;)"><span class="INFIXOP0">&lt;&gt;</span></a> <span class="MINUS">-</span><span class="INT">1</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_vals_668"><span class="LIDENT">vals</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_v_674"><span class="LIDENT">v</span></a><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="THEN">then</span><span class="EOL">
</span>          <a href="or_error.ml.html#val-error_s"><span class="UIDENT">Or_error</span><span class="DOT">.</span><span class="LIDENT">error_s</span></a><span class="EOL">
</span>            <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp.ml.html#val-message"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">message</span></a><span class="EOL">
</span>               <span class="STRING">&quot;escapeworthy_map not one-to-one&quot;</span><span class="EOL">
</span>               <span class="LBRACKET">[</span> <span class="STRING">&quot;c_from&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_c_from_670"><span class="LIDENT">c_from</span></a><span class="EOL">
</span>               <span class="SEMI">;</span> <span class="STRING">&quot;c_to&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_c_to_671"><span class="LIDENT">c_to</span></a><span class="EOL">
</span>               <span class="SEMI">;</span> <span class="LPAREN">(</span> <span class="STRING">&quot;escapeworthy_map&quot;</span><span class="EOL">
</span>                 <span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_list"><span class="LIDENT">sexp_of_list</span></a> <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_pair"><span class="LIDENT">sexp_of_pair</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a><span class="RPAREN">)</span> <a href="#local_escapeworthy_map_666"><span class="LIDENT">escapeworthy_map</span></a><span class="EOL">
</span>                 <span class="RPAREN">)</span><span class="EOL">
</span>               <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <a href="#local_arr_667"><span class="LIDENT">arr</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="#local_k_673"><span class="LIDENT">k</span></a><span class="RPAREN">)</span> <span class="LESSMINUS">&lt;-</span> <a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_v_674"><span class="LIDENT">v</span></a><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_vals_668"><span class="LIDENT">vals</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_v_674"><span class="LIDENT">v</span></a><span class="RPAREN">)</span> <span class="LESSMINUS">&lt;-</span> <span class="TRUE">true</span><span class="SEMI">;</span><span class="EOL">
</span>          <a href="#local_loop_669"><span class="LIDENT">loop</span></a> <a href="#local_l_672"><span class="LIDENT">l</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_loop_669"><span class="LIDENT">loop</span></a> <a href="#local_escapeworthy_map_666"><span class="LIDENT">escapeworthy_map</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-escape_gen"><span class="LIDENT">escape_gen</span></span> <span class="TILDE">~</span><span id="local_escapeworthy_map_675"><span class="LIDENT">escapeworthy_map</span></span> <span class="TILDE">~</span><span id="local_escape_char_676"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">build_and_validate_escapeworthy_map</span> <a href="#local_escapeworthy_map_675"><span class="LIDENT">escapeworthy_map</span></a> <a href="#local_escape_char_676"><span class="LIDENT">escape_char</span></a> <span class="BACKQUOTE">`</span><span class="UIDENT">Escape</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_x_677"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_677"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_escapeworthy_678"><span class="LIDENT">escapeworthy</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_src_679"><span class="LIDENT">src</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>           <span class="COMMENT">(* calculate a list of (index of char to escape * escaped char) first, the order
              is from tail to head *)</span><span class="EOL">
</span>           <span class="LET">let</span> <span id="local_to_escape_len_680"><span class="LIDENT">to_escape_len</span></span> <span class="EQUAL">=</span> <a href="import0.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="INT">0</span> <span class="IN">in</span><span class="EOL">
</span>           <span class="LET">let</span> <span id="local_to_escape_681"><span class="LIDENT">to_escape</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>             <span class="LIDENT">foldi</span> <a href="#local_src_679"><span class="LIDENT">src</span></a> <span class="LABEL">~init:</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_682"><span class="LIDENT">i</span></span> <span id="local_acc_683"><span class="LIDENT">acc</span></span> <span id="local_c_684"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>               <span class="MATCH">match</span> <a href="#local_escapeworthy_678"><span class="LIDENT">escapeworthy</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_c_684"><span class="LIDENT">c</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>               <span class="BAR">|</span> <span class="MINUS">-</span><span class="INT">1</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_683"><span class="LIDENT">acc</span></a><span class="EOL">
</span>               <span class="BAR">|</span> <span id="local_n_685"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <span class="COMMENT">(* (index of char to escape * escaped char) *)</span><span class="EOL">
</span>                 <a href="import0.ml.html#val-incr"><span class="LIDENT">incr</span></a> <a href="#local_to_escape_len_680"><span class="LIDENT">to_escape_len</span></a><span class="SEMI">;</span><span class="EOL">
</span>                 <span class="LPAREN">(</span><a href="#local_i_682"><span class="LIDENT">i</span></a><span class="COMMA">,</span> <a href="char0.ml.html#val-unsafe_of_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">unsafe_of_int</span></a> <a href="#local_n_685"><span class="LIDENT">n</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_acc_683"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>           <span class="IN">in</span><span class="EOL">
</span>           <span class="MATCH">match</span> <a href="#local_to_escape_681"><span class="LIDENT">to_escape</span></a> <span class="WITH">with</span><span class="EOL">
</span>           <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_src_679"><span class="LIDENT">src</span></a><span class="EOL">
</span>           <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>             <span class="COMMENT">(* [to_escape] divide [src] to [List.length to_escape + 1] pieces separated by
                the chars to escape.

                Lets take
                {[
                  escape_gen_exn
                    ~escapeworthy_map:[('a', 'A'); ('b', 'B'); ('c', 'C')]
                    ~escape_char:'_'
                ]}
                for example, and assume the string to escape is

                &quot;000a111b222c333&quot;

                then [to_escape] is [(11, 'C'); (7, 'B'); (3, 'A')].

                Then we create a [dst] of length [length src + 3] to store the
                result, copy piece &quot;333&quot; to [dst] directly, then copy '_' and 'C' to [dst];
                then move on to next; after 3 iterations, copy piece &quot;000&quot; and we are done.

                Finally the result will be

                &quot;000_A111_B222_C333&quot; *)</span><span class="EOL">
</span>             <span class="LET">let</span> <span id="local_src_len_686"><span class="LIDENT">src_len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_src_679"><span class="LIDENT">src</span></a> <span class="IN">in</span><span class="EOL">
</span>             <span class="LET">let</span> <span id="local_dst_len_687"><span class="LIDENT">dst_len</span></span> <span class="EQUAL">=</span> <a href="#local_src_len_686"><span class="LIDENT">src_len</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <a href="import0.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_to_escape_len_680"><span class="LIDENT">to_escape_len</span></a> <span class="IN">in</span><span class="EOL">
</span>             <span class="LET">let</span> <span id="local_dst_688"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <a href="#local_dst_len_687"><span class="LIDENT">dst_len</span></a> <span class="IN">in</span><span class="EOL">
</span>             <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_689"><span class="LIDENT">loop</span></span> <span id="local_last_idx_690"><span class="LIDENT">last_idx</span></span> <span id="local_last_dst_pos_691"><span class="LIDENT">last_dst_pos</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>               <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <span class="COMMENT">(* copy &quot;000&quot; at last *)</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="TILDE">~</span><a href="#local_src_679"><span class="LIDENT">src</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_dst_688"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_last_idx_690"><span class="LIDENT">last_idx</span></a><span class="EOL">
</span>               <span class="BAR">|</span> <span class="LPAREN">(</span><span id="local_idx_692"><span class="LIDENT">idx</span></span><span class="COMMA">,</span> <span id="local_escaped_char_693"><span class="LIDENT">escaped_char</span></span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <span id="local_to_escape_694"><span class="LIDENT">to_escape</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <span class="COMMENT">(*[idx] = the char to escape*)</span><span class="EOL">
</span>                 <span class="COMMENT">(* take first iteration for example *)</span><span class="EOL">
</span>                 <span class="COMMENT">(* calculate length of &quot;333&quot;, minus 1 because we don't copy 'c' *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_len_695"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="#local_last_idx_690"><span class="LIDENT">last_idx</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_idx_692"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>                 <span class="COMMENT">(* set the dst_pos to copy to *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_dst_pos_696"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span> <a href="#local_last_dst_pos_691"><span class="LIDENT">last_dst_pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_695"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>                 <span class="COMMENT">(* copy &quot;333&quot;, set [src_pos] to [idx + 1] to skip 'c' *)</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="TILDE">~</span><a href="#local_src_679"><span class="LIDENT">src</span></a> <span class="LABEL">~src_pos:</span><span class="LPAREN">(</span><a href="#local_idx_692"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_dst_688"><span class="LIDENT">dst</span></a> <span class="TILDE">~</span><a href="#local_dst_pos_696"><span class="LIDENT">dst_pos</span></a> <span class="TILDE">~</span><a href="#local_len_695"><span class="LIDENT">len</span></a><span class="SEMI">;</span><span class="EOL">
</span>                 <span class="COMMENT">(* backoff [dst_pos] by 2 to copy '_' and 'C' *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_dst_pos_697"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span> <a href="#local_dst_pos_696"><span class="LIDENT">dst_pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">2</span> <span class="IN">in</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_dst_688"><span class="LIDENT">dst</span></a> <a href="#local_dst_pos_697"><span class="LIDENT">dst_pos</span></a> <a href="#local_escape_char_676"><span class="LIDENT">escape_char</span></a><span class="SEMI">;</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span> <a href="#local_dst_688"><span class="LIDENT">dst</span></a> <span class="LPAREN">(</span><a href="#local_dst_pos_697"><span class="LIDENT">dst_pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_escaped_char_693"><span class="LIDENT">escaped_char</span></a><span class="SEMI">;</span><span class="EOL">
</span>                 <a href="#local_loop_689"><span class="LIDENT">loop</span></a> <a href="#local_idx_692"><span class="LIDENT">idx</span></a> <a href="#local_dst_pos_697"><span class="LIDENT">dst_pos</span></a> <a href="#local_to_escape_694"><span class="LIDENT">to_escape</span></a><span class="EOL">
</span>             <span class="IN">in</span><span class="EOL">
</span>             <span class="COMMENT">(* set [last_dst_pos] and [last_idx] to length of [dst] and [src] first *)</span><span class="EOL">
</span>             <a href="#local_loop_689"><span class="LIDENT">loop</span></a> <a href="#local_src_len_686"><span class="LIDENT">src_len</span></a> <a href="#local_dst_len_687"><span class="LIDENT">dst_len</span></a> <a href="#local_to_escape_681"><span class="LIDENT">to_escape</span></a><span class="SEMI">;</span><span class="EOL">
</span>             <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_dst_688"><span class="LIDENT">dst</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-escape_gen_exn"><span class="LIDENT">escape_gen_exn</span></span> <span class="TILDE">~</span><span id="local_escapeworthy_map_698"><span class="LIDENT">escapeworthy_map</span></span> <span class="TILDE">~</span><span id="local_escape_char_699"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="or_error.ml.html#val-ok_exn"><span class="UIDENT">Or_error</span><span class="DOT">.</span><span class="LIDENT">ok_exn</span></a> <span class="LPAREN">(</span><span class="LIDENT">escape_gen</span> <span class="TILDE">~</span><a href="#local_escapeworthy_map_698"><span class="LIDENT">escapeworthy_map</span></a> <span class="TILDE">~</span><a href="#local_escape_char_699"><span class="LIDENT">escape_char</span></a><span class="RPAREN">)</span> <span class="INFIXOP0">|&gt;</span> <span class="LIDENT">stage</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-escape"><span class="LIDENT">escape</span></span> <span class="TILDE">~</span><span id="local_escapeworthy_700"><span class="LIDENT">escapeworthy</span></span> <span class="TILDE">~</span><span id="local_escape_char_701"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* For [escape_gen_exn], we don't know how to fix invalid escapeworthy_map so we have
       to raise exception; but in this case, we know how to fix duplicated elements in
       escapeworthy list, so we just fix it instead of raising exception to make this
       function easier to use.  *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_escapeworthy_map_702"><span class="LIDENT">escapeworthy_map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <a href="#local_escapeworthy_700"><span class="LIDENT">escapeworthy</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="list.ml.html#val-dedup_and_sort"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">dedup_and_sort</span></a> <span class="LABEL">~compare:</span><a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-compare"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">compare</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="list.ml.html#module-Cartesian_product.val-map"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_c_703"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_c_703"><span class="LIDENT">c</span></a><span class="COMMA">,</span> <a href="#local_c_703"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LIDENT">escape_gen_exn</span> <span class="TILDE">~</span><a href="#local_escapeworthy_map_702"><span class="LIDENT">escapeworthy_map</span></a> <span class="TILDE">~</span><a href="#local_escape_char_701"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* In an escaped string, any char is either `Escaping, `Escaped or `Literal. For
     example, the escape statuses of chars in string &quot;a_a__&quot; with escape_char = '_' are

     a : `Literal
     _ : `Escaping
     a : `Escaped
     _ : `Escaping
     _ : `Escaped

     [update_escape_status str ~escape_char i previous_status] gets escape status of
     str.[i] basing on escape status of str.[i - 1] *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-{update_escape_status}6/shadowed/(base-src-base-string.ml)"><span class="LIDENT">update_escape_status</span></span> <span id="local_str_704"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_705"><span class="LIDENT">escape_char</span></span> <span id="local_i_706"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_str_704"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_706"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <a href="#local_escape_char_705"><span class="LIDENT">escape_char</span></a> <span class="THEN">then</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="ELSE">else</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-unescape_gen"><span class="LIDENT">unescape_gen</span></span> <span class="TILDE">~</span><span id="local_escapeworthy_map_707"><span class="LIDENT">escapeworthy_map</span></span> <span class="TILDE">~</span><span id="local_escape_char_708"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">build_and_validate_escapeworthy_map</span> <a href="#local_escapeworthy_map_707"><span class="LIDENT">escapeworthy_map</span></a> <a href="#local_escape_char_708"><span class="LIDENT">escape_char</span></a> <span class="BACKQUOTE">`</span><span class="UIDENT">Unescape</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_x_709"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_x_709"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_escapeworthy_710"><span class="LIDENT">escapeworthy</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_src_711"><span class="LIDENT">src</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>           <span class="COMMENT">(* Continue the example in [escape_gen_exn], now we unescape

              &quot;000_A111_B222_C333&quot;

              back to

              &quot;000a111b222c333&quot;

              Then [to_unescape] is [14; 9; 4], which is indexes of '_'s.

              Then we create a string [dst] to store the result, copy &quot;333&quot; to it, then copy
              'c', then move on to next iteration. After 3 iterations copy &quot;000&quot; and we are
              done.  *)</span><span class="EOL">
</span>           <span class="COMMENT">(* indexes of escape chars *)</span><span class="EOL">
</span>           <span class="LET">let</span> <span id="local_to_unescape_712"><span class="LIDENT">to_unescape</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>             <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_713"><span class="LIDENT">loop</span></span> <span id="local_i_714"><span class="LIDENT">i</span></span> <span id="local_status_715"><span class="LIDENT">status</span></span> <span id="local_acc_716"><span class="LIDENT">acc</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>               <span class="IF">if</span> <a href="#local_i_714"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="LIDENT">length</span> <a href="#local_src_711"><span class="LIDENT">src</span></a><span class="EOL">
</span>               <span class="THEN">then</span> <a href="#local_acc_716"><span class="LIDENT">acc</span></a><span class="EOL">
</span>               <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_status_717"><span class="LIDENT">status</span></span> <span class="EQUAL">=</span> <span class="LIDENT">update_escape_status</span> <a href="#local_src_711"><span class="LIDENT">src</span></a> <span class="TILDE">~</span><a href="#local_escape_char_708"><span class="LIDENT">escape_char</span></a> <a href="#local_i_714"><span class="LIDENT">i</span></a> <a href="#local_status_715"><span class="LIDENT">status</span></a> <span class="IN">in</span><span class="EOL">
</span>                 <a href="#local_loop_713"><span class="LIDENT">loop</span></a><span class="EOL">
</span>                   <span class="LPAREN">(</span><a href="#local_i_714"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>                   <a href="#local_status_717"><span class="LIDENT">status</span></a><span class="EOL">
</span>                   <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_status_717"><span class="LIDENT">status</span></a> <span class="WITH">with</span><span class="EOL">
</span>                    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_i_714"><span class="LIDENT">i</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_716"><span class="LIDENT">acc</span></a><span class="EOL">
</span>                    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_acc_716"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>             <span class="IN">in</span><span class="EOL">
</span>             <a href="#local_loop_713"><span class="LIDENT">loop</span></a> <span class="INT">0</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>           <span class="IN">in</span><span class="EOL">
</span>           <span class="MATCH">match</span> <a href="#local_to_unescape_712"><span class="LIDENT">to_unescape</span></a> <span class="WITH">with</span><span class="EOL">
</span>           <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_src_711"><span class="LIDENT">src</span></a><span class="EOL">
</span>           <span class="BAR">|</span> <span id="local_idx_718"><span class="LIDENT">idx</span></span> <span class="COLONCOLON">::</span> <span id="local_to_unescape'_719"><span class="LIDENT">to_unescape'</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>             <span class="LET">let</span> <span id="local_dst_720"><span class="LIDENT">dst</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_src_711"><span class="LIDENT">src</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="list0.ml.html#val-length"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">length</span></a> <a href="#local_to_unescape_712"><span class="LIDENT">to_unescape</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>             <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_721"><span class="LIDENT">loop</span></span> <span id="local_last_idx_722"><span class="LIDENT">last_idx</span></span> <span id="local_last_dst_pos_723"><span class="LIDENT">last_dst_pos</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>               <span class="BAR">|</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <span class="COMMENT">(* copy &quot;000&quot; at last *)</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="TILDE">~</span><a href="#local_src_711"><span class="LIDENT">src</span></a> <span class="LABEL">~src_pos:</span><span class="INT">0</span> <span class="TILDE">~</span><a href="#local_dst_720"><span class="LIDENT">dst</span></a> <span class="LABEL">~dst_pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_last_idx_722"><span class="LIDENT">last_idx</span></a><span class="EOL">
</span>               <span class="BAR">|</span> <span id="local_idx_724"><span class="LIDENT">idx</span></span> <span class="COLONCOLON">::</span> <span id="local_to_unescape_725"><span class="LIDENT">to_unescape</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                 <span class="COMMENT">(* [idx] = index of escaping char *)</span><span class="EOL">
</span>                 <span class="COMMENT">(* take 1st iteration as example, calculate the length of &quot;333&quot;, minus 2 to
                    skip '_C' *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_len_726"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <a href="#local_last_idx_722"><span class="LIDENT">last_idx</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_idx_724"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">2</span> <span class="IN">in</span><span class="EOL">
</span>                 <span class="COMMENT">(* point [dst_pos] to the position to copy &quot;333&quot; to *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_dst_pos_727"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span> <a href="#local_last_dst_pos_723"><span class="LIDENT">last_dst_pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_len_726"><span class="LIDENT">len</span></a> <span class="IN">in</span><span class="EOL">
</span>                 <span class="COMMENT">(* copy &quot;333&quot; *)</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">blit_string</span> <span class="TILDE">~</span><a href="#local_src_711"><span class="LIDENT">src</span></a> <span class="LABEL">~src_pos:</span><span class="LPAREN">(</span><a href="#local_idx_724"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">2</span><span class="RPAREN">)</span> <span class="TILDE">~</span><a href="#local_dst_720"><span class="LIDENT">dst</span></a> <span class="TILDE">~</span><a href="#local_dst_pos_727"><span class="LIDENT">dst_pos</span></a> <span class="TILDE">~</span><a href="#local_len_726"><span class="LIDENT">len</span></a><span class="SEMI">;</span><span class="EOL">
</span>                 <span class="COMMENT">(* backoff [dst_pos] by 1 to copy 'c' *)</span><span class="EOL">
</span>                 <span class="LET">let</span> <span id="local_dst_pos_728"><span class="LIDENT">dst_pos</span></span> <span class="EQUAL">=</span> <a href="#local_dst_pos_727"><span class="LIDENT">dst_pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>                 <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">set</span><span class="EOL">
</span>                   <a href="#local_dst_720"><span class="LIDENT">dst</span></a><span class="EOL">
</span>                   <a href="#local_dst_pos_728"><span class="LIDENT">dst_pos</span></a><span class="EOL">
</span>                   <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_escapeworthy_710"><span class="LIDENT">escapeworthy</span></a><span class="DOT">.</span><span class="LPAREN">(</span><a href="char0.ml.html#val-to_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">to_int</span></a> <a href="#local_src_711"><span class="LIDENT">src</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_idx_724"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>                    <span class="BAR">|</span> <span class="MINUS">-</span><span class="INT">1</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_src_711"><span class="LIDENT">src</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_idx_724"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RBRACKET">]</span><span class="EOL">
</span>                    <span class="BAR">|</span> <span id="local_n_729"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="char0.ml.html#val-unsafe_of_int"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">unsafe_of_int</span></a> <a href="#local_n_729"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>                 <span class="COMMENT">(* update [last_dst_pos] and [last_idx] *)</span><span class="EOL">
</span>                 <a href="#local_loop_721"><span class="LIDENT">loop</span></a> <a href="#local_idx_724"><span class="LIDENT">idx</span></a> <a href="#local_dst_pos_728"><span class="LIDENT">dst_pos</span></a> <a href="#local_to_unescape_725"><span class="LIDENT">to_unescape</span></a><span class="EOL">
</span>             <span class="IN">in</span><span class="EOL">
</span>             <span class="IF">if</span> <a href="#local_idx_718"><span class="LIDENT">idx</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="LIDENT">length</span> <a href="#local_src_711"><span class="LIDENT">src</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="EOL">
</span>             <span class="THEN">then</span><span class="EOL">
</span>               <span class="COMMENT">(* set [last_dst_pos] and [last_idx] to length of [dst] and [src] *)</span><span class="EOL">
</span>               <a href="#local_loop_721"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_src_711"><span class="LIDENT">src</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_dst_720"><span class="LIDENT">dst</span></a><span class="RPAREN">)</span> <a href="#local_to_unescape_712"><span class="LIDENT">to_unescape</span></a><span class="EOL">
</span>             <span class="ELSE">else</span><span class="EOL">
</span>               <span class="COMMENT">(* for escaped string ending with an escaping char like &quot;000_&quot;, just ignore
                  the last escaping char *)</span><span class="EOL">
</span>               <a href="#local_loop_721"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_src_711"><span class="LIDENT">src</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_dst_720"><span class="LIDENT">dst</span></a><span class="RPAREN">)</span> <a href="#local_to_unescape'_719"><span class="LIDENT">to_unescape'</span></a><span class="SEMI">;</span><span class="EOL">
</span>             <span class="UIDENT">Bytes</span><span class="DOT">.</span><span class="LIDENT">unsafe_to_string</span> <span class="LABEL">~no_mutation_while_string_reachable:</span><a href="#local_dst_720"><span class="LIDENT">dst</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-unescape_gen_exn"><span class="LIDENT">unescape_gen_exn</span></span> <span class="TILDE">~</span><span id="local_escapeworthy_map_730"><span class="LIDENT">escapeworthy_map</span></span> <span class="TILDE">~</span><span id="local_escape_char_731"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="or_error.ml.html#val-ok_exn"><span class="UIDENT">Or_error</span><span class="DOT">.</span><span class="LIDENT">ok_exn</span></a> <span class="LPAREN">(</span><span class="LIDENT">unescape_gen</span> <span class="TILDE">~</span><a href="#local_escapeworthy_map_730"><span class="LIDENT">escapeworthy_map</span></a> <span class="TILDE">~</span><a href="#local_escape_char_731"><span class="LIDENT">escape_char</span></a><span class="RPAREN">)</span> <span class="INFIXOP0">|&gt;</span> <span class="LIDENT">stage</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-unescape"><span class="LIDENT">unescape</span></span> <span class="TILDE">~</span><span id="local_escape_char_732"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">unescape_gen_exn</span> <span class="LABEL">~escapeworthy_map:</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="TILDE">~</span><a href="#local_escape_char_732"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-preceding_escape_chars"><span class="LIDENT">preceding_escape_chars</span></span> <span id="local_str_733"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_734"><span class="LIDENT">escape_char</span></span> <span id="local_pos_735"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_736"><span class="LIDENT">loop</span></span> <span id="local_p_737"><span class="LIDENT">p</span></span> <span id="local_cnt_738"><span class="LIDENT">cnt</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_p_737"><span class="LIDENT">p</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-(&lt;&gt;)"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LPAREN">(</span> <span class="INFIXOP0">&lt;&gt;</span> <span class="RPAREN">)</span></a> <a href="#local_str_733"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_p_737"><span class="LIDENT">p</span></a><span class="RBRACKET">]</span> <a href="#local_escape_char_734"><span class="LIDENT">escape_char</span></a> <span class="THEN">then</span> <a href="#local_cnt_738"><span class="LIDENT">cnt</span></a> <span class="ELSE">else</span> <a href="#local_loop_736"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_p_737"><span class="LIDENT">p</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_cnt_738"><span class="LIDENT">cnt</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_loop_736"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_pos_735"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="INT">0</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* In an escaped string, any char is either `Escaping, `Escaped or `Literal. For
     example, the escape statuses of chars in string &quot;a_a__&quot; with escape_char = '_' are

     a : `Literal
     _ : `Escaping
     a : `Escaped
     _ : `Escaping
     _ : `Escaped

     [update_escape_status str ~escape_char i previous_status] gets escape status of
     str.[i] basing on escape status of str.[i - 1] *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-update_escape_status"><span class="LIDENT">update_escape_status</span></span> <span id="local_str_739"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_740"><span class="LIDENT">escape_char</span></span> <span id="local_i_741"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_str_739"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_741"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <a href="#local_escape_char_740"><span class="LIDENT">escape_char</span></a> <span class="THEN">then</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="ELSE">else</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-escape_status"><span class="LIDENT">escape_status</span></span> <span id="local_str_742"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_743"><span class="LIDENT">escape_char</span></span> <span id="local_pos_744"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_odd_745"><span class="LIDENT">odd</span></span> <span class="EQUAL">=</span> <span class="LIDENT">preceding_escape_chars</span> <a href="#local_str_742"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_743"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_744"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(mod)"><span class="INFIXOP3">mod</span></a> <span class="INT">2</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_odd_745"><span class="LIDENT">odd</span></a><span class="COMMA">,</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_str_742"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_pos_744"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span> <a href="#local_escape_char_743"><span class="LIDENT">escape_char</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="TRUE">true</span><span class="COMMA">,</span> <span class="LPAREN">(</span><span class="TRUE">true</span> <span class="BAR">|</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="FALSE">false</span><span class="COMMA">,</span> <span class="TRUE">true</span> <span class="MINUSGREATER">-&gt;</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="FALSE">false</span><span class="COMMA">,</span> <span class="FALSE">false</span> <span class="MINUSGREATER">-&gt;</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-check_bound"><span class="LIDENT">check_bound</span></span> <span id="local_str_746"><span class="LIDENT">str</span></span> <span id="local_pos_747"><span class="LIDENT">pos</span></span> <span id="local_function_name_748"><span class="LIDENT">function_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_pos_747"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="LIDENT">length</span> <a href="#local_str_746"><span class="LIDENT">str</span></a> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_pos_747"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span> <span class="THEN">then</span> <span class="LIDENT">invalid_argf</span> <span class="STRING">&quot;%s: out of bounds&quot;</span> <a href="#local_function_name_748"><span class="LIDENT">function_name</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-is_char_escaping"><span class="LIDENT">is_char_escaping</span></span> <span id="local_str_749"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_750"><span class="LIDENT">escape_char</span></span> <span id="local_pos_751"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">check_bound</span> <a href="#local_str_749"><span class="LIDENT">str</span></a> <a href="#local_pos_751"><span class="LIDENT">pos</span></a> <span class="STRING">&quot;is_char_escaping&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">escape_status</span> <a href="#local_str_749"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_750"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_751"><span class="LIDENT">pos</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-is_char_escaped"><span class="LIDENT">is_char_escaped</span></span> <span id="local_str_752"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_753"><span class="LIDENT">escape_char</span></span> <span id="local_pos_754"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">check_bound</span> <a href="#local_str_752"><span class="LIDENT">str</span></a> <a href="#local_pos_754"><span class="LIDENT">pos</span></a> <span class="STRING">&quot;is_char_escaped&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">escape_status</span> <a href="#local_str_752"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_753"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_754"><span class="LIDENT">pos</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-is_char_literal"><span class="LIDENT">is_char_literal</span></span> <span id="local_str_755"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_756"><span class="LIDENT">escape_char</span></span> <span id="local_pos_757"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">check_bound</span> <a href="#local_str_755"><span class="LIDENT">str</span></a> <a href="#local_pos_757"><span class="LIDENT">pos</span></a> <span class="STRING">&quot;is_char_literal&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">escape_status</span> <a href="#local_str_755"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_756"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_757"><span class="LIDENT">pos</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-index_from"><span class="LIDENT">index_from</span></span> <span id="local_str_758"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_759"><span class="LIDENT">escape_char</span></span> <span id="local_pos_760"><span class="LIDENT">pos</span></span> <span id="local_char_761"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">check_bound</span> <a href="#local_str_758"><span class="LIDENT">str</span></a> <a href="#local_pos_760"><span class="LIDENT">pos</span></a> <span class="STRING">&quot;index_from&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_762"><span class="LIDENT">loop</span></span> <span id="local_i_763"><span class="LIDENT">i</span></span> <span id="local_status_764"><span class="LIDENT">status</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_i_763"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <a href="#local_pos_760"><span class="LIDENT">pos</span></a><span class="EOL">
</span>      <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_status_764"><span class="LIDENT">status</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_str_758"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_i_763"><span class="LIDENT">i</span></a><span class="RBRACKET">]</span> <a href="#local_char_761"><span class="LIDENT">char</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_i_763"><span class="LIDENT">i</span></a><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_i_765"><span class="LIDENT">i</span></span> <span class="EQUAL">=</span> <a href="#local_i_763"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_i_765"><span class="LIDENT">i</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&gt;=)"><span class="INFIXOP0">&gt;=</span></a> <span class="LIDENT">length</span> <a href="#local_str_758"><span class="LIDENT">str</span></a><span class="EOL">
</span>        <span class="THEN">then</span> <span class="UIDENT">None</span><span class="EOL">
</span>        <span class="ELSE">else</span> <a href="#local_loop_762"><span class="LIDENT">loop</span></a> <a href="#local_i_765"><span class="LIDENT">i</span></a> <span class="LPAREN">(</span><span class="LIDENT">update_escape_status</span> <a href="#local_str_758"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_759"><span class="LIDENT">escape_char</span></a> <a href="#local_i_765"><span class="LIDENT">i</span></a> <a href="#local_status_764"><span class="LIDENT">status</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_loop_762"><span class="LIDENT">loop</span></a> <a href="#local_pos_760"><span class="LIDENT">pos</span></a> <span class="LPAREN">(</span><span class="LIDENT">escape_status</span> <a href="#local_str_758"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_759"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_760"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-index_from_exn"><span class="LIDENT">index_from_exn</span></span> <span id="local_str_766"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_767"><span class="LIDENT">escape_char</span></span> <span id="local_pos_768"><span class="LIDENT">pos</span></span> <span id="local_char_769"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">index_from</span> <a href="#local_str_766"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_767"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_768"><span class="LIDENT">pos</span></a> <a href="#local_char_769"><span class="LIDENT">char</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">raise_s</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp.ml.html#val-message"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">message</span></a><span class="EOL">
</span>           <span class="STRING">&quot;index_from_exn: not found&quot;</span><span class="EOL">
</span>           <span class="LBRACKET">[</span> <span class="STRING">&quot;str&quot;</span><span class="COMMA">,</span> <span class="LIDENT">sexp_of_t</span> <a href="#local_str_766"><span class="LIDENT">str</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;escape_char&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_escape_char_767"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;pos&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_int"><span class="LIDENT">sexp_of_int</span></a> <a href="#local_pos_768"><span class="LIDENT">pos</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;char&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_char_769"><span class="LIDENT">char</span></a><span class="EOL">
</span>           <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_pos_770"><span class="LIDENT">pos</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pos_770"><span class="LIDENT">pos</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-index"><span class="LIDENT">index</span></span> <span id="local_str_771"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_772"><span class="LIDENT">escape_char</span></span> <span id="local_char_773"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_from</span> <a href="#local_str_771"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_772"><span class="LIDENT">escape_char</span></a> <span class="INT">0</span> <a href="#local_char_773"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-index_exn"><span class="LIDENT">index_exn</span></span> <span id="local_str_774"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_775"><span class="LIDENT">escape_char</span></span> <span id="local_char_776"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">index_from_exn</span> <a href="#local_str_774"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_775"><span class="LIDENT">escape_char</span></a> <span class="INT">0</span> <a href="#local_char_776"><span class="LIDENT">char</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rindex_from"><span class="LIDENT">rindex_from</span></span> <span id="local_str_777"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_778"><span class="LIDENT">escape_char</span></span> <span id="local_pos_779"><span class="LIDENT">pos</span></span> <span id="local_char_780"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">check_bound</span> <a href="#local_str_777"><span class="LIDENT">str</span></a> <a href="#local_pos_779"><span class="LIDENT">pos</span></a> <span class="STRING">&quot;rindex_from&quot;</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* if the target char is the same as [escape_char], we have no way to determine which
       escape_char is literal, so just return None *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_char_780"><span class="LIDENT">char</span></a> <a href="#local_escape_char_778"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span>    <span class="THEN">then</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_781"><span class="LIDENT">loop</span></span> <span id="local_pos_782"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="IF">if</span> <a href="#local_pos_782"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#module-Int_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <span class="INT">0</span><span class="EOL">
</span>        <span class="THEN">then</span> <span class="UIDENT">None</span><span class="EOL">
</span>        <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_escape_chars_783"><span class="LIDENT">escape_chars</span></span> <span class="EQUAL">=</span> <span class="LIDENT">preceding_escape_chars</span> <a href="#local_str_777"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_778"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_782"><span class="LIDENT">pos</span></a> <span class="IN">in</span><span class="EOL">
</span>          <span class="IF">if</span> <a href="#local_escape_chars_783"><span class="LIDENT">escape_chars</span></a> <a href="import0.ml.html#val-(mod)"><span class="INFIXOP3">mod</span></a> <span class="INT">2</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_str_777"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_pos_782"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span> <a href="#local_char_780"><span class="LIDENT">char</span></a><span class="EOL">
</span>          <span class="THEN">then</span> <span class="UIDENT">Some</span> <a href="#local_pos_782"><span class="LIDENT">pos</span></a><span class="EOL">
</span>          <span class="ELSE">else</span> <a href="#local_loop_781"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_pos_782"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_escape_chars_783"><span class="LIDENT">escape_chars</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <a href="#local_loop_781"><span class="LIDENT">loop</span></a> <a href="#local_pos_779"><span class="LIDENT">pos</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rindex_from_exn"><span class="LIDENT">rindex_from_exn</span></span> <span id="local_str_784"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_785"><span class="LIDENT">escape_char</span></span> <span id="local_pos_786"><span class="LIDENT">pos</span></span> <span id="local_char_787"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">rindex_from</span> <a href="#local_str_784"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_785"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_786"><span class="LIDENT">pos</span></a> <a href="#local_char_787"><span class="LIDENT">char</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">raise_s</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp.ml.html#val-message"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">message</span></a><span class="EOL">
</span>           <span class="STRING">&quot;rindex_from_exn: not found&quot;</span><span class="EOL">
</span>           <span class="LBRACKET">[</span> <span class="STRING">&quot;str&quot;</span><span class="COMMA">,</span> <span class="LIDENT">sexp_of_t</span> <a href="#local_str_784"><span class="LIDENT">str</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;escape_char&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_escape_char_785"><span class="LIDENT">escape_char</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;pos&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_int"><span class="LIDENT">sexp_of_int</span></a> <a href="#local_pos_786"><span class="LIDENT">pos</span></a><span class="EOL">
</span>           <span class="SEMI">;</span> <span class="STRING">&quot;char&quot;</span><span class="COMMA">,</span> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-sexp_of_char"><span class="LIDENT">sexp_of_char</span></a> <a href="#local_char_787"><span class="LIDENT">char</span></a><span class="EOL">
</span>           <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_pos_788"><span class="LIDENT">pos</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_pos_788"><span class="LIDENT">pos</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rindex"><span class="LIDENT">rindex</span></span> <span id="local_str_789"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_790"><span class="LIDENT">escape_char</span></span> <span id="local_char_791"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="LIDENT">is_empty</span> <a href="#local_str_789"><span class="LIDENT">str</span></a> <span class="THEN">then</span> <span class="UIDENT">None</span> <span class="ELSE">else</span> <span class="LIDENT">rindex_from</span> <a href="#local_str_789"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_790"><span class="LIDENT">escape_char</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_str_789"><span class="LIDENT">str</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_char_791"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rindex_exn"><span class="LIDENT">rindex_exn</span></span> <span id="local_str_792"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_793"><span class="LIDENT">escape_char</span></span> <span id="local_char_794"><span class="LIDENT">char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">rindex_from_exn</span> <a href="#local_str_792"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_793"><span class="LIDENT">escape_char</span></a> <span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_str_792"><span class="LIDENT">str</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <a href="#local_char_794"><span class="LIDENT">char</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* [split_gen str ~escape_char ~on] works similarly to [String.split_gen], with an
     additional requirement: only split on literal chars, not escaping or escaped *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-split_gen"><span class="LIDENT">split_gen</span></span> <span id="local_str_795"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_escape_char_796"><span class="LIDENT">escape_char</span></span> <span class="TILDE">~</span><span id="local_on_797"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_is_delim_798"><span class="LIDENT">is_delim</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_on_797"><span class="LIDENT">on</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">char</span> <span id="local_c'_799"><span class="LIDENT">c'</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUN">fun</span> <span id="local_c_800"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="import0.ml.html#module-Char_replace_polymorphic_compare.val-equal"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">equal</span></a> <a href="#local_c_800"><span class="LIDENT">c</span></a> <a href="#local_c'_799"><span class="LIDENT">c'</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="LIDENT">char_list</span> <span id="local_l_801"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="FUN">fun</span> <span id="local_c_802"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">char_list_mem</span> <a href="#local_l_801"><span class="LIDENT">l</span></a> <a href="#local_c_802"><span class="LIDENT">c</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_803"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_str_795"><span class="LIDENT">str</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="REC">rec</span> <span id="local_loop_804"><span class="LIDENT">loop</span></span> <span id="local_acc_805"><span class="LIDENT">acc</span></span> <span id="local_status_806"><span class="LIDENT">status</span></span> <span id="local_last_pos_807"><span class="LIDENT">last_pos</span></span> <span id="local_pos_808"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_len_803"><span class="LIDENT">len</span></a><span class="EOL">
</span>      <span class="THEN">then</span> <a href="list0.ml.html#val-rev"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">rev</span></a> <span class="LPAREN">(</span><span class="LIDENT">sub</span> <a href="#local_str_795"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><a href="#local_last_pos_807"><span class="LIDENT">last_pos</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_803"><span class="LIDENT">len</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_last_pos_807"><span class="LIDENT">last_pos</span></a><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_acc_805"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_status_809"><span class="LIDENT">status</span></span> <span class="EQUAL">=</span> <span class="LIDENT">update_escape_status</span> <a href="#local_str_795"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_796"><span class="LIDENT">escape_char</span></a> <a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="#local_status_806"><span class="LIDENT">status</span></a> <span class="IN">in</span><span class="EOL">
</span>        <span class="IF">if</span> <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_status_809"><span class="LIDENT">status</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaped</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Escaping</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_is_delim_798"><span class="LIDENT">is_delim</span></a> <a href="#local_str_795"><span class="LIDENT">str</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_pos_808"><span class="LIDENT">pos</span></a><span class="RBRACKET">]</span><span class="EOL">
</span>        <span class="THEN">then</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="LET">let</span> <span id="local_sub_str_810"><span class="LIDENT">sub_str</span></span> <span class="EQUAL">=</span> <span class="LIDENT">sub</span> <a href="#local_str_795"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><a href="#local_last_pos_807"><span class="LIDENT">last_pos</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_last_pos_807"><span class="LIDENT">last_pos</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>          <a href="#local_loop_804"><span class="LIDENT">loop</span></a> <span class="LPAREN">(</span><a href="#local_sub_str_810"><span class="LIDENT">sub_str</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_805"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span> <a href="#local_status_809"><span class="LIDENT">status</span></a> <span class="LPAREN">(</span><a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="ELSE">else</span> <a href="#local_loop_804"><span class="LIDENT">loop</span></a> <a href="#local_acc_805"><span class="LIDENT">acc</span></a> <a href="#local_status_809"><span class="LIDENT">status</span></a> <a href="#local_last_pos_807"><span class="LIDENT">last_pos</span></a> <span class="LPAREN">(</span><a href="#local_pos_808"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_loop_804"><span class="LIDENT">loop</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Literal</span> <span class="INT">0</span> <span class="INT">0</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-split"><span class="LIDENT">split</span></span> <span id="local_str_811"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_812"><span class="LIDENT">on</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_gen</span> <a href="#local_str_811"><span class="LIDENT">str</span></a> <span class="LABEL">~on:</span><span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="LIDENT">char</span> <a href="#local_on_812"><span class="LIDENT">on</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-split_on_chars"><span class="LIDENT">split_on_chars</span></span> <span id="local_str_813"><span class="LIDENT">str</span></span> <span class="LABEL">~on:</span><span id="local_chars_814"><span class="LIDENT">chars</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_gen</span> <a href="#local_str_813"><span class="LIDENT">str</span></a> <span class="LABEL">~on:</span><span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="LIDENT">char_list</span> <a href="#local_chars_814"><span class="LIDENT">chars</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-split_at"><span class="LIDENT">split_at</span></span> <span id="local_str_815"><span class="LIDENT">str</span></span> <span id="local_pos_816"><span class="LIDENT">pos</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">sub</span> <a href="#local_str_815"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><span class="INT">0</span> <span class="LABEL">~len:</span><a href="#local_pos_816"><span class="LIDENT">pos</span></a><span class="COMMA">,</span> <span class="LIDENT">sub</span> <a href="#local_str_815"><span class="LIDENT">str</span></a> <span class="LABEL">~pos:</span><span class="LPAREN">(</span><a href="#local_pos_816"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><span class="LIDENT">length</span> <a href="#local_str_815"><span class="LIDENT">str</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_pos_816"><span class="LIDENT">pos</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-lsplit2"><span class="LIDENT">lsplit2</span></span> <span id="local_str_817"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_818"><span class="LIDENT">on</span></span> <span class="TILDE">~</span><span id="local_escape_char_819"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="applicative.ml.html#module-Make3_using_map2_local.val-map"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="LIDENT">index</span> <a href="#local_str_817"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_819"><span class="LIDENT">escape_char</span></a> <a href="#local_on_818"><span class="LIDENT">on</span></a><span class="RPAREN">)</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_820"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">split_at</span> <a href="#local_str_817"><span class="LIDENT">str</span></a> <a href="#local_x_820"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rsplit2"><span class="LIDENT">rsplit2</span></span> <span id="local_str_821"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_822"><span class="LIDENT">on</span></span> <span class="TILDE">~</span><span id="local_escape_char_823"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <a href="applicative.ml.html#module-Make3_using_map2_local.val-map"><span class="UIDENT">Option</span><span class="DOT">.</span><span class="LIDENT">map</span></a> <span class="LPAREN">(</span><span class="LIDENT">rindex</span> <a href="#local_str_821"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_823"><span class="LIDENT">escape_char</span></a> <a href="#local_on_822"><span class="LIDENT">on</span></a><span class="RPAREN">)</span> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_x_824"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">split_at</span> <a href="#local_str_821"><span class="LIDENT">str</span></a> <a href="#local_x_824"><span class="LIDENT">x</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-lsplit2_exn"><span class="LIDENT">lsplit2_exn</span></span> <span id="local_str_825"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_826"><span class="LIDENT">on</span></span> <span class="TILDE">~</span><span id="local_escape_char_827"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_at</span> <a href="#local_str_825"><span class="LIDENT">str</span></a> <span class="LPAREN">(</span><span class="LIDENT">index_exn</span> <a href="#local_str_825"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_827"><span class="LIDENT">escape_char</span></a> <a href="#local_on_826"><span class="LIDENT">on</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rsplit2_exn"><span class="LIDENT">rsplit2_exn</span></span> <span id="local_str_828"><span class="LIDENT">str</span></span> <span class="TILDE">~</span><span id="local_on_829"><span class="LIDENT">on</span></span> <span class="TILDE">~</span><span id="local_escape_char_830"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span> <span class="LIDENT">split_at</span> <a href="#local_str_828"><span class="LIDENT">str</span></a> <span class="LPAREN">(</span><span class="LIDENT">rindex_exn</span> <a href="#local_str_828"><span class="LIDENT">str</span></a> <span class="TILDE">~</span><a href="#local_escape_char_830"><span class="LIDENT">escape_char</span></a> <a href="#local_on_829"><span class="LIDENT">on</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* [last_non_drop_literal] and [first_non_drop_literal] are either both [None] or both
     [Some]. If [Some], then the former is &gt;= the latter. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-last_non_drop_literal"><span class="LIDENT">last_non_drop_literal</span></span> <span class="TILDE">~</span><span id="local_drop_831"><span class="LIDENT">drop</span></span> <span class="TILDE">~</span><span id="local_escape_char_832"><span class="LIDENT">escape_char</span></span> <span id="local_t_833"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">rfindi</span> <a href="#local_t_833"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_834"><span class="LIDENT">i</span></span> <span id="local_c_835"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_831"><span class="LIDENT">drop</span></a> <a href="#local_c_835"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">is_char_escaping</span> <a href="#local_t_833"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_escape_char_832"><span class="LIDENT">escape_char</span></a> <a href="#local_i_834"><span class="LIDENT">i</span></a><span class="EOL">
</span>      <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">is_char_escaped</span> <a href="#local_t_833"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_escape_char_832"><span class="LIDENT">escape_char</span></a> <a href="#local_i_834"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-first_non_drop_literal"><span class="LIDENT">first_non_drop_literal</span></span> <span class="TILDE">~</span><span id="local_drop_836"><span class="LIDENT">drop</span></span> <span class="TILDE">~</span><span id="local_escape_char_837"><span class="LIDENT">escape_char</span></span> <span id="local_t_838"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LIDENT">lfindi</span> <a href="#local_t_838"><span class="LIDENT">t</span></a> <span class="LABEL">~f:</span><span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_i_839"><span class="LIDENT">i</span></span> <span id="local_c_840"><span class="LIDENT">c</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_836"><span class="LIDENT">drop</span></a> <a href="#local_c_840"><span class="LIDENT">c</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">is_char_escaping</span> <a href="#local_t_838"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_escape_char_837"><span class="LIDENT">escape_char</span></a> <a href="#local_i_839"><span class="LIDENT">i</span></a><span class="EOL">
</span>      <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <span class="LIDENT">is_char_escaped</span> <a href="#local_t_838"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_escape_char_837"><span class="LIDENT">escape_char</span></a> <a href="#local_i_839"><span class="LIDENT">i</span></a><span class="RPAREN">)</span> <span class="LBRACKETAT">[@</span><span class="LIDENT">nontail</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-rstrip_literal"><span class="LIDENT">rstrip_literal</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_841"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_842"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_escape_char_843"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">last_non_drop_literal</span> <a href="#local_t_842"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_841"><span class="LIDENT">drop</span></a> <span class="TILDE">~</span><a href="#local_escape_char_843"><span class="LIDENT">escape_char</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_i_844"><span class="LIDENT">i</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="#local_i_844"><span class="LIDENT">i</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="LIDENT">length</span> <a href="#local_t_842"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span> <span class="THEN">then</span> <a href="#local_t_842"><span class="LIDENT">t</span></a> <span class="ELSE">else</span> <span class="LIDENT">prefix</span> <a href="#local_t_842"><span class="LIDENT">t</span></a> <span class="LPAREN">(</span><a href="#local_i_844"><span class="LIDENT">i</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-lstrip_literal"><span class="LIDENT">lstrip_literal</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_845"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_846"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_escape_char_847"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="LIDENT">first_non_drop_literal</span> <a href="#local_t_846"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_845"><span class="LIDENT">drop</span></a> <span class="TILDE">~</span><a href="#local_escape_char_847"><span class="LIDENT">escape_char</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="INT">0</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_t_846"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_n_848"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">drop_prefix</span> <a href="#local_t_846"><span class="LIDENT">t</span></a> <a href="#local_n_848"><span class="LIDENT">n</span></a><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="COMMENT">(* [strip t] could be implemented as [lstrip (rstrip t)].  The implementation
     below saves (at least) a factor of two allocation, by only allocating the
     final result.  This also saves some amount of time. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Escaping.val-strip_literal"><span class="LIDENT">strip_literal</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_drop_849"><span class="LIDENT">drop</span></span> <span class="EQUAL">=</span> <a href="char.ml.html#val-is_whitespace"><span class="UIDENT">Char</span><span class="DOT">.</span><span class="LIDENT">is_whitespace</span></a><span class="RPAREN">)</span> <span id="local_t_850"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_escape_char_851"><span class="LIDENT">escape_char</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_length_852"><span class="LIDENT">length</span></span> <span class="EQUAL">=</span> <span class="LIDENT">length</span> <a href="#local_t_850"><span class="LIDENT">t</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* performance hack: avoid copying [t] in common cases *)</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_length_852"><span class="LIDENT">length</span></a> <a href="../../../sexplib0/src/sexplib0/sexp_conv.ml.html#val-(=)"><span class="EQUAL">=</span></a> <span class="INT">0</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="import0.ml.html#val-not"><span class="LIDENT">not</span></a> <span class="LPAREN">(</span><a href="#local_drop_849"><span class="LIDENT">drop</span></a> <a href="#local_t_850"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span> <a href="import0.ml.html#val-(||)"><span class="BARBAR">||</span></a> <a href="#local_drop_849"><span class="LIDENT">drop</span></a> <a href="#local_t_850"><span class="LIDENT">t</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><a href="#local_length_852"><span class="LIDENT">length</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <span class="INT">1</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="THEN">then</span> <a href="#local_t_850"><span class="LIDENT">t</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LIDENT">first_non_drop_literal</span> <a href="#local_t_850"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_849"><span class="LIDENT">drop</span></a> <span class="TILDE">~</span><a href="#local_escape_char_851"><span class="LIDENT">escape_char</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;&quot;</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_first_853"><span class="LIDENT">first</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="MATCH">match</span> <span class="LIDENT">last_non_drop_literal</span> <a href="#local_t_850"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_drop_849"><span class="LIDENT">drop</span></a> <span class="TILDE">~</span><a href="#local_escape_char_851"><span class="LIDENT">escape_char</span></a> <span class="WITH">with</span><span class="EOL">
</span>         <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="ASSERT">assert</span> <span class="FALSE">false</span><span class="EOL">
</span>         <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_last_854"><span class="LIDENT">last</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">sub</span> <a href="#local_t_850"><span class="LIDENT">t</span></a> <span class="LABEL">~pos:</span><a href="#local_first_853"><span class="LIDENT">first</span></a> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_last_854"><span class="LIDENT">last</span></a> <a href="import0.ml.html#val-(-)"><span class="MINUS">-</span></a> <a href="#local_first_853"><span class="LIDENT">first</span></a> <a href="import0.ml.html#val-(+)"><span class="PLUS">+</span></a> <span class="INT">1</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Open replace_polymorphic_compare after including functor instantiations so they do not
   shadow its definitions. This is here so that efficient versions of the comparison
   functions are available within this module. *)</span><span class="EOL">
</span><span class="OPEN">open</span><span class="BANG">!</span> <a href="import0.ml.html#module-String_replace_polymorphic_compare"><span class="UIDENT">String_replace_polymorphic_compare</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-between"><span class="LIDENT">between</span></span> <span id="local_t_855"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_low_856"><span class="LIDENT">low</span></span> <span class="TILDE">~</span><span id="local_high_857"><span class="LIDENT">high</span></span> <span class="EQUAL">=</span> <a href="#local_low_856"><span class="LIDENT">low</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_t_855"><span class="LIDENT">t</span></a> <a href="import0.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="#local_t_855"><span class="LIDENT">t</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_high_857"><span class="LIDENT">high</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-clamp_unchecked"><span class="LIDENT">clamp_unchecked</span></span> <span id="local_t_858"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_min_859"><span class="LIDENT">min</span></span> <span class="TILDE">~</span><span id="local_max_860"><span class="LIDENT">max</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_t_858"><span class="LIDENT">t</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&lt;)"><span class="LESS">&lt;</span></a> <a href="#local_min_859"><span class="LIDENT">min</span></a> <span class="THEN">then</span> <a href="#local_min_859"><span class="LIDENT">min</span></a> <span class="ELSE">else</span> <span class="IF">if</span> <a href="#local_t_858"><span class="LIDENT">t</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_max_860"><span class="LIDENT">max</span></a> <span class="THEN">then</span> <a href="#local_t_858"><span class="LIDENT">t</span></a> <span class="ELSE">else</span> <a href="#local_max_860"><span class="LIDENT">max</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-clamp_exn"><span class="LIDENT">clamp_exn</span></span> <span id="local_t_861"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_min_862"><span class="LIDENT">min</span></span> <span class="TILDE">~</span><span id="local_max_863"><span class="LIDENT">max</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="ASSERT">assert</span> <span class="LPAREN">(</span><a href="#local_min_862"><span class="LIDENT">min</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_max_863"><span class="LIDENT">max</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">clamp_unchecked</span> <a href="#local_t_861"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_min_862"><span class="LIDENT">min</span></a> <span class="TILDE">~</span><a href="#local_max_863"><span class="LIDENT">max</span></a><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-clamp"><span class="LIDENT">clamp</span></span> <span id="local_t_864"><span class="LIDENT">t</span></span> <span class="TILDE">~</span><span id="local_min_865"><span class="LIDENT">min</span></span> <span class="TILDE">~</span><span id="local_max_866"><span class="LIDENT">max</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_min_865"><span class="LIDENT">min</span></a> <a href="import0.ml.html#module-String_replace_polymorphic_compare.val-(&gt;)"><span class="GREATER">&gt;</span></a> <a href="#local_max_866"><span class="LIDENT">max</span></a><span class="EOL">
</span>  <span class="THEN">then</span><span class="EOL">
</span>    <a href="or_error.ml.html#val-error_s"><span class="UIDENT">Or_error</span><span class="DOT">.</span><span class="LIDENT">error_s</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><a href="../../../sexplib0/src/sexplib0/sexp.ml.html#val-message"><span class="UIDENT">Sexp</span><span class="DOT">.</span><span class="LIDENT">message</span></a><span class="EOL">
</span>         <span class="STRING">&quot;clamp requires [min &lt;= max]&quot;</span><span class="EOL">
</span>         <span class="LBRACKET">[</span> <span class="STRING">&quot;min&quot;</span><span class="COMMA">,</span> <span class="UIDENT">T</span><span class="DOT">.</span><span class="LIDENT">sexp_of_t</span> <a href="#local_min_865"><span class="LIDENT">min</span></a><span class="SEMI">;</span> <span class="STRING">&quot;max&quot;</span><span class="COMMA">,</span> <span class="UIDENT">T</span><span class="DOT">.</span><span class="LIDENT">sexp_of_t</span> <a href="#local_max_866"><span class="LIDENT">max</span></a> <span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="ELSE">else</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="LIDENT">clamp_unchecked</span> <a href="#local_t_864"><span class="LIDENT">t</span></a> <span class="TILDE">~</span><a href="#local_min_865"><span class="LIDENT">min</span></a> <span class="TILDE">~</span><a href="#local_max_866"><span class="LIDENT">max</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="SEMISEMI">;;</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Override [Search_pattern] with default case-sensitivity argument at the end of the
   file, so that call sites above are forced to supply case-sensitivity explicitly. *)</span><span class="EOL">
</span><span id="module-Search_pattern"><span class="MODULE">module</span> <span class="UIDENT">Search_pattern</span> <span class="EQUAL">=</span> <span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="INCLUDE">include</span> <span class="UIDENT">Search_pattern0</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Search_pattern.val-create"><span class="LIDENT">create</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_case_sensitive_867"><span class="LIDENT">case_sensitive</span></span> <span class="EQUAL">=</span> <span class="TRUE">true</span><span class="RPAREN">)</span> <span id="local_pattern_868"><span class="LIDENT">pattern</span></span> <span class="EQUAL">=</span> <span class="LIDENT">create</span> <a href="#local_pattern_868"><span class="LIDENT">pattern</span></a> <span class="TILDE">~</span><a href="#local_case_sensitive_867"><span class="LIDENT">case_sensitive</span></a><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Include type-specific [Replace_polymorphic_compare] at the end, after
   including functor application that could shadow its definitions. This is
   here so that efficient versions of the comparison functions are exported by
   this module. *)</span><span class="EOL">
</span><span class="INCLUDE">include</span> <a href="import0.ml.html#module-String_replace_polymorphic_compare"><span class="UIDENT">String_replace_polymorphic_compare</span></a><span class="EOL">
</span></span></code></pre></body></html>
