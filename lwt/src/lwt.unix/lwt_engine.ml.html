<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: lwt_engine.ml (lwt.src.lwt.unix)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Lwt</a> &#x00BB; <a href="../index.html">Sources</a> &#x00BB; lwt.unix &#x00BB; lwt_engine.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>lwt_engine.ml</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-global-toc"><ul><li><a href="../../index.html">Lwt</a><ul><li>Library <code>lwt</code><ul><li><a href="../../lwt/Lwt/index.html">Lwt</a></li><li><a href="../../lwt/Lwt_condition/index.html">Lwt_condition</a></li><li><a href="../../lwt/Lwt_list/index.html">Lwt_list</a></li><li><a href="../../lwt/Lwt_mutex/index.html">Lwt_mutex</a></li><li><a href="../../lwt/Lwt_mvar/index.html">Lwt_mvar</a></li><li><a href="../../lwt/Lwt_pool/index.html">Lwt_pool</a></li><li><a href="../../lwt/Lwt_pqueue/index.html">Lwt_pqueue</a></li><li><a href="../../lwt/Lwt_result/index.html">Lwt_result</a></li><li><a href="../../lwt/Lwt_seq/index.html">Lwt_seq</a></li><li><a href="../../lwt/Lwt_sequence/index.html">Lwt_sequence</a></li><li><a href="../../lwt/Lwt_stream/index.html">Lwt_stream</a></li><li><a href="../../lwt/Lwt_switch/index.html">Lwt_switch</a></li></ul></li><li>Library <code>lwt.unix</code><ul><li><a href="../../lwt.unix/Lwt_bytes/index.html">Lwt_bytes</a></li><li><a href="../../lwt.unix/Lwt_config/index.html">Lwt_config</a></li><li><a href="../../lwt.unix/Lwt_engine/index.html">Lwt_engine</a></li><li><a href="../../lwt.unix/Lwt_features/index.html">Lwt_features</a></li><li><a href="../../lwt.unix/Lwt_fmt/index.html">Lwt_fmt</a></li><li><a href="../../lwt.unix/Lwt_gc/index.html">Lwt_gc</a></li><li><a href="../../lwt.unix/Lwt_io/index.html">Lwt_io</a></li><li><a href="../../lwt.unix/Lwt_main/index.html">Lwt_main</a></li><li><a href="../../lwt.unix/Lwt_preemptive/index.html">Lwt_preemptive</a></li><li><a href="../../lwt.unix/Lwt_process/index.html">Lwt_process</a></li><li><a href="../../lwt.unix/Lwt_sys/index.html">Lwt_sys</a></li><li><a href="../../lwt.unix/Lwt_throttle/index.html">Lwt_throttle</a></li><li><a href="../../lwt.unix/Lwt_timeout/index.html">Lwt_timeout</a></li><li><a href="../../lwt.unix/Lwt_unix/index.html">Lwt_unix</a></li></ul></li><li><a href="../index.html">Sources</a><ul><li>lwt<ul><li><a href="../lwt/lwt.ml.html">lwt.ml</a></li><li><a href="../lwt/lwt_condition.ml.html">lwt_condition.ml</a></li><li><a href="../lwt/lwt_list.ml.html">lwt_list.ml</a></li><li><a href="../lwt/lwt_mutex.ml.html">lwt_mutex.ml</a></li><li><a href="../lwt/lwt_mvar.ml.html">lwt_mvar.ml</a></li><li><a href="../lwt/lwt_pool.ml.html">lwt_pool.ml</a></li><li><a href="../lwt/lwt_pqueue.ml.html">lwt_pqueue.ml</a></li><li><a href="../lwt/lwt_result.ml.html">lwt_result.ml</a></li><li><a href="../lwt/lwt_seq.ml.html">lwt_seq.ml</a></li><li><a href="../lwt/lwt_sequence.ml.html">lwt_sequence.ml</a></li><li><a href="../lwt/lwt_stream.ml.html">lwt_stream.ml</a></li><li><a href="../lwt/lwt_switch.ml.html">lwt_switch.ml</a></li></ul></li><li>lwt.unix<ul><li><a href="lwt_bytes.ml.html">lwt_bytes.ml</a></li><li><a href="lwt_config.ml.html">lwt_config.ml</a></li><li><a href="#" class="current_unit">lwt_engine.ml</a></li><li><a href="lwt_features.ml.html">lwt_features.ml</a></li><li><a href="lwt_fmt.ml.html">lwt_fmt.ml</a></li><li><a href="lwt_gc.ml.html">lwt_gc.ml</a></li><li><a href="lwt_io.ml.html">lwt_io.ml</a></li><li><a href="lwt_main.ml.html">lwt_main.ml</a></li><li><a href="lwt_preemptive.ml.html">lwt_preemptive.ml</a></li><li><a href="lwt_process.ml.html">lwt_process.ml</a></li><li><a href="lwt_sys.ml.html">lwt_sys.ml</a></li><li><a href="lwt_throttle.ml.html">lwt_throttle.ml</a></li><li><a href="lwt_timeout.ml.html">lwt_timeout.ml</a></li><li><a href="lwt_unix.ml.html">lwt_unix.ml</a></li></ul></li></ul></li></ul></li></ul></nav></div><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
<a id="L306" class="source_line" href="#L306">306</a>
<a id="L307" class="source_line" href="#L307">307</a>
<a id="L308" class="source_line" href="#L308">308</a>
<a id="L309" class="source_line" href="#L309">309</a>
<a id="L310" class="source_line" href="#L310">310</a>
<a id="L311" class="source_line" href="#L311">311</a>
<a id="L312" class="source_line" href="#L312">312</a>
<a id="L313" class="source_line" href="#L313">313</a>
<a id="L314" class="source_line" href="#L314">314</a>
<a id="L315" class="source_line" href="#L315">315</a>
<a id="L316" class="source_line" href="#L316">316</a>
<a id="L317" class="source_line" href="#L317">317</a>
<a id="L318" class="source_line" href="#L318">318</a>
<a id="L319" class="source_line" href="#L319">319</a>
<a id="L320" class="source_line" href="#L320">320</a>
<a id="L321" class="source_line" href="#L321">321</a>
<a id="L322" class="source_line" href="#L322">322</a>
<a id="L323" class="source_line" href="#L323">323</a>
<a id="L324" class="source_line" href="#L324">324</a>
<a id="L325" class="source_line" href="#L325">325</a>
<a id="L326" class="source_line" href="#L326">326</a>
<a id="L327" class="source_line" href="#L327">327</a>
<a id="L328" class="source_line" href="#L328">328</a>
<a id="L329" class="source_line" href="#L329">329</a>
<a id="L330" class="source_line" href="#L330">330</a>
<a id="L331" class="source_line" href="#L331">331</a>
<a id="L332" class="source_line" href="#L332">332</a>
<a id="L333" class="source_line" href="#L333">333</a>
<a id="L334" class="source_line" href="#L334">334</a>
<a id="L335" class="source_line" href="#L335">335</a>
<a id="L336" class="source_line" href="#L336">336</a>
<a id="L337" class="source_line" href="#L337">337</a>
<a id="L338" class="source_line" href="#L338">338</a>
<a id="L339" class="source_line" href="#L339">339</a>
<a id="L340" class="source_line" href="#L340">340</a>
<a id="L341" class="source_line" href="#L341">341</a>
<a id="L342" class="source_line" href="#L342">342</a>
<a id="L343" class="source_line" href="#L343">343</a>
<a id="L344" class="source_line" href="#L344">344</a>
<a id="L345" class="source_line" href="#L345">345</a>
<a id="L346" class="source_line" href="#L346">346</a>
<a id="L347" class="source_line" href="#L347">347</a>
<a id="L348" class="source_line" href="#L348">348</a>
<a id="L349" class="source_line" href="#L349">349</a>
<a id="L350" class="source_line" href="#L350">350</a>
<a id="L351" class="source_line" href="#L351">351</a>
<a id="L352" class="source_line" href="#L352">352</a>
<a id="L353" class="source_line" href="#L353">353</a>
<a id="L354" class="source_line" href="#L354">354</a>
<a id="L355" class="source_line" href="#L355">355</a>
<a id="L356" class="source_line" href="#L356">356</a>
<a id="L357" class="source_line" href="#L357">357</a>
<a id="L358" class="source_line" href="#L358">358</a>
<a id="L359" class="source_line" href="#L359">359</a>
<a id="L360" class="source_line" href="#L360">360</a>
<a id="L361" class="source_line" href="#L361">361</a>
<a id="L362" class="source_line" href="#L362">362</a>
<a id="L363" class="source_line" href="#L363">363</a>
<a id="L364" class="source_line" href="#L364">364</a>
<a id="L365" class="source_line" href="#L365">365</a>
<a id="L366" class="source_line" href="#L366">366</a>
<a id="L367" class="source_line" href="#L367">367</a>
<a id="L368" class="source_line" href="#L368">368</a>
<a id="L369" class="source_line" href="#L369">369</a>
<a id="L370" class="source_line" href="#L370">370</a>
<a id="L371" class="source_line" href="#L371">371</a>
<a id="L372" class="source_line" href="#L372">372</a>
<a id="L373" class="source_line" href="#L373">373</a>
<a id="L374" class="source_line" href="#L374">374</a>
<a id="L375" class="source_line" href="#L375">375</a>
<a id="L376" class="source_line" href="#L376">376</a>
<a id="L377" class="source_line" href="#L377">377</a>
<a id="L378" class="source_line" href="#L378">378</a>
<a id="L379" class="source_line" href="#L379">379</a>
<a id="L380" class="source_line" href="#L380">380</a>
<a id="L381" class="source_line" href="#L381">381</a>
<a id="L382" class="source_line" href="#L382">382</a>
<a id="L383" class="source_line" href="#L383">383</a>
<a id="L384" class="source_line" href="#L384">384</a>
<a id="L385" class="source_line" href="#L385">385</a>
<a id="L386" class="source_line" href="#L386">386</a>
<a id="L387" class="source_line" href="#L387">387</a>
<a id="L388" class="source_line" href="#L388">388</a>
<a id="L389" class="source_line" href="#L389">389</a>
<a id="L390" class="source_line" href="#L390">390</a>
<a id="L391" class="source_line" href="#L391">391</a>
<a id="L392" class="source_line" href="#L392">392</a>
<a id="L393" class="source_line" href="#L393">393</a>
<a id="L394" class="source_line" href="#L394">394</a>
<a id="L395" class="source_line" href="#L395">395</a>
<a id="L396" class="source_line" href="#L396">396</a>
<a id="L397" class="source_line" href="#L397">397</a>
<a id="L398" class="source_line" href="#L398">398</a>
<a id="L399" class="source_line" href="#L399">399</a>
<a id="L400" class="source_line" href="#L400">400</a>
<a id="L401" class="source_line" href="#L401">401</a>
<a id="L402" class="source_line" href="#L402">402</a>
<a id="L403" class="source_line" href="#L403">403</a>
<a id="L404" class="source_line" href="#L404">404</a>
<a id="L405" class="source_line" href="#L405">405</a>
<a id="L406" class="source_line" href="#L406">406</a>
<a id="L407" class="source_line" href="#L407">407</a>
<a id="L408" class="source_line" href="#L408">408</a>
<a id="L409" class="source_line" href="#L409">409</a>
<a id="L410" class="source_line" href="#L410">410</a>
<a id="L411" class="source_line" href="#L411">411</a>
<a id="L412" class="source_line" href="#L412">412</a>
<a id="L413" class="source_line" href="#L413">413</a>
<a id="L414" class="source_line" href="#L414">414</a>
<a id="L415" class="source_line" href="#L415">415</a>
<a id="L416" class="source_line" href="#L416">416</a>
<a id="L417" class="source_line" href="#L417">417</a>
<a id="L418" class="source_line" href="#L418">418</a>
<a id="L419" class="source_line" href="#L419">419</a>
<a id="L420" class="source_line" href="#L420">420</a>
<a id="L421" class="source_line" href="#L421">421</a>
<a id="L422" class="source_line" href="#L422">422</a>
<a id="L423" class="source_line" href="#L423">423</a>
<a id="L424" class="source_line" href="#L424">424</a>
<a id="L425" class="source_line" href="#L425">425</a>
<a id="L426" class="source_line" href="#L426">426</a>
<a id="L427" class="source_line" href="#L427">427</a>
<a id="L428" class="source_line" href="#L428">428</a>
<a id="L429" class="source_line" href="#L429">429</a>
<a id="L430" class="source_line" href="#L430">430</a>
<a id="L431" class="source_line" href="#L431">431</a>
<a id="L432" class="source_line" href="#L432">432</a>
<a id="L433" class="source_line" href="#L433">433</a>
<a id="L434" class="source_line" href="#L434">434</a>
<a id="L435" class="source_line" href="#L435">435</a>
<a id="L436" class="source_line" href="#L436">436</a>
<a id="L437" class="source_line" href="#L437">437</a>
<a id="L438" class="source_line" href="#L438">438</a>
<a id="L439" class="source_line" href="#L439">439</a>
<a id="L440" class="source_line" href="#L440">440</a>
<a id="L441" class="source_line" href="#L441">441</a>
<a id="L442" class="source_line" href="#L442">442</a>
<a id="L443" class="source_line" href="#L443">443</a>
<a id="L444" class="source_line" href="#L444">444</a>
</code><code class="source_code"><span><span id="local_*opt*_59"></span><span id="local_*sth*_61"></span><span class="COMMENT">(* This file is part of Lwt, released under the MIT license. See LICENSE.md for
   details, or visit https://github.com/ocsigen/lwt/blob/master/LICENSE.md. *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* [Lwt_sequence] is deprecated â€“ we don't want users outside Lwt using it.
   However, it is still used internally by Lwt. So, briefly disable warning 3
   (&quot;deprecated&quot;), and create a local, non-deprecated alias for
   [Lwt_sequence] that can be referred to by the rest of the code in this
   module without triggering any more warnings. *)</span><span class="EOL">
</span><span class="LBRACKETATATAT">[@@@</span><span class="LIDENT">ocaml</span><span class="DOT">.</span><span class="LIDENT">warning</span> <span class="STRING">&quot;-3&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span id="module-Lwt_sequence"><span class="MODULE">module</span> <span class="UIDENT">Lwt_sequence</span> <span class="EQUAL">=</span> <a href="../lwt/lwt_sequence.ml.html"><span class="UIDENT">Lwt_sequence</span></a></span><span class="EOL">
</span><span class="LBRACKETATATAT">[@@@</span><span class="LIDENT">ocaml</span><span class="DOT">.</span><span class="LIDENT">warning</span> <span class="STRING">&quot;+3&quot;</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* +-----------------------------------------------------------------+
   | Events                                                          |
   +-----------------------------------------------------------------+ *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-_event"><span class="TYPE">type</span> <span class="LIDENT">_event</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_159"><span class="LIDENT">stop</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="SEMI">;</span></span><span class="EOL">
</span>  <span class="COMMENT">(* The stop method of the event. *)</span><span class="EOL">
</span>  <span id="def_161"><span class="LIDENT">node</span> <span class="COLON">:</span> <a href="../../../ocaml-base-compiler/src/stdlib/obj.ml.html#type-t"><span class="UIDENT">Obj</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">node</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span class="COMMENT">(* The node in the sequence of registered events. *)</span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-event"><span class="TYPE">type</span> <span class="LIDENT">event</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#type-ref"><span class="LIDENT">_event</span> <span class="LIDENT">ref</span></a></span><span class="EOL">
</span><span class="EOL">
</span><span id="val-cast_node"><span class="EXTERNAL">external</span> <span class="LIDENT">cast_node</span> <span class="COLON">:</span> <span class="QUOTE">'</span><span class="LIDENT">a</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">node</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/obj.ml.html#type-t"><span class="UIDENT">Obj</span><span class="DOT">.</span><span class="LIDENT">t</span></a> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">node</span> <span class="EQUAL">=</span> <span class="STRING">&quot;%identity&quot;</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-stop_event"><span class="LIDENT">stop_event</span></span> <span id="local_ev_1"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_ev_2"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><a href="#local_ev_1"><span class="LIDENT">ev</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_ev_2"><span class="LIDENT">ev</span></a><span class="DOT">.</span><span class="LIDENT">node</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#val-force"><span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">force</span></a> <a href="#local_ev_2"><span class="LIDENT">ev</span></a><span class="DOT">.</span><span class="LIDENT">stop</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-_fake_event"><span class="LIDENT">_fake_event</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span class="LIDENT">stop</span> <span class="EQUAL">=</span> <span class="LAZY">lazy</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">node</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_l</span> <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/obj.ml.html#val-repr"><span class="UIDENT">Obj</span><span class="DOT">.</span><span class="LIDENT">repr</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span><span class="RBRACE">}</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-fake_event"><span class="LIDENT">fake_event</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LIDENT">_fake_event</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* +-----------------------------------------------------------------+
   | Engines                                                         |
   +-----------------------------------------------------------------+ *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span class="VIRTUAL">virtual</span> <span id="class-abstract"><span class="LIDENT">abstract</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="LPAREN">(</span><span id="local_self_3"><span class="LIDENT">self</span></span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="VIRTUAL">virtual</span> <span class="LIDENT">iter</span> <span class="COLON">:</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="VIRTUAL">virtual</span> <span class="PRIVATE">private</span> <span class="LIDENT">cleanup</span> <span class="COLON">:</span> <span class="LIDENT">unit</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="VIRTUAL">virtual</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_readable</span> <span class="COLON">:</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="VIRTUAL">virtual</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_writable</span> <span class="COLON">:</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="VIRTUAL">virtual</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_timer</span> <span class="COLON">:</span> <span class="LIDENT">float</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="LIDENT">readables</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="COMMENT">(* Sequence of callbacks waiting for a file descriptor to become
     readable. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="LIDENT">writables</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="COMMENT">(* Sequence of callbacks waiting for a file descriptor to become
     writable. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="LIDENT">timers</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="COMMENT">(* Sequence of timers. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">destroy</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local__fd_4"><span class="LIDENT">_fd</span></span><span class="COMMA">,</span> <span id="local__f_5"><span class="LIDENT">_f</span></span><span class="COMMA">,</span> <span id="local__g_6"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_7"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">stop_event</span> <a href="#local_ev_7"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span> <span class="LIDENT">readables</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local__fd_8"><span class="LIDENT">_fd</span></span><span class="COMMA">,</span> <span id="local__f_9"><span class="LIDENT">_f</span></span><span class="COMMA">,</span> <span id="local__g_10"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_11"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">stop_event</span> <a href="#local_ev_11"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span> <span class="LIDENT">writables</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local__delay_12"><span class="LIDENT">_delay</span></span><span class="COMMA">,</span> <span id="local__repeat_13"><span class="LIDENT">_repeat</span></span><span class="COMMA">,</span> <span id="local__f_14"><span class="LIDENT">_f</span></span><span class="COMMA">,</span> <span id="local__g_15"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_16"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">stop_event</span> <a href="#local_ev_16"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="LIDENT">timers</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">cleanup</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">transfer</span> <span class="LPAREN">(</span><span id="local_engine_17"><span class="LIDENT">engine</span></span> <span class="COLON">:</span> <span class="LIDENT">abstract</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd_18"><span class="LIDENT">fd</span></span><span class="COMMA">,</span> <span id="local_f_19"><span class="LIDENT">f</span></span><span class="COMMA">,</span> <span id="local__g_20"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_21"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">stop_event</span> <a href="#local_ev_21"><span class="LIDENT">ev</span></a><span class="SEMI">;</span> <a href="#local_ev_21"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LPAREN">(</span><a href="#local_engine_17"><span class="LIDENT">engine</span></a><span class="HASH">#</span><span class="LIDENT">on_readable</span> <a href="#local_fd_18"><span class="LIDENT">fd</span></a> <a href="#local_f_19"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LIDENT">readables</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd_22"><span class="LIDENT">fd</span></span><span class="COMMA">,</span> <span id="local_f_23"><span class="LIDENT">f</span></span><span class="COMMA">,</span> <span id="local__g_24"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_25"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">stop_event</span> <a href="#local_ev_25"><span class="LIDENT">ev</span></a><span class="SEMI">;</span> <a href="#local_ev_25"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LPAREN">(</span><a href="#local_engine_17"><span class="LIDENT">engine</span></a><span class="HASH">#</span><span class="LIDENT">on_writable</span> <a href="#local_fd_22"><span class="LIDENT">fd</span></a> <a href="#local_f_23"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LIDENT">writables</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_delay_26"><span class="LIDENT">delay</span></span><span class="COMMA">,</span> <span id="local_repeat_27"><span class="LIDENT">repeat</span></span><span class="COMMA">,</span> <span id="local_f_28"><span class="LIDENT">f</span></span><span class="COMMA">,</span> <span id="local__g_29"><span class="LIDENT">_g</span></span><span class="COMMA">,</span> <span id="local_ev_30"><span class="LIDENT">ev</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">stop_event</span> <a href="#local_ev_30"><span class="LIDENT">ev</span></a><span class="SEMI">;</span> <a href="#local_ev_30"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LPAREN">(</span><a href="#local_engine_17"><span class="LIDENT">engine</span></a><span class="HASH">#</span><span class="LIDENT">on_timer</span> <a href="#local_delay_26"><span class="LIDENT">delay</span></a> <a href="#local_repeat_27"><span class="LIDENT">repeat</span></a> <a href="#local_f_28"><span class="LIDENT">f</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LIDENT">timers</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">fake_io</span> <span id="local_fd_31"><span class="LIDENT">fd</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd'_32"><span class="LIDENT">fd'</span></span><span class="COMMA">,</span> <span id="local__f_33"><span class="LIDENT">_f</span></span><span class="COMMA">,</span> <span id="local_g_34"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local__stop_35"><span class="LIDENT">_stop</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_fd_31"><span class="LIDENT">fd</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_fd'_32"><span class="LIDENT">fd'</span></a> <span class="THEN">then</span> <a href="#local_g_34"><span class="LIDENT">g</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LIDENT">readables</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd'_36"><span class="LIDENT">fd'</span></span><span class="COMMA">,</span> <span id="local__f_37"><span class="LIDENT">_f</span></span><span class="COMMA">,</span> <span id="local_g_38"><span class="LIDENT">g</span></span><span class="COMMA">,</span> <span id="local__stop_39"><span class="LIDENT">_stop</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <a href="#local_fd_31"><span class="LIDENT">fd</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(=)"><span class="EQUAL">=</span></a> <a href="#local_fd'_36"><span class="LIDENT">fd'</span></a> <span class="THEN">then</span> <a href="#local_g_38"><span class="LIDENT">g</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <span class="LIDENT">writables</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">on_readable</span> <span id="local_fd_40"><span class="LIDENT">fd</span></span> <span id="local_f_41"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_42"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LIDENT">_fake_event</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_g_43"><span class="LIDENT">g</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_f_41"><span class="LIDENT">f</span></a> <a href="#local_ev_42"><span class="LIDENT">ev</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_stop_44"><span class="LIDENT">stop</span></span> <span class="EQUAL">=</span> <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">register_readable</span> <a href="#local_fd_40"><span class="LIDENT">fd</span></a> <a href="#local_g_43"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_ev_42"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LBRACE">{</span> <span class="LIDENT">stop</span> <span class="EQUAL">=</span> <a href="#local_stop_44"><span class="LIDENT">stop</span></a><span class="SEMI">;</span> <span class="LIDENT">node</span> <span class="EQUAL">=</span> <span class="LIDENT">cast_node</span> <span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_r</span> <span class="LPAREN">(</span><a href="#local_fd_40"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <a href="#local_f_41"><span class="LIDENT">f</span></a><span class="COMMA">,</span> <a href="#local_g_43"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_ev_42"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span> <span class="LIDENT">readables</span><span class="RPAREN">)</span> <span class="RBRACE">}</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_ev_42"><span class="LIDENT">ev</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">on_writable</span> <span id="local_fd_45"><span class="LIDENT">fd</span></span> <span id="local_f_46"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_47"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LIDENT">_fake_event</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_g_48"><span class="LIDENT">g</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_f_46"><span class="LIDENT">f</span></a> <a href="#local_ev_47"><span class="LIDENT">ev</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_stop_49"><span class="LIDENT">stop</span></span> <span class="EQUAL">=</span> <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">register_writable</span> <a href="#local_fd_45"><span class="LIDENT">fd</span></a> <a href="#local_g_48"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_ev_47"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LBRACE">{</span> <span class="LIDENT">stop</span> <span class="EQUAL">=</span> <a href="#local_stop_49"><span class="LIDENT">stop</span></a><span class="SEMI">;</span> <span class="LIDENT">node</span> <span class="EQUAL">=</span> <span class="LIDENT">cast_node</span> <span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_r</span> <span class="LPAREN">(</span><a href="#local_fd_45"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <a href="#local_f_46"><span class="LIDENT">f</span></a><span class="COMMA">,</span> <a href="#local_g_48"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_ev_47"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span> <span class="LIDENT">writables</span><span class="RPAREN">)</span> <span class="RBRACE">}</span> <span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_ev_47"><span class="LIDENT">ev</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">on_timer</span> <span id="local_delay_50"><span class="LIDENT">delay</span></span> <span id="local_repeat_51"><span class="LIDENT">repeat</span></span> <span id="local_f_52"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_53"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LIDENT">_fake_event</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_g_54"><span class="LIDENT">g</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="#local_f_52"><span class="LIDENT">f</span></a> <a href="#local_ev_53"><span class="LIDENT">ev</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_stop_55"><span class="LIDENT">stop</span></span> <span class="EQUAL">=</span> <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">register_timer</span> <a href="#local_delay_50"><span class="LIDENT">delay</span></a> <a href="#local_repeat_51"><span class="LIDENT">repeat</span></a> <a href="#local_g_54"><span class="LIDENT">g</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_ev_53"><span class="LIDENT">ev</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LBRACE">{</span> <span class="LIDENT">stop</span> <span class="EQUAL">=</span> <a href="#local_stop_55"><span class="LIDENT">stop</span></a><span class="SEMI">;</span> <span class="LIDENT">node</span> <span class="EQUAL">=</span> <span class="LIDENT">cast_node</span> <span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_r</span> <span class="LPAREN">(</span><a href="#local_delay_50"><span class="LIDENT">delay</span></a><span class="COMMA">,</span> <a href="#local_repeat_51"><span class="LIDENT">repeat</span></a><span class="COMMA">,</span> <a href="#local_f_52"><span class="LIDENT">f</span></a><span class="COMMA">,</span> <a href="#local_g_54"><span class="LIDENT">g</span></a><span class="COMMA">,</span> <a href="#local_ev_53"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span> <span class="LIDENT">timers</span><span class="RPAREN">)</span> <span class="RBRACE">}</span><span class="SEMI">;</span><span class="EOL">
</span>    <a href="#local_ev_53"><span class="LIDENT">ev</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">readable_count</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">length</span> <span class="LIDENT">readables</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">writable_count</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">length</span> <span class="LIDENT">writables</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">timer_count</span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">length</span> <span class="LIDENT">timers</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">fork</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">forwards_signal</span> <span class="LPAREN">(</span><span id="local__signum_56"><span class="LIDENT">_signum</span></span><span class="COLON">:</span><span class="LIDENT">int</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="FALSE">false</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span class="TYPE">type</span> <span id="class-type-t"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">abstract</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">iter</span> <span class="COLON">:</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">cleanup</span> <span class="COLON">:</span> <span class="LIDENT">unit</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_readable</span> <span class="COLON">:</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_writable</span> <span class="COLON">:</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_timer</span> <span class="COLON">:</span> <span class="LIDENT">float</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="../../../ocaml-base-compiler/src/stdlib/lazy.ml.html#type-t"><span class="LIDENT">unit</span> <span class="UIDENT">Lazy</span><span class="DOT">.</span><span class="LIDENT">t</span></a><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* +-----------------------------------------------------------------+
   | The libev engine                                                |
   +-----------------------------------------------------------------+ *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-ev_loop"><span class="TYPE">type</span> <span class="LIDENT">ev_loop</span></span><span class="EOL">
</span><span id="type-ev_io"><span class="TYPE">type</span> <span class="LIDENT">ev_io</span></span><span class="EOL">
</span><span id="type-ev_timer"><span class="TYPE">type</span> <span class="LIDENT">ev_timer</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Ev_backend"><span class="MODULE">module</span> <span class="UIDENT">Ev_backend</span> <span class="EQUAL">=</span><span class="EOL">
</span><span class="STRUCT">struct</span><span class="EOL">
</span>  <span id="module-Ev_backend.type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_DEFAULT"><span class="BAR">|</span> <span class="UIDENT">EV_DEFAULT</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_SELECT"><span class="BAR">|</span> <span class="UIDENT">EV_SELECT</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_POLL"><span class="BAR">|</span> <span class="UIDENT">EV_POLL</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_EPOLL"><span class="BAR">|</span> <span class="UIDENT">EV_EPOLL</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_KQUEUE"><span class="BAR">|</span> <span class="UIDENT">EV_KQUEUE</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_DEVPOLL"><span class="BAR">|</span> <span class="UIDENT">EV_DEVPOLL</span></span><span class="EOL">
</span>    <span id="module-Ev_backend.type-t.constructor-EV_PORT"><span class="BAR">|</span> <span class="UIDENT">EV_PORT</span></span></span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-default"><span class="LIDENT">default</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_DEFAULT</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-select"><span class="LIDENT">select</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_SELECT</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-poll"><span class="LIDENT">poll</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_POLL</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-epoll"><span class="LIDENT">epoll</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_EPOLL</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-kqueue"><span class="LIDENT">kqueue</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_KQUEUE</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-devpoll"><span class="LIDENT">devpoll</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_DEVPOLL</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-port"><span class="LIDENT">port</span></span> <span class="EQUAL">=</span> <span class="UIDENT">EV_PORT</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-name"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_DEFAULT</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_DEFAULT&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_SELECT</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_SELECT&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_POLL</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_POLL&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_EPOLL</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_EPOLL&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_KQUEUE</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_KQUEUE&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_DEVPOLL</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_DEVPOLL&quot;</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">EV_PORT</span> <span class="MINUSGREATER">-&gt;</span> <span class="STRING">&quot;EV_PORT&quot;</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="module-Ev_backend.val-pp"><span class="LIDENT">pp</span></span> <span id="local_fmt_57"><span class="LIDENT">fmt</span></span> <span id="local_t_58"><span class="LIDENT">t</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/format.ml.html#val-pp_print_string"><span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">pp_print_string</span></a> <a href="#local_fmt_57"><span class="LIDENT">fmt</span></a> <span class="LPAREN">(</span><span class="LIDENT">name</span> <a href="#local_t_58"><span class="LIDENT">t</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="val-ev_init"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_init</span> <span class="COLON">:</span> <span class="UIDENT">Ev_backend</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_loop</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_init&quot;</span></span><span class="EOL">
</span><span id="val-ev_stop"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_stop</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_stop&quot;</span></span><span class="EOL">
</span><span id="val-ev_loop"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_loop</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_loop&quot;</span></span><span class="EOL">
</span><span id="val-ev_unloop"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_unloop</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_unloop&quot;</span></span><span class="EOL">
</span><span id="val-ev_readable_init"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_readable_init</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_io</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_readable_init&quot;</span></span><span class="EOL">
</span><span id="val-ev_writable_init"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_writable_init</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_io</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_writable_init&quot;</span></span><span class="EOL">
</span><span id="val-ev_io_stop"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_io_stop</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_io</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_io_stop&quot;</span></span><span class="EOL">
</span><span id="val-ev_timer_init"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_timer_init</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">float</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bool</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_timer</span> <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_timer_init&quot;</span></span><span class="EOL">
</span><span id="val-ev_timer_stop"><span class="EXTERNAL">external</span> <span class="LIDENT">ev_timer_stop</span> <span class="COLON">:</span> <span class="LIDENT">ev_loop</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">ev_timer</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span>  <span class="EQUAL">=</span> <span class="STRING">&quot;lwt_libev_timer_stop&quot;</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span id="class-libev"><span class="LIDENT">libev</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_backend_60"><span class="LIDENT">backend</span></span><span class="EQUAL">=</span><a href="#local_*sth*_61"><span class="UIDENT">Ev_backend</span><span class="DOT">.</span><span class="LIDENT">default</span></a><span class="RPAREN">)</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">abstract</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="LIDENT">loop</span> <span class="EQUAL">=</span> <span class="LIDENT">ev_init</span> <a href="#local_backend_60"><span class="LIDENT">backend</span></a><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">loop</span> <span class="EQUAL">=</span> <span class="LIDENT">loop</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">cleanup</span> <span class="EQUAL">=</span> <span class="LIDENT">ev_stop</span> <span class="LIDENT">loop</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">iter</span> <span id="local_block_62"><span class="LIDENT">block</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="TRY">try</span><span class="EOL">
</span>      <span class="LIDENT">ev_loop</span> <span class="LIDENT">loop</span> <a href="#local_block_62"><span class="LIDENT">block</span></a><span class="EOL">
</span>    <span class="WITH">with</span> <span id="local_exn_63"><span class="LIDENT">exn</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="LIDENT">ev_unloop</span> <span class="LIDENT">loop</span><span class="SEMI">;</span><span class="EOL">
</span>      <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-raise"><span class="LIDENT">raise</span></a> <a href="#local_exn_63"><span class="LIDENT">exn</span></a><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_readable</span> <span id="local_fd_64"><span class="LIDENT">fd</span></span> <span id="local_f_65"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_66"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <span class="LIDENT">ev_readable_init</span> <span class="LIDENT">loop</span> <a href="#local_fd_64"><span class="LIDENT">fd</span></a> <a href="#local_f_65"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LAZY">lazy</span><span class="LPAREN">(</span><span class="LIDENT">ev_io_stop</span> <span class="LIDENT">loop</span> <a href="#local_ev_66"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_writable</span> <span id="local_fd_67"><span class="LIDENT">fd</span></span> <span id="local_f_68"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_69"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <span class="LIDENT">ev_writable_init</span> <span class="LIDENT">loop</span> <a href="#local_fd_67"><span class="LIDENT">fd</span></a> <a href="#local_f_68"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LAZY">lazy</span><span class="LPAREN">(</span><span class="LIDENT">ev_io_stop</span> <span class="LIDENT">loop</span> <a href="#local_ev_69"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_timer</span> <span id="local_delay_70"><span class="LIDENT">delay</span></span> <span id="local_repeat_71"><span class="LIDENT">repeat</span></span> <span id="local_f_72"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_ev_73"><span class="LIDENT">ev</span></span> <span class="EQUAL">=</span> <span class="LIDENT">ev_timer_init</span> <span class="LIDENT">loop</span> <a href="#local_delay_70"><span class="LIDENT">delay</span></a> <a href="#local_repeat_71"><span class="LIDENT">repeat</span></a> <a href="#local_f_72"><span class="LIDENT">f</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LAZY">lazy</span><span class="LPAREN">(</span><span class="LIDENT">ev_timer_stop</span> <span class="LIDENT">loop</span> <a href="#local_ev_73"><span class="LIDENT">ev</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span id="class-libev_deprecated"><span class="LIDENT">libev_deprecated</span></span> <span class="EQUAL">=</span> <span class="LIDENT">libev</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* +-----------------------------------------------------------------+
   | Select/poll based engines                                       |
   +-----------------------------------------------------------------+ *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* Type of a sleeper for the select engine. *)</span><span class="EOL">
</span><span id="type-sleeper"><span class="TYPE">type</span> <span class="LIDENT">sleeper</span> <span class="EQUAL">=</span> <span class="LBRACE">{</span><span class="EOL">
</span>  <span id="def_158"><span class="MUTABLE">mutable</span> <span class="LIDENT">time</span> <span class="COLON">:</span> <span class="LIDENT">float</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span class="COMMENT">(* The time at which the sleeper should be wakeup. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="def_162"><span class="MUTABLE">mutable</span> <span class="LIDENT">stopped</span> <span class="COLON">:</span> <span class="LIDENT">bool</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span class="COMMENT">(* [true] iff the event has been stopped. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span id="def_164"><span class="LIDENT">action</span> <span class="COLON">:</span> <span class="LIDENT">unit</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">unit</span><span class="SEMI">;</span></span><span class="EOL">
</span>  <span class="COMMENT">(* The action for the sleeper. *)</span><span class="EOL">
</span><span class="RBRACE">}</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Sleep_queue"><span class="MODULE">module</span> <span class="UIDENT">Sleep_queue</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../lwt/lwt_pqueue.ml.html#module-Make"><span class="UIDENT">Lwt_pqueue</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="def_156"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="LIDENT">sleeper</span></span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_compare_74"><span class="LIDENT">compare</span></span> <span class="LBRACE">{</span><span class="LIDENT">time</span> <span class="EQUAL">=</span> <span id="local_t1_75"><span class="LIDENT">t1</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span><span class="RBRACE">}</span> <span class="LBRACE">{</span><span class="LIDENT">time</span> <span class="EQUAL">=</span> <span id="local_t2_76"><span class="LIDENT">t2</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span><span class="RBRACE">}</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-compare"><span class="LIDENT">compare</span></a> <a href="#local_t1_75"><span class="LIDENT">t1</span></a> <a href="#local_t2_76"><span class="LIDENT">t2</span></a><span class="EOL">
</span>  <span class="END">end</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="LBRACKETATAT">[@@</span><span class="LIDENT">ocaml</span><span class="DOT">.</span><span class="LIDENT">warning</span> <span class="STRING">&quot;-3&quot;</span><span class="RBRACKET">]</span></span><span class="EOL">
</span><span class="EOL">
</span><span id="module-Fd_map"><span class="MODULE">module</span> <span class="UIDENT">Fd_map</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/map.ml.html#module-Make"><span class="UIDENT">Map</span><span class="DOT">.</span><span class="UIDENT">Make</span></a><span class="LPAREN">(</span><span class="STRUCT">struct</span> <span id="def_157"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span></span> <span class="LET">let</span> <span id="local_compare_77"><span class="LIDENT">compare</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-compare"><span class="LIDENT">compare</span></a> <span class="END">end</span><span class="RPAREN">)</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-restart_actions"><span class="LIDENT">restart_actions</span></span> <span id="local_sleep_queue_78"><span class="LIDENT">sleep_queue</span></span> <span id="local_now_79"><span class="LIDENT">now</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">lookup_min</span> <a href="#local_sleep_queue_78"><span class="LIDENT">sleep_queue</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span><span class="LBRACE">{</span> <span class="LIDENT">stopped</span> <span class="EQUAL">=</span> <span class="TRUE">true</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">restart_actions</span> <span class="LPAREN">(</span><span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">remove_min</span> <a href="#local_sleep_queue_78"><span class="LIDENT">sleep_queue</span></a><span class="RPAREN">)</span> <a href="#local_now_79"><span class="LIDENT">now</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span><span class="LBRACE">{</span> <span class="LIDENT">time</span> <span class="EQUAL">=</span> <span id="local_time_80"><span class="LIDENT">time</span></span><span class="SEMI">;</span> <span class="LIDENT">action</span> <span class="EQUAL">=</span> <span id="local_action_81"><span class="LIDENT">action</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="WHEN">when</span> <a href="#local_time_80"><span class="LIDENT">time</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&lt;=)"><span class="INFIXOP0">&lt;=</span></a> <a href="#local_now_79"><span class="LIDENT">now</span></a> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="COMMENT">(* We have to remove the sleeper to the queue before performing
       the action. The action can change the sleeper's time, and this
       might break the priority queue invariant if the sleeper is
       still in the queue. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_q_82"><span class="LIDENT">q</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">remove_min</span> <a href="#local_sleep_queue_78"><span class="LIDENT">sleep_queue</span></a> <span class="IN">in</span><span class="EOL">
</span>    <a href="#local_action_81"><span class="LIDENT">action</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">restart_actions</span> <a href="#local_q_82"><span class="LIDENT">q</span></a> <a href="#local_now_79"><span class="LIDENT">now</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="#local_sleep_queue_78"><span class="LIDENT">sleep_queue</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-get_next_timeout"><span class="LIDENT">get_next_timeout</span></span> <span id="local_sleep_queue_83"><span class="LIDENT">sleep_queue</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">lookup_min</span> <a href="#local_sleep_queue_83"><span class="LIDENT">sleep_queue</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span><span class="LBRACE">{</span> <span class="LIDENT">stopped</span> <span class="EQUAL">=</span> <span class="TRUE">true</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LIDENT">get_next_timeout</span> <span class="LPAREN">(</span><span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">remove_min</span> <a href="#local_sleep_queue_83"><span class="LIDENT">sleep_queue</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span><span class="LBRACE">{</span> <span class="LIDENT">time</span> <span class="EQUAL">=</span> <span id="local_time_84"><span class="LIDENT">time</span></span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-max"><span class="LIDENT">max</span></a> <span class="FLOAT">0.</span> <span class="LPAREN">(</span><a href="#local_time_84"><span class="LIDENT">time</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(-.)"><span class="MINUSDOT">-.</span></a> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MINUS">-</span><span class="FLOAT">1.</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-bad_fd"><span class="LIDENT">bad_fd</span></span> <span id="local_fd_85"><span class="LIDENT">fd</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="TRY">try</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">fstat</span> <a href="#local_fd_85"><span class="LIDENT">fd</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="FALSE">false</span><span class="EOL">
</span>  <span class="WITH">with</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="TRUE">true</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-invoke_actions"><span class="LIDENT">invoke_actions</span></span> <span id="local_fd_86"><span class="LIDENT">fd</span></span> <span id="local_map_87"><span class="LIDENT">map</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_fd_86"><span class="LIDENT">fd</span></a> <a href="#local_map_87"><span class="LIDENT">map</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="EXCEPTION">exception</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span id="local_actions_88"><span class="LIDENT">actions</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">iter_l</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_f_89"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_89"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span> <a href="#local_actions_88"><span class="LIDENT">actions</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span class="VIRTUAL">virtual</span> <span id="class-select_or_poll_based"><span class="LIDENT">select_or_poll_based</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">abstract</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="MUTABLE">mutable</span> <span class="LIDENT">sleep_queue</span> <span class="EQUAL">=</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>  <span class="COMMENT">(* Threads waiting for a timeout to expire. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="MUTABLE">mutable</span> <span class="LIDENT">new_sleeps</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>  <span class="COMMENT">(* Sleepers added since the last iteration of the main loop:

     They are not added immediately to the main sleep queue in order
     to prevent them from being wakeup immediately.  *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="MUTABLE">mutable</span> <span class="LIDENT">wait_readable</span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>  <span class="COMMENT">(* Sequences of actions waiting for file descriptors to become
     readable. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="VAL">val</span> <span class="MUTABLE">mutable</span> <span class="LIDENT">wait_writable</span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="EOL">
</span>  <span class="COMMENT">(* Sequences of actions waiting for file descriptors to become
     writable. *)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">cleanup</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_timer</span> <span id="local_delay_90"><span class="LIDENT">delay</span></span> <span id="local_repeat_91"><span class="LIDENT">repeat</span></span> <span id="local_f_92"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <a href="#local_repeat_91"><span class="LIDENT">repeat</span></a> <span class="THEN">then</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span class="REC">rec</span> <span id="local_sleeper_93"><span class="LIDENT">sleeper</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span class="LIDENT">time</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+.)"><span class="PLUSDOT">+.</span></a> <a href="#local_delay_90"><span class="LIDENT">delay</span></a><span class="SEMI">;</span> <span class="LIDENT">stopped</span> <span class="EQUAL">=</span> <span class="FALSE">false</span><span class="SEMI">;</span> <span class="LIDENT">action</span> <span class="EQUAL">=</span> <a href="#local_g_94"><span class="LIDENT">g</span></a> <span class="RBRACE">}</span><span class="EOL">
</span>      <span class="AND">and</span> <span id="local_g_94"><span class="LIDENT">g</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>        <a href="#local_sleeper_93"><span class="LIDENT">sleeper</span></a><span class="DOT">.</span><span class="LIDENT">time</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+.)"><span class="PLUSDOT">+.</span></a> <a href="#local_delay_90"><span class="LIDENT">delay</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">new_sleeps</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_sleeper_93"><span class="LIDENT">sleeper</span></a> <span class="COLONCOLON">::</span> <span class="LIDENT">new_sleeps</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_f_92"><span class="LIDENT">f</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">new_sleeps</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_sleeper_93"><span class="LIDENT">sleeper</span></a> <span class="COLONCOLON">::</span> <span class="LIDENT">new_sleeps</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LAZY">lazy</span><span class="LPAREN">(</span><a href="#local_sleeper_93"><span class="LIDENT">sleeper</span></a><span class="DOT">.</span><span class="LIDENT">stopped</span> <span class="LESSMINUS">&lt;-</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span> <span class="ELSE">else</span> <span class="BEGIN">begin</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_sleeper_95"><span class="LIDENT">sleeper</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <span class="LIDENT">time</span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(+.)"><span class="PLUSDOT">+.</span></a> <a href="#local_delay_90"><span class="LIDENT">delay</span></a><span class="SEMI">;</span> <span class="LIDENT">stopped</span> <span class="EQUAL">=</span> <span class="FALSE">false</span><span class="SEMI">;</span> <span class="LIDENT">action</span> <span class="EQUAL">=</span> <a href="#local_f_92"><span class="LIDENT">f</span></a> <span class="RBRACE">}</span> <span class="IN">in</span><span class="EOL">
</span>      <span class="LIDENT">new_sleeps</span> <span class="LESSMINUS">&lt;-</span> <a href="#local_sleeper_95"><span class="LIDENT">sleeper</span></a> <span class="COLONCOLON">::</span> <span class="LIDENT">new_sleeps</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="LAZY">lazy</span><span class="LPAREN">(</span><a href="#local_sleeper_95"><span class="LIDENT">sleeper</span></a><span class="DOT">.</span><span class="LIDENT">stopped</span> <span class="LESSMINUS">&lt;-</span> <span class="TRUE">true</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_readable</span> <span id="local_fd_96"><span class="LIDENT">fd</span></span> <span id="local_f_97"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_actions_98"><span class="LIDENT">actions</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="TRY">try</span><span class="EOL">
</span>        <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_fd_96"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_readable</span><span class="EOL">
</span>      <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_actions_99"><span class="LIDENT">actions</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">wait_readable</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_fd_96"><span class="LIDENT">fd</span></a> <a href="#local_actions_99"><span class="LIDENT">actions</span></a> <span class="LIDENT">wait_readable</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_actions_99"><span class="LIDENT">actions</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_node_100"><span class="LIDENT">node</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_l</span> <a href="#local_f_97"><span class="LIDENT">f</span></a> <a href="#local_actions_98"><span class="LIDENT">actions</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LAZY">lazy</span><span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_node_100"><span class="LIDENT">node</span></a><span class="SEMI">;</span><span class="EOL">
</span>         <span class="IF">if</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_actions_98"><span class="LIDENT">actions</span></a> <span class="THEN">then</span> <span class="LIDENT">wait_readable</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_fd_96"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_readable</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">register_writable</span> <span id="local_fd_101"><span class="LIDENT">fd</span></span> <span id="local_f_102"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_actions_103"><span class="LIDENT">actions</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="TRY">try</span><span class="EOL">
</span>        <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">find</span> <a href="#local_fd_101"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_writable</span><span class="EOL">
</span>      <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_actions_104"><span class="LIDENT">actions</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">create</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LIDENT">wait_writable</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_fd_101"><span class="LIDENT">fd</span></a> <a href="#local_actions_104"><span class="LIDENT">actions</span></a> <span class="LIDENT">wait_writable</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_actions_104"><span class="LIDENT">actions</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_node_105"><span class="LIDENT">node</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">add_l</span> <a href="#local_f_102"><span class="LIDENT">f</span></a> <a href="#local_actions_103"><span class="LIDENT">actions</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LAZY">lazy</span><span class="LPAREN">(</span><span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_node_105"><span class="LIDENT">node</span></a><span class="SEMI">;</span><span class="EOL">
</span>         <span class="IF">if</span> <span class="UIDENT">Lwt_sequence</span><span class="DOT">.</span><span class="LIDENT">is_empty</span> <a href="#local_actions_103"><span class="LIDENT">actions</span></a> <span class="THEN">then</span> <span class="LIDENT">wait_writable</span> <span class="LESSMINUS">&lt;-</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">remove</span> <a href="#local_fd_101"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_writable</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span class="VIRTUAL">virtual</span> <span id="class-select_based"><span class="LIDENT">select_based</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="LPAREN">(</span><span id="local_self_106"><span class="LIDENT">self</span></span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">select_or_poll_based</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="VIRTUAL">virtual</span> <span class="LIDENT">select</span> <span class="COLON">:</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">float</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="LIDENT">list</span> <span class="STAR">*</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="LIDENT">list</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">iter</span> <span id="local_block_107"><span class="LIDENT">block</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Transfer all sleepers added since the last iteration to the
       main sleep queue: *)</span><span class="EOL">
</span>    <span class="LIDENT">sleep_queue</span> <span class="LESSMINUS">&lt;-</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_q_108"><span class="LIDENT">q</span></span> <span id="local_e_109"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_e_109"><span class="LIDENT">e</span></a> <a href="#local_q_108"><span class="LIDENT">q</span></a><span class="RPAREN">)</span> <span class="LIDENT">sleep_queue</span> <span class="LIDENT">new_sleeps</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">new_sleeps</span> <span class="LESSMINUS">&lt;-</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* Collect file descriptors. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_r_110"><span class="LIDENT">fds_r</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_111"><span class="LIDENT">fd</span></span> <span class="UNDERSCORE">_</span> <span id="local_l_112"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fd_111"><span class="LIDENT">fd</span></a> <span class="COLONCOLON">::</span> <a href="#local_l_112"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="LIDENT">wait_readable</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_w_113"><span class="LIDENT">fds_w</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_114"><span class="LIDENT">fd</span></span> <span class="UNDERSCORE">_</span> <span id="local_l_115"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_fd_114"><span class="LIDENT">fd</span></a> <span class="COLONCOLON">::</span> <a href="#local_l_115"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="LIDENT">wait_writable</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Compute the timeout. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_timeout_116"><span class="LIDENT">timeout</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_block_107"><span class="LIDENT">block</span></a> <span class="THEN">then</span> <span class="LIDENT">get_next_timeout</span> <span class="LIDENT">sleep_queue</span> <span class="ELSE">else</span> <span class="FLOAT">0.</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Do the blocking call *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_160"><span id="local_fds_r_117"><span class="LIDENT">fds_r</span></span><span class="COMMA">,</span> <span id="local_fds_w_118"><span class="LIDENT">fds_w</span></span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="TRY">try</span><span class="EOL">
</span>        <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">select</span> <a href="#local_fds_r_110"><span class="LIDENT">fds_r</span></a> <a href="#local_fds_w_113"><span class="LIDENT">fds_w</span></a> <a href="#local_timeout_116"><span class="LIDENT">timeout</span></a><span class="EOL">
</span>      <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">EINTR</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LPAREN">(</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="COMMA">,</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">EBADF</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* Keeps only bad file descriptors. Actions registered on
           them have to handle the error: *)</span><span class="EOL">
</span>        <span class="LPAREN">(</span><a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LIDENT">bad_fd</span> <a href="#local_fds_r_110"><span class="LIDENT">fds_r</span></a><span class="COMMA">,</span><span class="EOL">
</span>         <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LIDENT">bad_fd</span> <a href="#local_fds_w_113"><span class="LIDENT">fds_w</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Restart threads waiting for a timeout: *)</span><span class="EOL">
</span>    <span class="LIDENT">sleep_queue</span> <span class="LESSMINUS">&lt;-</span> <span class="LIDENT">restart_actions</span> <span class="LIDENT">sleep_queue</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* Restart threads waiting on a file descriptors: *)</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_119"><span class="LIDENT">fd</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">invoke_actions</span> <a href="#local_fd_119"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_readable</span><span class="RPAREN">)</span> <a href="#local_fds_r_117"><span class="LIDENT">fds_r</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_120"><span class="LIDENT">fd</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">invoke_actions</span> <a href="#local_fd_120"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_writable</span><span class="RPAREN">)</span> <a href="#local_fds_w_118"><span class="LIDENT">fds_w</span></a><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span class="VIRTUAL">virtual</span> <span id="class-poll_based"><span class="LIDENT">poll_based</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="LPAREN">(</span><span id="local_self_121"><span class="LIDENT">self</span></span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">select_or_poll_based</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="VIRTUAL">virtual</span> <span class="LIDENT">poll</span> <span class="COLON">:</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="STAR">*</span> <span class="LIDENT">bool</span> <span class="STAR">*</span> <span class="LIDENT">bool</span><span class="RPAREN">)</span> <span class="LIDENT">list</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">float</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">file_descr</span> <span class="STAR">*</span> <span class="LIDENT">bool</span> <span class="STAR">*</span> <span class="LIDENT">bool</span><span class="RPAREN">)</span> <span class="LIDENT">list</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="LIDENT">iter</span> <span id="local_block_122"><span class="LIDENT">block</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="COMMENT">(* Transfer all sleepers added since the last iteration to the
       main sleep queue: *)</span><span class="EOL">
</span>    <span class="LIDENT">sleep_queue</span> <span class="LESSMINUS">&lt;-</span> <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-fold_left"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_q_123"><span class="LIDENT">q</span></span> <span id="local_e_124"><span class="LIDENT">e</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Sleep_queue</span><span class="DOT">.</span><span class="LIDENT">add</span> <a href="#local_e_124"><span class="LIDENT">e</span></a> <a href="#local_q_123"><span class="LIDENT">q</span></a><span class="RPAREN">)</span> <span class="LIDENT">sleep_queue</span> <span class="LIDENT">new_sleeps</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="LIDENT">new_sleeps</span> <span class="LESSMINUS">&lt;-</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* Collect file descriptors. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_125"><span class="LIDENT">fds</span></span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_126"><span class="LIDENT">fds</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_127"><span class="LIDENT">fd</span></span> <span class="UNDERSCORE">_</span> <span id="local_l_128"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_fd_127"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <span class="TRUE">true</span><span class="COMMA">,</span> <span class="FALSE">false</span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_l_128"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="LIDENT">wait_readable</span> <a href="#local_fds_125"><span class="LIDENT">fds</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_129"><span class="LIDENT">fds</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fd_map</span><span class="DOT">.</span><span class="LIDENT">fold</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_fd_130"><span class="LIDENT">fd</span></span> <span class="UNDERSCORE">_</span> <span id="local_l_131"><span class="LIDENT">l</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><a href="#local_fd_130"><span class="LIDENT">fd</span></a><span class="COMMA">,</span> <span class="FALSE">false</span><span class="COMMA">,</span> <span class="TRUE">true</span><span class="RPAREN">)</span> <span class="COLONCOLON">::</span> <a href="#local_l_131"><span class="LIDENT">l</span></a><span class="RPAREN">)</span> <span class="LIDENT">wait_writable</span> <a href="#local_fds_126"><span class="LIDENT">fds</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Compute the timeout. *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_timeout_132"><span class="LIDENT">timeout</span></span> <span class="EQUAL">=</span> <span class="IF">if</span> <a href="#local_block_122"><span class="LIDENT">block</span></a> <span class="THEN">then</span> <span class="LIDENT">get_next_timeout</span> <span class="LIDENT">sleep_queue</span> <span class="ELSE">else</span> <span class="FLOAT">0.</span> <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Do the blocking call *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fds_133"><span class="LIDENT">fds</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="TRY">try</span><span class="EOL">
</span>        <span class="LIDENT">self</span><span class="HASH">#</span><span class="LIDENT">poll</span> <a href="#local_fds_129"><span class="LIDENT">fds</span></a> <a href="#local_timeout_132"><span class="LIDENT">timeout</span></a><span class="EOL">
</span>      <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">EINTR</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">Unix_error</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="UIDENT">EBADF</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* Keeps only bad file descriptors. Actions registered on
           them have to handle the error: *)</span><span class="EOL">
</span>        <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-filter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">filter</span></a> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd_134"><span class="LIDENT">fd</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LIDENT">bad_fd</span> <a href="#local_fd_134"><span class="LIDENT">fd</span></a><span class="RPAREN">)</span> <a href="#local_fds_129"><span class="LIDENT">fds</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Restart threads waiting for a timeout: *)</span><span class="EOL">
</span>    <span class="LIDENT">sleep_queue</span> <span class="LESSMINUS">&lt;-</span> <span class="LIDENT">restart_actions</span> <span class="LIDENT">sleep_queue</span> <span class="LPAREN">(</span><span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">gettimeofday</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>    <span class="COMMENT">(* Restart threads waiting on a file descriptors: *)</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/list.ml.html#val-iter"><span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">iter</span></a><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_fd_135"><span class="LIDENT">fd</span></span><span class="COMMA">,</span> <span id="local_readable_136"><span class="LIDENT">readable</span></span><span class="COMMA">,</span> <span id="local_writable_137"><span class="LIDENT">writable</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="IF">if</span> <a href="#local_readable_136"><span class="LIDENT">readable</span></a> <span class="THEN">then</span> <span class="LIDENT">invoke_actions</span> <a href="#local_fd_135"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_readable</span><span class="SEMI">;</span><span class="EOL">
</span>         <span class="IF">if</span> <a href="#local_writable_137"><span class="LIDENT">writable</span></a> <span class="THEN">then</span> <span class="LIDENT">invoke_actions</span> <a href="#local_fd_135"><span class="LIDENT">fd</span></a> <span class="LIDENT">wait_writable</span><span class="RPAREN">)</span><span class="EOL">
</span>      <a href="#local_fds_133"><span class="LIDENT">fds</span></a><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="CLASS">class</span> <span id="class-select"><span class="LIDENT">select</span></span> <span class="EQUAL">=</span> <span class="OBJECT">object</span><span class="EOL">
</span>  <span class="INHERIT">inherit</span> <span class="LIDENT">select_based</span><span class="EOL">
</span><span class="EOL">
</span>  <span class="METHOD">method</span> <span class="PRIVATE">private</span> <span class="LIDENT">select</span> <span id="local_fds_r_138"><span class="LIDENT">fds_r</span></span> <span id="local_fds_w_139"><span class="LIDENT">fds_w</span></span> <span id="local_timeout_140"><span class="LIDENT">timeout</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="def_163"><span id="local_fds_r_141"><span class="LIDENT">fds_r</span></span><span class="COMMA">,</span> <span id="local_fds_w_142"><span class="LIDENT">fds_w</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Unix</span><span class="DOT">.</span><span class="LIDENT">select</span> <a href="#local_fds_r_138"><span class="LIDENT">fds_r</span></a> <a href="#local_fds_w_139"><span class="LIDENT">fds_w</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="#local_timeout_140"><span class="LIDENT">timeout</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LPAREN">(</span><a href="#local_fds_r_141"><span class="LIDENT">fds_r</span></a><span class="COMMA">,</span> <a href="#local_fds_w_142"><span class="LIDENT">fds_w</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="END">end</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(* +-----------------------------------------------------------------+
   | The current engine                                              |
   +-----------------------------------------------------------------+ *)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-current"><span class="LIDENT">current</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="lwt_features.ml.html#val-_HAVE_LIBEV"><span class="UIDENT">Lwt_config</span><span class="DOT">.</span><span class="LIDENT">_HAVE_LIBEV</span></a> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(&amp;&amp;)"><span class="AMPERAMPER">&amp;&amp;</span></a> <a href="lwt_features.ml.html#val-libev_default"><span class="UIDENT">Lwt_config</span><span class="DOT">.</span><span class="LIDENT">libev_default</span></a> <span class="THEN">then</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><span class="NEW">new</span> <span class="LIDENT">libev</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="COLONGREATER">:&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="ELSE">else</span><span class="EOL">
</span>    <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-ref"><span class="LIDENT">ref</span></a> <span class="LPAREN">(</span><span class="NEW">new</span> <span class="LIDENT">select</span> <span class="COLONGREATER">:&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-get"><span class="LIDENT">get</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-set"><span class="LIDENT">set</span></span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_transfer_143"><span class="LIDENT">transfer</span></span><span class="EQUAL">=</span><span class="TRUE">true</span><span class="RPAREN">)</span> <span class="QUESTION">?</span><span class="LPAREN">(</span><span id="local_destroy_144"><span class="LIDENT">destroy</span></span><span class="EQUAL">=</span><span class="TRUE">true</span><span class="RPAREN">)</span> <span id="local_engine_145"><span class="LIDENT">engine</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_transfer_143"><span class="LIDENT">transfer</span></a> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">transfer</span> <span class="LPAREN">(</span><a href="#local_engine_145"><span class="LIDENT">engine</span></a> <span class="COLON">:</span> <span class="HASH">#</span><span class="LIDENT">t</span> <span class="COLONGREATER">:&gt;</span> <span class="LIDENT">abstract</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_destroy_144"><span class="LIDENT">destroy</span></a> <span class="THEN">then</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">destroy</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="LIDENT">current</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(:=)"><span class="COLONEQUAL">:=</span></a> <span class="LPAREN">(</span><a href="#local_engine_145"><span class="LIDENT">engine</span></a> <span class="COLON">:</span> <span class="HASH">#</span><span class="LIDENT">t</span> <span class="COLONGREATER">:&gt;</span> <span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-iter"><span class="LIDENT">iter</span></span> <span id="local_block_146"><span class="LIDENT">block</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">iter</span> <a href="#local_block_146"><span class="LIDENT">block</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-on_readable"><span class="LIDENT">on_readable</span></span> <span id="local_fd_147"><span class="LIDENT">fd</span></span> <span id="local_f_148"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">on_readable</span> <a href="#local_fd_147"><span class="LIDENT">fd</span></a> <a href="#local_f_148"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-on_writable"><span class="LIDENT">on_writable</span></span> <span id="local_fd_149"><span class="LIDENT">fd</span></span> <span id="local_f_150"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">on_writable</span> <a href="#local_fd_149"><span class="LIDENT">fd</span></a> <a href="#local_f_150"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-on_timer"><span class="LIDENT">on_timer</span></span> <span id="local_delay_151"><span class="LIDENT">delay</span></span> <span id="local_repeat_152"><span class="LIDENT">repeat</span></span> <span id="local_f_153"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">on_timer</span> <a href="#local_delay_151"><span class="LIDENT">delay</span></a> <a href="#local_repeat_152"><span class="LIDENT">repeat</span></a> <a href="#local_f_153"><span class="LIDENT">f</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-fake_io"><span class="LIDENT">fake_io</span></span> <span id="local_fd_154"><span class="LIDENT">fd</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">fake_io</span> <a href="#local_fd_154"><span class="LIDENT">fd</span></a><span class="EOL">
</span><span class="LET">let</span> <span id="val-readable_count"><span class="LIDENT">readable_count</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">readable_count</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-writable_count"><span class="LIDENT">writable_count</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">writable_count</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-timer_count"><span class="LIDENT">timer_count</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">timer_count</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-fork"><span class="LIDENT">fork</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">fork</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-forwards_signal"><span class="LIDENT">forwards_signal</span></span> <span id="local_n_155"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <a href="../../../ocaml-base-compiler/src/stdlib/stdlib.ml.html#val-(!)"><span class="BANG">!</span></a><span class="LIDENT">current</span><span class="HASH">#</span><span class="LIDENT">forwards_signal</span> <a href="#local_n_155"><span class="LIDENT">n</span></a><span class="EOL">
</span><span class="EOL">
</span><span id="module-Versioned"><span class="MODULE">module</span> <span class="UIDENT">Versioned</span> <span class="EQUAL">=</span><span class="EOL">
</span><span class="STRUCT">struct</span><span class="EOL">
</span>  <span class="CLASS">class</span> <span id="module-Versioned.class-libev_1"><span class="LIDENT">libev_1</span></span> <span class="EQUAL">=</span> <span class="LIDENT">libev_deprecated</span><span class="EOL">
</span>  <span class="CLASS">class</span> <span id="module-Versioned.class-libev_2"><span class="LIDENT">libev_2</span></span> <span class="EQUAL">=</span> <span class="LIDENT">libev</span><span class="EOL">
</span><span class="END">end</span></span><span class="EOL">
</span></span></code></pre></body></html>
